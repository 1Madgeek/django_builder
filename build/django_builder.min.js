<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
function TarballFactory(){return function(){function a(){var a=this,b=require("tar-js"),c=new b;a.uInt8ToString=function(a){var b,c,d="";for(b=0,c=a.length;c>b;b+=1)d+=String.fromCharCode(a[b]);return d},a.append=function(a,b){c.append(a,b)},a.get_url=function(b){var d=btoa(a.uInt8ToString(c.out));return"data:application/tar;base64,"+d}}return new a}}function ModelRenderFactory(){return function(a){var b=this;b.built_in_models=a,b.spaces=function(a){var b=a||1;return new Array(b+1).join(" ")},b.model_names=function(a,b){var c=b||"";return Object.keys(a).map(function(b){return a[b].name+c})},b.new_lines=function(a){var b=a||1;return new Array(b+1).join("\n")},b.render_all=function(a,c){var d="";return d+=b.render_base_html(a,c),d+=b.render_forms_py(a,c),d+=b.render_urls_py(a,c),d+=b.render_admin_py(a,c),d+=b.render_views_py(a,c),d+=b.render_models_py(a,c),d+=b.render_django_rest_framework_api_py(a,c),d+=b.render_django_rest_framework_serializers_py(a,c),d+=b.render_templates_html(a,c)},b.render_base_html=function(a,b){return"<html><head></head><body>{% block content %}Replace this.{% endblock %}</body>"},b.pre_imported_modules=function(a){return{"django.contrib.auth.models":{as:"auth_models"},"django.db.models":{as:"models"},"django_extensions.db.fields":{as:"extension_fields"}}},b.pre_imported_modules_names=function(a){return Object.keys(b.pre_imported_modules())},b.render_forms_py=function(a,c){var d="from django import forms\n";return d+="from .models import "+b.model_names(c,"").join(", ")+"\n",d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_forms(a,b)}),d},b.render_tests_py=function(a,c){var d="import unittest\nfrom django.core.urlresolvers import reverse\nfrom django.test import Client\n";return d+="from .models import "+b.model_names(c,"").join(", ")+"\n",jQuery.each(b.built_in_models,function(a,c){var e=a.split("."),f=e.pop(),g=e.join(".");d+="from "+g+" import "+f,d+=b.new_lines(1)}),d+=b.new_lines(2),jQuery.each(b.built_in_models,function(a,c){var e="create_"+a.toLowerCase().replace(/\./g,"_"),f=a.split(".").pop(),g="";g+="def "+e+"(**kwargs):\n",g+=b.spaces(4)+"defaults = {}\n",jQuery.each(c.fields,function(a,c){g+=b.spaces(4)+'defaults["'+a+'"] = "'+c["default"]+'"\n'}),g+=b.spaces(4)+"defaults.update(**kwargs)\n",g+=b.spaces(4)+"return "+f+".objects.create(**defaults)\n",g+=b.new_lines(2),d+=g}),jQuery.each(c,function(c,e){d+=e.render_tests_helpers(a,b)}),jQuery.each(c,function(c,e){d+=e.render_tests(a,b)}),d},b.render_urls_py=function(a,c){var d="from django.conf.urls import url, include\n";return d+="from rest_framework import routers"+b.new_lines(1),d+="import api"+b.new_lines(1),d+="import views"+b.new_lines(2),d+="router = routers.DefaultRouter()"+b.new_lines(1),jQuery.each(c,function(a,c){d+="router.register(r'"+c.l_name()+"', api."+c.name+"ViewSet)"+b.new_lines(1)}),d+=b.new_lines(2),d+="urlpatterns = ("+b.new_lines(1),d+=b.spaces(4)+"# urls for Django Rest Framework API"+b.new_lines(1),d+=b.spaces(4)+"url(r'^api/v1/', include(router.urls)),"+b.new_lines(1),d+=")"+b.new_lines(1),d+=b.new_lines(1),jQuery.each(c,function(c,e){d+=e.render_urls(a,b)}),d},b.render_admin_py=function(a,c){var d="from django.contrib import admin\nfrom django import forms\n";return d+="from .models import "+b.model_names(c).join(", "),d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_admin_classes(a,b)}),d},b.render_views_py=function(a,c){var d="from django.views.generic import DetailView, ListView, UpdateView, CreateView\n";return d+="from .models import "+b.model_names(c).join(", "),d+=b.new_lines(1),d+="from .forms import "+b.model_names(c,"Form").join(", "),d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_view_classes(a,b)}),d},b.render_models_py=function(a,c){var d="from django.core.urlresolvers import reverse\n";d+="from django_extensions.db.fields import AutoSlugField\n",d+="from django.db.models import *\n",d+="from django.conf import settings\n",d+="from django.contrib.contenttypes.fields import GenericForeignKey\n",d+="from django.contrib.contenttypes.models import ContentType\n",d+="from django.contrib.auth import get_user_model\n",jQuery.each(b.pre_imported_modules(),function(a,b){var c=a.split("."),e=c.pop();d+="from "+c.join(".")+" import "+e+" as "+b.as+"\n"});var e={};jQuery.each(c,function(a,b){jQuery.each(b.fields,function(a,b){e[b.module()]=b.module()})});var f={};return jQuery.each(c,function(a,b){jQuery.each(b.fields,function(a,b){f[b.type]=b}),jQuery.each(b.relationships,function(a,b){f[b.type]=b})}),jQuery.each(f,function(a,b){}),d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_model_class(a,b)}),d},b.render_templates_html=function(a,b){var c=[];return jQuery.each(b,function(b,d){c.push([d.l_name()+"_form.html",d.render_form_html(a)]),c.push([d.l_name()+"_detail.html",d.render_detail_html(a)]),c.push([d.l_name()+"_list.html",d.render_list_html(a)])}),c},b.render_django_rest_framework_api_py=function(a,c){var d="import models\n";return d+="import serializers\n",d+="from rest_framework import viewsets, permissions\n",d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_model_api(a,b)}),d},b.render_django_rest_framework_serializers_py=function(a,c){var d="import models";return d+=b.new_lines(2),d+="from rest_framework import serializers",d+=b.new_lines(3),jQuery.each(c,function(c,e){d+=e.render_model_serializer(a,b)}),d}}}function MessageServiceFactory(){return function(){var a=this;a.base_modal=function(){var a=jQuery("<div>").addClass("modal fade");a.attr("tabindex","-1"),a.attr("role","dialog"),a.css("display","none");var b=jQuery("<div>").addClass("modal-dialog"),c=jQuery("<div>").addClass("modal-content").appendTo(b),d=jQuery("<h2>").addClass("modal-header-inner");return jQuery("<div>").addClass("modal-header").appendTo(c).append(d),jQuery("<div>").addClass("modal-body").appendTo(c),jQuery("<div>").addClass("modal-footer").appendTo(c),a.append(b),a},a.icon=function(a){return jQuery("<icon>").addClass("fa").addClass(a)},a.simple_error=function(b,c){var d=a.base_modal(),e=a.icon("fa-info").addClass("pull-right");d.find(".modal-header-inner").append(e).append(jQuery("<span>").text(b)),d.find(".modal-body").empty().append(c);var f=jQuery("<button>").addClass("btn btn-default").text("Ok");return d.find(".modal-footer").append(f),f.attr("data-dismiss","modal"),d.modal(),d},a.simple_info=function(b,c){var d=a.base_modal(),e=a.icon("fa-info").addClass("pull-right");d.find(".modal-header-inner").append(e).append(jQuery("<span>").text(b)),d.find(".modal-body").empty().append(c);var f=jQuery("<button>").addClass("btn btn-default").text("Ok");return d.find(".modal-footer").append(f),f.attr("data-dismiss","modal"),d.modal(),d},a.simple_confirm=function(b,c,d){var e=d||jQuery.noop,f=a.base_modal();f.find(".modal-header-inner").html(b),f.find(".modal-body").empty().append(c);var g=jQuery("<button>").addClass("btn btn-primary").text("Ok"),h=jQuery("<button>").addClass("btn btn-default").text("Cancel");return f.find(".modal-footer").append(g).append(h),g.click(function(){e()}),h.attr("data-dismiss","modal"),g.attr("data-dismiss","modal"),f.modal(),f},a.simple_choice=function(b,c,d){var e=a.base_modal();return e.find(".modal-header-inner").html(b),e.find(".modal-body").empty().append(c),jQuery.each(d,function(a,b){var c=jQuery("<button>").addClass("btn btn-primary").text(b.text);e.find(".modal-footer").append(c),c.click(function(){b.callback()}),c.attr("data-dismiss","modal")}),e.modal(),e},a.simple_form=function(b,c,d,e,f){var g=e||jQuery.noop,h=f||!0,i=a.base_modal();i.find(".modal-header-inner").html(b),i.find(".modal-body").empty().append(c).append(d);var j=jQuery("<button>").addClass("btn btn-primary").text("Ok"),k=jQuery("<button>").addClass("btn btn-default").text("Cancel");return i.find(".modal-footer").append(j).append(k),j.click(function(){h||i.modal("hide"),g(d)}),k.attr("data-dismiss","modal"),h||j.attr("data-dismiss","modal"),i.modal(),i},a.simple_form_no_dismiss=function(b,c,d,e){return a.simple_form(b,c,d,e,!0)},a.simple_input=function(b,c,d,e,f){var g=e||jQuery.noop,h=f||!1,i=a.base_modal();i.find(".modal-header-inner").html(b);var j=jQuery("<label>").text(c),k=jQuery("<input>").attr("type","text").attr("name","input").addClass("form-control").attr("value",d),l=jQuery("<span>").text("error message").addClass("help-block hide"),m=jQuery("<div>").addClass("form-group form-group-input has-feedback").append(j).append(k).append(l),n=function(){var a=k.val();!h||""!=a&&void 0!=k?(i.modal("hide"),g(a)):m.addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text("Field Required")},o=jQuery("<form>").append(m).submit(function(a){a.preventDefault(),n()});i.find(".modal-body").empty().append(o);var p=jQuery("<button>").addClass("btn btn-primary").text("Ok"),q=jQuery("<button>").addClass("btn btn-default").text("Cancel");return i.find(".modal-footer").append(p).append(q),p.click(n),q.attr("data-dismiss","modal"),h||p.attr("data-dismiss","modal"),i.modal(),i}}}function RelationshipFactory(){return function(a){function b(a){this.name=a.name,this.type=a.type,this.opts=a.opts,this.to=a.to,this.external_app=a.external_app||!1,this.class_name=function(){return this.type.split(".").reverse()[0]},this.form_update=function(a){this.name=jQuery(a).find("input[name=name]").val(),this.type=jQuery(a).find("select[name=type]").val(),this.opts=jQuery(a).find("input[name=opts]").val(),this.to=jQuery(a).find("input[name=to]").val()},this.to_clean=function(){return this.to.replace(/['"]+/g,"")},this.to_class=function(){return this.to.split(".").reverse().shift()},this.opts_args=function(){return this.opts.split(",").join(", ")},this.to_module=function(){var a=this.to.split(".");return a.slice(0,a.length-1).join(".")},this.module=function(){var a=this.type.split(".");return a.slice(0,a.length-1).join(".")},this.edit_form=function(a){var b=jQuery("<form>"),c=jQuery("<div>").addClass("form-group form-group-name has-feedback").appendTo(b),d=jQuery("<div>").addClass("form-group form-group-type").appendTo(b),e=jQuery("<div>").addClass("form-group form-group-args").appendTo(b),f=jQuery("<div>").addClass("form-group form-group-args").appendTo(b);c.append(jQuery("<label>").text("Name")),c.append(jQuery("<input>").attr("name","name").addClass("form-control").val(this.name)),c.append(jQuery("<span>").text("error message").addClass("help-block hide")),d.append(jQuery("<label>").text("To")),d.append(jQuery("<input>").attr("name","to").attr("placeholder","to").addClass("form-control").val(this.to));var g=jQuery("<select>").attr("name","type").addClass("form-control"),h=this;return jQuery.each(a.relationship_factory.relationship_types(),function(a,b){var c=jQuery("<option>").attr("val",b).text(b);b==h.type&&c.attr("selected","selected"),g.append(c)}),e.append(jQuery("<label>").text("Field Type")),e.append(g),f.append(jQuery("<label>").text("Arguments")),f.append(jQuery("<input>").attr("name","opts").attr("placeholder","options").addClass("form-control").val(this.args)),b}}var c=this;c.relationship_types=function(){return["django.db.models.ForeignKey","django.db.models.OneToOneField","django.db.models.ManyToManyField"]},c.relationship_matches=function(){return c.relationship_types+["ForeignKey","OneToOneField","ManyToManyField","models.ForeignKey","models.OneToOneField","models.ManyToManyField"]},c.relationship_match=function(a){return-1!=c.relationship_matches().indexOf(a)},c.make_relationship=function(a){return new b(a)}}}function FieldFactory(){return function(a){function b(a){this.name=a.name,this.type=a.type,this.opts=a.opts||"",this.class_name=function(){return this.type.split(".").reverse()[0]},this.opts_args=function(){return this.opts.split(",").join(", ")},this.to_clean=function(){return this.to.replace(/['"]+/g,"")},this.module=function(){var a=this.type.split(".");return a.slice(0,a.length-1).join(".")},this.form_update=function(a){this.name=jQuery(a).find("input[name=name]").val(),this.type=jQuery(a).find("select[name=type]").val(),this.opts=jQuery(a).find("input[name=opts]").val()},this.edit_form=function(a){var b=jQuery("<form>"),c=jQuery("<div>").addClass("form-group form-group-name has-feedback").appendTo(b),d=jQuery("<div>").addClass("form-group form-group-type").appendTo(b),e=jQuery("<div>").addClass("form-group form-group-args").appendTo(b);c.append(jQuery("<label>").text("Name")),c.append(jQuery("<input>").attr("name","name").addClass("form-control").val(this.name)),c.append(jQuery("<span>").text("error message").addClass("help-block hide"));var f=jQuery("<select>").attr("name","type").addClass("form-control"),g=this;return jQuery.each(a.field_factory.field_types(),function(a,b){var c=jQuery("<option>").attr("val",b).text(b);b==g.type&&c.attr("selected","selected"),f.append(c)}),d.append(jQuery("<label>").text("Field Type")),d.append(f),e.append(jQuery("<label>").text("Arguments")),e.append(jQuery("<input>").attr("name","opts").attr("placeholder","options").addClass("form-control").val(this.opts)),b}}var c=this;c.fields=function(){return{"django.db.models.TextField":{default_args:"max_length=100"},"django.db.models.CharField":{default_args:"max_length=30"},"django.contrib.contenttypes.fields.GenericForeignKey":{default_args:'"content_type", "object_id"'},"django_extensions.db.fields.AutoSlugField":{},"django.db.models.CommaSeparatedIntegerField":{},"django.db.models.BigAutoField":{},"django.db.models.BigIntegerField":{},"django.db.models.BooleanField":{},"django.db.models.DateField":{},"django.db.models.DateTimeField":{},"django.db.models.DecimalField":{default_args:"max_digits=10, decimal_places=2"},"django.db.models.DurationField":{},"django.db.models.FilePathField":{},"django.db.models.FloatField":{},"django.db.models.IntegerField":{},"django.db.models.PositiveIntegerField":{},"django.db.models.PositiveSmallIntegerField":{},"django.db.models.SlugField":{},"django.db.models.IPAddressField":{},"django.db.models.GenericIPAddressField":{},"django.db.models.NullBooleanField":{},"django.db.models.TimeField":{},"django.db.models.BinaryField":{},"django.db.models.AutoField":{},"django.db.models.SmallIntegerField":{},"django.db.models.URLField":{},"django.db.models.UUIDField":{},"django.db.models.EmailField":{}}},c.default_field_args=function(a){var b=c.fields()[a];return b&&b.default_args?b.default_args:""},c.field_types=function(){return Object.keys(c.fields())},c.make_field=function(a){return new b(a)}}}function ModelServiceFactory(){return function(a,b){function c(a){this.slugify=function(a){return a.toString().replace(/\s+/g,"").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"").replace(/^-+/,"").replace(/-+$/,"")},this.set_name=function(a){this.name=this.slugify(a)},this.set_name(a.name),this.fields=[];a.fields||[];this.fields=(a.fields||[]).map(b.field_factory.make_field),this.relationships=(a.relationships||[]).map(b.relationship_factory.make_relationship),this.relationship_names=function(){var a=this;return Object.keys(a.relationships).map(function(b){return a.relationships[b].name})},this.field_names=function(){var a=this;return Object.keys(a.fields).map(function(b){return a.fields[b].name})},this.l_name=function(){return this.name.toLowerCase()},this.has_relationship=function(a){return-1!=this.relationship_names().indexOf(a)},this.has_field=function(a){return-1!=this.field_names().indexOf(a)},this.name_field=function(){return-1!=this.field_names().indexOf("name")?"name":"id"},this.ordering_field=function(){return-1!=this.field_names().indexOf("created")?"created":"id"},this.identifier=function(){return-1!=this.field_names().indexOf("slug")?"slug":"id"},this.render_forms=function(a,b){var c="";return c+="class "+this.name+"Form(forms.ModelForm):\n",c+=b.spaces(4)+"class Meta:\n",c+=b.spaces(8)+"model = "+this.name+"\n",this.form_fields()&&(c+=b.spaces(8)+"fields = "+this.form_fields()+"\n"),c+=b.new_lines(2)},this.get_initial_data=function(a,b){var c="{";return c+=b.new_lines(1),jQuery.each(this.readable_fields(),function(a,d){c+=b.spaces(12)+'"'+d.name+'": "'+d.name+'",',c+=b.new_lines(1)}),jQuery.each(this.relationships,function(a,d){c+=b.spaces(12)+'"'+d.name+'": create_'+d.to.toLowerCase().replace(/\./g,"_")+"().id,",c+=b.new_lines(1)}),c+=b.spaces(8)+"}"},this.render_tests_helpers=function(a,b){var c="";return c+="def create_"+this.l_name()+"(**kwargs):\n",c+=b.spaces(4)+"defaults = {}\n",jQuery.each(this.readable_fields(),function(a,d){c+=b.spaces(4)+'defaults["'+d.name+'"] = "'+d.name+'"\n'}),c+=b.spaces(4)+"defaults.update(**kwargs)\n",jQuery.each(this.relationships,function(a,d){c+=b.spaces(4)+'if "'+d.name+'" not in defaults:\n';var e="create_"+d.to.toLowerCase().replace(/\./g,"_");b.built_in_models[d.to]&&(e="create_"+d.to.toLowerCase().replace(/\./g,"_")),c+=b.spaces(8)+'defaults["'+d.name+'"] = '+e+"()\n"}),c+=b.spaces(4)+"return "+this.name+".objects.create(**defaults)\n",c+=b.new_lines(2)},this.render_tests=function(a,b){var c="";return c+="class "+this.name+"ViewTest(unittest.TestCase):\n",c+=b.spaces(4)+"'''\n",c+=b.spaces(4)+"Tests for "+this.name+"\n",c+=b.spaces(4)+"'''\n",c+=b.spaces(4)+"def setUp(self):\n",c+=b.spaces(8)+"self.client = Client()\n",c+=b.new_lines(1),c+=b.spaces(4)+"def test_list_"+this.l_name()+"(self):\n",c+=b.spaces(8)+"url = reverse('"+a+"_"+this.l_name()+"_list')\n",c+=b.spaces(8)+"response = self.client.get(url)\n",c+=b.spaces(8)+"self.assertEqual(response.status_code, 200)\n",c+=b.new_lines(1),c+=b.spaces(4)+"def test_create_"+this.l_name()+"(self):\n",c+=b.spaces(8)+"url = reverse('"+a+"_"+this.l_name()+"_create')\n",c+=b.spaces(8)+"data = "+this.get_initial_data(a,b)+"\n",c+=b.spaces(8)+"response = self.client.post(url, data=data)\n",c+=b.spaces(8)+"self.assertEqual(response.status_code, 302)\n",c+=b.new_lines(1),c+=b.spaces(4)+"def test_detail_"+this.l_name()+"(self):\n",c+=b.spaces(8)+this.l_name()+" = create_"+this.l_name()+"()\n",c+=b.spaces(8)+"url = reverse('"+a+"_"+this.l_name()+"_detail', args=["+this.l_name()+"."+this.identifier()+",])\n",c+=b.spaces(8)+"response = self.client.get(url)\n",c+=b.spaces(8)+"self.assertEqual(response.status_code, 200)\n",c+=b.new_lines(1),c+=b.spaces(4)+"def test_update_"+this.l_name()+"(self):\n",c+=b.spaces(8)+this.l_name()+" = create_"+this.l_name()+"()\n",c+=b.spaces(8)+"data = "+this.get_initial_data(a,b)+"\n",c+=b.spaces(8)+"url = reverse('"+a+"_"+this.l_name()+"_update', args=["+this.l_name()+"."+this.identifier()+",])\n",c+=b.spaces(8)+"response = self.client.post(url, data)\n",c+=b.spaces(8)+"self.assertEqual(response.status_code, 302)\n",c+=b.new_lines(2)},this.render_urls=function(a,b){var c="";return c+="urlpatterns += (\n",c+=b.spaces(4)+"# urls for "+this.name+"\n",c+=b.spaces(4)+"url(r'^"+a+"/"+this.l_name()+"/$', views."+this.name+"ListView.as_view(), name='"+a+"_"+this.l_name()+"_list'),\n",c+=b.spaces(4)+"url(r'^"+a+"/"+this.l_name()+"/create/$', views."+this.name+"CreateView.as_view(), name='"+a+"_"+this.l_name()+"_create'),\n",c+=b.spaces(4)+"url(r'^"+a+"/"+this.l_name()+"/detail/(?P<"+this.identifier()+">\\S+)/$', views."+this.name+"DetailView.as_view(), name='"+a+"_"+this.l_name()+"_detail'),\n",c+=b.spaces(4)+"url(r'^"+a+"/"+this.l_name()+"/update/(?P<"+this.identifier()+">\\S+)/$', views."+this.name+"UpdateView.as_view(), name='"+a+"_"+this.l_name()+"_update'),\n",c+=")\n",c+=b.new_lines(1)},this.render_admin_classes=function(a,b){var c="";c+="class "+this.name+"AdminForm(forms.ModelForm):\n",c+=b.new_lines(1),c+=b.spaces(4)+"class Meta:\n",c+=b.spaces(8)+"model = "+this.name+"\n",c+=b.spaces(8)+"fields = '__all__'\n",c+=b.new_lines(2),c+="class "+this.name+"Admin(admin.ModelAdmin):\n",c+=b.spaces(4)+"form = "+this.name+"AdminForm\n";var d=this.admin_fields();return d.length>0?(c+=b.spaces(4)+"list_display = "+this.admin_fields()+"\n",c+=b.spaces(4)+"readonly_fields = "+this.admin_read_only_fields()+"\n"):c+=b.new_lines(1),c+=b.new_lines(1),c+="admin.site.register("+this.name+", "+this.name+"Admin)\n",c+=b.new_lines(2)},this.render_view_classes=function(a,b){var c=b.new_lines(1);return c+="class "+this.name+"ListView(ListView):\n",c+=b.spaces(4)+"model = "+this.name+"\n",c+=b.new_lines(2),c+="class "+this.name+"CreateView(CreateView):\n",c+=b.spaces(4)+"model = "+this.name+"\n",c+=b.spaces(4)+"form_class = "+this.name+"Form\n",c+=b.new_lines(2),c+="class "+this.name+"DetailView(DetailView):\n",c+=b.spaces(4)+"model = "+this.name+"\n",c+=b.new_lines(2),c+="class "+this.name+"UpdateView(UpdateView):\n",c+=b.spaces(4)+"model = "+this.name+"\n",c+=b.spaces(4)+"form_class = "+this.name+"Form",c+=b.new_lines(2)},this.render_model_class_header=function(a,b){var c="class "+this.name+"(models.Model):";return c+b.new_lines(2)},this.render_model_class_fields=function(a,b){var c="";return this.fields.length>0&&(c+=b.spaces(4)+"# Fields",c+=b.new_lines(1)),jQuery.each(this.fields,function(a,d){if(-1==b.pre_imported_modules_names().indexOf(d.module()))c+=b.spaces(4)+d.name+" = "+d.class_name()+"("+d.opts+")";else{var e=b.pre_imported_modules()[d.module()].as;c+=b.spaces(4)+d.name+" = "+e+"."+d.class_name()+"("+d.opts+")"}c+=b.new_lines(1)}),c+=b.new_lines(1)},this.render_model_class_relationships=function(a,c){var d="";return this.relationships.length>0&&(d+=c.spaces(4)+"# Relationship Fields",d+=c.new_lines(1)),jQuery.each(this.relationships,function(e,f){var g="'"+a+"."+f.to_clean()+"'";if(f.external_app&&(g="'"+f.to_clean()+"'"),f.to==b.user_model?g=b.user_model_setting:c.built_in_models[f.to]&&(g=f.to_class()),-1==c.pre_imported_modules_names().indexOf(f.module()))d+=c.spaces(4)+f.name+" = "+f.class_name()+"("+g+", "+f.opts+")";else{var h=c.pre_imported_modules()[f.module()].as;d+=c.spaces(4)+f.name+" = "+h+"."+f.class_name()+"("+g+", "+f.opts+")"}d+=c.new_lines(1)}),d},this.render_model_class=function(a,b){var c=this.render_model_class_header(a,b);return c+=this.render_model_class_fields(a,b),c+=this.render_model_class_relationships(a,b),c+=b.new_lines(1),c+=b.spaces(4)+"class Meta:",c+=b.new_lines(1),c+=b.spaces(8)+"ordering = ('-"+this.ordering_field()+"',)",c+=b.new_lines(2),c+=b.spaces(4)+"def __unicode__(self):",c+=b.new_lines(1),c+=b.spaces(8)+"return u'%s' % self."+this.identifier(),c+=b.new_lines(2),c+=b.spaces(4)+"def get_absolute_url(self):",c+=b.new_lines(1),c+=b.spaces(8)+"return reverse('"+a+"_"+this.l_name()+"_detail', args=(self."+this.identifier()+",))",c+=b.new_lines(1),c+=b.new_lines(2),c+=b.spaces(4)+"def get_update_url(self):",c+=b.new_lines(1),c+=b.spaces(8)+"return reverse('"+a+"_"+this.l_name()+"_update', args=(self."+this.identifier()+",))",c+=b.new_lines(3)},this.render_model_class_fields_only=function(a,b){var c="";return c+=this.render_model_class_header(a,b),c+=this.render_model_class_fields(a,b)},this.render_model_api=function(a,b){var c="class "+this.name+"ViewSet(viewsets.ModelViewSet):"+b.new_lines(1);return c+=b.spaces(4)+'"""ViewSet for the '+this.name+' class"""',c+=b.new_lines(2),c+=b.spaces(4)+"queryset = models."+this.name+".objects.all()"+b.new_lines(1),c+=b.spaces(4)+"serializer_class = serializers."+this.name+"Serializer"+b.new_lines(1),c+=b.spaces(4)+"permission_classes = [permissions.IsAuthenticated]"+b.new_lines(1),c+=b.new_lines(2)},this.render_model_serializer=function(a,b){var c="class "+this.name+"Serializer(serializers.ModelSerializer):";c+=b.new_lines(2),c+=b.spaces(4)+"class Meta:"+b.new_lines(1),c+=b.spaces(8)+"model = models."+this.name+b.new_lines(1),c+=b.spaces(8)+"fields = ("+b.new_lines(1),c+=b.spaces(12)+"'"+this.identifier()+"', "+b.new_lines(1);var d=this;return jQuery.each(this.fields,function(a,e){e.name!=d.identifier()&&(c+=b.spaces(12)+"'"+e.name+"', "+b.new_lines(1))}),c+=b.spaces(8)+")"+b.new_lines(3)},this._template_header=function(){return'{% extends "base.html" %}\n{% load static %}\n'},this._template_links=function(a){var b=a+"_"+this.l_name()+"_list";return'<p><a class="btn btn-default" href="{% url \''+b+"' %}\">"+this.name+" Listing</a></p>\n"},this._wrap_block=function(a,b){return"{% block "+a+" %}\n"+b+"\n{% endblock %}"},this.render_form_html=function(a){var b=this._template_header();b+="{% load crispy_forms_tags %}\n";var c=this._template_links(a)+'<form method="post">\n';return c+="{% csrf_token %}\n{{form|crispy}}\n",c+='<button class="btn btn-primary" type="submit">Submit</button>\n',c+="</form>",b+=this._wrap_block("content",c)},this.render_list_html=function(a){var b=a+"_"+this.l_name()+"_create",c=this._template_header(),d=this._template_links(a)+'<table class="table">\n';return d+="<tr>\n",d+="<td>ID</td><td>Link</td>\n",jQuery.each(this.fields,function(a,b){d+="    <td>"+b.name+"</td>\n"}),d+="</tr>\n",d+="{% for object in object_list %}\n",d+="<tr>\n",d+="    <td>{{object.id}}</td>\n",d+='    <td><a href="{{object.get_absolute_url}}">{{object}}</a></td>\n',jQuery.each(this.fields,function(a,b){d+="    <td>{{ object."+b.name+" }}</td>\n"}),d+="</tr>\n",d+="{% endfor %}\n",d+="</table>",d+='<a class="btn btn-primary" href="{% url \''+b+"' %}\">Create new "+this.name+"</a>",c+=this._wrap_block("content",d)},this.render_detail_html=function(a){var b=this._template_header(),c=this._template_links(a)+'<table class="table">\n';return jQuery.each(this.fields,function(a,b){c+="<tr><td>"+b.name+"</td><td>{{ object."+b.name+" }}</td></tr>\n"}),c+="</table>",c+='\n<a class="btn btn-primary" href="{{object.get_update_url}}">Edit '+this.name+"</a>\n",b+=this._wrap_block("content",c)},this.form_fields=function(){var a=this.readable_fields().map(function(a){return a.name}),b=this.relationships.map(function(a){return a.name}),c=a.concat(b);return c.length?"['"+c.join("', '")+"']":"'__all__'"},this.readable_fields=function(){var a=[];return jQuery.each(this.fields,function(b,c){-1==c.opts.indexOf("readonly")&&-1==c.opts.indexOf("editable")&&-1==c.opts.indexOf("auto_now_add")&&"django.contrib.contenttypes.fields.GenericForeignKey"!=c.type&&"django_extensions.db.fields.AutoSlugField"!=c.type&&a.push(c)}),a},this.admin_fields=function(){return this.field_names().length>0?"['"+this.field_names().join("', '")+"']":""},this.admin_read_only_fields=function(){return this.field_names().length>0?"['"+this.field_names().join("', '")+"']":""}}return new c(a)}}function ModelParserFactory(){return function(a){function b(){this.parse=function(b,c){var d=new FileReader;d.onload=function(b){var e=d.result,f=e.split("\n"),g=[],h=null,i="",j=new RegExp("class ([a-zA-Z_]*)[(]([a-zA-Z._]*)[)][:]$"),k=new RegExp("^([a-zA-Z0-9_]+) = ([a-zA-Z0-9._]+)[(](.*)[)]$");jQuery.each(f,function(b,c){c=c.trim();var d=j.exec(c);d&&d[2].match(/model/i)&&(console.log("Model:",d[1]),h={name:d[1],"class":d[2],fields:[],relationships:[]},g.push(h),i="");var e,f=k.exec(c);f&&(e=f);var l=k.exec(i);if(l&&(e=l),e){if(h&&e[2]&&(e[2].match(/field/i)||a.relationship_factory.relationship_match(e[2]))){var m=a.relationship_factory.relationship_match(e[2]);if(m){var n=e[1],o=e[2],p=e[3].split(","),q=p.shift(),r=p.join(",").trim();console.log("Model:",h.name,"Relationship:",n,o,q,r),h.relationships.push(a.relationship_factory.make_relationship({name:n,type:o,opts:r,to:q}))}else{var s=e[1],t=e[2],u=e[3];console.log("Model:",h.name,"Field:",s,t,u),h.fields.push(a.field_factory.make_field({name:s,type:t,opts:u}))}}i=""}else h&&(i+=c)});var l=[];jQuery.each(g,function(b,c){var d=a.model_factory(c,a);l.push(d)}),c&&c(l)},d.readAsText(b)}}return new b}}ace.define("ace/mode/python",["require","exports","module","ace/lib/oop","ace/mode/text","ace/tokenizer","ace/mode/python_highlight_rules","ace/mode/folding/pythonic","ace/range"],function(a,b,c){var d=a("../lib/oop"),e=a("./text").Mode,f=(a("../tokenizer").Tokenizer,a("./python_highlight_rules").PythonHighlightRules),g=a("./folding/pythonic").FoldMode,h=a("../range").Range,i=function(){this.HighlightRules=f,this.foldingRules=new g("\\:")};d.inherits(i,e),function(){this.lineCommentStart="#",this.getNextLineIndent=function(a,b,c){var d=this.$getIndent(b),e=this.getTokenizer().getLineTokens(b,a),f=e.tokens;if(f.length&&"comment"==f[f.length-1].type)return d;if("start"==a){var g=b.match(/^.*[\{\(\[\:]\s*$/);g&&(d+=c)}return d};var a={pass:1,"return":1,raise:1,"break":1,"continue":1};this.checkOutdent=function(b,c,d){if("\r\n"!==d&&"\r"!==d&&"\n"!==d)return!1;var e=this.getTokenizer().getLineTokens(c.trim(),b).tokens;if(!e)return!1;do var f=e.pop();while(f&&("comment"==f.type||"text"==f.type&&f.value.match(/^\s+$/)));return f?"keyword"==f.type&&a[f.value]:!1},this.autoOutdent=function(a,b,c){c+=1;var d=this.$getIndent(b.getLine(c)),e=b.getTabString();d.slice(-e.length)==e&&b.remove(new h(c,d.length-e.length,c,d.length))},this.$id="ace/mode/python"}.call(i.prototype),b.Mode=i}),ace.define("ace/mode/python_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/text_highlight_rules"],function(a,b,c){var d=a("../lib/oop"),e=a("./text_highlight_rules").TextHighlightRules,f=function(){var a="and|as|assert|break|class|continue|def|del|elif|else|except|exec|finally|for|from|global|if|import|in|is|lambda|not|or|pass|print|raise|return|try|while|with|yield",b="True|False|None|NotImplemented|Ellipsis|__debug__",c="abs|divmod|input|open|staticmethod|all|enumerate|int|ord|str|any|eval|isinstance|pow|sum|basestring|execfile|issubclass|print|super|binfile|iter|property|tuple|bool|filter|len|range|type|bytearray|float|list|raw_input|unichr|callable|format|locals|reduce|unicode|chr|frozenset|long|reload|vars|classmethod|getattr|map|repr|xrange|cmp|globals|max|reversed|zip|compile|hasattr|memoryview|round|__import__|complex|hash|min|set|apply|delattr|help|next|setattr|buffer|dict|hex|object|slice|coerce|dir|id|oct|sorted|intern",d=this.createKeywordMapper({"invalid.deprecated":"debugger","support.function":c,"constant.language":b,keyword:a},"identifier"),e="(?:r|u|ur|R|U|UR|Ur|uR)?",f="(?:(?:[1-9]\\d*)|(?:0))",g="(?:0[oO]?[0-7]+)",h="(?:0[xX][\\dA-Fa-f]+)",i="(?:0[bB][01]+)",j="(?:"+f+"|"+g+"|"+h+"|"+i+")",k="(?:[eE][+-]?\\d+)",l="(?:\\.\\d+)",m="(?:\\d+)",n="(?:(?:"+m+"?"+l+")|(?:"+m+"\\.))",o="(?:(?:"+n+"|"+m+")"+k+")",p="(?:"+o+"|"+n+")",q="\\\\(x[0-9A-Fa-f]{2}|[0-7]{3}|[\\\\abfnrtv'\"]|U[0-9A-Fa-f]{8}|u[0-9A-Fa-f]{4})";this.$rules={start:[{token:"comment",regex:"#.*$"},{token:"string",regex:e+'"{3}',next:"qqstring3"},{token:"string",regex:e+'"(?=.)',next:"qqstring"},{token:"string",regex:e+"'{3}",next:"qstring3"},{token:"string",regex:e+"'(?=.)",next:"qstring"},{token:"constant.numeric",regex:"(?:"+p+"|\\d+)[jJ]\\b"},{token:"constant.numeric",regex:p},{token:"constant.numeric",regex:j+"[lL]\\b"},{token:"constant.numeric",regex:j+"\\b"},{token:d,regex:"[a-zA-Z_$][a-zA-Z0-9_$]*\\b"},{token:"keyword.operator",regex:"\\+|\\-|\\*|\\*\\*|\\/|\\/\\/|%|<<|>>|&|\\||\\^|~|<|>|<=|=>|==|!=|<>|="},{token:"paren.lparen",regex:"[\\[\\(\\{]"},{token:"paren.rparen",regex:"[\\]\\)\\}]"},{token:"text",regex:"\\s+"}],qqstring3:[{token:"constant.language.escape",regex:q},{token:"string",regex:'"{3}',next:"start"},{defaultToken:"string"}],qstring3:[{token:"constant.language.escape",regex:q},{token:"string",regex:"'{3}",next:"start"},{defaultToken:"string"}],qqstring:[{token:"constant.language.escape",regex:q},{token:"string",regex:"\\\\$",next:"qqstring"},{token:"string",regex:'"|$',next:"start"},{defaultToken:"string"}],qstring:[{token:"constant.language.escape",regex:q},{token:"string",regex:"\\\\$",next:"qstring"},{token:"string",regex:"'|$",next:"start"},{defaultToken:"string"}]}};d.inherits(f,e),b.PythonHighlightRules=f}),ace.define("ace/mode/folding/pythonic",["require","exports","module","ace/lib/oop","ace/mode/folding/fold_mode"],function(a,b,c){var d=a("../../lib/oop"),e=a("./fold_mode").FoldMode,f=b.FoldMode=function(a){this.foldingStartMarker=new RegExp("([\\[{])(?:\\s*)$|("+a+")(?:\\s*)(?:#.*)?$")};d.inherits(f,e),function(){this.getFoldWidgetRange=function(a,b,c){var d=a.getLine(c),e=d.match(this.foldingStartMarker);return e?e[1]?this.openingBracketBlock(a,e[1],c,e.index):e[2]?this.indentationBlock(a,c,e.index+e[2].length):this.indentationBlock(a,c):void 0;
}}.call(f.prototype)}),ace.define("ace/theme/dawn",["require","exports","module","ace/lib/dom"],function(a,b,c){b.isDark=!1,b.cssClass="ace-dawn",b.cssText=".ace-dawn .ace_gutter {background: #ebebeb;color: #333}.ace-dawn .ace_print-margin {width: 1px;background: #e8e8e8}.ace-dawn {background-color: #F9F9F9;color: #080808}.ace-dawn .ace_cursor {color: #000000}.ace-dawn .ace_marker-layer .ace_selection {background: rgba(39, 95, 255, 0.30)}.ace-dawn.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px #F9F9F9;border-radius: 2px}.ace-dawn .ace_marker-layer .ace_step {background: rgb(255, 255, 0)}.ace-dawn .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgba(75, 75, 126, 0.50)}.ace-dawn .ace_marker-layer .ace_active-line {background: rgba(36, 99, 180, 0.12)}.ace-dawn .ace_gutter-active-line {background-color : #dcdcdc}.ace-dawn .ace_marker-layer .ace_selected-word {border: 1px solid rgba(39, 95, 255, 0.30)}.ace-dawn .ace_invisible {color: rgba(75, 75, 126, 0.50)}.ace-dawn .ace_keyword,.ace-dawn .ace_meta {color: #794938}.ace-dawn .ace_constant,.ace-dawn .ace_constant.ace_character,.ace-dawn .ace_constant.ace_character.ace_escape,.ace-dawn .ace_constant.ace_other {color: #811F24}.ace-dawn .ace_invalid.ace_illegal {text-decoration: underline;font-style: italic;color: #F8F8F8;background-color: #B52A1D}.ace-dawn .ace_invalid.ace_deprecated {text-decoration: underline;font-style: italic;color: #B52A1D}.ace-dawn .ace_support {color: #691C97}.ace-dawn .ace_support.ace_constant {color: #B4371F}.ace-dawn .ace_fold {background-color: #794938;border-color: #080808}.ace-dawn .ace_list,.ace-dawn .ace_markup.ace_list,.ace-dawn .ace_support.ace_function {color: #693A17}.ace-dawn .ace_storage {font-style: italic;color: #A71D5D}.ace-dawn .ace_string {color: #0B6125}.ace-dawn .ace_string.ace_regexp {color: #CF5628}.ace-dawn .ace_comment {font-style: italic;color: #5A525F}.ace-dawn .ace_heading,.ace-dawn .ace_markup.ace_heading {color: #19356D}.ace-dawn .ace_variable {color: #234A97}.ace-dawn .ace_indent-guide {background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAEklEQVQImWNgYGBgYLh/5+x/AAizA4hxNNsZAAAAAElFTkSuQmCC) right repeat-y}";var d=a("../lib/dom");d.importCssString(b.cssText,b.cssClass)});var global=Function("return this;")();!function(a){function b(a){var b=g[a]||window[a];if(!b)throw new Error("Requested module '"+a+"' has not been defined.");return b}function c(a,b){return g[a]=b}function d(a,b){for(var c in b)"noConflict"!=c&&"_VERSION"!=c&&(a[c]=b[c]);return a}function e(a,b,c){return"string"==typeof a||a.nodeName||a.length&&"item"in a||a==window?(c=f._select(a,b),c.selector=a):c=isFinite(a.length)?a:[a],d(c,e)}function f(a,b){return e(a,b)}a.global=a;var g={},h=a.$;a.provide=c,a.require=b,d(f,{_VERSION:"0.3.6",fn:e,ender:function(a,b){d(b?e:f,a)},_select:function(a,b){return(b||document).querySelectorAll(a)}}),d(e,{forEach:function(a,b,c){for(c=0,l=this.length;c<l;++c)c in this&&a.call(b||this[c],this[c],c,this);return this},$:f}),f.noConflict=function(){return a.$=h,this},"undefined"!=typeof module&&module.exports&&(module.exports=f),a.ender=a.$=a.ender||f}(this),function(a){var b={exports:{}};b.exports,require("ender");!function(){"use strict";function a(a){var b,c=new Uint8Array(a);for(b=0;a>b;b+=1)c[b]=0;return c}function c(b,c,d,e){var f=c+d,g=a((parseInt(f/e)+1)*e);return g.set(b),g}function d(a,b,c){return a=a.toString(c||8),"000000000000".substr(a.length+12-b)+a}function e(b,c,d){var e,f;for(c=c||a(b.length),d=d||0,e=0,f=b.length;f>e;e+=1)c[d]=b.charCodeAt(e),d+=1;return c}function f(a){function b(a){return g[a>>18&63]+g[a>>12&63]+g[a>>6&63]+g[63&a]}var c,d,e,f=a.length%3,h="";for(c=0,e=a.length-f;e>c;c+=3)d=(a[c]<<16)+(a[c+1]<<8)+a[c+2],h+=b(d);switch(h.length%4){case 1:h+="=";break;case 2:h+="=="}return h}var g=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"];b.exports.clean=a,b.exports.pad=d,b.exports.extend=c,b.exports.stringToUint8=e,b.exports.uint8ToBase64=f}(),provide("tar-js/utils",b.exports)}(global),function(a){var b={exports:{}};b.exports,require("ender");!function(){"use strict";function a(a,b){var e=d.clean(512),f=0;return c.forEach(function(b){var c,d,g=a[b.field]||"";for(c=0,d=g.length;d>c;c+=1)e[f]=g.charCodeAt(c),f+=1;f+=b.length-c}),"function"==typeof b?b(e,f):e}var c,d=require("tar-js/utils");c=[{field:"fileName",length:100},{field:"fileMode",length:8},{field:"uid",length:8},{field:"gid",length:8},{field:"fileSize",length:12},{field:"mtime",length:12},{field:"checksum",length:8},{field:"type",length:1},{field:"linkName",length:100},{field:"ustar",length:8},{field:"owner",length:32},{field:"group",length:32},{field:"majorNumber",length:8},{field:"minorNumber",length:8},{field:"filenamePrefix",length:155},{field:"padding",length:12}],b.exports.structure=c,b.exports.format=a}(),provide("tar-js/header",b.exports)}(global),function(a){var b={exports:{}};b.exports,require("ender");!function(){"use strict";function a(a){this.written=0,c=(a||20)*f,this.out=e.clean(c)}var c,d=require("tar-js/header"),e=require("tar-js/utils"),f=512;a.prototype.append=function(a,b,g,h){var i,j,k,l,m,n,o;if("string"==typeof b)b=e.stringToUint8(b);else if(b.constructor!==Uint8Array.prototype.constructor)throw"Invalid input type. You gave me: "+b.constructor.toString().match(/function\s*([$A-Za-z_][0-9A-Za-z_]*)\s*\(/)[1];"function"==typeof g&&(h=g,g={}),g=g||{},k=g.mode||4095&parseInt("777",8),l=g.mtime||Math.floor(+new Date/1e3),m=g.uid||0,n=g.gid||0,i={fileName:a,fileMode:e.pad(k,7),uid:e.pad(m,7),gid:e.pad(n,7),fileSize:e.pad(b.length,11),mtime:e.pad(l,11),checksum:"        ",type:"0",ustar:"ustar  ",owner:g.owner||"",group:g.group||""},j=0,Object.keys(i).forEach(function(a){var b,c,d=i[a];for(b=0,c=d.length;c>b;b+=1)j+=d.charCodeAt(b)}),i.checksum=e.pad(j,6)+"\x00 ",o=d.format(i);return this.out.set(o,this.written),this.written+=o.length,this.written+b.length>this.out.length&&(this.out=e.extend(this.out,this.written,b.length,c)),this.out.set(b,this.written),this.written+=b.length+(f-(b.length%f||f)),this.out.length-this.written<2*f&&(this.out=e.extend(this.out,this.written,2*f,c)),"function"==typeof h&&h(this.out),this.out},a.prototype.clear=function(){this.written=0,this.out=e.clean(c)},b.exports=a}(),provide("tar-js",b.exports)}(global),angular.module("ui.ace",[]).constant("uiAceConfig",{}).directive("uiAce",["uiAceConfig",function(a){if(angular.isUndefined(window.ace))throw new Error("ui-ace need ace to work... (o rly?)");var b=function(a,b,c){if(angular.isDefined(c.workerPath)){var d=window.ace.require("ace/config");d.set("workerPath",c.workerPath)}angular.isDefined(c.require)&&c.require.forEach(function(a){window.ace.require(a)}),angular.isDefined(c.showGutter)&&a.renderer.setShowGutter(c.showGutter),angular.isDefined(c.useWrapMode)&&b.setUseWrapMode(c.useWrapMode),angular.isDefined(c.showInvisibles)&&a.renderer.setShowInvisibles(c.showInvisibles),angular.isDefined(c.showIndentGuides)&&a.renderer.setDisplayIndentGuides(c.showIndentGuides),angular.isDefined(c.useSoftTabs)&&b.setUseSoftTabs(c.useSoftTabs),angular.isDefined(c.showPrintMargin)&&a.setShowPrintMargin(c.showPrintMargin),angular.isDefined(c.disableSearch)&&c.disableSearch&&a.commands.addCommands([{name:"unfind",bindKey:{win:"Ctrl-F",mac:"Command-F"},exec:function(){return!1},readOnly:!0}]),angular.isString(c.theme)&&a.setTheme("ace/theme/"+c.theme),angular.isString(c.mode)&&b.setMode("ace/mode/"+c.mode),angular.isDefined(c.firstLineNumber)&&(angular.isNumber(c.firstLineNumber)?b.setOption("firstLineNumber",c.firstLineNumber):angular.isFunction(c.firstLineNumber)&&b.setOption("firstLineNumber",c.firstLineNumber()));var e,f;if(angular.isDefined(c.advanced))for(e in c.advanced)f={name:e,value:c.advanced[e]},a.setOption(f.name,f.value);if(angular.isDefined(c.rendererOptions))for(e in c.rendererOptions)f={name:e,value:c.rendererOptions[e]},a.renderer.setOption(f.name,f.value);angular.forEach(c.callbacks,function(b){angular.isFunction(b)&&b(a)})};return{restrict:"EA",require:"?ngModel",link:function(c,d,e,f){var g,h,i=a.ace||{},j=angular.extend({},i,c.$eval(e.uiAce)),k=window.ace.edit(d[0]),l=k.getSession(),m=function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1);angular.isDefined(a)&&c.$evalAsync(function(){if(!angular.isFunction(a))throw new Error("ui-ace use a function as callback.");a(b)})},n={onChange:function(a){return function(b){var d=l.getValue();!f||d===f.$viewValue||c.$$phase||c.$root.$$phase||c.$evalAsync(function(){f.$setViewValue(d)}),m(a,b,k)}},onBlur:function(a){return function(){m(a,k)}}};e.$observe("readonly",function(a){k.setReadOnly(!!a||""===a)}),f&&(f.$formatters.push(function(a){if(angular.isUndefined(a)||null===a)return"";if(angular.isObject(a)||angular.isArray(a))throw new Error("ui-ace cannot use an object or an array as a model");return a}),f.$render=function(){l.setValue(f.$viewValue)});var o=function(a,d){a!==d&&(j=angular.extend({},i,c.$eval(e.uiAce)),j.callbacks=[j.onLoad],j.onLoad!==i.onLoad&&j.callbacks.unshift(i.onLoad),l.removeListener("change",g),g=n.onChange(j.onChange),l.on("change",g),k.removeListener("blur",h),h=n.onBlur(j.onBlur),k.on("blur",h),b(k,l,j))};c.$watch(e.uiAce,o,!0),o(i),d.on("$destroy",function(){k.session.$stopWorker(),k.destroy()}),c.$watch(function(){return[d[0].offsetWidth,d[0].offsetHeight]},function(){k.resize(),k.renderer.updateFull()},!0)}}}]),!function(a,b){"use strict";var c=b.isDefined,d=b.isUndefined,e=b.isNumber,f=b.isObject,g=b.isArray,h=b.extend,i=b.toJson,j=b.module("LocalStorageModule",[]);j.provider("localStorageService",function(){this.prefix="ls",this.storageType="localStorage",this.cookie={expiry:30,path:"/"},this.notify={setItem:!0,removeItem:!1},this.setPrefix=function(a){return this.prefix=a,this},this.setStorageType=function(a){return this.storageType=a,this},this.setStorageCookie=function(a,b){return this.cookie.expiry=a,this.cookie.path=b,this},this.setStorageCookieDomain=function(a){return this.cookie.domain=a,this},this.setNotify=function(a,b){return this.notify={setItem:a,removeItem:b},this},this.$get=["$rootScope","$window","$document","$parse",function(a,b,j,k){var l,m=this,n=m.prefix,o=m.cookie,p=m.notify,q=m.storageType;j?j[0]&&(j=j[0]):j=document,"."!==n.substr(-1)&&(n=n?n+".":"");var r=function(a){return n+a},s=function(){try{var c=q in b&&null!==b[q],d=r("__"+Math.round(1e7*Math.random()));return c&&(l=b[q],l.setItem(d,""),l.removeItem(d)),c}catch(e){return q="cookie",a.$broadcast("LocalStorageModule.notification.error",e.message),!1}}(),t=function(b,c){if(c=d(c)?null:i(c),!s||"cookie"===m.storageType)return s||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),p.setItem&&a.$broadcast("LocalStorageModule.notification.setitem",{key:b,newvalue:c,storageType:"cookie"}),z(b,c);try{l&&l.setItem(r(b),c),p.setItem&&a.$broadcast("LocalStorageModule.notification.setitem",{key:b,newvalue:c,storageType:m.storageType})}catch(e){return a.$broadcast("LocalStorageModule.notification.error",e.message),z(b,c)}return!0},u=function(b){if(!s||"cookie"===m.storageType)return s||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),A(b);var c=l?l.getItem(r(b)):null;if(!c||"null"===c)return null;try{return JSON.parse(c)}catch(d){return c}},v=function(){var b,c;for(b=0;b<arguments.length;b++)if(c=arguments[b],s&&"cookie"!==m.storageType)try{l.removeItem(r(c)),p.removeItem&&a.$broadcast("LocalStorageModule.notification.removeitem",{key:c,storageType:m.storageType})}catch(d){a.$broadcast("LocalStorageModule.notification.error",d.message),B(c)}else s||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),p.removeItem&&a.$broadcast("LocalStorageModule.notification.removeitem",{key:c,storageType:"cookie"}),B(c)},w=function(){if(!s)return a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),!1;var b=n.length,c=[];for(var d in l)if(d.substr(0,b)===n)try{c.push(d.substr(b))}catch(e){return a.$broadcast("LocalStorageModule.notification.error",e.Description),[]}return c},x=function(b){var c=n?new RegExp("^"+n):new RegExp,d=b?new RegExp(b):new RegExp;if(!s||"cookie"===m.storageType)return s||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),C();var e=n.length;for(var f in l)if(c.test(f)&&d.test(f.substr(e)))try{v(f.substr(e))}catch(g){return a.$broadcast("LocalStorageModule.notification.error",g.message),C()}return!0},y=function(){try{return b.navigator.cookieEnabled||"cookie"in j&&(j.cookie.length>0||(j.cookie="test").indexOf.call(j.cookie,"test")>-1)}catch(c){return a.$broadcast("LocalStorageModule.notification.error",c.message),!1}}(),z=function(b,c,h){if(d(c))return!1;if((g(c)||f(c))&&(c=i(c)),!y)return a.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var k="",l=new Date,m="";if(null===c?(l.setTime(l.getTime()+-864e5),k="; expires="+l.toGMTString(),c=""):e(h)&&0!==h?(l.setTime(l.getTime()+24*h*60*60*1e3),k="; expires="+l.toGMTString()):0!==o.expiry&&(l.setTime(l.getTime()+24*o.expiry*60*60*1e3),k="; expires="+l.toGMTString()),b){var n="; path="+o.path;o.domain&&(m="; domain="+o.domain),j.cookie=r(b)+"="+encodeURIComponent(c)+k+n+m}}catch(p){return a.$broadcast("LocalStorageModule.notification.error",p.message),!1}return!0},A=function(b){if(!y)return a.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var c=j.cookie&&j.cookie.split(";")||[],d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(r(b)+"=")){var f=decodeURIComponent(e.substring(n.length+b.length+1,e.length));try{return JSON.parse(f)}catch(g){return f}}}return null},B=function(a){z(a,null)},C=function(){for(var a=null,b=n.length,c=j.cookie.split(";"),d=0;d<c.length;d++){for(a=c[d];" "===a.charAt(0);)a=a.substring(1,a.length);var e=a.substring(b,a.indexOf("="));B(e)}},D=function(){return q},E=function(a,b,d,e){e=e||b;var g=u(e);return null===g&&c(d)?g=d:f(g)&&f(d)&&(g=h(d,g)),k(b).assign(a,g),a.$watch(b,function(a){t(e,a)},f(a[b]))},F=function(){for(var a=0,c=b[q],d=0;d<c.length;d++)0===c.key(d).indexOf(n)&&a++;return a};return{isSupported:s,getStorageType:D,set:t,add:t,get:u,keys:w,remove:v,clearAll:x,bind:E,deriveKey:r,length:F,cookie:{isSupported:y,set:z,add:z,get:A,remove:B,clearAll:C}}}]})}(window,window.angular),angular.module("builder",["ngRoute","builder.filters","builder.services","builder.directives","builder.controllers","LocalStorageModule","ui.ace","angulartics","angulartics.google.analytics"]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/models",{templateUrl:"partials/models.html",controller:"ModelController"}),a.when("/home",{templateUrl:"partials/home.html",controller:"ModelController"}),a.otherwise({redirectTo:"/home"})}]),angular.module("builder.controllers",["LocalStorageModule"]).controller("ModelController",["$scope","$http","ModelFactory","ModelParser","FieldFactory","RelationshipFactory","localStorageService","MessageService","RenderFactory","TarballFactory",function(a,b,c,d,e,f,g,h,i,j){a.models=[],a.new_models=[],a.user_model="django.contrib.auth.models.User",a.user_model_setting="settings.AUTH_USER_MODEL",a.built_in_models={"django.contrib.auth.models.User":{fields:{username:{"default":"username"},email:{"default":"username@tempurl.com"}}},"django.contrib.auth.models.Group":{fields:{name:{"default":"group"}}},"django.contrib.contenttypes.models.ContentType":{fields:{}}},a.messageService=new h,a.field_factory=new e,a.model_factory=c,a.relationship_factory=new f,a.render_factory=new i(a.built_in_models),a.editors=[],a.models_storage_key="local_models",a._app_name="app_name",a.create_tar_ball_url=function(){var b="Built with django_builder\n",c="#",d=a.render_factory.render_models_py(a.app_name(),a.models),e=a.render_factory.render_views_py(a.app_name(),a.models),f=a.render_factory.render_admin_py(a.app_name(),a.models),g=a.render_factory.render_urls_py(a.app_name(),a.models),h=a.render_factory.render_tests_py(a.app_name(),a.models),i=a.render_factory.render_forms_py(a.app_name(),a.models),k=a.render_factory.render_django_rest_framework_api_py(a.app_name(),a.models),l=a.render_factory.render_django_rest_framework_serializers_py(a.app_name(),a.models),m=a.render_factory.render_templates_html(a.app_name(),a.models),n=new j;return n.append("README.txt",b),n.append(a.app_name()+"/__init__.py",c),n.append(a.app_name()+"/models.py",d),n.append(a.app_name()+"/views.py",e),n.append(a.app_name()+"/admin.py",f),n.append(a.app_name()+"/urls.py",g),n.append(a.app_name()+"/tests.py",h),n.append(a.app_name()+"/forms.py",i),n.append(a.app_name()+"/api.py",k),n.append(a.app_name()+"/serializers.py",l),n.append(a.app_name()+"/templates/base.html",a.render_factory.render_base_html(a.app_name(),a.models)),jQuery.each(m,function(b,c){n.append(a.app_name()+"/templates/"+a.app_name()+"/"+c[0],c[1])}),n.get_url()},a.create_download_modal=function(){var b=a.create_tar_ball_url(),c=a.app_name()+".tar",d=jQuery("<a>").attr("href",b).attr("id","django_builder_download_a");d.addClass("btn btn-success btn-lg").css("text-transform","none"),d.text("Click here to download "+c),d.attr("download",c);var e=jQuery("<div>").addClass("text-center").append(d),f=jQuery("<div>");f.append(jQuery("<br>")),f.append("Chrome can block downloads of the generated tarball, if this happens navigate to the "),f.append(jQuery("<strong>").text("Downloads")),f.append(" section of chrome to accept the download"),f.append(jQuery("<br>")),f.append("Window -> Downloads");var g=jQuery("<div>");g.append(e),g.append(f);var h="django_builder_download_modal";return a.messageService.simple_info("Download info",g).modal("show").attr("id",h),h},a.render_model_class_fields_only=function(b){return b.render_model_class_fields_only(a._app_name,a.render_factory)},a.upload_input=function(){return jQuery('<input type="file" />')},a.upload_drop_target=function(a){var b=jQuery("<div>").addClass("builder_dnd_target text-center"),c=jQuery("<i>").addClass("fa fa-upload fa-4x builder_dnd_icon");return b.append(jQuery("<div>").text("Drag and Drop files here!")),b.append(c),b},a.upload_form=function(a,b){var c=jQuery("<form>"),d=jQuery("<span>").addClass("btn btn-default btn-file center-block builder_upload_models_py");return d.append("Browse"),d.append(a),c.append(d),c.append(b),c},a.save_new_models=function(b){a.new_models=[],a.models=b,a.saveApp(),a.$apply()},a.merge_models=function(){for(var b=a.models.concat(a.new_models),c=0;c<b.length;++c)for(var d=c+1;d<b.length;++d)b[c].name===b[d].name&&b.splice(d--,1);return a.save_new_models(b)},a.add_unique=function(){jQuery.each(a.new_models,function(b,c){a.existingModel(c.name)||a.models.push(c)}),a.save_new_models(a.models)},a.add_new_models=function(b){a.new_models=b,a.$apply();var c=function(){console.log("Overwriting existing models"),a.merge_models()},d=function(){var b=!1,d=[],e=jQuery("<p>").text("The following models are duplicates:");jQuery.each(a.new_models,function(c,f){a.existingModel(f.name)&&(b=!0,d.push(f),e.append(jQuery("<div>").text(f.name)))});var f=d.length==a.new_models.length;if(b){var g=[{text:"Overwrite existing models",callback:c}];f||g.push({text:"Add unique",callback:a.add_unique}),g.push({text:"Cancel",callback:function(){}});var h="duplicate_models";a.messageService.simple_choice("Add duplicate models?",e,g).modal("show").attr("id",h)}else a.merge_models()},e=jQuery("<div>");jQuery.each(a.new_models,function(b,c){e.append(jQuery("<hr>")),e.append(jQuery("<pre>").html(c.render_model_class_fields_only(a._app_name,a.render_factory)));var d=jQuery('<button class="btn btn-danger pull-right">').text("Remove");e.append(d),e.append(jQuery("<div>").addClass("clearfix"))});var f="add_new_models";return a.messageService.simple_confirm("Add the following models?",jQuery("#builder_new_models"),d).modal("show").find(".modal-dialog").css("width","50%").attr("id",f),f},a.process_models_py=function(b){if(0==b.length)a.messageService.simple_error("Sorry","You didn't seem to choose any files.").modal("show");else if(b.length>1)a.messageService.simple_error("Sorry","Multiple files not yet supported, please choose a single file.").modal("show");else{var c=d(a);c.parse(b[0],function(b){a.add_new_models(b)})}},a.upload_models_py=function(){var b=a.upload_input(),c=a.upload_drop_target(),d=a.upload_form(b,c),e=a.messageService.simple_form("Upload models.py","Choose a models.py file to analyse",d,function(){a.process_models_py(jQuery(b)[0].files),e.modal("hide")}).modal("show");b.change(function(){a.process_models_py(jQuery(b)[0].files),e.modal("hide")}),d.on("drag dragstart dragend dragover dragenter dragleave drop",function(a){a.preventDefault(),a.stopPropagation()}).on("dragover dragenter",function(){c.addClass("is-drag-over")}).on("dragleave dragend drop",function(){c.removeClass("is-drag-over")}).on("drop",function(b){var c=b.originalEvent.dataTransfer.files;e.modal("hide"),a.process_models_py(c)})},jQuery("html body").on("drag dragstart dragend dragover dragenter dragleave drop",function(a){a.preventDefault(),a.stopPropagation()}).on("dragover dragenter",function(){}).on("drop",function(a){}),jQuery("#builder_models_content").on("drag dragstart dragend dragover dragenter dragleave drop",function(a){a.preventDefault(),a.stopPropagation()}).on("dragover dragenter",function(){jQuery(".builder_dnd_target").addClass("is-drag-over")}).on("drop",function(b){jQuery(".builder_dnd_target").removeClass("is-drag-over");var c=b.originalEvent.dataTransfer.files;a.process_models_py(c)}),a.aceLoad=function(b){var c=jQuery(b.container).attr("id");"builder_models"==c?b.setValue(a.render_factory.render_models_py(a.app_name(),a.models)):"builder_views"==c?b.setValue(a.render_factory.render_views_py(a.app_name(),a.models)):"builder_admin"==c?b.setValue(a.render_factory.render_admin_py(a.app_name(),a.models)):"builder_urls"==c?b.setValue(a.render_factory.render_urls_py(a.app_name(),a.models)):"builder_tests"==c?b.setValue(a.render_factory.render_tests_py(a.app_name(),a.models)):"builder_forms"==c?b.setValue(a.render_factory.render_forms_py(a.app_name(),a.models)):"builder_django_rest_framework_api"==c?b.setValue(a.render_factory.render_django_rest_framework_api_py(a.app_name(),a.models)):"builder_django_rest_framework_serializers"==c&&b.setValue(a.render_factory.render_django_rest_framework_serializers_py(a.app_name(),a.models)),b.session.selection.clearSelection()},a.reLoadAce=function(){Object.keys(a.editors).map(function(b){a.aceLoad(a.editors[b])})},a.aceLoaded=function(b){b.setOptions({readOnly:!0,highlightActiveLine:!1,highlightGutterLine:!1,maxLines:1/0}),b.renderer.$cursorLayer.element.style.opacity=0,a.aceLoad(b),a.editors.push(b)},a.$watch("[models,_app_name]",function(){a.reLoadAce(),a.saveApp()},!0),a.aceChanged=function(a){},a.do_set_app_name=function(b){a._app_name=b},a.set_app_name=function(){a.do_set_app_name(jQuery("input#appname").val()),a.reLoadAce()},a.l_app_name=function(){return a._app_name.toLowerCase()},a.app_name=function(){return a._app_name.replace(new RegExp(" ","g"),"_")},a.updateModel=function(b){var c=a.models.indexOf(b);a.models[c]=b,a.$apply()},a.serializeApp=function(){var b={models:a.models,app_config:{app_name:a._app_name}};return JSON.stringify(b)},a.saveApp=function(){g.set(a.models_storage_key,a.serializeApp())},a.doClearModels=function(){g.set(a.models_storage_key,""),a.loadModels(),a.models=[],a.$apply()},a.clearModels=function(){var b=function(){a.doClearModels()},c="clear_all";return a.messageService.simple_confirm("Confirm","Remove all models?",b).modal("show").attr("id",c),c},a.model_count=function(){return a.models.length},a.add_model=function(b){var d={name:b};d.fields=[a.field_factory.make_field({name:"name",type:"django.db.models.CharField",opts:"max_length=255"}),a.field_factory.make_field({name:"slug",type:"django_extensions.db.fields.AutoSlugField",opts:"populate_from='name', blank=True"}),a.field_factory.make_field({name:"created",type:"django.db.models.DateTimeField",opts:"auto_now_add=True, editable=False"}),a.field_factory.make_field({name:"last_updated",type:"django.db.models.DateTimeField",opts:"auto_now=True, editable=False"})];var e=c(d,a);a.models.push(e),a.saveApp(),a.$apply()},a.existingModel=function(b){var c=!1;return jQuery.each(a.models,function(a,d){b==d.name&&(c=!0)}),c},a.addModel=function(){var b=function(b){void 0==b||""===b?a.messageService.simple_info("Model Name Required","Enter a Model name").modal("show"):a.existingModel(b)?a.messageService.simple_error("Error with Model Name","There is already a model with the name "+b).modal("show"):a.add_model(b)},c="add_model";return a.messageService.simple_input("Model Name Required","Enter a Model name","Model1",b,!0).modal("show").attr("id",c),c},a.cleanModel=function(a){delete a.$$hashKey,void 0!=a.fields&&jQuery.each(a.fields,function(a,b){delete b.$$hashKey}),void 0!=a.relationships&&jQuery.each(a.relationships,function(a,b){delete b.$$hashKey})},a.loadModels=function(){var b=g.get(a.models_storage_key)||{models:[],app_config:{app_name:"app_name"}};"string"==typeof b&&(b=JSON.parse(b));var c=b.models||[],d=b.app_config||{app_name:"app_name"};return a._app_name=d.app_name,jQuery.each(c,function(b,c){a.cleanModel(c)}),c},a.loadModel=function(b){var d=c(b,a);a.models.push(d)},a.__init__=function(){jQuery.each(a.loadModels(),function(b,c){a.loadModel(c)})},a.__init__(),a.debug=function(){},a.do_rename_model=function(b,c){var d="rename_model_existing",e=a.models[b];a.existingModel(c)?a.messageService.simple_error("Error with Model Name","There is already a model with the name "+c).modal("show").attr("id",d):(e.set_name(c),a.updateModel(e),a.$apply())},a.rename_model=function(b){var c=a.models[b],d="rename_model",e=function(c){a.do_rename_model(b,c)};return a.messageService.simple_input("Rename model","Enter a new Model name",c.name,e,!0).modal("show").attr("id",d),d},a.add_relationship=function(b){const c=a.models[b],d=function(b){var d=b.find("input[name=name]").val().trim(),e=b.find("select[name=to]").val().trim(),f=!0;if(jQuery.each(a.built_in_models,function(a,b){e==a&&(f=!1)}),jQuery.each(a.models,function(a,b){e==b.name&&(f=!1)}),b.find("div.form-group-name").removeClass("has-error"),b.find("div.form-group-to").removeClass("has-error"),void 0===d||""===d)b.find("div.form-group-name").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text("Field Required");else if(void 0===e||""===e)b.find("div.form-group-to").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text("Field Required");else if(c.has_relationship(d))b.find("div.form-group-name").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text('Field "'+d+'" exists');else{var g=b.find("select[name=type]").val(),h=b.find("input[name=opts]").val(),i=a.relationship_factory.make_relationship({name:d,type:g,opts:h,to:e,external_app:f});c.relationships.push(i),a.updateModel(c),a.$apply(),jQuery(".modal").modal("hide")}},e=jQuery("<form>"),f=jQuery("<div>").addClass("form-group form-group-name has-feedback").appendTo(e),g=jQuery("<div>").addClass("form-group form-group-to").appendTo(e),h=jQuery("<div>").addClass("form-group form-group-type").appendTo(e),i=jQuery("<div>").addClass("form-group form-group-args").appendTo(e);f.append(jQuery("<label>").text("Name")),f.append(jQuery("<input>").attr("name","name").addClass("form-control")),f.append(jQuery("<span>").text("error message").addClass("help-block hide"));const j=jQuery("<select>").attr("name","to").addClass("form-control"),k=jQuery("<optgroup>").attr("label","Django models");jQuery.each(a.built_in_models,function(a,b){k.append(jQuery("<option>").attr("val",a).text(a))}),j.append(k);const l=jQuery("<optgroup>").attr("label","Your App models");jQuery.each(a.models,function(a,b){l.append(jQuery("<option>").attr("val",b.name).text(b.name))}),j.append(l),g.append(jQuery("<label>").text("Relationship to Model")),g.append(j),g.append(jQuery("<p>").addClass("text-primary small clearfix").text("You can add external models (otherapp.models.Model1)").css("margin","4px"));const m=jQuery("<select>").attr("name","type");jQuery.each(a.relationship_factory.relationship_types(),function(a,b){m.append(jQuery("<option>").attr("val",b).text(b))}),h.append(jQuery("<label>").text("Relationship Type")),h.append(m),i.append(jQuery("<label>").text("Arguments")),i.append(jQuery("<input>").attr("name","opts").attr("placeholder","options").addClass("form-control")),j.select2({theme:"bootstrap",allowClear:!0,placeholder:"Select a model.",tags:!0,selectOnClose:!0}),m.select2({theme:"bootstrap"});const n="add_rel_"+c.name+"_"+b;return a.messageService.simple_form_no_dismiss("Add Relationship","",e,d).modal("show").attr("id",n).appendTo("body"),n},a.add_field=function(b){var c=a.models[b],d=function(b){var d=b.find("input[name=name]").val();if(void 0===d||""===d)b.find("div.form-group-name").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text("Field Required");else if(c.has_field(d))b.find("div.form-group-name").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text('Field "'+d+'" exists');else{var e=b.find("select[name=type]").val(),f=b.find("input[name=opts]").val(),g=a.field_factory.make_field({name:d,type:e,opts:f});c.fields.push(g),a.updateModel(c),a.$apply(),jQuery(".modal").modal("hide")}},e=jQuery("<form>"),f=jQuery("<div>").addClass("form-group form-group-name  has-feedback").appendTo(e),g=jQuery("<div>").addClass("form-group form-group-type").appendTo(e),h=jQuery("<div>").addClass("form-group form-group-args").appendTo(e);f.append(jQuery("<label>").text("Name")),f.append(jQuery("<input>").attr("name","name").addClass("form-control")),f.append(jQuery("<span>").text("error message").addClass("help-block hide"));var i=jQuery("<select>").attr("name","type").addClass("form-control");jQuery.each(a.field_factory.field_types(),function(a,b){i.append(jQuery("<option>").attr("val",b).text(b))});var j=jQuery("<input>").attr("name","opts").attr("placeholder","options").addClass("form-control");g.append(jQuery("<label>").text("Field Type")),g.append(i),h.append(jQuery("<label>").text("Arguments")),h.append(j),i.change(function(){j.val(a.field_factory.default_field_args(i.val()))}),j.val(a.field_factory.default_field_args(i.val()));var k="add_field_"+c.name+"_"+b;return a.messageService.simple_form_no_dismiss("Add Field","",e,d).modal("show").attr("id",k).appendTo("body"),k},a.edit_relationship=function(b,c){var d=a.models[b].relationships[c],e=function(b){d.form_update(b),a.$apply(),jQuery(".modal").modal("hide")},f=d.$$hashKey||"edit_relationship_"+d.name;return a.messageService.simple_form("Edit Relationship '"+d.name+"'","",d.edit_form(a),e).modal("show").attr("id",f).appendTo("body"),f},a.edit_field=function(b,c){var d=a.models[b].fields[c],e=function(b){d.form_update(b),a.$apply(),jQuery(".modal").modal("hide")},f=d.$$hashKey||"edit_field_"+d.name;return a.messageService.simple_form("Edit field '"+d.name+"'","",d.edit_form(a),e).modal("show").attr("id",f).appendTo("body"),f},a.do_remove_new_model=function(b){a.new_models.splice(b,1),a.$apply()},a.remove_new_model=function(b){setTimeout(function(){a.do_remove_new_model(b)})},a.remove_relationship=function(b,c){var d=function(){a.models[b].relationships.splice(c,1),a.$apply()},e=a.models[b].relationships[c],f=e.$$hashKey||"remove_relationship_"+e.name;
return a.messageService.simple_confirm("Confirm","Remove the relationship '"+e.name+"'",d).modal("show").attr("id",f).appendTo("body"),f},a.do_remove_new_relationship=function(b,c){a.new_models[b].relationships.splice(c,1)},a.remove_new_relationship=function(b,c){setTimeout(function(){a.do_remove_new_relationship(b,c)})},a.do_remove_new_field=function(b,c){a.new_models[b].fields.splice(c,1),a.$apply()},a.remove_new_field=function(b,c){setTimeout(function(){a.do_remove_new_field(b,c)})},a.remove_field=function(b,c){var d=function(){a.models[b].fields.splice(c,1),a.$apply()},e=a.models[b].fields[c],f=e.$$hashKey||"remove_field_"+e.name;return a.messageService.simple_confirm("Confirm","Remove the field '"+e.name+"'",d).modal("show").attr("id",f).appendTo("body"),f},a.remove_model=function(b){var c=function(){a.models.splice(b,1),a.$apply()},d=a.models[b],e=d.$$hashKey||"remove_model_"+d.name;return a.messageService.simple_confirm("Confirm","Remove the model '"+d.name+"'",c).modal("show").modal("show").attr("id",e).appendTo("body"),e},a.model_highlight=function(b,c){var d=a.models[b].relationships[c];jQuery(".builder_model_"+d.to_clean()).addClass("builder_model_highlight")},a.model_unhighlight=function(){jQuery(".builder_model").removeClass("builder_model_highlight")},a.new_model_highlight=function(b,c){var d=a.new_models[b].relationships[c];jQuery(".builder_model_"+d.to_clean()).addClass("builder_model_highlight")},a.new_model_unhighlight=function(){jQuery(".builder_model").removeClass("builder_model_highlight")}}]),angular.module("builder.directives",[]).directive("appVersion",["version",function(a){return function(b,c,d){c.text(a)}}]),angular.module("builder.filters",[]).filter("interpolate",["version",function(a){return function(b){return String(b).replace(/\%VERSION\%/gm,a)}}]),angular.module("builder.services",[]).factory("ModelFactory",[ModelServiceFactory]).factory("ModelParser",[ModelParserFactory]).factory("MessageService",[MessageServiceFactory]).factory("FieldFactory",[FieldFactory]).factory("RelationshipFactory",[RelationshipFactory]).factory("RenderFactory",[ModelRenderFactory]).factory("TarballFactory",[TarballFactory]).value("version","0.1");
=======
function TarballFactory(){return function(){function a(){var a=this,b=require("tar-js"),c=new b;a.uInt8ToString=function(a){var b,c,d="";for(b=0,c=a.length;c>b;b+=1)d+=String.fromCharCode(a[b]);return d},a.append=function(a,b){c.append(a,b)},a.get_url=function(b){var d=btoa(a.uInt8ToString(c.out));return"data:application/tar;base64,"+d}}return new a}}function ModelRenderFactory(){return function(a){var b=this;b.built_in_models=a,b.spaces=function(a){var b=a||1;return new Array(b+1).join(" ")},b.model_names=function(a,b){var c=b||"";return Object.keys(a).map(function(b){return a[b].name+c})},b.new_lines=function(a){var b=a||1;return new Array(b+1).join("\n")},b.render_all=function(a,c){var d="";return d+=b.render_base_html(a,c),d+=b.render_forms_py(a,c),d+=b.render_urls_py(a,c),d+=b.render_admin_py(a,c),d+=b.render_views_py(a,c),d+=b.render_models_py(a,c),d+=b.render_django_rest_framework_api_py(a,c),d+=b.render_django_rest_framework_serializers_py(a,c),d+=b.render_templates_html(a,c)},b.render_base_html=function(a,b){return"<html><head></head><body>{% block content %}Replace this.{% endblock %}</body>"},b.pre_imported_modules=function(a){return{"django.contrib.auth.models":{as:"auth_models"},"django.db.models":{as:"models"},"django_extensions.db.fields":{as:"extension_fields"}}},b.pre_imported_modules_names=function(a){return Object.keys(b.pre_imported_modules())},b.render_forms_py=function(a,c){var d="from django import forms\n";return d+="from .models import "+b.model_names(c,"").join(", ")+"\n",d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_forms(a,b)}),d},b.render_tests_py=function(a,c){var d="import unittest\nfrom django.core.urlresolvers import reverse\nfrom django.test import Client\n";return d+="from .models import "+b.model_names(c,"").join(", ")+"\n",jQuery.each(b.built_in_models,function(a,c){var e=a.split("."),f=e.pop(),g=e.join(".");d+="from "+g+" import "+f,d+=b.new_lines(1)}),d+=b.new_lines(2),jQuery.each(b.built_in_models,function(a,c){var e="create_"+a.toLowerCase().replace(/\./g,"_"),f=a.split(".").pop(),g="";g+="def "+e+"(**kwargs):\n",g+=b.spaces(4)+"defaults = {}\n",jQuery.each(c.fields,function(a,c){g+=b.spaces(4)+'defaults["'+a+'"] = "'+c["default"]+'"\n'}),g+=b.spaces(4)+"defaults.update(**kwargs)\n",g+=b.spaces(4)+"return "+f+".objects.create(**defaults)\n",g+=b.new_lines(2),d+=g}),jQuery.each(c,function(c,e){d+=e.render_tests_helpers(a,b)}),jQuery.each(c,function(c,e){d+=e.render_tests(a,b)}),d},b.render_urls_py=function(a,c){var d="from django.conf.urls import url, include\n";return d+="from rest_framework import routers"+b.new_lines(1),d+="import api"+b.new_lines(1),d+="import views"+b.new_lines(2),d+="router = routers.DefaultRouter()"+b.new_lines(1),jQuery.each(c,function(a,c){d+="router.register(r'"+c.l_name()+"', api."+c.name+"ViewSet)"+b.new_lines(1)}),d+=b.new_lines(2),d+="urlpatterns = ("+b.new_lines(1),d+=b.spaces(4)+"# urls for Django Rest Framework API"+b.new_lines(1),d+=b.spaces(4)+"url(r'^api/v1/', include(router.urls)),"+b.new_lines(1),d+=")"+b.new_lines(1),d+=b.new_lines(1),jQuery.each(c,function(c,e){d+=e.render_urls(a,b)}),d},b.render_admin_py=function(a,c){var d="from django.contrib import admin\nfrom django import forms\n";return d+="from .models import "+b.model_names(c).join(", "),d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_admin_classes(a,b)}),d},b.render_views_py=function(a,c){var d="from django.views.generic import DetailView, ListView, UpdateView, CreateView\n";return d+="from .models import "+b.model_names(c).join(", "),d+=b.new_lines(1),d+="from .forms import "+b.model_names(c,"Form").join(", "),d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_view_classes(a,b)}),d},b.render_models_py=function(a,c){var d="from django.core.urlresolvers import reverse\n";d+="from django_extensions.db.fields import AutoSlugField\n",d+="from django.db.models import *\n",d+="from django.conf import settings\n",d+="from django.contrib.contenttypes.fields import GenericForeignKey\n",d+="from django.contrib.contenttypes.models import ContentType\n",d+="from django.contrib.auth import get_user_model\n",jQuery.each(b.pre_imported_modules(),function(a,b){var c=a.split("."),e=c.pop();d+="from "+c.join(".")+" import "+e+" as "+b.as+"\n"});var e={};jQuery.each(c,function(a,b){jQuery.each(b.fields,function(a,b){e[b.module()]=b.module()})});var f={};return jQuery.each(c,function(a,b){jQuery.each(b.fields,function(a,b){f[b.type]=b}),jQuery.each(b.relationships,function(a,b){f[b.type]=b})}),jQuery.each(f,function(a,b){}),d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_model_class(a,b)}),d},b.render_templates_html=function(a,b){var c=[];return jQuery.each(b,function(b,d){c.push([d.l_name()+"_form.html",d.render_form_html(a)]),c.push([d.l_name()+"_detail.html",d.render_detail_html(a)]),c.push([d.l_name()+"_list.html",d.render_list_html(a)])}),c},b.render_django_rest_framework_api_py=function(a,c){var d="import models\n";return d+="import serializers\n",d+="from rest_framework import viewsets, permissions\n",d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_model_api(a,b)}),d},b.render_django_rest_framework_serializers_py=function(a,c){var d="import models";return d+=b.new_lines(2),d+="from rest_framework import serializers",d+=b.new_lines(3),jQuery.each(c,function(c,e){d+=e.render_model_serializer(a,b)}),d}}}function MessageServiceFactory(){return function(){var a=this;a.base_modal=function(){var a=jQuery("<div>").addClass("modal fade");a.attr("tabindex","-1"),a.attr("role","dialog"),a.css("display","none");var b=jQuery("<div>").addClass("modal-dialog"),c=jQuery("<div>").addClass("modal-content").appendTo(b),d=jQuery("<h2>").addClass("modal-header-inner");return jQuery("<div>").addClass("modal-header").appendTo(c).append(d),jQuery("<div>").addClass("modal-body").appendTo(c),jQuery("<div>").addClass("modal-footer").appendTo(c),a.append(b),a},a.icon=function(a){return jQuery("<icon>").addClass("fa").addClass(a)},a.simple_error=function(b,c){var d=a.base_modal(),e=a.icon("fa-info").addClass("pull-right");d.find(".modal-header-inner").append(e).append(jQuery("<span>").text(b)),d.find(".modal-body").empty().append(c);var f=jQuery("<button>").addClass("btn btn-default").text("Ok");return d.find(".modal-footer").append(f),f.attr("data-dismiss","modal"),d.modal(),d},a.simple_info=function(b,c){var d=a.base_modal(),e=a.icon("fa-info").addClass("pull-right");d.find(".modal-header-inner").append(e).append(jQuery("<span>").text(b)),d.find(".modal-body").empty().append(c);var f=jQuery("<button>").addClass("btn btn-default").text("Ok");return d.find(".modal-footer").append(f),f.attr("data-dismiss","modal"),d.modal(),d},a.simple_confirm=function(b,c,d){var e=d||jQuery.noop,f=a.base_modal();f.find(".modal-header-inner").html(b),f.find(".modal-body").empty().append(c);var g=jQuery("<button>").addClass("btn btn-primary").text("Ok"),h=jQuery("<button>").addClass("btn btn-default").text("Cancel");return f.find(".modal-footer").append(g).append(h),g.click(function(){e()}),h.attr("data-dismiss","modal"),g.attr("data-dismiss","modal"),f.modal(),f},a.simple_choice=function(b,c,d){var e=a.base_modal();return e.find(".modal-header-inner").html(b),e.find(".modal-body").empty().append(c),jQuery.each(d,function(a,b){var c=jQuery("<button>").addClass("btn btn-primary").text(b.text);e.find(".modal-footer").append(c),c.click(function(){b.callback()}),c.attr("data-dismiss","modal")}),e.modal(),e},a.simple_form=function(b,c,d,e,f){var g=e||jQuery.noop,h=f||!0,i=a.base_modal();i.find(".modal-header-inner").html(b),i.find(".modal-body").empty().append(c).append(d);var j=jQuery("<button>").addClass("btn btn-primary").text("Ok"),k=jQuery("<button>").addClass("btn btn-default").text("Cancel");return i.find(".modal-footer").append(j).append(k),j.click(function(){i.modal("hide"),g(d)}),k.attr("data-dismiss","modal"),h||j.attr("data-dismiss","modal"),i.modal(),i},a.simple_form_no_dismiss=function(b,c,d,e){return a.simple_form(b,c,d,e,!0)},a.simple_input=function(b,c,d,e,f){var g=e||jQuery.noop,h=f||!1,i=a.base_modal();i.find(".modal-header-inner").html(b);var j=jQuery("<label>").text(c),k=jQuery("<input>").attr("type","text").attr("name","input").addClass("form-control").attr("value",d),l=jQuery("<span>").text("error message").addClass("help-block hide"),m=jQuery("<div>").addClass("form-group form-group-input has-feedback").append(j).append(k).append(l),n=function(){var a=k.val();!h||""!=a&&void 0!=k?(i.modal("hide"),g(a)):m.addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text("Field Required")},o=jQuery("<form>").append(m).submit(function(a){a.preventDefault(),n()});i.find(".modal-body").empty().append(o);var p=jQuery("<button>").addClass("btn btn-primary").text("Ok"),q=jQuery("<button>").addClass("btn btn-default").text("Cancel");return i.find(".modal-footer").append(p).append(q),p.click(n),q.attr("data-dismiss","modal"),h||p.attr("data-dismiss","modal"),i.modal(),i}}}function RelationshipFactory(){return function(a){function b(a){this.name=a.name,this.type=a.type,this.opts=a.opts,this.to=a.to,this.class_name=function(){return this.type.split(".").reverse()[0]},this.form_update=function(a){this.name=jQuery(a).find("input[name=name]").val(),this.type=jQuery(a).find("select[name=type]").val(),this.opts=jQuery(a).find("input[name=opts]").val(),this.to=jQuery(a).find("input[name=to]").val()},this.to_clean=function(){return this.to.replace(/['"]+/g,"")},this.to_class=function(){return this.to.split(".").reverse().shift()},this.opts_args=function(){return this.opts.split(",").join(", ")},this.to_module=function(){var a=this.to.split(".");return a.slice(0,a.length-1).join(".")},this.module=function(){var a=this.type.split(".");return a.slice(0,a.length-1).join(".")},this.edit_form=function(a){var b=jQuery("<form>"),c=jQuery("<div>").addClass("form-group form-group-name has-feedback").appendTo(b),d=jQuery("<div>").addClass("form-group form-group-type").appendTo(b),e=jQuery("<div>").addClass("form-group form-group-args").appendTo(b),f=jQuery("<div>").addClass("form-group form-group-args").appendTo(b);c.append(jQuery("<label>").text("Name")),c.append(jQuery("<input>").attr("name","name").addClass("form-control").val(this.name)),c.append(jQuery("<span>").text("error message").addClass("help-block hide")),d.append(jQuery("<label>").text("To")),d.append(jQuery("<input>").attr("name","to").attr("placeholder","to").addClass("form-control").val(this.to));var g=jQuery("<select>").attr("name","type").addClass("form-control"),h=this;return jQuery.each(a.relationship_factory.relationship_types(),function(a,b){var c=jQuery("<option>").attr("val",b).text(b);b==h.type&&c.attr("selected","selected"),g.append(c)}),e.append(jQuery("<label>").text("Field Type")),e.append(g),f.append(jQuery("<label>").text("Arguments")),f.append(jQuery("<input>").attr("name","opts").attr("placeholder","options").addClass("form-control").val(this.args)),b}}var c=this;c.relationship_types=function(){return["django.db.models.ForeignKey","django.db.models.OneToOneField","django.db.models.ManyToManyField"]},c.relationship_matches=function(){return c.relationship_types+["ForeignKey","OneToOneField","ManyToManyField","models.ForeignKey","models.OneToOneField","models.ManyToManyField"]},c.relationship_match=function(a){return-1!=c.relationship_matches().indexOf(a)},c.make_relationship=function(a){return new b(a)}}}function FieldFactory(){return function(a){function b(a){this.name=a.name,this.type=a.type,this.opts=a.opts||"",this.class_name=function(){return this.type.split(".").reverse()[0]},this.opts_args=function(){return this.opts.split(",").join(", ")},this.to_clean=function(){return this.to.replace(/['"]+/g,"")},this.module=function(){var a=this.type.split(".");return a.slice(0,a.length-1).join(".")},this.form_update=function(a){this.name=jQuery(a).find("input[name=name]").val(),this.type=jQuery(a).find("select[name=type]").val(),this.opts=jQuery(a).find("input[name=opts]").val()},this.edit_form=function(a){var b=jQuery("<form>"),c=jQuery("<div>").addClass("form-group form-group-name has-feedback").appendTo(b),d=jQuery("<div>").addClass("form-group form-group-type").appendTo(b),e=jQuery("<div>").addClass("form-group form-group-args").appendTo(b);c.append(jQuery("<label>").text("Name")),c.append(jQuery("<input>").attr("name","name").addClass("form-control").val(this.name)),c.append(jQuery("<span>").text("error message").addClass("help-block hide"));var f=jQuery("<select>").attr("name","type").addClass("form-control"),g=this;return jQuery.each(a.field_factory.field_types(),function(a,b){var c=jQuery("<option>").attr("val",b).text(b);b==g.type&&c.attr("selected","selected"),f.append(c)}),d.append(jQuery("<label>").text("Field Type")),d.append(f),e.append(jQuery("<label>").text("Arguments")),e.append(jQuery("<input>").attr("name","opts").attr("placeholder","options").addClass("form-control").val(this.opts)),b}}var c=this;c.fields=function(){return{"django.db.models.TextField":{default_args:"max_length=100"},"django.db.models.CharField":{default_args:"max_length=30"},"django.contrib.contenttypes.fields.GenericForeignKey":{default_args:'"content_type", "object_id"'},"django_extensions.db.fields.AutoSlugField":{},"django.db.models.CommaSeparatedIntegerField":{},"django.db.models.BigAutoField":{},"django.db.models.BigIntegerField":{},"django.db.models.BooleanField":{},"django.db.models.DateField":{},"django.db.models.DateTimeField":{},"django.db.models.DecimalField":{default_args:"max_digits=10, decimal_places=2"},"django.db.models.DurationField":{},"django.db.models.FileField":{default_args:'upload_to="/upload/files/"'},"django.db.models.ImageField":{default_args:'upload_to="/upload/images/"'},"django.db.models.FilePathField":{},"django.db.models.FloatField":{},"django.db.models.IntegerField":{},"django.db.models.PositiveIntegerField":{},"django.db.models.PositiveSmallIntegerField":{},"django.db.models.SlugField":{},"django.db.models.IPAddressField":{},"django.db.models.GenericIPAddressField":{},"django.db.models.NullBooleanField":{},"django.db.models.TimeField":{},"django.db.models.BinaryField":{},"django.db.models.AutoField":{},"django.db.models.SmallIntegerField":{},"django.db.models.URLField":{},"django.db.models.UUIDField":{},"django.db.models.EmailField":{}}},c.default_field_args=function(a){var b=c.fields()[a];return b&&b.default_args?b.default_args:""},c.field_types=function(){return Object.keys(c.fields())},c.make_field=function(a){return new b(a)}}}function ModelServiceFactory(){return function(a,b){function c(a){this.slugify=function(a){return a.toString().replace(/\s+/g,"").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"").replace(/^-+/,"").replace(/-+$/,"")},this.set_name=function(a){this.name=this.slugify(a)},this.set_name(a.name),this.fields=[];a.fields||[];this.fields=(a.fields||[]).map(b.field_factory.make_field),this.relationships=(a.relationships||[]).map(b.relationship_factory.make_relationship),this.relationship_names=function(){var a=this;return Object.keys(a.relationships).map(function(b){return a.relationships[b].name})},this.field_names=function(){var a=this;return Object.keys(a.fields).map(function(b){return a.fields[b].name})},this.l_name=function(){return this.name.toLowerCase()},this.has_relationship=function(a){return-1!=this.relationship_names().indexOf(a)},this.has_field=function(a){return-1!=this.field_names().indexOf(a)},this.name_field=function(){return-1!=this.field_names().indexOf("name")?"name":"id"},this.ordering_field=function(){return-1!=this.field_names().indexOf("created")?"created":"id"},this.identifier=function(){return-1!=this.field_names().indexOf("slug")?"slug":"id"},this.render_forms=function(a,b){var c="";return c+="class "+this.name+"Form(forms.ModelForm):\n",c+=b.spaces(4)+"class Meta:\n",c+=b.spaces(8)+"model = "+this.name+"\n",this.form_fields()&&(c+=b.spaces(8)+"fields = "+this.form_fields()+"\n"),c+=b.new_lines(2)},this.get_initial_data=function(a,b){var c="{";return c+=b.new_lines(1),jQuery.each(this.readable_fields(),function(a,d){c+=b.spaces(12)+'"'+d.name+'": "'+d.name+'",',c+=b.new_lines(1)}),jQuery.each(this.relationships,function(a,d){c+=b.spaces(12)+'"'+d.name+'": create_'+d.to.toLowerCase()+"().id,",c+=b.new_lines(1)}),c+=b.spaces(8)+"}"},this.render_tests_helpers=function(a,b){var c="";return c+="def create_"+this.l_name()+"(**kwargs):\n",c+=b.spaces(4)+"defaults = {}\n",jQuery.each(this.readable_fields(),function(a,d){c+=b.spaces(4)+'defaults["'+d.name+'"] = "'+d.name+'"\n'}),c+=b.spaces(4)+"defaults.update(**kwargs)\n",jQuery.each(this.relationships,function(a,d){c+=b.spaces(4)+'if "'+d.name+'" not in defaults:\n';var e="create_"+d.to.toLowerCase();b.built_in_models[d.to]&&(e="create_"+d.to.toLowerCase().replace(/\./g,"_")),c+=b.spaces(8)+'defaults["'+d.name+'"] = '+e+"()\n"}),c+=b.spaces(4)+"return "+this.name+".objects.create(**defaults)\n",c+=b.new_lines(2)},this.render_tests=function(a,b){var c="";return c+="class "+this.name+"ViewTest(unittest.TestCase):\n",c+=b.spaces(4)+"'''\n",c+=b.spaces(4)+"Tests for "+this.name+"\n",c+=b.spaces(4)+"'''\n",c+=b.spaces(4)+"def setUp(self):\n",c+=b.spaces(8)+"self.client = Client()\n",c+=b.new_lines(1),c+=b.spaces(4)+"def test_list_"+this.l_name()+"(self):\n",c+=b.spaces(8)+"url = reverse('"+a+"_"+this.l_name()+"_list')\n",c+=b.spaces(8)+"response = self.client.get(url)\n",c+=b.spaces(8)+"self.assertEqual(response.status_code, 200)\n",c+=b.new_lines(1),c+=b.spaces(4)+"def test_create_"+this.l_name()+"(self):\n",c+=b.spaces(8)+"url = reverse('"+a+"_"+this.l_name()+"_create')\n",c+=b.spaces(8)+"data = "+this.get_initial_data(a,b)+"\n",c+=b.spaces(8)+"response = self.client.post(url, data=data)\n",c+=b.spaces(8)+"self.assertEqual(response.status_code, 302)\n",c+=b.new_lines(1),c+=b.spaces(4)+"def test_detail_"+this.l_name()+"(self):\n",c+=b.spaces(8)+this.l_name()+" = create_"+this.l_name()+"()\n",c+=b.spaces(8)+"url = reverse('"+a+"_"+this.l_name()+"_detail', args=["+this.l_name()+"."+this.identifier()+",])\n",c+=b.spaces(8)+"response = self.client.get(url)\n",c+=b.spaces(8)+"self.assertEqual(response.status_code, 200)\n",c+=b.new_lines(1),c+=b.spaces(4)+"def test_update_"+this.l_name()+"(self):\n",c+=b.spaces(8)+this.l_name()+" = create_"+this.l_name()+"()\n",c+=b.spaces(8)+"data = "+this.get_initial_data(a,b)+"\n",c+=b.spaces(8)+"url = reverse('"+a+"_"+this.l_name()+"_update', args=["+this.l_name()+"."+this.identifier()+",])\n",c+=b.spaces(8)+"response = self.client.post(url, data)\n",c+=b.spaces(8)+"self.assertEqual(response.status_code, 302)\n",c+=b.new_lines(2)},this.render_urls=function(a,b){var c="";return c+="urlpatterns += (\n",c+=b.spaces(4)+"# urls for "+this.name+"\n",c+=b.spaces(4)+"url(r'^"+a+"/"+this.l_name()+"/$', views."+this.name+"ListView.as_view(), name='"+a+"_"+this.l_name()+"_list'),\n",c+=b.spaces(4)+"url(r'^"+a+"/"+this.l_name()+"/create/$', views."+this.name+"CreateView.as_view(), name='"+a+"_"+this.l_name()+"_create'),\n",c+=b.spaces(4)+"url(r'^"+a+"/"+this.l_name()+"/detail/(?P<"+this.identifier()+">\\S+)/$', views."+this.name+"DetailView.as_view(), name='"+a+"_"+this.l_name()+"_detail'),\n",c+=b.spaces(4)+"url(r'^"+a+"/"+this.l_name()+"/update/(?P<"+this.identifier()+">\\S+)/$', views."+this.name+"UpdateView.as_view(), name='"+a+"_"+this.l_name()+"_update'),\n",c+=")\n",c+=b.new_lines(1)},this.render_admin_classes=function(a,b){var c="";c+="class "+this.name+"AdminForm(forms.ModelForm):\n",c+=b.new_lines(1),c+=b.spaces(4)+"class Meta:\n",c+=b.spaces(8)+"model = "+this.name+"\n",c+=b.spaces(8)+"fields = '__all__'\n",c+=b.new_lines(2),c+="class "+this.name+"Admin(admin.ModelAdmin):\n",c+=b.spaces(4)+"form = "+this.name+"AdminForm\n";var d=this.admin_fields();return d.length>0?(c+=b.spaces(4)+"list_display = "+this.admin_fields()+"\n",c+=b.spaces(4)+"readonly_fields = "+this.admin_read_only_fields()+"\n"):c+=b.new_lines(1),c+=b.new_lines(1),c+="admin.site.register("+this.name+", "+this.name+"Admin)\n",c+=b.new_lines(2)},this.render_view_classes=function(a,b){var c=b.new_lines(1);return c+="class "+this.name+"ListView(ListView):\n",c+=b.spaces(4)+"model = "+this.name+"\n",c+=b.new_lines(2),c+="class "+this.name+"CreateView(CreateView):\n",c+=b.spaces(4)+"model = "+this.name+"\n",c+=b.spaces(4)+"form_class = "+this.name+"Form\n",c+=b.new_lines(2),c+="class "+this.name+"DetailView(DetailView):\n",c+=b.spaces(4)+"model = "+this.name+"\n",c+=b.new_lines(2),c+="class "+this.name+"UpdateView(UpdateView):\n",c+=b.spaces(4)+"model = "+this.name+"\n",c+=b.spaces(4)+"form_class = "+this.name+"Form",c+=b.new_lines(2)},this.render_model_class_header=function(a,b){var c="class "+this.name+"(models.Model):";return c+b.new_lines(2)},this.render_model_class_fields=function(a,b){var c="";return this.fields.length>0&&(c+=b.spaces(4)+"# Fields",c+=b.new_lines(1)),jQuery.each(this.fields,function(a,d){if(-1==b.pre_imported_modules_names().indexOf(d.module()))c+=b.spaces(4)+d.name+" = "+d.class_name()+"("+d.opts+")";else{var e=b.pre_imported_modules()[d.module()].as;c+=b.spaces(4)+d.name+" = "+e+"."+d.class_name()+"("+d.opts+")"}c+=b.new_lines(1)}),c+=b.new_lines(1)},this.render_model_class_relationships=function(a,c){var d="";return this.relationships.length>0&&(d+=c.spaces(4)+"# Relationship Fields",d+=c.new_lines(1)),jQuery.each(this.relationships,function(e,f){var g="'"+a+"."+f.to_clean()+"'";if(f.to==b.user_model?g=b.user_model_setting:c.built_in_models[f.to]&&(g=f.to_class()),-1==c.pre_imported_modules_names().indexOf(f.module()))d+=c.spaces(4)+f.name+" = "+f.class_name()+"("+g+", "+f.opts+")";else{var h=c.pre_imported_modules()[f.module()].as;d+=c.spaces(4)+f.name+" = "+h+"."+f.class_name()+"("+g+", "+f.opts+")"}d+=c.new_lines(1)}),d},this.render_model_class=function(a,b){var c=this.render_model_class_header(a,b);return c+=this.render_model_class_fields(a,b),c+=this.render_model_class_relationships(a,b),c+=b.new_lines(1),c+=b.spaces(4)+"class Meta:",c+=b.new_lines(1),c+=b.spaces(8)+"ordering = ('-"+this.ordering_field()+"',)",c+=b.new_lines(2),c+=b.spaces(4)+"def __unicode__(self):",c+=b.new_lines(1),c+=b.spaces(8)+"return u'%s' % self."+this.identifier(),c+=b.new_lines(2),c+=b.spaces(4)+"def get_absolute_url(self):",c+=b.new_lines(1),c+=b.spaces(8)+"return reverse('"+a+"_"+this.l_name()+"_detail', args=(self."+this.identifier()+",))",c+=b.new_lines(1),c+=b.new_lines(2),c+=b.spaces(4)+"def get_update_url(self):",c+=b.new_lines(1),c+=b.spaces(8)+"return reverse('"+a+"_"+this.l_name()+"_update', args=(self."+this.identifier()+",))",c+=b.new_lines(3)},this.render_model_class_fields_only=function(a,b){var c="";return c+=this.render_model_class_header(a,b),c+=this.render_model_class_fields(a,b)},this.render_model_api=function(a,b){var c="class "+this.name+"ViewSet(viewsets.ModelViewSet):"+b.new_lines(1);return c+=b.spaces(4)+'"""ViewSet for the '+this.name+' class"""',c+=b.new_lines(2),c+=b.spaces(4)+"queryset = models."+this.name+".objects.all()"+b.new_lines(1),c+=b.spaces(4)+"serializer_class = serializers."+this.name+"Serializer"+b.new_lines(1),c+=b.spaces(4)+"permission_classes = [permissions.IsAuthenticated]"+b.new_lines(1),c+=b.new_lines(2)},this.render_model_serializer=function(a,b){var c="class "+this.name+"Serializer(serializers.ModelSerializer):";c+=b.new_lines(2),c+=b.spaces(4)+"class Meta:"+b.new_lines(1),c+=b.spaces(8)+"model = models."+this.name+b.new_lines(1),c+=b.spaces(8)+"fields = ("+b.new_lines(1),c+=b.spaces(12)+"'"+this.identifier()+"', "+b.new_lines(1);var d=this;return jQuery.each(this.fields,function(a,e){e.name!=d.identifier()&&(c+=b.spaces(12)+"'"+e.name+"', "+b.new_lines(1))}),c+=b.spaces(8)+")"+b.new_lines(3)},this._template_header=function(){return'{% extends "base.html" %}\n{% load static %}\n'},this._template_links=function(a){var b=a+"_"+this.l_name()+"_list";return'<p><a class="btn btn-default" href="{% url \''+b+"' %}\">"+this.name+" Listing</a></p>\n"},this._wrap_block=function(a,b){return"{% block "+a+" %}\n"+b+"\n{% endblock %}"},this.render_form_html=function(a){var b=this._template_header();b+="{% load crispy_forms_tags %}\n";var c=this._template_links(a)+'<form method="post">\n';return c+="{% csrf_token %}\n{{form|crispy}}\n",c+='<button class="btn btn-primary" type="submit">Submit</button>\n',c+="</form>",b+=this._wrap_block("content",c)},this.render_list_html=function(a){var b=a+"_"+this.l_name()+"_create",c=this._template_header(),d=this._template_links(a)+'<table class="table">\n';return d+="<tr>\n",d+="<td>ID</td><td>Link</td>\n",jQuery.each(this.fields,function(a,b){d+="    <td>"+b.name+"</td>\n"}),d+="</tr>\n",d+="{% for object in object_list %}\n",d+="<tr>\n",d+="    <td>{{object.id}}</td>\n",d+='    <td><a href="{{object.get_absolute_url}}">{{object}}</a></td>\n',jQuery.each(this.fields,function(a,b){d+="    <td>{{ object."+b.name+" }}</td>\n"}),d+="</tr>\n",d+="{% endfor %}\n",d+="</table>",d+='<a class="btn btn-primary" href="{% url \''+b+"' %}\">Create new "+this.name+"</a>",c+=this._wrap_block("content",d)},this.render_detail_html=function(a){var b=this._template_header(),c=this._template_links(a)+'<table class="table">\n';return jQuery.each(this.fields,function(a,b){c+="<tr><td>"+b.name+"</td><td>{{ object."+b.name+" }}</td></tr>\n"}),c+="</table>",c+='\n<a class="btn btn-primary" href="{{object.get_update_url}}">Edit '+this.name+"</a>\n",b+=this._wrap_block("content",c)},this.form_fields=function(){var a=this.readable_fields().map(function(a){return a.name}),b=this.relationships.map(function(a){return a.name}),c=a.concat(b);return c.length?"['"+c.join("', '")+"']":"'__all__'"},this.readable_fields=function(){var a=[];return jQuery.each(this.fields,function(b,c){-1==c.opts.indexOf("readonly")&&-1==c.opts.indexOf("editable")&&-1==c.opts.indexOf("auto_now_add")&&"django.contrib.contenttypes.fields.GenericForeignKey"!=c.type&&"django_extensions.db.fields.AutoSlugField"!=c.type&&a.push(c)}),a},this.admin_fields=function(){return this.field_names().length>0?"['"+this.field_names().join("', '")+"']":""},this.admin_read_only_fields=function(){return this.field_names().length>0?"['"+this.field_names().join("', '")+"']":""}}return new c(a)}}function ModelParserFactory(){return function(a){function b(){this.parse=function(b,c){var d=new FileReader;d.onload=function(b){var e=d.result,f=e.split("\n"),g=[],h=null,i="",j=new RegExp("class ([a-zA-Z_]*)[(]([a-zA-Z._]*)[)][:]$"),k=new RegExp("^([a-zA-Z0-9_]+) = ([a-zA-Z0-9._]+)[(](.*)[)]$");jQuery.each(f,function(b,c){c=c.trim();var d=j.exec(c);d&&d[2].match(/model/i)&&(console.log("Model:",d[1]),h={name:d[1],"class":d[2],fields:[],relationships:[]},g.push(h),i="");var e,f=k.exec(c);f&&(e=f);var l=k.exec(i);if(l&&(e=l),e){if(h&&e[2]&&(e[2].match(/field/i)||a.relationship_factory.relationship_match(e[2]))){var m=a.relationship_factory.relationship_match(e[2]);if(m){var n=e[1],o=e[2],p=e[3].split(","),q=p.shift(),r=p.join(",").trim();console.log("Model:",h.name,"Relationship:",n,o,q,r),h.relationships.push(a.relationship_factory.make_relationship({name:n,type:o,opts:r,to:q}))}else{var s=e[1],t=e[2],u=e[3];console.log("Model:",h.name,"Field:",s,t,u),h.fields.push(a.field_factory.make_field({name:s,type:t,opts:u}))}}i=""}else h&&(i+=c)});var l=[];jQuery.each(g,function(b,c){var d=a.model_factory(c,a);l.push(d)}),c&&c(l)},d.readAsText(b)}}return new b}}ace.define("ace/mode/python",["require","exports","module","ace/lib/oop","ace/mode/text","ace/tokenizer","ace/mode/python_highlight_rules","ace/mode/folding/pythonic","ace/range"],function(a,b,c){var d=a("../lib/oop"),e=a("./text").Mode,f=(a("../tokenizer").Tokenizer,a("./python_highlight_rules").PythonHighlightRules),g=a("./folding/pythonic").FoldMode,h=a("../range").Range,i=function(){this.HighlightRules=f,this.foldingRules=new g("\\:")};d.inherits(i,e),function(){this.lineCommentStart="#",this.getNextLineIndent=function(a,b,c){var d=this.$getIndent(b),e=this.getTokenizer().getLineTokens(b,a),f=e.tokens;if(f.length&&"comment"==f[f.length-1].type)return d;if("start"==a){var g=b.match(/^.*[\{\(\[\:]\s*$/);g&&(d+=c)}return d};var a={pass:1,"return":1,raise:1,"break":1,"continue":1};this.checkOutdent=function(b,c,d){if("\r\n"!==d&&"\r"!==d&&"\n"!==d)return!1;var e=this.getTokenizer().getLineTokens(c.trim(),b).tokens;if(!e)return!1;do var f=e.pop();while(f&&("comment"==f.type||"text"==f.type&&f.value.match(/^\s+$/)));return f?"keyword"==f.type&&a[f.value]:!1},this.autoOutdent=function(a,b,c){c+=1;var d=this.$getIndent(b.getLine(c)),e=b.getTabString();d.slice(-e.length)==e&&b.remove(new h(c,d.length-e.length,c,d.length))},this.$id="ace/mode/python"}.call(i.prototype),b.Mode=i}),ace.define("ace/mode/python_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/text_highlight_rules"],function(a,b,c){var d=a("../lib/oop"),e=a("./text_highlight_rules").TextHighlightRules,f=function(){var a="and|as|assert|break|class|continue|def|del|elif|else|except|exec|finally|for|from|global|if|import|in|is|lambda|not|or|pass|print|raise|return|try|while|with|yield",b="True|False|None|NotImplemented|Ellipsis|__debug__",c="abs|divmod|input|open|staticmethod|all|enumerate|int|ord|str|any|eval|isinstance|pow|sum|basestring|execfile|issubclass|print|super|binfile|iter|property|tuple|bool|filter|len|range|type|bytearray|float|list|raw_input|unichr|callable|format|locals|reduce|unicode|chr|frozenset|long|reload|vars|classmethod|getattr|map|repr|xrange|cmp|globals|max|reversed|zip|compile|hasattr|memoryview|round|__import__|complex|hash|min|set|apply|delattr|help|next|setattr|buffer|dict|hex|object|slice|coerce|dir|id|oct|sorted|intern",d=this.createKeywordMapper({"invalid.deprecated":"debugger","support.function":c,"constant.language":b,keyword:a},"identifier"),e="(?:r|u|ur|R|U|UR|Ur|uR)?",f="(?:(?:[1-9]\\d*)|(?:0))",g="(?:0[oO]?[0-7]+)",h="(?:0[xX][\\dA-Fa-f]+)",i="(?:0[bB][01]+)",j="(?:"+f+"|"+g+"|"+h+"|"+i+")",k="(?:[eE][+-]?\\d+)",l="(?:\\.\\d+)",m="(?:\\d+)",n="(?:(?:"+m+"?"+l+")|(?:"+m+"\\.))",o="(?:(?:"+n+"|"+m+")"+k+")",p="(?:"+o+"|"+n+")",q="\\\\(x[0-9A-Fa-f]{2}|[0-7]{3}|[\\\\abfnrtv'\"]|U[0-9A-Fa-f]{8}|u[0-9A-Fa-f]{4})";this.$rules={start:[{token:"comment",regex:"#.*$"},{token:"string",regex:e+'"{3}',next:"qqstring3"},{token:"string",regex:e+'"(?=.)',next:"qqstring"},{token:"string",regex:e+"'{3}",next:"qstring3"},{token:"string",regex:e+"'(?=.)",next:"qstring"},{token:"constant.numeric",regex:"(?:"+p+"|\\d+)[jJ]\\b"},{token:"constant.numeric",regex:p},{token:"constant.numeric",regex:j+"[lL]\\b"},{token:"constant.numeric",regex:j+"\\b"},{token:d,regex:"[a-zA-Z_$][a-zA-Z0-9_$]*\\b"},{token:"keyword.operator",regex:"\\+|\\-|\\*|\\*\\*|\\/|\\/\\/|%|<<|>>|&|\\||\\^|~|<|>|<=|=>|==|!=|<>|="},{token:"paren.lparen",regex:"[\\[\\(\\{]"},{token:"paren.rparen",regex:"[\\]\\)\\}]"},{token:"text",regex:"\\s+"}],qqstring3:[{token:"constant.language.escape",regex:q},{token:"string",regex:'"{3}',next:"start"},{defaultToken:"string"}],qstring3:[{token:"constant.language.escape",regex:q},{token:"string",regex:"'{3}",next:"start"},{defaultToken:"string"}],qqstring:[{token:"constant.language.escape",regex:q},{token:"string",regex:"\\\\$",next:"qqstring"},{token:"string",regex:'"|$',next:"start"},{defaultToken:"string"}],qstring:[{token:"constant.language.escape",regex:q},{token:"string",regex:"\\\\$",next:"qstring"},{token:"string",regex:"'|$",next:"start"},{defaultToken:"string"}]}};d.inherits(f,e),b.PythonHighlightRules=f}),ace.define("ace/mode/folding/pythonic",["require","exports","module","ace/lib/oop","ace/mode/folding/fold_mode"],function(a,b,c){var d=a("../../lib/oop"),e=a("./fold_mode").FoldMode,f=b.FoldMode=function(a){this.foldingStartMarker=new RegExp("([\\[{])(?:\\s*)$|("+a+")(?:\\s*)(?:#.*)?$")};d.inherits(f,e),function(){this.getFoldWidgetRange=function(a,b,c){var d=a.getLine(c),e=d.match(this.foldingStartMarker);return e?e[1]?this.openingBracketBlock(a,e[1],c,e.index):e[2]?this.indentationBlock(a,c,e.index+e[2].length):this.indentationBlock(a,c):void 0;
}}.call(f.prototype)}),ace.define("ace/theme/dawn",["require","exports","module","ace/lib/dom"],function(a,b,c){b.isDark=!1,b.cssClass="ace-dawn",b.cssText=".ace-dawn .ace_gutter {background: #ebebeb;color: #333}.ace-dawn .ace_print-margin {width: 1px;background: #e8e8e8}.ace-dawn {background-color: #F9F9F9;color: #080808}.ace-dawn .ace_cursor {color: #000000}.ace-dawn .ace_marker-layer .ace_selection {background: rgba(39, 95, 255, 0.30)}.ace-dawn.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px #F9F9F9;border-radius: 2px}.ace-dawn .ace_marker-layer .ace_step {background: rgb(255, 255, 0)}.ace-dawn .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgba(75, 75, 126, 0.50)}.ace-dawn .ace_marker-layer .ace_active-line {background: rgba(36, 99, 180, 0.12)}.ace-dawn .ace_gutter-active-line {background-color : #dcdcdc}.ace-dawn .ace_marker-layer .ace_selected-word {border: 1px solid rgba(39, 95, 255, 0.30)}.ace-dawn .ace_invisible {color: rgba(75, 75, 126, 0.50)}.ace-dawn .ace_keyword,.ace-dawn .ace_meta {color: #794938}.ace-dawn .ace_constant,.ace-dawn .ace_constant.ace_character,.ace-dawn .ace_constant.ace_character.ace_escape,.ace-dawn .ace_constant.ace_other {color: #811F24}.ace-dawn .ace_invalid.ace_illegal {text-decoration: underline;font-style: italic;color: #F8F8F8;background-color: #B52A1D}.ace-dawn .ace_invalid.ace_deprecated {text-decoration: underline;font-style: italic;color: #B52A1D}.ace-dawn .ace_support {color: #691C97}.ace-dawn .ace_support.ace_constant {color: #B4371F}.ace-dawn .ace_fold {background-color: #794938;border-color: #080808}.ace-dawn .ace_list,.ace-dawn .ace_markup.ace_list,.ace-dawn .ace_support.ace_function {color: #693A17}.ace-dawn .ace_storage {font-style: italic;color: #A71D5D}.ace-dawn .ace_string {color: #0B6125}.ace-dawn .ace_string.ace_regexp {color: #CF5628}.ace-dawn .ace_comment {font-style: italic;color: #5A525F}.ace-dawn .ace_heading,.ace-dawn .ace_markup.ace_heading {color: #19356D}.ace-dawn .ace_variable {color: #234A97}.ace-dawn .ace_indent-guide {background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAEklEQVQImWNgYGBgYLh/5+x/AAizA4hxNNsZAAAAAElFTkSuQmCC) right repeat-y}";var d=a("../lib/dom");d.importCssString(b.cssText,b.cssClass)});var global=Function("return this;")();!function(a){function b(a){var b=g[a]||window[a];if(!b)throw new Error("Requested module '"+a+"' has not been defined.");return b}function c(a,b){return g[a]=b}function d(a,b){for(var c in b)"noConflict"!=c&&"_VERSION"!=c&&(a[c]=b[c]);return a}function e(a,b,c){return"string"==typeof a||a.nodeName||a.length&&"item"in a||a==window?(c=f._select(a,b),c.selector=a):c=isFinite(a.length)?a:[a],d(c,e)}function f(a,b){return e(a,b)}a.global=a;var g={},h=a.$;a.provide=c,a.require=b,d(f,{_VERSION:"0.3.6",fn:e,ender:function(a,b){d(b?e:f,a)},_select:function(a,b){return(b||document).querySelectorAll(a)}}),d(e,{forEach:function(a,b,c){for(c=0,l=this.length;c<l;++c)c in this&&a.call(b||this[c],this[c],c,this);return this},$:f}),f.noConflict=function(){return a.$=h,this},"undefined"!=typeof module&&module.exports&&(module.exports=f),a.ender=a.$=a.ender||f}(this),function(a){var b={exports:{}};b.exports,require("ender");!function(){"use strict";function a(a){var b,c=new Uint8Array(a);for(b=0;a>b;b+=1)c[b]=0;return c}function c(b,c,d,e){var f=c+d,g=a((parseInt(f/e)+1)*e);return g.set(b),g}function d(a,b,c){return a=a.toString(c||8),"000000000000".substr(a.length+12-b)+a}function e(b,c,d){var e,f;for(c=c||a(b.length),d=d||0,e=0,f=b.length;f>e;e+=1)c[d]=b.charCodeAt(e),d+=1;return c}function f(a){function b(a){return g[a>>18&63]+g[a>>12&63]+g[a>>6&63]+g[63&a]}var c,d,e,f=a.length%3,h="";for(c=0,e=a.length-f;e>c;c+=3)d=(a[c]<<16)+(a[c+1]<<8)+a[c+2],h+=b(d);switch(h.length%4){case 1:h+="=";break;case 2:h+="=="}return h}var g=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"];b.exports.clean=a,b.exports.pad=d,b.exports.extend=c,b.exports.stringToUint8=e,b.exports.uint8ToBase64=f}(),provide("tar-js/utils",b.exports)}(global),function(a){var b={exports:{}};b.exports,require("ender");!function(){"use strict";function a(a,b){var e=d.clean(512),f=0;return c.forEach(function(b){var c,d,g=a[b.field]||"";for(c=0,d=g.length;d>c;c+=1)e[f]=g.charCodeAt(c),f+=1;f+=b.length-c}),"function"==typeof b?b(e,f):e}var c,d=require("tar-js/utils");c=[{field:"fileName",length:100},{field:"fileMode",length:8},{field:"uid",length:8},{field:"gid",length:8},{field:"fileSize",length:12},{field:"mtime",length:12},{field:"checksum",length:8},{field:"type",length:1},{field:"linkName",length:100},{field:"ustar",length:8},{field:"owner",length:32},{field:"group",length:32},{field:"majorNumber",length:8},{field:"minorNumber",length:8},{field:"filenamePrefix",length:155},{field:"padding",length:12}],b.exports.structure=c,b.exports.format=a}(),provide("tar-js/header",b.exports)}(global),function(a){var b={exports:{}};b.exports,require("ender");!function(){"use strict";function a(a){this.written=0,c=(a||20)*f,this.out=e.clean(c)}var c,d=require("tar-js/header"),e=require("tar-js/utils"),f=512;a.prototype.append=function(a,b,g,h){var i,j,k,l,m,n,o;if("string"==typeof b)b=e.stringToUint8(b);else if(b.constructor!==Uint8Array.prototype.constructor)throw"Invalid input type. You gave me: "+b.constructor.toString().match(/function\s*([$A-Za-z_][0-9A-Za-z_]*)\s*\(/)[1];"function"==typeof g&&(h=g,g={}),g=g||{},k=g.mode||4095&parseInt("777",8),l=g.mtime||Math.floor(+new Date/1e3),m=g.uid||0,n=g.gid||0,i={fileName:a,fileMode:e.pad(k,7),uid:e.pad(m,7),gid:e.pad(n,7),fileSize:e.pad(b.length,11),mtime:e.pad(l,11),checksum:"        ",type:"0",ustar:"ustar  ",owner:g.owner||"",group:g.group||""},j=0,Object.keys(i).forEach(function(a){var b,c,d=i[a];for(b=0,c=d.length;c>b;b+=1)j+=d.charCodeAt(b)}),i.checksum=e.pad(j,6)+"\x00 ",o=d.format(i);return this.out.set(o,this.written),this.written+=o.length,this.written+b.length>this.out.length&&(this.out=e.extend(this.out,this.written,b.length,c)),this.out.set(b,this.written),this.written+=b.length+(f-(b.length%f||f)),this.out.length-this.written<2*f&&(this.out=e.extend(this.out,this.written,2*f,c)),"function"==typeof h&&h(this.out),this.out},a.prototype.clear=function(){this.written=0,this.out=e.clean(c)},b.exports=a}(),provide("tar-js",b.exports)}(global),angular.module("ui.ace",[]).constant("uiAceConfig",{}).directive("uiAce",["uiAceConfig",function(a){if(angular.isUndefined(window.ace))throw new Error("ui-ace need ace to work... (o rly?)");var b=function(a,b,c){if(angular.isDefined(c.workerPath)){var d=window.ace.require("ace/config");d.set("workerPath",c.workerPath)}angular.isDefined(c.require)&&c.require.forEach(function(a){window.ace.require(a)}),angular.isDefined(c.showGutter)&&a.renderer.setShowGutter(c.showGutter),angular.isDefined(c.useWrapMode)&&b.setUseWrapMode(c.useWrapMode),angular.isDefined(c.showInvisibles)&&a.renderer.setShowInvisibles(c.showInvisibles),angular.isDefined(c.showIndentGuides)&&a.renderer.setDisplayIndentGuides(c.showIndentGuides),angular.isDefined(c.useSoftTabs)&&b.setUseSoftTabs(c.useSoftTabs),angular.isDefined(c.showPrintMargin)&&a.setShowPrintMargin(c.showPrintMargin),angular.isDefined(c.disableSearch)&&c.disableSearch&&a.commands.addCommands([{name:"unfind",bindKey:{win:"Ctrl-F",mac:"Command-F"},exec:function(){return!1},readOnly:!0}]),angular.isString(c.theme)&&a.setTheme("ace/theme/"+c.theme),angular.isString(c.mode)&&b.setMode("ace/mode/"+c.mode),angular.isDefined(c.firstLineNumber)&&(angular.isNumber(c.firstLineNumber)?b.setOption("firstLineNumber",c.firstLineNumber):angular.isFunction(c.firstLineNumber)&&b.setOption("firstLineNumber",c.firstLineNumber()));var e,f;if(angular.isDefined(c.advanced))for(e in c.advanced)f={name:e,value:c.advanced[e]},a.setOption(f.name,f.value);if(angular.isDefined(c.rendererOptions))for(e in c.rendererOptions)f={name:e,value:c.rendererOptions[e]},a.renderer.setOption(f.name,f.value);angular.forEach(c.callbacks,function(b){angular.isFunction(b)&&b(a)})};return{restrict:"EA",require:"?ngModel",link:function(c,d,e,f){var g,h,i=a.ace||{},j=angular.extend({},i,c.$eval(e.uiAce)),k=window.ace.edit(d[0]),l=k.getSession(),m=function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1);angular.isDefined(a)&&c.$evalAsync(function(){if(!angular.isFunction(a))throw new Error("ui-ace use a function as callback.");a(b)})},n={onChange:function(a){return function(b){var d=l.getValue();!f||d===f.$viewValue||c.$$phase||c.$root.$$phase||c.$evalAsync(function(){f.$setViewValue(d)}),m(a,b,k)}},onBlur:function(a){return function(){m(a,k)}}};e.$observe("readonly",function(a){k.setReadOnly(!!a||""===a)}),f&&(f.$formatters.push(function(a){if(angular.isUndefined(a)||null===a)return"";if(angular.isObject(a)||angular.isArray(a))throw new Error("ui-ace cannot use an object or an array as a model");return a}),f.$render=function(){l.setValue(f.$viewValue)});var o=function(a,d){a!==d&&(j=angular.extend({},i,c.$eval(e.uiAce)),j.callbacks=[j.onLoad],j.onLoad!==i.onLoad&&j.callbacks.unshift(i.onLoad),l.removeListener("change",g),g=n.onChange(j.onChange),l.on("change",g),k.removeListener("blur",h),h=n.onBlur(j.onBlur),k.on("blur",h),b(k,l,j))};c.$watch(e.uiAce,o,!0),o(i),d.on("$destroy",function(){k.session.$stopWorker(),k.destroy()}),c.$watch(function(){return[d[0].offsetWidth,d[0].offsetHeight]},function(){k.resize(),k.renderer.updateFull()},!0)}}}]),!function(a,b){"use strict";var c=b.isDefined,d=b.isUndefined,e=b.isNumber,f=b.isObject,g=b.isArray,h=b.extend,i=b.toJson,j=b.module("LocalStorageModule",[]);j.provider("localStorageService",function(){this.prefix="ls",this.storageType="localStorage",this.cookie={expiry:30,path:"/"},this.notify={setItem:!0,removeItem:!1},this.setPrefix=function(a){return this.prefix=a,this},this.setStorageType=function(a){return this.storageType=a,this},this.setStorageCookie=function(a,b){return this.cookie.expiry=a,this.cookie.path=b,this},this.setStorageCookieDomain=function(a){return this.cookie.domain=a,this},this.setNotify=function(a,b){return this.notify={setItem:a,removeItem:b},this},this.$get=["$rootScope","$window","$document","$parse",function(a,b,j,k){var l,m=this,n=m.prefix,o=m.cookie,p=m.notify,q=m.storageType;j?j[0]&&(j=j[0]):j=document,"."!==n.substr(-1)&&(n=n?n+".":"");var r=function(a){return n+a},s=function(){try{var c=q in b&&null!==b[q],d=r("__"+Math.round(1e7*Math.random()));return c&&(l=b[q],l.setItem(d,""),l.removeItem(d)),c}catch(e){return q="cookie",a.$broadcast("LocalStorageModule.notification.error",e.message),!1}}(),t=function(b,c){if(c=d(c)?null:i(c),!s||"cookie"===m.storageType)return s||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),p.setItem&&a.$broadcast("LocalStorageModule.notification.setitem",{key:b,newvalue:c,storageType:"cookie"}),z(b,c);try{l&&l.setItem(r(b),c),p.setItem&&a.$broadcast("LocalStorageModule.notification.setitem",{key:b,newvalue:c,storageType:m.storageType})}catch(e){return a.$broadcast("LocalStorageModule.notification.error",e.message),z(b,c)}return!0},u=function(b){if(!s||"cookie"===m.storageType)return s||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),A(b);var c=l?l.getItem(r(b)):null;if(!c||"null"===c)return null;try{return JSON.parse(c)}catch(d){return c}},v=function(){var b,c;for(b=0;b<arguments.length;b++)if(c=arguments[b],s&&"cookie"!==m.storageType)try{l.removeItem(r(c)),p.removeItem&&a.$broadcast("LocalStorageModule.notification.removeitem",{key:c,storageType:m.storageType})}catch(d){a.$broadcast("LocalStorageModule.notification.error",d.message),B(c)}else s||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),p.removeItem&&a.$broadcast("LocalStorageModule.notification.removeitem",{key:c,storageType:"cookie"}),B(c)},w=function(){if(!s)return a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),!1;var b=n.length,c=[];for(var d in l)if(d.substr(0,b)===n)try{c.push(d.substr(b))}catch(e){return a.$broadcast("LocalStorageModule.notification.error",e.Description),[]}return c},x=function(b){var c=n?new RegExp("^"+n):new RegExp,d=b?new RegExp(b):new RegExp;if(!s||"cookie"===m.storageType)return s||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),C();var e=n.length;for(var f in l)if(c.test(f)&&d.test(f.substr(e)))try{v(f.substr(e))}catch(g){return a.$broadcast("LocalStorageModule.notification.error",g.message),C()}return!0},y=function(){try{return b.navigator.cookieEnabled||"cookie"in j&&(j.cookie.length>0||(j.cookie="test").indexOf.call(j.cookie,"test")>-1)}catch(c){return a.$broadcast("LocalStorageModule.notification.error",c.message),!1}}(),z=function(b,c,h){if(d(c))return!1;if((g(c)||f(c))&&(c=i(c)),!y)return a.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var k="",l=new Date,m="";if(null===c?(l.setTime(l.getTime()+-864e5),k="; expires="+l.toGMTString(),c=""):e(h)&&0!==h?(l.setTime(l.getTime()+24*h*60*60*1e3),k="; expires="+l.toGMTString()):0!==o.expiry&&(l.setTime(l.getTime()+24*o.expiry*60*60*1e3),k="; expires="+l.toGMTString()),b){var n="; path="+o.path;o.domain&&(m="; domain="+o.domain),j.cookie=r(b)+"="+encodeURIComponent(c)+k+n+m}}catch(p){return a.$broadcast("LocalStorageModule.notification.error",p.message),!1}return!0},A=function(b){if(!y)return a.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var c=j.cookie&&j.cookie.split(";")||[],d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(r(b)+"=")){var f=decodeURIComponent(e.substring(n.length+b.length+1,e.length));try{return JSON.parse(f)}catch(g){return f}}}return null},B=function(a){z(a,null)},C=function(){for(var a=null,b=n.length,c=j.cookie.split(";"),d=0;d<c.length;d++){for(a=c[d];" "===a.charAt(0);)a=a.substring(1,a.length);var e=a.substring(b,a.indexOf("="));B(e)}},D=function(){return q},E=function(a,b,d,e){e=e||b;var g=u(e);return null===g&&c(d)?g=d:f(g)&&f(d)&&(g=h(d,g)),k(b).assign(a,g),a.$watch(b,function(a){t(e,a)},f(a[b]))},F=function(){for(var a=0,c=b[q],d=0;d<c.length;d++)0===c.key(d).indexOf(n)&&a++;return a};return{isSupported:s,getStorageType:D,set:t,add:t,get:u,keys:w,remove:v,clearAll:x,bind:E,deriveKey:r,length:F,cookie:{isSupported:y,set:z,add:z,get:A,remove:B,clearAll:C}}}]})}(window,window.angular),angular.module("builder",["ngRoute","builder.filters","builder.services","builder.directives","builder.controllers","LocalStorageModule","ui.ace","angulartics","angulartics.google.analytics"]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/models",{templateUrl:"partials/models.html",controller:"ModelController"}),a.when("/home",{templateUrl:"partials/home.html",controller:"ModelController"}),a.otherwise({redirectTo:"/home"})}]),angular.module("builder.controllers",["LocalStorageModule"]).controller("ModelController",["$scope","$http","ModelFactory","ModelParser","FieldFactory","RelationshipFactory","localStorageService","MessageService","RenderFactory","TarballFactory",function(a,b,c,d,e,f,g,h,i,j){a.models=[],a.new_models=[],a.user_model="django.contrib.auth.models.User",a.user_model_setting="settings.AUTH_USER_MODEL",a.built_in_models={"django.contrib.auth.models.User":{fields:{username:{"default":"username"},email:{"default":"username@tempurl.com"}}},"django.contrib.auth.models.Group":{fields:{name:{"default":"group"}}},"django.contrib.contenttypes.models.ContentType":{fields:{}}},a.messageService=new h,a.field_factory=new e,a.model_factory=c,a.relationship_factory=new f,a.render_factory=new i(a.built_in_models),a.editors=[],a.models_storage_key="local_models",a._app_name="app_name",a.create_tar_ball_url=function(){var b="Built with django_builder\n",c="#",d=a.render_factory.render_models_py(a.app_name(),a.models),e=a.render_factory.render_views_py(a.app_name(),a.models),f=a.render_factory.render_admin_py(a.app_name(),a.models),g=a.render_factory.render_urls_py(a.app_name(),a.models),h=a.render_factory.render_tests_py(a.app_name(),a.models),i=a.render_factory.render_forms_py(a.app_name(),a.models),k=a.render_factory.render_django_rest_framework_api_py(a.app_name(),a.models),l=a.render_factory.render_django_rest_framework_serializers_py(a.app_name(),a.models),m=a.render_factory.render_templates_html(a.app_name(),a.models),n=new j;return n.append("README.txt",b),n.append(a.app_name()+"/__init__.py",c),n.append(a.app_name()+"/models.py",d),n.append(a.app_name()+"/views.py",e),n.append(a.app_name()+"/admin.py",f),n.append(a.app_name()+"/urls.py",g),n.append(a.app_name()+"/tests.py",h),n.append(a.app_name()+"/forms.py",i),n.append(a.app_name()+"/api.py",k),n.append(a.app_name()+"/serializers.py",l),n.append(a.app_name()+"/templates/base.html",a.render_factory.render_base_html(a.app_name(),a.models)),jQuery.each(m,function(b,c){n.append(a.app_name()+"/templates/"+a.app_name()+"/"+c[0],c[1])}),n.get_url()},a.create_download_modal=function(){var b=a.create_tar_ball_url(),c=a.app_name()+".tar",d=jQuery("<a>").attr("href",b).attr("id","django_builder_download_a");d.addClass("btn btn-success btn-lg").css("text-transform","none"),d.text("Click here to download "+c),d.attr("download",c);var e=jQuery("<div>").addClass("text-center").append(d),f=jQuery("<div>");f.append(jQuery("<br>")),f.append("Chrome can block downloads of the generated tarball, if this happens navigate to the "),f.append(jQuery("<strong>").text("Downloads")),f.append(" section of chrome to accept the download"),f.append(jQuery("<br>")),f.append("Window -> Downloads");var g=jQuery("<div>");g.append(e),g.append(f);var h="django_builder_download_modal";return a.messageService.simple_info("Download info",g).modal("show").attr("id",h),h},a.render_model_class_fields_only=function(b){return b.render_model_class_fields_only(a._app_name,a.render_factory)},a.upload_input=function(){return jQuery('<input type="file" />')},a.upload_drop_target=function(a){var b=jQuery("<div>").addClass("builder_dnd_target text-center"),c=jQuery("<i>").addClass("fa fa-upload fa-4x builder_dnd_icon");return b.append(jQuery("<div>").text("Drag and Drop files here!")),b.append(c),b},a.upload_form=function(a,b){var c=jQuery("<form>"),d=jQuery("<span>").addClass("btn btn-default btn-file center-block builder_upload_models_py");return d.append("Browse"),d.append(a),c.append(d),c.append(b),c},a.save_new_models=function(b){a.new_models=[],a.models=b,a.saveApp(),a.$apply()},a.merge_models=function(){for(var b=a.models.concat(a.new_models),c=0;c<b.length;++c)for(var d=c+1;d<b.length;++d)b[c].name===b[d].name&&b.splice(d--,1);return a.save_new_models(b)},a.add_unique=function(){jQuery.each(a.new_models,function(b,c){a.existingModel(c.name)||a.models.push(c)}),a.save_new_models(a.models)},a.add_new_models=function(b){a.new_models=b,a.$apply();var c=function(){console.log("Overwriting existing models"),a.merge_models()},d=function(){var b=!1,d=[],e=jQuery("<p>").text("The following models are duplicates:");jQuery.each(a.new_models,function(c,f){a.existingModel(f.name)&&(b=!0,d.push(f),e.append(jQuery("<div>").text(f.name)))});var f=d.length==a.new_models.length;if(b){var g=[{text:"Overwrite existing models",callback:c}];f||g.push({text:"Add unique",callback:a.add_unique}),g.push({text:"Cancel",callback:function(){}});var h="duplicate_models";a.messageService.simple_choice("Add duplicate models?",e,g).modal("show").attr("id",h)}else a.merge_models()},e=jQuery("<div>");jQuery.each(a.new_models,function(b,c){e.append(jQuery("<hr>")),e.append(jQuery("<pre>").html(c.render_model_class_fields_only(a._app_name,a.render_factory)));var d=jQuery('<button class="btn btn-danger pull-right">').text("Remove");e.append(d),e.append(jQuery("<div>").addClass("clearfix"))});var f="add_new_models";return a.messageService.simple_confirm("Add the following models?",jQuery("#builder_new_models"),d).modal("show").find(".modal-dialog").css("width","50%").attr("id",f),f},a.process_models_py=function(b){if(0==b.length)a.messageService.simple_error("Sorry","You didn't seem to choose any files.").modal("show");else if(b.length>1)a.messageService.simple_error("Sorry","Multiple files not yet supported, please choose a single file.").modal("show");else{var c=d(a);c.parse(b[0],function(b){a.add_new_models(b)})}},a.upload_models_py=function(){var b=a.upload_input(),c=a.upload_drop_target(),d=a.upload_form(b,c),e=a.messageService.simple_form("Upload models.py","Choose a models.py file to analyse",d,function(){a.process_models_py(jQuery(b)[0].files),e.modal("hide")}).modal("show");b.change(function(){a.process_models_py(jQuery(b)[0].files),e.modal("hide")}),d.on("drag dragstart dragend dragover dragenter dragleave drop",function(a){a.preventDefault(),a.stopPropagation()}).on("dragover dragenter",function(){c.addClass("is-drag-over")}).on("dragleave dragend drop",function(){c.removeClass("is-drag-over")}).on("drop",function(b){var c=b.originalEvent.dataTransfer.files;e.modal("hide"),a.process_models_py(c)})},jQuery("html body").on("drag dragstart dragend dragover dragenter dragleave drop",function(a){a.preventDefault(),a.stopPropagation()}).on("dragover dragenter",function(){}).on("drop",function(a){}),jQuery("#builder_models_content").on("drag dragstart dragend dragover dragenter dragleave drop",function(a){a.preventDefault(),a.stopPropagation()}).on("dragover dragenter",function(){jQuery(".builder_dnd_target").addClass("is-drag-over")}).on("drop",function(b){jQuery(".builder_dnd_target").removeClass("is-drag-over");var c=b.originalEvent.dataTransfer.files;a.process_models_py(c)}),a.aceLoad=function(b){var c=jQuery(b.container).attr("id");"builder_models"==c?b.setValue(a.render_factory.render_models_py(a.app_name(),a.models)):"builder_views"==c?b.setValue(a.render_factory.render_views_py(a.app_name(),a.models)):"builder_admin"==c?b.setValue(a.render_factory.render_admin_py(a.app_name(),a.models)):"builder_urls"==c?b.setValue(a.render_factory.render_urls_py(a.app_name(),a.models)):"builder_tests"==c?b.setValue(a.render_factory.render_tests_py(a.app_name(),a.models)):"builder_forms"==c?b.setValue(a.render_factory.render_forms_py(a.app_name(),a.models)):"builder_django_rest_framework_api"==c?b.setValue(a.render_factory.render_django_rest_framework_api_py(a.app_name(),a.models)):"builder_django_rest_framework_serializers"==c&&b.setValue(a.render_factory.render_django_rest_framework_serializers_py(a.app_name(),a.models)),b.session.selection.clearSelection()},a.reLoadAce=function(){Object.keys(a.editors).map(function(b){a.aceLoad(a.editors[b])})},a.aceLoaded=function(b){b.setOptions({readOnly:!0,highlightActiveLine:!1,highlightGutterLine:!1,maxLines:1/0}),b.renderer.$cursorLayer.element.style.opacity=0,a.aceLoad(b),a.editors.push(b)},a.$watch("[models,_app_name]",function(){a.reLoadAce(),a.saveApp()},!0),a.aceChanged=function(a){},a.do_set_app_name=function(b){a._app_name=b},a.set_app_name=function(){a.do_set_app_name(jQuery("input#appname").val()),a.reLoadAce()},a.l_app_name=function(){return a._app_name.toLowerCase()},a.app_name=function(){return a._app_name.replace(new RegExp(" ","g"),"_")},a.updateModel=function(b){var c=a.models.indexOf(b);a.models[c]=b,a.$apply()},a.serializeApp=function(){var b={models:a.models,app_config:{app_name:a._app_name}};return JSON.stringify(b)},a.saveApp=function(){g.set(a.models_storage_key,a.serializeApp())},a.doClearModels=function(){g.set(a.models_storage_key,""),a.loadModels(),a.models=[],a.$apply()},a.clearModels=function(){var b=function(){a.doClearModels()},c="clear_all";return a.messageService.simple_confirm("Confirm","Remove all models?",b).modal("show").attr("id",c),c},a.model_count=function(){return a.models.length},a.add_model=function(b){var d={name:b};d.fields=[a.field_factory.make_field({name:"name",type:"django.db.models.CharField",opts:"max_length=255"}),a.field_factory.make_field({name:"slug",type:"django_extensions.db.fields.AutoSlugField",opts:"populate_from='name', blank=True"}),a.field_factory.make_field({name:"created",type:"django.db.models.DateTimeField",opts:"auto_now_add=True, editable=False"}),a.field_factory.make_field({name:"last_updated",type:"django.db.models.DateTimeField",opts:"auto_now=True, editable=False"})];var e=c(d,a);a.models.push(e),a.saveApp(),a.$apply()},a.existingModel=function(b){var c=!1;return jQuery.each(a.models,function(a,d){b==d.name&&(c=!0)}),c},a.addModel=function(){var b=function(b){void 0==b||""===b?a.messageService.simple_info("Model Name Required","Enter a Model name").modal("show"):a.existingModel(b)?a.messageService.simple_error("Error with Model Name","There is already a model with the name "+b).modal("show"):a.add_model(b)},c="add_model";return a.messageService.simple_input("Model Name Required","Enter a Model name","Model1",b,!0).modal("show").attr("id",c),c},a.cleanModel=function(a){delete a.$$hashKey,void 0!=a.fields&&jQuery.each(a.fields,function(a,b){delete b.$$hashKey}),void 0!=a.relationships&&jQuery.each(a.relationships,function(a,b){delete b.$$hashKey})},a.loadModels=function(){var b=g.get(a.models_storage_key)||{models:[],app_config:{app_name:"app_name"}};"string"==typeof b&&(b=JSON.parse(b));var c=b.models||[],d=b.app_config||{app_name:"app_name"};return a._app_name=d.app_name,jQuery.each(c,function(b,c){a.cleanModel(c)}),c},a.loadModel=function(b){var d=c(b,a);a.models.push(d)},a.__init__=function(){jQuery.each(a.loadModels(),function(b,c){a.loadModel(c)})},a.__init__(),a.debug=function(){},a.do_rename_model=function(b,c){var d="rename_model_existing",e=a.models[b];a.existingModel(c)?a.messageService.simple_error("Error with Model Name","There is already a model with the name "+c).modal("show").attr("id",d):(e.set_name(c),a.updateModel(e),a.$apply())},a.rename_model=function(b){var c=a.models[b],d="rename_model",e=function(c){a.do_rename_model(b,c)};return a.messageService.simple_input("Rename model","Enter a new Model name",c.name,e,!0).modal("show").attr("id",d),d},a.add_relationship=function(b){var c=a.models[b],d=function(b){var d=b.find("input[name=name]").val();if(void 0===d||""===d)b.find("div.form-group-name").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text("Field Required");else if(c.has_relationship(d))b.find("div.form-group-name").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text('Field "'+d+'" exists');else{var e=b.find("select[name=type]").val(),f=b.find("input[name=opts]").val(),g=b.find("select[name=to]").val(),h=a.relationship_factory.make_relationship({name:d,type:e,opts:f,to:g});c.relationships.push(h),a.updateModel(c),a.$apply(),jQuery(".modal").modal("hide")}},e=jQuery("<form>"),f=jQuery("<div>").addClass("form-group form-group-name has-feedback").appendTo(e),g=jQuery("<div>").addClass("form-group form-group-to").appendTo(e),h=jQuery("<div>").addClass("form-group form-group-type").appendTo(e),i=jQuery("<div>").addClass("form-group form-group-args").appendTo(e);f.append(jQuery("<label>").text("Name")),f.append(jQuery("<input>").attr("name","name").addClass("form-control")),f.append(jQuery("<span>").text("error message").addClass("help-block hide"));var j=jQuery("<select>").attr("name","to").addClass("form-control"),k=jQuery("<optgroup>").attr("label","Django models");jQuery.each(a.built_in_models,function(a,b){k.append(jQuery("<option>").attr("val",a).text(a))}),j.append(k);var l=jQuery("<optgroup>").attr("label","Your App models");jQuery.each(a.models,function(a,b){l.append(jQuery("<option>").attr("val",b.name).text(b.name))}),j.append(l),g.append(jQuery("<label>").text("Relationship to Model")),g.append(j);var m=jQuery("<select>").attr("name","type");jQuery.each(a.relationship_factory.relationship_types(),function(a,b){m.append(jQuery("<option>").attr("val",b).text(b))}),h.append(jQuery("<label>").text("Relationship Type")),h.append(m),i.append(jQuery("<label>").text("Arguments")),i.append(jQuery("<input>").attr("name","opts").attr("placeholder","options").addClass("form-control")),j.select2({theme:"bootstrap"}),m.select2({theme:"bootstrap"});var n="add_rel_"+c.name+"_"+b;return a.messageService.simple_form_no_dismiss("Add Relationship","",e,d).modal("show").attr("id",n).appendTo("body"),n},a.add_field=function(b){var c=a.models[b],d=function(b){var d=b.find("input[name=name]").val();if(void 0===d||""===d)b.find("div.form-group-name").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text("Field Required");else if(c.has_field(d))b.find("div.form-group-name").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text('Field "'+d+'" exists');else{var e=b.find("select[name=type]").val(),f=b.find("input[name=opts]").val(),g=a.field_factory.make_field({name:d,type:e,opts:f});c.fields.push(g),a.updateModel(c),a.$apply(),jQuery(".modal").modal("hide")}},e=jQuery("<form>"),f=jQuery("<div>").addClass("form-group form-group-name  has-feedback").appendTo(e),g=jQuery("<div>").addClass("form-group form-group-type").appendTo(e),h=jQuery("<div>").addClass("form-group form-group-args").appendTo(e);f.append(jQuery("<label>").text("Name")),f.append(jQuery("<input>").attr("name","name").addClass("form-control")),f.append(jQuery("<span>").text("error message").addClass("help-block hide"));var i=jQuery("<select>").attr("name","type").addClass("form-control");jQuery.each(a.field_factory.field_types(),function(a,b){i.append(jQuery("<option>").attr("val",b).text(b))});var j=jQuery("<input>").attr("name","opts").attr("placeholder","options").addClass("form-control");g.append(jQuery("<label>").text("Field Type")),g.append(i),h.append(jQuery("<label>").text("Arguments")),h.append(j),i.change(function(){j.val(a.field_factory.default_field_args(i.val()))}),j.val(a.field_factory.default_field_args(i.val()));var k="add_field_"+c.name+"_"+b;return a.messageService.simple_form_no_dismiss("Add Field","",e,d).modal("show").attr("id",k).appendTo("body"),k},a.edit_relationship=function(b,c){var d=a.models[b].relationships[c],e=function(b){d.form_update(b),a.$apply()},f=d.$$hashKey||"edit_relationship_"+d.name;return a.messageService.simple_form("Edit Relationship '"+d.name+"'","",d.edit_form(a),e).modal("show").attr("id",f).appendTo("body"),f},a.edit_field=function(b,c){var d=a.models[b].fields[c],e=function(b){d.form_update(b),a.$apply()},f=d.$$hashKey||"edit_field_"+d.name;return a.messageService.simple_form("Edit field '"+d.name+"'","",d.edit_form(a),e).modal("show").attr("id",f).appendTo("body"),f},a.do_remove_new_model=function(b){a.new_models.splice(b,1),a.$apply()},a.remove_new_model=function(b){setTimeout(function(){a.do_remove_new_model(b)})},a.remove_relationship=function(b,c){var d=function(){a.models[b].relationships.splice(c,1),a.$apply()},e=a.models[b].relationships[c],f=e.$$hashKey||"remove_relationship_"+e.name;return a.messageService.simple_confirm("Confirm","Remove the relationship '"+e.name+"'",d).modal("show").attr("id",f).appendTo("body"),f},a.do_remove_new_relationship=function(b,c){a.new_models[b].relationships.splice(c,1)},a.remove_new_relationship=function(b,c){setTimeout(function(){a.do_remove_new_relationship(b,c)})},a.do_remove_new_field=function(b,c){a.new_models[b].fields.splice(c,1),a.$apply()},a.remove_new_field=function(b,c){setTimeout(function(){a.do_remove_new_field(b,c)})},a.remove_field=function(b,c){var d=function(){a.models[b].fields.splice(c,1),a.$apply()},e=a.models[b].fields[c],f=e.$$hashKey||"remove_field_"+e.name;return a.messageService.simple_confirm("Confirm","Remove the field '"+e.name+"'",d).modal("show").attr("id",f).appendTo("body"),
f},a.remove_model=function(b){var c=function(){a.models.splice(b,1),a.$apply()},d=a.models[b],e=d.$$hashKey||"remove_model_"+d.name;return a.messageService.simple_confirm("Confirm","Remove the model '"+d.name+"'",c).modal("show").modal("show").attr("id",e).appendTo("body"),e},a.model_highlight=function(b,c){var d=a.models[b].relationships[c];jQuery(".builder_model_"+d.to_clean()).addClass("builder_model_highlight")},a.model_unhighlight=function(){jQuery(".builder_model").removeClass("builder_model_highlight")},a.new_model_highlight=function(b,c){var d=a.new_models[b].relationships[c];jQuery(".builder_model_"+d.to_clean()).addClass("builder_model_highlight")},a.new_model_unhighlight=function(){jQuery(".builder_model").removeClass("builder_model_highlight")}}]),angular.module("builder.directives",[]).directive("appVersion",["version",function(a){return function(b,c,d){c.text(a)}}]),angular.module("builder.filters",[]).filter("interpolate",["version",function(a){return function(b){return String(b).replace(/\%VERSION\%/gm,a)}}]),angular.module("builder.services",[]).factory("ModelFactory",[ModelServiceFactory]).factory("ModelParser",[ModelParserFactory]).factory("MessageService",[MessageServiceFactory]).factory("FieldFactory",[FieldFactory]).factory("RelationshipFactory",[RelationshipFactory]).factory("RenderFactory",[ModelRenderFactory]).factory("TarballFactory",[TarballFactory]).value("version","0.1");
>>>>>>> Adding missing fields #24
=======
function TarballFactory(){return function(){function a(){var a=this,b=require("tar-js"),c=new b;a.uInt8ToString=function(a){var b,c,d="";for(b=0,c=a.length;c>b;b+=1)d+=String.fromCharCode(a[b]);return d},a.append=function(a,b){c.append(a,b)},a.get_url=function(b){var d=btoa(a.uInt8ToString(c.out));return"data:application/tar;base64,"+d}}return new a}}function ModelRenderFactory(){return function(a){var b=this;b.built_in_models=a,b.spaces=function(a){var b=a||1;return new Array(b+1).join(" ")},b.model_names=function(a,b){var c=b||"";return Object.keys(a).map(function(b){return a[b].name+c})},b.new_lines=function(a){var b=a||1;return new Array(b+1).join("\n")},b.render_all=function(a,c){var d="";return d+=b.render_base_html(a,c),d+=b.render_forms_py(a,c),d+=b.render_urls_py(a,c),d+=b.render_admin_py(a,c),d+=b.render_views_py(a,c),d+=b.render_models_py(a,c),d+=b.render_django_rest_framework_api_py(a,c),d+=b.render_django_rest_framework_serializers_py(a,c),d+=b.render_templates_html(a,c)},b.render_base_html=function(a,b){return"<html><head></head><body>{% block content %}Replace this.{% endblock %}</body>"},b.pre_imported_modules=function(a){return{"django.contrib.auth.models":{as:"auth_models"},"django.db.models":{as:"models"},"django_extensions.db.fields":{as:"extension_fields"}}},b.pre_imported_modules_names=function(a){return Object.keys(b.pre_imported_modules())},b.render_project_manage_py=function(a){var b="# Project: "+a+"\n";return b},b.render_project_settings_py=function(a){var b="# Project: "+a+"\n";return b},b.render_project_wsgi_py=function(a){var b="\n";return b},b.render_project_urls_py=function(a){var b="";return b},b.render_forms_py=function(a,c){var d="from django import forms\n";return d+="from .models import "+b.model_names(c,"").join(", ")+"\n",d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_forms(a,b)}),d},b.render_tests_py=function(a,c){var d="import unittest\nfrom django.core.urlresolvers import reverse\nfrom django.test import Client\n";return d+="from .models import "+b.model_names(c,"").join(", ")+"\n",jQuery.each(b.built_in_models,function(a,c){var e=a.split("."),f=e.pop(),g=e.join(".");d+="from "+g+" import "+f,d+=b.new_lines(1)}),d+=b.new_lines(2),jQuery.each(b.built_in_models,function(a,c){var e="create_"+a.toLowerCase().replace(/\./g,"_"),f=a.split(".").pop(),g="";g+="def "+e+"(**kwargs):\n",g+=b.spaces(4)+"defaults = {}\n",jQuery.each(c.fields,function(a,c){g+=b.spaces(4)+'defaults["'+a+'"] = "'+c["default"]+'"\n'}),g+=b.spaces(4)+"defaults.update(**kwargs)\n",g+=b.spaces(4)+"return "+f+".objects.create(**defaults)\n",g+=b.new_lines(2),d+=g}),jQuery.each(c,function(c,e){d+=e.render_tests_helpers(a,b)}),jQuery.each(c,function(c,e){d+=e.render_tests(a,b)}),d},b.render_urls_py=function(a,c){var d="from django.conf.urls import url, include\n";return d+="from rest_framework import routers"+b.new_lines(1),d+="import api"+b.new_lines(1),d+="import views"+b.new_lines(2),d+="router = routers.DefaultRouter()"+b.new_lines(1),jQuery.each(c,function(a,c){d+="router.register(r'"+c.l_name()+"', api."+c.name+"ViewSet)"+b.new_lines(1)}),d+=b.new_lines(2),d+="urlpatterns = ("+b.new_lines(1),d+=b.spaces(4)+"# urls for Django Rest Framework API"+b.new_lines(1),d+=b.spaces(4)+"url(r'^api/v1/', include(router.urls)),"+b.new_lines(1),d+=")"+b.new_lines(1),d+=b.new_lines(1),jQuery.each(c,function(c,e){d+=e.render_urls(a,b)}),d},b.render_admin_py=function(a,c){var d="from django.contrib import admin\nfrom django import forms\n";return d+="from .models import "+b.model_names(c).join(", "),d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_admin_classes(a,b)}),d},b.render_views_py=function(a,c){var d="from django.views.generic import DetailView, ListView, UpdateView, CreateView\n";return d+="from .models import "+b.model_names(c).join(", "),d+=b.new_lines(1),d+="from .forms import "+b.model_names(c,"Form").join(", "),d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_view_classes(a,b)}),d},b.render_models_py=function(a,c){var d="from django.core.urlresolvers import reverse\n";d+="from django_extensions.db.fields import AutoSlugField\n",d+="from django.db.models import *\n",d+="from django.conf import settings\n",d+="from django.contrib.contenttypes.fields import GenericForeignKey\n",d+="from django.contrib.contenttypes.models import ContentType\n",d+="from django.contrib.auth import get_user_model\n",jQuery.each(b.pre_imported_modules(),function(a,b){var c=a.split("."),e=c.pop();d+="from "+c.join(".")+" import "+e+" as "+b.as+"\n"});var e={};jQuery.each(c,function(a,b){jQuery.each(b.fields,function(a,b){e[b.module()]=b.module()})});var f={};return jQuery.each(c,function(a,b){jQuery.each(b.fields,function(a,b){f[b.type]=b}),jQuery.each(b.relationships,function(a,b){f[b.type]=b})}),jQuery.each(f,function(a,b){}),d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_model_class(a,b)}),d},b.render_templates_html=function(a,b){var c=[];return jQuery.each(b,function(b,d){c.push([d.l_name()+"_form.html",d.render_form_html(a)]),c.push([d.l_name()+"_detail.html",d.render_detail_html(a)]),c.push([d.l_name()+"_list.html",d.render_list_html(a)])}),c},b.render_django_rest_framework_api_py=function(a,c){var d="import models\n";return d+="import serializers\n",d+="from rest_framework import viewsets, permissions\n",d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_model_api(a,b)}),d},b.render_django_rest_framework_serializers_py=function(a,c){var d="import models";return d+=b.new_lines(2),d+="from rest_framework import serializers",d+=b.new_lines(3),jQuery.each(c,function(c,e){d+=e.render_model_serializer(a,b)}),d}}}function MessageServiceFactory(){return function(){var a=this;a.base_modal=function(){var a=jQuery("<div>").addClass("modal fade");a.attr("tabindex","-1"),a.attr("role","dialog"),a.css("display","none");var b=jQuery("<div>").addClass("modal-dialog"),c=jQuery("<div>").addClass("modal-content").appendTo(b),d=jQuery("<h2>").addClass("modal-header-inner");return jQuery("<div>").addClass("modal-header").appendTo(c).append(d),jQuery("<div>").addClass("modal-body").appendTo(c),jQuery("<div>").addClass("modal-footer").appendTo(c),a.append(b),a},a.icon=function(a){return jQuery("<icon>").addClass("fa").addClass(a)},a.simple_error=function(b,c){var d=a.base_modal(),e=a.icon("fa-info").addClass("pull-right");d.find(".modal-header-inner").append(e).append(jQuery("<span>").text(b)),d.find(".modal-body").empty().append(c);var f=jQuery("<button>").addClass("btn btn-default").text("Ok");return d.find(".modal-footer").append(f),f.attr("data-dismiss","modal"),d.modal(),d},a.simple_info=function(b,c){var d=a.base_modal(),e=a.icon("fa-info").addClass("pull-right");d.find(".modal-header-inner").append(e).append(jQuery("<span>").text(b)),d.find(".modal-body").empty().append(c);var f=jQuery("<button>").addClass("btn btn-default").text("Ok");return d.find(".modal-footer").append(f),f.attr("data-dismiss","modal"),d.modal(),d},a.simple_confirm=function(b,c,d){var e=d||jQuery.noop,f=a.base_modal();f.find(".modal-header-inner").html(b),f.find(".modal-body").empty().append(c);var g=jQuery("<button>").addClass("btn btn-primary").text("Ok"),h=jQuery("<button>").addClass("btn btn-default").text("Cancel");return f.find(".modal-footer").append(g).append(h),g.click(function(){e()}),h.attr("data-dismiss","modal"),g.attr("data-dismiss","modal"),f.modal(),f},a.simple_choice=function(b,c,d){var e=a.base_modal();return e.find(".modal-header-inner").html(b),e.find(".modal-body").empty().append(c),jQuery.each(d,function(a,b){var c=jQuery("<button>").addClass("btn btn-primary").text(b.text);e.find(".modal-footer").append(c),c.click(function(){b.callback()}),c.attr("data-dismiss","modal")}),e.modal(),e},a.simple_form=function(b,c,d,e,f){var g=e||jQuery.noop,h=f||!0,i=a.base_modal();i.find(".modal-header-inner").html(b),i.find(".modal-body").empty().append(c).append(d);var j=jQuery("<button>").addClass("btn btn-primary").text("Ok"),k=jQuery("<button>").addClass("btn btn-default").text("Cancel");return i.find(".modal-footer").append(j).append(k),j.click(function(){i.modal("hide"),g(d)}),k.attr("data-dismiss","modal"),h||j.attr("data-dismiss","modal"),i.modal(),i},a.simple_form_no_dismiss=function(b,c,d,e){return a.simple_form(b,c,d,e,!0)},a.simple_input=function(b,c,d,e,f){var g=e||jQuery.noop,h=f||!1,i=a.base_modal();i.find(".modal-header-inner").html(b);var j=jQuery("<label>").text(c),k=jQuery("<input>").attr("type","text").attr("name","input").addClass("form-control").attr("value",d),l=jQuery("<span>").text("error message").addClass("help-block hide"),m=jQuery("<div>").addClass("form-group form-group-input has-feedback").append(j).append(k).append(l),n=function(){var a=k.val();!h||""!=a&&void 0!=k?(i.modal("hide"),g(a)):m.addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text("Field Required")},o=jQuery("<form>").append(m).submit(function(a){a.preventDefault(),n()});i.find(".modal-body").empty().append(o);var p=jQuery("<button>").addClass("btn btn-primary").text("Ok"),q=jQuery("<button>").addClass("btn btn-default").text("Cancel");return i.find(".modal-footer").append(p).append(q),p.click(n),q.attr("data-dismiss","modal"),h||p.attr("data-dismiss","modal"),i.modal(),i}}}function RelationshipFactory(){return function(a){function b(a){this.name=a.name,this.type=a.type,this.opts=a.opts,this.to=a.to,this.class_name=function(){return this.type.split(".").reverse()[0]},this.form_update=function(a){this.name=jQuery(a).find("input[name=name]").val(),this.type=jQuery(a).find("select[name=type]").val(),this.opts=jQuery(a).find("input[name=opts]").val(),this.to=jQuery(a).find("input[name=to]").val()},this.to_clean=function(){return this.to.replace(/['"]+/g,"")},this.to_class=function(){return this.to.split(".").reverse().shift()},this.opts_args=function(){return this.opts.split(",").join(", ")},this.to_module=function(){var a=this.to.split(".");return a.slice(0,a.length-1).join(".")},this.module=function(){var a=this.type.split(".");return a.slice(0,a.length-1).join(".")},this.edit_form=function(a){var b=jQuery("<form>"),c=jQuery("<div>").addClass("form-group form-group-name has-feedback").appendTo(b),d=jQuery("<div>").addClass("form-group form-group-type").appendTo(b),e=jQuery("<div>").addClass("form-group form-group-args").appendTo(b),f=jQuery("<div>").addClass("form-group form-group-args").appendTo(b);c.append(jQuery("<label>").text("Name")),c.append(jQuery("<input>").attr("name","name").addClass("form-control").val(this.name)),c.append(jQuery("<span>").text("error message").addClass("help-block hide")),d.append(jQuery("<label>").text("To")),d.append(jQuery("<input>").attr("name","to").attr("placeholder","to").addClass("form-control").val(this.to));var g=jQuery("<select>").attr("name","type").addClass("form-control"),h=this;return jQuery.each(a.relationship_factory.relationship_types(),function(a,b){var c=jQuery("<option>").attr("val",b).text(b);b==h.type&&c.attr("selected","selected"),g.append(c)}),e.append(jQuery("<label>").text("Field Type")),e.append(g),f.append(jQuery("<label>").text("Arguments")),f.append(jQuery("<input>").attr("name","opts").attr("placeholder","options").addClass("form-control").val(this.args)),b}}var c=this;c.relationship_types=function(){return["django.db.models.ForeignKey","django.db.models.OneToOneField","django.db.models.ManyToManyField"]},c.relationship_matches=function(){return c.relationship_types+["ForeignKey","OneToOneField","ManyToManyField","models.ForeignKey","models.OneToOneField","models.ManyToManyField"]},c.relationship_match=function(a){return-1!=c.relationship_matches().indexOf(a)},c.make_relationship=function(a){return new b(a)}}}function FieldFactory(){return function(a){function b(a){this.name=a.name,this.type=a.type,this.opts=a.opts||"",this.class_name=function(){return this.type.split(".").reverse()[0]},this.opts_args=function(){return this.opts.split(",").join(", ")},this.to_clean=function(){return this.to.replace(/['"]+/g,"")},this.module=function(){var a=this.type.split(".");return a.slice(0,a.length-1).join(".")},this.form_update=function(a){this.name=jQuery(a).find("input[name=name]").val(),this.type=jQuery(a).find("select[name=type]").val(),this.opts=jQuery(a).find("input[name=opts]").val()},this.edit_form=function(a){var b=jQuery("<form>"),c=jQuery("<div>").addClass("form-group form-group-name has-feedback").appendTo(b),d=jQuery("<div>").addClass("form-group form-group-type").appendTo(b),e=jQuery("<div>").addClass("form-group form-group-args").appendTo(b);c.append(jQuery("<label>").text("Name")),c.append(jQuery("<input>").attr("name","name").addClass("form-control").val(this.name)),c.append(jQuery("<span>").text("error message").addClass("help-block hide"));var f=jQuery("<select>").attr("name","type").addClass("form-control"),g=this;return jQuery.each(a.field_factory.field_types(),function(a,b){var c=jQuery("<option>").attr("val",b).text(b);b==g.type&&c.attr("selected","selected"),f.append(c)}),d.append(jQuery("<label>").text("Field Type")),d.append(f),e.append(jQuery("<label>").text("Arguments")),e.append(jQuery("<input>").attr("name","opts").attr("placeholder","options").addClass("form-control").val(this.opts)),b}}var c=this;c.fields=function(){return{"django.db.models.TextField":{default_args:"max_length=100"},"django.db.models.CharField":{default_args:"max_length=30"},"django.contrib.contenttypes.fields.GenericForeignKey":{default_args:'"content_type", "object_id"'},"django_extensions.db.fields.AutoSlugField":{},"django.db.models.CommaSeparatedIntegerField":{},"django.db.models.BigAutoField":{},"django.db.models.BigIntegerField":{},"django.db.models.BooleanField":{},"django.db.models.DateField":{},"django.db.models.DateTimeField":{},"django.db.models.DecimalField":{default_args:"max_digits=10, decimal_places=2"},"django.db.models.DurationField":{},"django.db.models.FileField":{default_args:'upload_to="/upload/files/"'},"django.db.models.ImageField":{default_args:'upload_to="/upload/images/"'},"django.db.models.FilePathField":{},"django.db.models.FloatField":{},"django.db.models.IntegerField":{},"django.db.models.PositiveIntegerField":{},"django.db.models.PositiveSmallIntegerField":{},"django.db.models.SlugField":{},"django.db.models.IPAddressField":{},"django.db.models.GenericIPAddressField":{},"django.db.models.NullBooleanField":{},"django.db.models.TimeField":{},"django.db.models.BinaryField":{},"django.db.models.AutoField":{},"django.db.models.SmallIntegerField":{},"django.db.models.URLField":{},"django.db.models.UUIDField":{},"django.db.models.EmailField":{}}},c.default_field_args=function(a){var b=c.fields()[a];return b&&b.default_args?b.default_args:""},c.field_types=function(){return Object.keys(c.fields())},c.make_field=function(a){return new b(a)}}}function ModelServiceFactory(){return function(a,b){function c(a){this.slugify=function(a){return a.toString().replace(/\s+/g,"").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"").replace(/^-+/,"").replace(/-+$/,"")},this.set_name=function(a){this.name=this.slugify(a)},this.set_name(a.name),this.fields=[];a.fields||[];this.fields=(a.fields||[]).map(b.field_factory.make_field),this.relationships=(a.relationships||[]).map(b.relationship_factory.make_relationship),this.relationship_names=function(){var a=this;return Object.keys(a.relationships).map(function(b){return a.relationships[b].name})},this.field_names=function(){var a=this;return Object.keys(a.fields).map(function(b){return a.fields[b].name})},this.l_name=function(){return this.name.toLowerCase()},this.has_relationship=function(a){return-1!=this.relationship_names().indexOf(a)},this.has_field=function(a){return-1!=this.field_names().indexOf(a)},this.name_field=function(){return-1!=this.field_names().indexOf("name")?"name":"id"},this.ordering_field=function(){return-1!=this.field_names().indexOf("created")?"created":"id"},this.identifier=function(){return-1!=this.field_names().indexOf("slug")?"slug":"id"},this.render_forms=function(a,b){var c="";return c+="class "+this.name+"Form(forms.ModelForm):\n",c+=b.spaces(4)+"class Meta:\n",c+=b.spaces(8)+"model = "+this.name+"\n",this.form_fields()&&(c+=b.spaces(8)+"fields = "+this.form_fields()+"\n"),c+=b.new_lines(2)},this.get_initial_data=function(a,b){var c="{";return c+=b.new_lines(1),jQuery.each(this.readable_fields(),function(a,d){c+=b.spaces(12)+'"'+d.name+'": "'+d.name+'",',c+=b.new_lines(1)}),jQuery.each(this.relationships,function(a,d){c+=b.spaces(12)+'"'+d.name+'": create_'+d.to.toLowerCase()+"().id,",c+=b.new_lines(1)}),c+=b.spaces(8)+"}"},this.render_tests_helpers=function(a,b){var c="";return c+="def create_"+this.l_name()+"(**kwargs):\n",c+=b.spaces(4)+"defaults = {}\n",jQuery.each(this.readable_fields(),function(a,d){c+=b.spaces(4)+'defaults["'+d.name+'"] = "'+d.name+'"\n'}),c+=b.spaces(4)+"defaults.update(**kwargs)\n",jQuery.each(this.relationships,function(a,d){c+=b.spaces(4)+'if "'+d.name+'" not in defaults:\n';var e="create_"+d.to.toLowerCase();b.built_in_models[d.to]&&(e="create_"+d.to.toLowerCase().replace(/\./g,"_")),c+=b.spaces(8)+'defaults["'+d.name+'"] = '+e+"()\n"}),c+=b.spaces(4)+"return "+this.name+".objects.create(**defaults)\n",c+=b.new_lines(2)},this.render_tests=function(a,b){var c="";return c+="class "+this.name+"ViewTest(unittest.TestCase):\n",c+=b.spaces(4)+"'''\n",c+=b.spaces(4)+"Tests for "+this.name+"\n",c+=b.spaces(4)+"'''\n",c+=b.spaces(4)+"def setUp(self):\n",c+=b.spaces(8)+"self.client = Client()\n",c+=b.new_lines(1),c+=b.spaces(4)+"def test_list_"+this.l_name()+"(self):\n",c+=b.spaces(8)+"url = reverse('"+a+"_"+this.l_name()+"_list')\n",c+=b.spaces(8)+"response = self.client.get(url)\n",c+=b.spaces(8)+"self.assertEqual(response.status_code, 200)\n",c+=b.new_lines(1),c+=b.spaces(4)+"def test_create_"+this.l_name()+"(self):\n",c+=b.spaces(8)+"url = reverse('"+a+"_"+this.l_name()+"_create')\n",c+=b.spaces(8)+"data = "+this.get_initial_data(a,b)+"\n",c+=b.spaces(8)+"response = self.client.post(url, data=data)\n",c+=b.spaces(8)+"self.assertEqual(response.status_code, 302)\n",c+=b.new_lines(1),c+=b.spaces(4)+"def test_detail_"+this.l_name()+"(self):\n",c+=b.spaces(8)+this.l_name()+" = create_"+this.l_name()+"()\n",c+=b.spaces(8)+"url = reverse('"+a+"_"+this.l_name()+"_detail', args=["+this.l_name()+"."+this.identifier()+",])\n",c+=b.spaces(8)+"response = self.client.get(url)\n",c+=b.spaces(8)+"self.assertEqual(response.status_code, 200)\n",c+=b.new_lines(1),c+=b.spaces(4)+"def test_update_"+this.l_name()+"(self):\n",c+=b.spaces(8)+this.l_name()+" = create_"+this.l_name()+"()\n",c+=b.spaces(8)+"data = "+this.get_initial_data(a,b)+"\n",c+=b.spaces(8)+"url = reverse('"+a+"_"+this.l_name()+"_update', args=["+this.l_name()+"."+this.identifier()+",])\n",c+=b.spaces(8)+"response = self.client.post(url, data)\n",c+=b.spaces(8)+"self.assertEqual(response.status_code, 302)\n",c+=b.new_lines(2)},this.render_urls=function(a,b){var c="";return c+="urlpatterns += (\n",c+=b.spaces(4)+"# urls for "+this.name+"\n",c+=b.spaces(4)+"url(r'^"+a+"/"+this.l_name()+"/$', views."+this.name+"ListView.as_view(), name='"+a+"_"+this.l_name()+"_list'),\n",c+=b.spaces(4)+"url(r'^"+a+"/"+this.l_name()+"/create/$', views."+this.name+"CreateView.as_view(), name='"+a+"_"+this.l_name()+"_create'),\n",c+=b.spaces(4)+"url(r'^"+a+"/"+this.l_name()+"/detail/(?P<"+this.identifier()+">\\S+)/$', views."+this.name+"DetailView.as_view(), name='"+a+"_"+this.l_name()+"_detail'),\n",c+=b.spaces(4)+"url(r'^"+a+"/"+this.l_name()+"/update/(?P<"+this.identifier()+">\\S+)/$', views."+this.name+"UpdateView.as_view(), name='"+a+"_"+this.l_name()+"_update'),\n",c+=")\n",c+=b.new_lines(1)},this.render_admin_classes=function(a,b){var c="";c+="class "+this.name+"AdminForm(forms.ModelForm):\n",c+=b.new_lines(1),c+=b.spaces(4)+"class Meta:\n",c+=b.spaces(8)+"model = "+this.name+"\n",c+=b.spaces(8)+"fields = '__all__'\n",c+=b.new_lines(2),c+="class "+this.name+"Admin(admin.ModelAdmin):\n",c+=b.spaces(4)+"form = "+this.name+"AdminForm\n";var d=this.admin_fields();return d.length>0?(c+=b.spaces(4)+"list_display = "+this.admin_fields()+"\n",c+=b.spaces(4)+"readonly_fields = "+this.admin_read_only_fields()+"\n"):c+=b.new_lines(1),c+=b.new_lines(1),c+="admin.site.register("+this.name+", "+this.name+"Admin)\n",c+=b.new_lines(2)},this.render_view_classes=function(a,b){var c=b.new_lines(1);return c+="class "+this.name+"ListView(ListView):\n",c+=b.spaces(4)+"model = "+this.name+"\n",c+=b.new_lines(2),c+="class "+this.name+"CreateView(CreateView):\n",c+=b.spaces(4)+"model = "+this.name+"\n",c+=b.spaces(4)+"form_class = "+this.name+"Form\n",c+=b.new_lines(2),c+="class "+this.name+"DetailView(DetailView):\n",c+=b.spaces(4)+"model = "+this.name+"\n",c+=b.new_lines(2),c+="class "+this.name+"UpdateView(UpdateView):\n",c+=b.spaces(4)+"model = "+this.name+"\n",c+=b.spaces(4)+"form_class = "+this.name+"Form",c+=b.new_lines(2)},this.render_model_class_header=function(a,b){var c="class "+this.name+"(models.Model):";return c+b.new_lines(2)},this.render_model_class_fields=function(a,b){var c="";return this.fields.length>0&&(c+=b.spaces(4)+"# Fields",c+=b.new_lines(1)),jQuery.each(this.fields,function(a,d){if(-1==b.pre_imported_modules_names().indexOf(d.module()))c+=b.spaces(4)+d.name+" = "+d.class_name()+"("+d.opts+")";else{var e=b.pre_imported_modules()[d.module()].as;c+=b.spaces(4)+d.name+" = "+e+"."+d.class_name()+"("+d.opts+")"}c+=b.new_lines(1)}),c+=b.new_lines(1)},this.render_model_class_relationships=function(a,c){var d="";return this.relationships.length>0&&(d+=c.spaces(4)+"# Relationship Fields",d+=c.new_lines(1)),jQuery.each(this.relationships,function(e,f){var g="'"+a+"."+f.to_clean()+"'";if(f.to==b.user_model?g=b.user_model_setting:c.built_in_models[f.to]&&(g=f.to_class()),-1==c.pre_imported_modules_names().indexOf(f.module()))d+=c.spaces(4)+f.name+" = "+f.class_name()+"("+g+", "+f.opts+")";else{var h=c.pre_imported_modules()[f.module()].as;d+=c.spaces(4)+f.name+" = "+h+"."+f.class_name()+"("+g+", "+f.opts+")"}d+=c.new_lines(1)}),d},this.render_model_class=function(a,b){var c=this.render_model_class_header(a,b);return c+=this.render_model_class_fields(a,b),c+=this.render_model_class_relationships(a,b),c+=b.new_lines(1),c+=b.spaces(4)+"class Meta:",c+=b.new_lines(1),c+=b.spaces(8)+"ordering = ('-"+this.ordering_field()+"',)",c+=b.new_lines(2),c+=b.spaces(4)+"def __unicode__(self):",c+=b.new_lines(1),c+=b.spaces(8)+"return u'%s' % self."+this.identifier(),c+=b.new_lines(2),c+=b.spaces(4)+"def get_absolute_url(self):",c+=b.new_lines(1),c+=b.spaces(8)+"return reverse('"+a+"_"+this.l_name()+"_detail', args=(self."+this.identifier()+",))",c+=b.new_lines(1),c+=b.new_lines(2),c+=b.spaces(4)+"def get_update_url(self):",c+=b.new_lines(1),c+=b.spaces(8)+"return reverse('"+a+"_"+this.l_name()+"_update', args=(self."+this.identifier()+",))",c+=b.new_lines(3)},this.render_model_class_fields_only=function(a,b){var c="";return c+=this.render_model_class_header(a,b),c+=this.render_model_class_fields(a,b)},this.render_model_api=function(a,b){var c="class "+this.name+"ViewSet(viewsets.ModelViewSet):"+b.new_lines(1);return c+=b.spaces(4)+'"""ViewSet for the '+this.name+' class"""',c+=b.new_lines(2),c+=b.spaces(4)+"queryset = models."+this.name+".objects.all()"+b.new_lines(1),c+=b.spaces(4)+"serializer_class = serializers."+this.name+"Serializer"+b.new_lines(1),c+=b.spaces(4)+"permission_classes = [permissions.IsAuthenticated]"+b.new_lines(1),c+=b.new_lines(2)},this.render_model_serializer=function(a,b){var c="class "+this.name+"Serializer(serializers.ModelSerializer):";c+=b.new_lines(2),c+=b.spaces(4)+"class Meta:"+b.new_lines(1),c+=b.spaces(8)+"model = models."+this.name+b.new_lines(1),c+=b.spaces(8)+"fields = ("+b.new_lines(1),c+=b.spaces(12)+"'"+this.identifier()+"', "+b.new_lines(1);var d=this;return jQuery.each(this.fields,function(a,e){e.name!=d.identifier()&&(c+=b.spaces(12)+"'"+e.name+"', "+b.new_lines(1))}),c+=b.spaces(8)+")"+b.new_lines(3)},this._template_header=function(){return'{% extends "base.html" %}\n{% load static %}\n'},this._template_links=function(a){var b=a+"_"+this.l_name()+"_list";return'<p><a class="btn btn-default" href="{% url \''+b+"' %}\">"+this.name+" Listing</a></p>\n"},this._wrap_block=function(a,b){return"{% block "+a+" %}\n"+b+"\n{% endblock %}"},this.render_form_html=function(a){var b=this._template_header();b+="{% load crispy_forms_tags %}\n";var c=this._template_links(a)+'<form method="post">\n';return c+="{% csrf_token %}\n{{form|crispy}}\n",c+='<button class="btn btn-primary" type="submit">Submit</button>\n',c+="</form>",b+=this._wrap_block("content",c)},this.render_list_html=function(a){var b=a+"_"+this.l_name()+"_create",c=this._template_header(),d=this._template_links(a)+'<table class="table">\n';return d+="<tr>\n",d+="<td>ID</td><td>Link</td>\n",jQuery.each(this.fields,function(a,b){d+="    <td>"+b.name+"</td>\n"}),d+="</tr>\n",d+="{% for object in object_list %}\n",d+="<tr>\n",d+="    <td>{{object.id}}</td>\n",d+='    <td><a href="{{object.get_absolute_url}}">{{object}}</a></td>\n',jQuery.each(this.fields,function(a,b){d+="    <td>{{ object."+b.name+" }}</td>\n"}),d+="</tr>\n",d+="{% endfor %}\n",d+="</table>",d+='<a class="btn btn-primary" href="{% url \''+b+"' %}\">Create new "+this.name+"</a>",c+=this._wrap_block("content",d)},this.render_detail_html=function(a){var b=this._template_header(),c=this._template_links(a)+'<table class="table">\n';return jQuery.each(this.fields,function(a,b){c+="<tr><td>"+b.name+"</td><td>{{ object."+b.name+" }}</td></tr>\n"}),c+="</table>",c+='\n<a class="btn btn-primary" href="{{object.get_update_url}}">Edit '+this.name+"</a>\n",b+=this._wrap_block("content",c)},this.form_fields=function(){var a=this.readable_fields().map(function(a){return a.name}),b=this.relationships.map(function(a){return a.name}),c=a.concat(b);return c.length?"['"+c.join("', '")+"']":"'__all__'"},this.readable_fields=function(){var a=[];return jQuery.each(this.fields,function(b,c){-1==c.opts.indexOf("readonly")&&-1==c.opts.indexOf("editable")&&-1==c.opts.indexOf("auto_now_add")&&"django.contrib.contenttypes.fields.GenericForeignKey"!=c.type&&"django_extensions.db.fields.AutoSlugField"!=c.type&&a.push(c)}),a},this.admin_fields=function(){return this.field_names().length>0?"['"+this.field_names().join("', '")+"']":""},this.admin_read_only_fields=function(){return this.field_names().length>0?"['"+this.field_names().join("', '")+"']":""}}return new c(a)}}function ModelParserFactory(){return function(a){function b(){this.parse=function(b,c){var d=new FileReader;d.onload=function(b){var e=d.result,f=e.split("\n"),g=[],h=null,i="",j=new RegExp("class ([a-zA-Z_]*)[(]([a-zA-Z._]*)[)][:]$"),k=new RegExp("^([a-zA-Z0-9_]+) = ([a-zA-Z0-9._]+)[(](.*)[)]$");jQuery.each(f,function(b,c){c=c.trim();var d=j.exec(c);d&&d[2].match(/model/i)&&(console.log("Model:",d[1]),h={name:d[1],"class":d[2],fields:[],relationships:[]},g.push(h),i="");var e,f=k.exec(c);f&&(e=f);var l=k.exec(i);if(l&&(e=l),e){if(h&&e[2]&&(e[2].match(/field/i)||a.relationship_factory.relationship_match(e[2]))){var m=a.relationship_factory.relationship_match(e[2]);if(m){var n=e[1],o=e[2],p=e[3].split(","),q=p.shift(),r=p.join(",").trim();console.log("Model:",h.name,"Relationship:",n,o,q,r),h.relationships.push(a.relationship_factory.make_relationship({name:n,type:o,opts:r,to:q}))}else{var s=e[1],t=e[2],u=e[3];console.log("Model:",h.name,"Field:",s,t,u),h.fields.push(a.field_factory.make_field({name:s,type:t,opts:u}))}}i=""}else h&&(i+=c)});var l=[];jQuery.each(g,function(b,c){var d=a.model_factory(c,a);l.push(d)}),c&&c(l)},d.readAsText(b)}}return new b}}ace.define("ace/mode/python",["require","exports","module","ace/lib/oop","ace/mode/text","ace/tokenizer","ace/mode/python_highlight_rules","ace/mode/folding/pythonic","ace/range"],function(a,b,c){var d=a("../lib/oop"),e=a("./text").Mode,f=(a("../tokenizer").Tokenizer,a("./python_highlight_rules").PythonHighlightRules),g=a("./folding/pythonic").FoldMode,h=a("../range").Range,i=function(){this.HighlightRules=f,this.foldingRules=new g("\\:")};d.inherits(i,e),function(){this.lineCommentStart="#",this.getNextLineIndent=function(a,b,c){var d=this.$getIndent(b),e=this.getTokenizer().getLineTokens(b,a),f=e.tokens;if(f.length&&"comment"==f[f.length-1].type)return d;if("start"==a){var g=b.match(/^.*[\{\(\[\:]\s*$/);g&&(d+=c)}return d};var a={pass:1,"return":1,raise:1,"break":1,"continue":1};this.checkOutdent=function(b,c,d){if("\r\n"!==d&&"\r"!==d&&"\n"!==d)return!1;var e=this.getTokenizer().getLineTokens(c.trim(),b).tokens;if(!e)return!1;do var f=e.pop();while(f&&("comment"==f.type||"text"==f.type&&f.value.match(/^\s+$/)));return f?"keyword"==f.type&&a[f.value]:!1},this.autoOutdent=function(a,b,c){c+=1;var d=this.$getIndent(b.getLine(c)),e=b.getTabString();d.slice(-e.length)==e&&b.remove(new h(c,d.length-e.length,c,d.length))},this.$id="ace/mode/python"}.call(i.prototype),b.Mode=i}),ace.define("ace/mode/python_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/text_highlight_rules"],function(a,b,c){var d=a("../lib/oop"),e=a("./text_highlight_rules").TextHighlightRules,f=function(){var a="and|as|assert|break|class|continue|def|del|elif|else|except|exec|finally|for|from|global|if|import|in|is|lambda|not|or|pass|print|raise|return|try|while|with|yield",b="True|False|None|NotImplemented|Ellipsis|__debug__",c="abs|divmod|input|open|staticmethod|all|enumerate|int|ord|str|any|eval|isinstance|pow|sum|basestring|execfile|issubclass|print|super|binfile|iter|property|tuple|bool|filter|len|range|type|bytearray|float|list|raw_input|unichr|callable|format|locals|reduce|unicode|chr|frozenset|long|reload|vars|classmethod|getattr|map|repr|xrange|cmp|globals|max|reversed|zip|compile|hasattr|memoryview|round|__import__|complex|hash|min|set|apply|delattr|help|next|setattr|buffer|dict|hex|object|slice|coerce|dir|id|oct|sorted|intern",d=this.createKeywordMapper({"invalid.deprecated":"debugger","support.function":c,"constant.language":b,keyword:a},"identifier"),e="(?:r|u|ur|R|U|UR|Ur|uR)?",f="(?:(?:[1-9]\\d*)|(?:0))",g="(?:0[oO]?[0-7]+)",h="(?:0[xX][\\dA-Fa-f]+)",i="(?:0[bB][01]+)",j="(?:"+f+"|"+g+"|"+h+"|"+i+")",k="(?:[eE][+-]?\\d+)",l="(?:\\.\\d+)",m="(?:\\d+)",n="(?:(?:"+m+"?"+l+")|(?:"+m+"\\.))",o="(?:(?:"+n+"|"+m+")"+k+")",p="(?:"+o+"|"+n+")",q="\\\\(x[0-9A-Fa-f]{2}|[0-7]{3}|[\\\\abfnrtv'\"]|U[0-9A-Fa-f]{8}|u[0-9A-Fa-f]{4})";this.$rules={start:[{token:"comment",regex:"#.*$"},{token:"string",regex:e+'"{3}',next:"qqstring3"},{token:"string",regex:e+'"(?=.)',next:"qqstring"},{token:"string",regex:e+"'{3}",next:"qstring3"},{token:"string",regex:e+"'(?=.)",next:"qstring"},{token:"constant.numeric",regex:"(?:"+p+"|\\d+)[jJ]\\b"},{token:"constant.numeric",regex:p},{token:"constant.numeric",regex:j+"[lL]\\b"},{token:"constant.numeric",regex:j+"\\b"},{token:d,regex:"[a-zA-Z_$][a-zA-Z0-9_$]*\\b"},{token:"keyword.operator",regex:"\\+|\\-|\\*|\\*\\*|\\/|\\/\\/|%|<<|>>|&|\\||\\^|~|<|>|<=|=>|==|!=|<>|="},{token:"paren.lparen",regex:"[\\[\\(\\{]"},{token:"paren.rparen",regex:"[\\]\\)\\}]"},{token:"text",regex:"\\s+"}],qqstring3:[{token:"constant.language.escape",regex:q},{token:"string",regex:'"{3}',next:"start"},{defaultToken:"string"}],qstring3:[{token:"constant.language.escape",regex:q},{token:"string",regex:"'{3}",next:"start"},{defaultToken:"string"}],qqstring:[{token:"constant.language.escape",regex:q},{token:"string",regex:"\\\\$",next:"qqstring"},{token:"string",regex:'"|$',next:"start"},{defaultToken:"string"}],qstring:[{token:"constant.language.escape",regex:q},{token:"string",regex:"\\\\$",next:"qstring"},{token:"string",regex:"'|$",next:"start"},{defaultToken:"string"}]}};d.inherits(f,e),b.PythonHighlightRules=f}),ace.define("ace/mode/folding/pythonic",["require","exports","module","ace/lib/oop","ace/mode/folding/fold_mode"],function(a,b,c){var d=a("../../lib/oop"),e=a("./fold_mode").FoldMode,f=b.FoldMode=function(a){this.foldingStartMarker=new RegExp("([\\[{])(?:\\s*)$|("+a+")(?:\\s*)(?:#.*)?$");
};d.inherits(f,e),function(){this.getFoldWidgetRange=function(a,b,c){var d=a.getLine(c),e=d.match(this.foldingStartMarker);return e?e[1]?this.openingBracketBlock(a,e[1],c,e.index):e[2]?this.indentationBlock(a,c,e.index+e[2].length):this.indentationBlock(a,c):void 0}}.call(f.prototype)}),ace.define("ace/theme/dawn",["require","exports","module","ace/lib/dom"],function(a,b,c){b.isDark=!1,b.cssClass="ace-dawn",b.cssText=".ace-dawn .ace_gutter {background: #ebebeb;color: #333}.ace-dawn .ace_print-margin {width: 1px;background: #e8e8e8}.ace-dawn {background-color: #F9F9F9;color: #080808}.ace-dawn .ace_cursor {color: #000000}.ace-dawn .ace_marker-layer .ace_selection {background: rgba(39, 95, 255, 0.30)}.ace-dawn.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px #F9F9F9;border-radius: 2px}.ace-dawn .ace_marker-layer .ace_step {background: rgb(255, 255, 0)}.ace-dawn .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgba(75, 75, 126, 0.50)}.ace-dawn .ace_marker-layer .ace_active-line {background: rgba(36, 99, 180, 0.12)}.ace-dawn .ace_gutter-active-line {background-color : #dcdcdc}.ace-dawn .ace_marker-layer .ace_selected-word {border: 1px solid rgba(39, 95, 255, 0.30)}.ace-dawn .ace_invisible {color: rgba(75, 75, 126, 0.50)}.ace-dawn .ace_keyword,.ace-dawn .ace_meta {color: #794938}.ace-dawn .ace_constant,.ace-dawn .ace_constant.ace_character,.ace-dawn .ace_constant.ace_character.ace_escape,.ace-dawn .ace_constant.ace_other {color: #811F24}.ace-dawn .ace_invalid.ace_illegal {text-decoration: underline;font-style: italic;color: #F8F8F8;background-color: #B52A1D}.ace-dawn .ace_invalid.ace_deprecated {text-decoration: underline;font-style: italic;color: #B52A1D}.ace-dawn .ace_support {color: #691C97}.ace-dawn .ace_support.ace_constant {color: #B4371F}.ace-dawn .ace_fold {background-color: #794938;border-color: #080808}.ace-dawn .ace_list,.ace-dawn .ace_markup.ace_list,.ace-dawn .ace_support.ace_function {color: #693A17}.ace-dawn .ace_storage {font-style: italic;color: #A71D5D}.ace-dawn .ace_string {color: #0B6125}.ace-dawn .ace_string.ace_regexp {color: #CF5628}.ace-dawn .ace_comment {font-style: italic;color: #5A525F}.ace-dawn .ace_heading,.ace-dawn .ace_markup.ace_heading {color: #19356D}.ace-dawn .ace_variable {color: #234A97}.ace-dawn .ace_indent-guide {background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAEklEQVQImWNgYGBgYLh/5+x/AAizA4hxNNsZAAAAAElFTkSuQmCC) right repeat-y}";var d=a("../lib/dom");d.importCssString(b.cssText,b.cssClass)});var global=Function("return this;")();!function(a){function b(a){var b=g[a]||window[a];if(!b)throw new Error("Requested module '"+a+"' has not been defined.");return b}function c(a,b){return g[a]=b}function d(a,b){for(var c in b)"noConflict"!=c&&"_VERSION"!=c&&(a[c]=b[c]);return a}function e(a,b,c){return"string"==typeof a||a.nodeName||a.length&&"item"in a||a==window?(c=f._select(a,b),c.selector=a):c=isFinite(a.length)?a:[a],d(c,e)}function f(a,b){return e(a,b)}a.global=a;var g={},h=a.$;a.provide=c,a.require=b,d(f,{_VERSION:"0.3.6",fn:e,ender:function(a,b){d(b?e:f,a)},_select:function(a,b){return(b||document).querySelectorAll(a)}}),d(e,{forEach:function(a,b,c){for(c=0,l=this.length;c<l;++c)c in this&&a.call(b||this[c],this[c],c,this);return this},$:f}),f.noConflict=function(){return a.$=h,this},"undefined"!=typeof module&&module.exports&&(module.exports=f),a.ender=a.$=a.ender||f}(this),function(a){var b={exports:{}};b.exports,require("ender");!function(){"use strict";function a(a){var b,c=new Uint8Array(a);for(b=0;a>b;b+=1)c[b]=0;return c}function c(b,c,d,e){var f=c+d,g=a((parseInt(f/e)+1)*e);return g.set(b),g}function d(a,b,c){return a=a.toString(c||8),"000000000000".substr(a.length+12-b)+a}function e(b,c,d){var e,f;for(c=c||a(b.length),d=d||0,e=0,f=b.length;f>e;e+=1)c[d]=b.charCodeAt(e),d+=1;return c}function f(a){function b(a){return g[a>>18&63]+g[a>>12&63]+g[a>>6&63]+g[63&a]}var c,d,e,f=a.length%3,h="";for(c=0,e=a.length-f;e>c;c+=3)d=(a[c]<<16)+(a[c+1]<<8)+a[c+2],h+=b(d);switch(h.length%4){case 1:h+="=";break;case 2:h+="=="}return h}var g=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"];b.exports.clean=a,b.exports.pad=d,b.exports.extend=c,b.exports.stringToUint8=e,b.exports.uint8ToBase64=f}(),provide("tar-js/utils",b.exports)}(global),function(a){var b={exports:{}};b.exports,require("ender");!function(){"use strict";function a(a,b){var e=d.clean(512),f=0;return c.forEach(function(b){var c,d,g=a[b.field]||"";for(c=0,d=g.length;d>c;c+=1)e[f]=g.charCodeAt(c),f+=1;f+=b.length-c}),"function"==typeof b?b(e,f):e}var c,d=require("tar-js/utils");c=[{field:"fileName",length:100},{field:"fileMode",length:8},{field:"uid",length:8},{field:"gid",length:8},{field:"fileSize",length:12},{field:"mtime",length:12},{field:"checksum",length:8},{field:"type",length:1},{field:"linkName",length:100},{field:"ustar",length:8},{field:"owner",length:32},{field:"group",length:32},{field:"majorNumber",length:8},{field:"minorNumber",length:8},{field:"filenamePrefix",length:155},{field:"padding",length:12}],b.exports.structure=c,b.exports.format=a}(),provide("tar-js/header",b.exports)}(global),function(a){var b={exports:{}};b.exports,require("ender");!function(){"use strict";function a(a){this.written=0,c=(a||20)*f,this.out=e.clean(c)}var c,d=require("tar-js/header"),e=require("tar-js/utils"),f=512;a.prototype.append=function(a,b,g,h){var i,j,k,l,m,n,o;if("string"==typeof b)b=e.stringToUint8(b);else if(b.constructor!==Uint8Array.prototype.constructor)throw"Invalid input type. You gave me: "+b.constructor.toString().match(/function\s*([$A-Za-z_][0-9A-Za-z_]*)\s*\(/)[1];"function"==typeof g&&(h=g,g={}),g=g||{},k=g.mode||4095&parseInt("777",8),l=g.mtime||Math.floor(+new Date/1e3),m=g.uid||0,n=g.gid||0,i={fileName:a,fileMode:e.pad(k,7),uid:e.pad(m,7),gid:e.pad(n,7),fileSize:e.pad(b.length,11),mtime:e.pad(l,11),checksum:"        ",type:"0",ustar:"ustar  ",owner:g.owner||"",group:g.group||""},j=0,Object.keys(i).forEach(function(a){var b,c,d=i[a];for(b=0,c=d.length;c>b;b+=1)j+=d.charCodeAt(b)}),i.checksum=e.pad(j,6)+"\x00 ",o=d.format(i);return this.out.set(o,this.written),this.written+=o.length,this.written+b.length>this.out.length&&(this.out=e.extend(this.out,this.written,b.length,c)),this.out.set(b,this.written),this.written+=b.length+(f-(b.length%f||f)),this.out.length-this.written<2*f&&(this.out=e.extend(this.out,this.written,2*f,c)),"function"==typeof h&&h(this.out),this.out},a.prototype.clear=function(){this.written=0,this.out=e.clean(c)},b.exports=a}(),provide("tar-js",b.exports)}(global),angular.module("ui.ace",[]).constant("uiAceConfig",{}).directive("uiAce",["uiAceConfig",function(a){if(angular.isUndefined(window.ace))throw new Error("ui-ace need ace to work... (o rly?)");var b=function(a,b,c){if(angular.isDefined(c.workerPath)){var d=window.ace.require("ace/config");d.set("workerPath",c.workerPath)}angular.isDefined(c.require)&&c.require.forEach(function(a){window.ace.require(a)}),angular.isDefined(c.showGutter)&&a.renderer.setShowGutter(c.showGutter),angular.isDefined(c.useWrapMode)&&b.setUseWrapMode(c.useWrapMode),angular.isDefined(c.showInvisibles)&&a.renderer.setShowInvisibles(c.showInvisibles),angular.isDefined(c.showIndentGuides)&&a.renderer.setDisplayIndentGuides(c.showIndentGuides),angular.isDefined(c.useSoftTabs)&&b.setUseSoftTabs(c.useSoftTabs),angular.isDefined(c.showPrintMargin)&&a.setShowPrintMargin(c.showPrintMargin),angular.isDefined(c.disableSearch)&&c.disableSearch&&a.commands.addCommands([{name:"unfind",bindKey:{win:"Ctrl-F",mac:"Command-F"},exec:function(){return!1},readOnly:!0}]),angular.isString(c.theme)&&a.setTheme("ace/theme/"+c.theme),angular.isString(c.mode)&&b.setMode("ace/mode/"+c.mode),angular.isDefined(c.firstLineNumber)&&(angular.isNumber(c.firstLineNumber)?b.setOption("firstLineNumber",c.firstLineNumber):angular.isFunction(c.firstLineNumber)&&b.setOption("firstLineNumber",c.firstLineNumber()));var e,f;if(angular.isDefined(c.advanced))for(e in c.advanced)f={name:e,value:c.advanced[e]},a.setOption(f.name,f.value);if(angular.isDefined(c.rendererOptions))for(e in c.rendererOptions)f={name:e,value:c.rendererOptions[e]},a.renderer.setOption(f.name,f.value);angular.forEach(c.callbacks,function(b){angular.isFunction(b)&&b(a)})};return{restrict:"EA",require:"?ngModel",link:function(c,d,e,f){var g,h,i=a.ace||{},j=angular.extend({},i,c.$eval(e.uiAce)),k=window.ace.edit(d[0]),l=k.getSession(),m=function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1);angular.isDefined(a)&&c.$evalAsync(function(){if(!angular.isFunction(a))throw new Error("ui-ace use a function as callback.");a(b)})},n={onChange:function(a){return function(b){var d=l.getValue();!f||d===f.$viewValue||c.$$phase||c.$root.$$phase||c.$evalAsync(function(){f.$setViewValue(d)}),m(a,b,k)}},onBlur:function(a){return function(){m(a,k)}}};e.$observe("readonly",function(a){k.setReadOnly(!!a||""===a)}),f&&(f.$formatters.push(function(a){if(angular.isUndefined(a)||null===a)return"";if(angular.isObject(a)||angular.isArray(a))throw new Error("ui-ace cannot use an object or an array as a model");return a}),f.$render=function(){l.setValue(f.$viewValue)});var o=function(a,d){a!==d&&(j=angular.extend({},i,c.$eval(e.uiAce)),j.callbacks=[j.onLoad],j.onLoad!==i.onLoad&&j.callbacks.unshift(i.onLoad),l.removeListener("change",g),g=n.onChange(j.onChange),l.on("change",g),k.removeListener("blur",h),h=n.onBlur(j.onBlur),k.on("blur",h),b(k,l,j))};c.$watch(e.uiAce,o,!0),o(i),d.on("$destroy",function(){k.session.$stopWorker(),k.destroy()}),c.$watch(function(){return[d[0].offsetWidth,d[0].offsetHeight]},function(){k.resize(),k.renderer.updateFull()},!0)}}}]),!function(a,b){"use strict";var c=b.isDefined,d=b.isUndefined,e=b.isNumber,f=b.isObject,g=b.isArray,h=b.extend,i=b.toJson,j=b.module("LocalStorageModule",[]);j.provider("localStorageService",function(){this.prefix="ls",this.storageType="localStorage",this.cookie={expiry:30,path:"/"},this.notify={setItem:!0,removeItem:!1},this.setPrefix=function(a){return this.prefix=a,this},this.setStorageType=function(a){return this.storageType=a,this},this.setStorageCookie=function(a,b){return this.cookie.expiry=a,this.cookie.path=b,this},this.setStorageCookieDomain=function(a){return this.cookie.domain=a,this},this.setNotify=function(a,b){return this.notify={setItem:a,removeItem:b},this},this.$get=["$rootScope","$window","$document","$parse",function(a,b,j,k){var l,m=this,n=m.prefix,o=m.cookie,p=m.notify,q=m.storageType;j?j[0]&&(j=j[0]):j=document,"."!==n.substr(-1)&&(n=n?n+".":"");var r=function(a){return n+a},s=function(){try{var c=q in b&&null!==b[q],d=r("__"+Math.round(1e7*Math.random()));return c&&(l=b[q],l.setItem(d,""),l.removeItem(d)),c}catch(e){return q="cookie",a.$broadcast("LocalStorageModule.notification.error",e.message),!1}}(),t=function(b,c){if(c=d(c)?null:i(c),!s||"cookie"===m.storageType)return s||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),p.setItem&&a.$broadcast("LocalStorageModule.notification.setitem",{key:b,newvalue:c,storageType:"cookie"}),z(b,c);try{l&&l.setItem(r(b),c),p.setItem&&a.$broadcast("LocalStorageModule.notification.setitem",{key:b,newvalue:c,storageType:m.storageType})}catch(e){return a.$broadcast("LocalStorageModule.notification.error",e.message),z(b,c)}return!0},u=function(b){if(!s||"cookie"===m.storageType)return s||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),A(b);var c=l?l.getItem(r(b)):null;if(!c||"null"===c)return null;try{return JSON.parse(c)}catch(d){return c}},v=function(){var b,c;for(b=0;b<arguments.length;b++)if(c=arguments[b],s&&"cookie"!==m.storageType)try{l.removeItem(r(c)),p.removeItem&&a.$broadcast("LocalStorageModule.notification.removeitem",{key:c,storageType:m.storageType})}catch(d){a.$broadcast("LocalStorageModule.notification.error",d.message),B(c)}else s||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),p.removeItem&&a.$broadcast("LocalStorageModule.notification.removeitem",{key:c,storageType:"cookie"}),B(c)},w=function(){if(!s)return a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),!1;var b=n.length,c=[];for(var d in l)if(d.substr(0,b)===n)try{c.push(d.substr(b))}catch(e){return a.$broadcast("LocalStorageModule.notification.error",e.Description),[]}return c},x=function(b){var c=n?new RegExp("^"+n):new RegExp,d=b?new RegExp(b):new RegExp;if(!s||"cookie"===m.storageType)return s||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),C();var e=n.length;for(var f in l)if(c.test(f)&&d.test(f.substr(e)))try{v(f.substr(e))}catch(g){return a.$broadcast("LocalStorageModule.notification.error",g.message),C()}return!0},y=function(){try{return b.navigator.cookieEnabled||"cookie"in j&&(j.cookie.length>0||(j.cookie="test").indexOf.call(j.cookie,"test")>-1)}catch(c){return a.$broadcast("LocalStorageModule.notification.error",c.message),!1}}(),z=function(b,c,h){if(d(c))return!1;if((g(c)||f(c))&&(c=i(c)),!y)return a.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var k="",l=new Date,m="";if(null===c?(l.setTime(l.getTime()+-864e5),k="; expires="+l.toGMTString(),c=""):e(h)&&0!==h?(l.setTime(l.getTime()+24*h*60*60*1e3),k="; expires="+l.toGMTString()):0!==o.expiry&&(l.setTime(l.getTime()+24*o.expiry*60*60*1e3),k="; expires="+l.toGMTString()),b){var n="; path="+o.path;o.domain&&(m="; domain="+o.domain),j.cookie=r(b)+"="+encodeURIComponent(c)+k+n+m}}catch(p){return a.$broadcast("LocalStorageModule.notification.error",p.message),!1}return!0},A=function(b){if(!y)return a.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var c=j.cookie&&j.cookie.split(";")||[],d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(r(b)+"=")){var f=decodeURIComponent(e.substring(n.length+b.length+1,e.length));try{return JSON.parse(f)}catch(g){return f}}}return null},B=function(a){z(a,null)},C=function(){for(var a=null,b=n.length,c=j.cookie.split(";"),d=0;d<c.length;d++){for(a=c[d];" "===a.charAt(0);)a=a.substring(1,a.length);var e=a.substring(b,a.indexOf("="));B(e)}},D=function(){return q},E=function(a,b,d,e){e=e||b;var g=u(e);return null===g&&c(d)?g=d:f(g)&&f(d)&&(g=h(d,g)),k(b).assign(a,g),a.$watch(b,function(a){t(e,a)},f(a[b]))},F=function(){for(var a=0,c=b[q],d=0;d<c.length;d++)0===c.key(d).indexOf(n)&&a++;return a};return{isSupported:s,getStorageType:D,set:t,add:t,get:u,keys:w,remove:v,clearAll:x,bind:E,deriveKey:r,length:F,cookie:{isSupported:y,set:z,add:z,get:A,remove:B,clearAll:C}}}]})}(window,window.angular),angular.module("builder",["ngRoute","builder.filters","builder.services","builder.directives","builder.controllers","LocalStorageModule","ui.ace","angulartics","angulartics.google.analytics"]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/models",{templateUrl:"partials/models.html",controller:"ModelController"}),a.when("/home",{templateUrl:"partials/home.html",controller:"ModelController"}),a.otherwise({redirectTo:"/home"})}]),angular.module("builder.controllers",["LocalStorageModule"]).controller("ModelController",["$scope","$http","ModelFactory","ModelParser","FieldFactory","RelationshipFactory","localStorageService","MessageService","RenderFactory","TarballFactory",function(a,b,c,d,e,f,g,h,i,j){a.models=[],a.new_models=[],a.user_model="django.contrib.auth.models.User",a.user_model_setting="settings.AUTH_USER_MODEL",a.built_in_models={"django.contrib.auth.models.User":{fields:{username:{"default":"username"},email:{"default":"username@tempurl.com"}}},"django.contrib.auth.models.Group":{fields:{name:{"default":"group"}}},"django.contrib.contenttypes.models.ContentType":{fields:{}}},a.messageService=new h,a.field_factory=new e,a.model_factory=c,a.relationship_factory=new f,a.render_factory=new i(a.built_in_models),a.editors=[],a.models_storage_key="local_models",a._app_name="app_name",a._project_name="project_name",a.create_tar_ball_url=function(b){var c="Built with django_builder\n",d="#";const e=a.project_name(),f=a.app_name();var g=a.render_factory.render_models_py(f,a.models),h=a.render_factory.render_views_py(f,a.models),i=a.render_factory.render_admin_py(f,a.models),k=a.render_factory.render_urls_py(f,a.models),l=a.render_factory.render_tests_py(f,a.models),m=a.render_factory.render_forms_py(f,a.models),n=a.render_factory.render_django_rest_framework_api_py(f,a.models),o=a.render_factory.render_django_rest_framework_serializers_py(f,a.models),p=a.render_factory.render_templates_html(f,a.models),q=new j,r=f;if(b&&(r=e+"/"+f),b){var s=a.render_factory.render_project_settings_py(e),t=a.render_factory.render_project_urls_py(e),u=a.render_factory.render_project_urls_py(e),v=a.render_factory.render_project_wsgi_py(e);q.append(e+"/manage.py",u),q.append(e+"/"+e+"/settings.py",s),q.append(e+"/"+e+"/urls.py",t),q.append(e+"/"+e+"/wsgi.py",v),q.append(e+"/"+e+"/__init__.py",d)}return q.append(r+"/README.txt",c),q.append(r+"/__init__.py",d),q.append(r+"/models.py",g),q.append(r+"/views.py",h),q.append(r+"/admin.py",i),q.append(r+"/urls.py",k),q.append(r+"/tests.py",l),q.append(r+"/forms.py",m),q.append(r+"/api.py",n),q.append(r+"/serializers.py",o),q.append(r+"/templates/base.html",a.render_factory.render_base_html(f,a.models)),jQuery.each(p,function(a,b){q.append(r+"/templates/"+f+"/"+b[0],b[1])}),q.get_url()},a.create_download_modal_app=function(){var b=a.create_tar_ball_url(!1),c=a.app_name()+".tar";return a.create_download_modal(b,c)},a.create_download_modal_project=function(){var b=a.create_tar_ball_url(!0),c=a.project_name()+".tar",d=jQuery("<p>");d.text("The project download includes the following files:");var e=jQuery("<div>").addClass("well well-sm");return e.append(jQuery("<p>").text("manage.py")),e.append(jQuery("<p>").text(a.project_name()+"/settings.py")),e.append(jQuery("<p>").text(a.project_name()+"/urls.py")),e.append(jQuery("<p>").text(a.project_name()+"/wsgi.py")),d.append(jQuery("<br><br>")),d.append(e),a.create_download_modal(b,c,d)},a.create_download_modal=function(b,c,d){var e=jQuery("<a>").attr("href",b).attr("id","django_builder_download_a");e.addClass("btn btn-success btn-lg").css("text-transform","none"),e.text("Click here to download "+c),e.attr("download",c);var f=jQuery("<div>").addClass("text-center").append(e),g=jQuery("<div>");g.append(jQuery("<br>")),g.append("Chrome can block downloads of the generated tarball, if this happens navigate to the "),g.append(jQuery("<strong>").text("Downloads")),g.append(" section of chrome to accept the download"),g.append(jQuery("<br>")),g.append("Window -> Downloads");var h=jQuery("<div>");void 0!=d&&h.append(d),h.append(f),h.append(g);var i="django_builder_download_modal";return a.messageService.simple_info("Download info",h).modal("show").attr("id",i),i},a.render_model_class_fields_only=function(b){return b.render_model_class_fields_only(a._app_name,a.render_factory)},a.upload_input=function(){return jQuery('<input type="file" />')},a.upload_drop_target=function(a){var b=jQuery("<div>").addClass("builder_dnd_target text-center"),c=jQuery("<i>").addClass("fa fa-upload fa-4x builder_dnd_icon");return b.append(jQuery("<div>").text("Drag and Drop files here!")),b.append(c),b},a.upload_form=function(a,b){var c=jQuery("<form>"),d=jQuery("<span>").addClass("btn btn-default btn-file center-block builder_upload_models_py");return d.append("Browse"),d.append(a),c.append(d),c.append(b),c},a.save_new_models=function(b){a.new_models=[],a.models=b,a.saveApp(),a.$apply()},a.merge_models=function(){for(var b=a.models.concat(a.new_models),c=0;c<b.length;++c)for(var d=c+1;d<b.length;++d)b[c].name===b[d].name&&b.splice(d--,1);return a.save_new_models(b)},a.add_unique=function(){jQuery.each(a.new_models,function(b,c){a.existingModel(c.name)||a.models.push(c)}),a.save_new_models(a.models)},a.add_new_models=function(b){a.new_models=b,a.$apply();var c=function(){console.log("Overwriting existing models"),a.merge_models()},d=function(){var b=!1,d=[],e=jQuery("<p>").text("The following models are duplicates:");jQuery.each(a.new_models,function(c,f){a.existingModel(f.name)&&(b=!0,d.push(f),e.append(jQuery("<div>").text(f.name)))});var f=d.length==a.new_models.length;if(b){var g=[{text:"Overwrite existing models",callback:c}];f||g.push({text:"Add unique",callback:a.add_unique}),g.push({text:"Cancel",callback:function(){}});var h="duplicate_models";a.messageService.simple_choice("Add duplicate models?",e,g).modal("show").attr("id",h)}else a.merge_models()},e=jQuery("<div>");jQuery.each(a.new_models,function(b,c){e.append(jQuery("<hr>")),e.append(jQuery("<pre>").html(c.render_model_class_fields_only(a._app_name,a.render_factory)));var d=jQuery('<button class="btn btn-danger pull-right">').text("Remove");e.append(d),e.append(jQuery("<div>").addClass("clearfix"))});var f="add_new_models";return a.messageService.simple_confirm("Add the following models?",jQuery("#builder_new_models"),d).modal("show").find(".modal-dialog").css("width","50%").attr("id",f),f},a.process_models_py=function(b){if(0==b.length)a.messageService.simple_error("Sorry","You didn't seem to choose any files.").modal("show");else if(b.length>1)a.messageService.simple_error("Sorry","Multiple files not yet supported, please choose a single file.").modal("show");else{var c=d(a);c.parse(b[0],function(b){a.add_new_models(b)})}},a.upload_models_py=function(){var b=a.upload_input(),c=a.upload_drop_target(),d=a.upload_form(b,c),e=a.messageService.simple_form("Upload models.py","Choose a models.py file to analyse",d,function(){a.process_models_py(jQuery(b)[0].files),e.modal("hide")}).modal("show");b.change(function(){a.process_models_py(jQuery(b)[0].files),e.modal("hide")}),d.on("drag dragstart dragend dragover dragenter dragleave drop",function(a){a.preventDefault(),a.stopPropagation()}).on("dragover dragenter",function(){c.addClass("is-drag-over")}).on("dragleave dragend drop",function(){c.removeClass("is-drag-over")}).on("drop",function(b){var c=b.originalEvent.dataTransfer.files;e.modal("hide"),a.process_models_py(c)})},jQuery("html body").on("drag dragstart dragend dragover dragenter dragleave drop",function(a){a.preventDefault(),a.stopPropagation()}).on("dragover dragenter",function(){}).on("drop",function(a){}),jQuery("#builder_models_content").on("drag dragstart dragend dragover dragenter dragleave drop",function(a){a.preventDefault(),a.stopPropagation()}).on("dragover dragenter",function(){jQuery(".builder_dnd_target").addClass("is-drag-over")}).on("drop",function(b){jQuery(".builder_dnd_target").removeClass("is-drag-over");var c=b.originalEvent.dataTransfer.files;a.process_models_py(c)}),a.aceLoad=function(b){var c=jQuery(b.container).attr("id");"builder_models"==c?b.setValue(a.render_factory.render_models_py(a.app_name(),a.models)):"builder_views"==c?b.setValue(a.render_factory.render_views_py(a.app_name(),a.models)):"builder_admin"==c?b.setValue(a.render_factory.render_admin_py(a.app_name(),a.models)):"builder_urls"==c?b.setValue(a.render_factory.render_urls_py(a.app_name(),a.models)):"builder_tests"==c?b.setValue(a.render_factory.render_tests_py(a.app_name(),a.models)):"builder_forms"==c?b.setValue(a.render_factory.render_forms_py(a.app_name(),a.models)):"builder_django_rest_framework_api"==c?b.setValue(a.render_factory.render_django_rest_framework_api_py(a.app_name(),a.models)):"builder_django_rest_framework_serializers"==c&&b.setValue(a.render_factory.render_django_rest_framework_serializers_py(a.app_name(),a.models)),b.session.selection.clearSelection()},a.reLoadAce=function(){Object.keys(a.editors).map(function(b){a.aceLoad(a.editors[b])})},a.aceLoaded=function(b){b.setOptions({readOnly:!0,highlightActiveLine:!1,highlightGutterLine:!1,maxLines:1/0}),b.renderer.$cursorLayer.element.style.opacity=0,a.aceLoad(b),a.editors.push(b)},a.$watch("[models,_app_name]",function(){a.reLoadAce(),a.saveApp()},!0),a.aceChanged=function(a){},a.do_set_app_name=function(b){a._app_name=b},a.set_app_name=function(){a.do_set_app_name(jQuery("input#appname").val()),a.reLoadAce()},a.do_set_project_name=function(b){a._project_name=b},a.set_project_name=function(){a.do_set_project_name(jQuery("input#projectname").val()),a.reLoadAce()},a.l_app_name=function(){return a._app_name.toLowerCase()},a.app_name=function(){return a._app_name.replace(new RegExp(" ","g"),"_")},a.project_name=function(){return a._project_name.replace(new RegExp(" ","g"),"_")},a.updateModel=function(b){var c=a.models.indexOf(b);a.models[c]=b,a.$apply()},a.serializeApp=function(){var b={models:a.models,app_config:{app_name:a._app_name}};return JSON.stringify(b)},a.saveApp=function(){g.set(a.models_storage_key,a.serializeApp())},a.doClearModels=function(){g.set(a.models_storage_key,""),a.loadModels(),a.models=[],a.$apply()},a.clearModels=function(){var b=function(){a.doClearModels()},c="clear_all";return a.messageService.simple_confirm("Confirm","Remove all models?",b).modal("show").attr("id",c),c},a.model_count=function(){return a.models.length},a.add_model=function(b){var d={name:b};d.fields=[a.field_factory.make_field({name:"name",type:"django.db.models.CharField",opts:"max_length=255"}),a.field_factory.make_field({name:"slug",type:"django_extensions.db.fields.AutoSlugField",opts:"populate_from='name', blank=True"}),a.field_factory.make_field({name:"created",type:"django.db.models.DateTimeField",opts:"auto_now_add=True, editable=False"}),a.field_factory.make_field({name:"last_updated",type:"django.db.models.DateTimeField",opts:"auto_now=True, editable=False"})];var e=c(d,a);a.models.push(e),a.saveApp(),a.$apply()},a.existingModel=function(b){var c=!1;return jQuery.each(a.models,function(a,d){b==d.name&&(c=!0)}),c},a.addModel=function(){var b=function(b){void 0==b||""===b?a.messageService.simple_info("Model Name Required","Enter a Model name").modal("show"):a.existingModel(b)?a.messageService.simple_error("Error with Model Name","There is already a model with the name "+b).modal("show"):a.add_model(b)},c="add_model";return a.messageService.simple_input("Model Name Required","Enter a Model name","Model1",b,!0).modal("show").attr("id",c),c},a.cleanModel=function(a){delete a.$$hashKey,void 0!=a.fields&&jQuery.each(a.fields,function(a,b){delete b.$$hashKey}),void 0!=a.relationships&&jQuery.each(a.relationships,function(a,b){delete b.$$hashKey})},a.loadModels=function(){var b=g.get(a.models_storage_key)||{models:[],app_config:{app_name:"app_name"}};"string"==typeof b&&(b=JSON.parse(b));var c=b.models||[],d=b.app_config||{app_name:"app_name"};return a._app_name=d.app_name,jQuery.each(c,function(b,c){a.cleanModel(c)}),c},a.loadModel=function(b){var d=c(b,a);a.models.push(d)},a.__init__=function(){jQuery.each(a.loadModels(),function(b,c){a.loadModel(c)})},a.__init__(),a.debug=function(){},a.do_rename_model=function(b,c){var d="rename_model_existing",e=a.models[b];a.existingModel(c)?a.messageService.simple_error("Error with Model Name","There is already a model with the name "+c).modal("show").attr("id",d):(e.set_name(c),a.updateModel(e),a.$apply())},a.rename_model=function(b){var c=a.models[b],d="rename_model",e=function(c){a.do_rename_model(b,c)};return a.messageService.simple_input("Rename model","Enter a new Model name",c.name,e,!0).modal("show").attr("id",d),d},a.add_relationship=function(b){var c=a.models[b],d=function(b){var d=b.find("input[name=name]").val();if(void 0===d||""===d)b.find("div.form-group-name").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text("Field Required");else if(c.has_relationship(d))b.find("div.form-group-name").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text('Field "'+d+'" exists');else{var e=b.find("select[name=type]").val(),f=b.find("input[name=opts]").val(),g=b.find("select[name=to]").val(),h=a.relationship_factory.make_relationship({name:d,type:e,opts:f,to:g});c.relationships.push(h),a.updateModel(c),a.$apply(),jQuery(".modal").modal("hide")}},e=jQuery("<form>"),f=jQuery("<div>").addClass("form-group form-group-name has-feedback").appendTo(e),g=jQuery("<div>").addClass("form-group form-group-to").appendTo(e),h=jQuery("<div>").addClass("form-group form-group-type").appendTo(e),i=jQuery("<div>").addClass("form-group form-group-args").appendTo(e);f.append(jQuery("<label>").text("Name")),f.append(jQuery("<input>").attr("name","name").addClass("form-control")),f.append(jQuery("<span>").text("error message").addClass("help-block hide"));var j=jQuery("<select>").attr("name","to").addClass("form-control"),k=jQuery("<optgroup>").attr("label","Django models");jQuery.each(a.built_in_models,function(a,b){k.append(jQuery("<option>").attr("val",a).text(a))}),j.append(k);var l=jQuery("<optgroup>").attr("label","Your App models");jQuery.each(a.models,function(a,b){l.append(jQuery("<option>").attr("val",b.name).text(b.name))}),j.append(l),g.append(jQuery("<label>").text("Relationship to Model")),g.append(j);var m=jQuery("<select>").attr("name","type");jQuery.each(a.relationship_factory.relationship_types(),function(a,b){m.append(jQuery("<option>").attr("val",b).text(b))}),h.append(jQuery("<label>").text("Relationship Type")),h.append(m),i.append(jQuery("<label>").text("Arguments")),i.append(jQuery("<input>").attr("name","opts").attr("placeholder","options").addClass("form-control")),j.select2({theme:"bootstrap"}),m.select2({theme:"bootstrap"});var n="add_rel_"+c.name+"_"+b;return a.messageService.simple_form_no_dismiss("Add Relationship","",e,d).modal("show").attr("id",n).appendTo("body"),n},a.add_field=function(b){var c=a.models[b],d=function(b){var d=b.find("input[name=name]").val();if(void 0===d||""===d)b.find("div.form-group-name").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text("Field Required");else if(c.has_field(d))b.find("div.form-group-name").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text('Field "'+d+'" exists');else{var e=b.find("select[name=type]").val(),f=b.find("input[name=opts]").val(),g=a.field_factory.make_field({name:d,type:e,opts:f});c.fields.push(g),a.updateModel(c),a.$apply(),jQuery(".modal").modal("hide")}},e=jQuery("<form>"),f=jQuery("<div>").addClass("form-group form-group-name  has-feedback").appendTo(e),g=jQuery("<div>").addClass("form-group form-group-type").appendTo(e),h=jQuery("<div>").addClass("form-group form-group-args").appendTo(e);f.append(jQuery("<label>").text("Name")),f.append(jQuery("<input>").attr("name","name").addClass("form-control")),f.append(jQuery("<span>").text("error message").addClass("help-block hide"));var i=jQuery("<select>").attr("name","type").addClass("form-control");jQuery.each(a.field_factory.field_types(),function(a,b){i.append(jQuery("<option>").attr("val",b).text(b))});var j=jQuery("<input>").attr("name","opts").attr("placeholder","options").addClass("form-control");g.append(jQuery("<label>").text("Field Type")),g.append(i),h.append(jQuery("<label>").text("Arguments")),h.append(j),i.change(function(){j.val(a.field_factory.default_field_args(i.val()))}),j.val(a.field_factory.default_field_args(i.val()));var k="add_field_"+c.name+"_"+b;return a.messageService.simple_form_no_dismiss("Add Field","",e,d).modal("show").attr("id",k).appendTo("body"),k},a.edit_relationship=function(b,c){var d=a.models[b].relationships[c],e=function(b){d.form_update(b),a.$apply()},f=d.$$hashKey||"edit_relationship_"+d.name;return a.messageService.simple_form("Edit Relationship '"+d.name+"'","",d.edit_form(a),e).modal("show").attr("id",f).appendTo("body"),
f},a.edit_field=function(b,c){var d=a.models[b].fields[c],e=function(b){d.form_update(b),a.$apply()},f=d.$$hashKey||"edit_field_"+d.name;return a.messageService.simple_form("Edit field '"+d.name+"'","",d.edit_form(a),e).modal("show").attr("id",f).appendTo("body"),f},a.do_remove_new_model=function(b){a.new_models.splice(b,1),a.$apply()},a.remove_new_model=function(b){setTimeout(function(){a.do_remove_new_model(b)})},a.remove_relationship=function(b,c){var d=function(){a.models[b].relationships.splice(c,1),a.$apply()},e=a.models[b].relationships[c],f=e.$$hashKey||"remove_relationship_"+e.name;return a.messageService.simple_confirm("Confirm","Remove the relationship '"+e.name+"'",d).modal("show").attr("id",f).appendTo("body"),f},a.do_remove_new_relationship=function(b,c){a.new_models[b].relationships.splice(c,1)},a.remove_new_relationship=function(b,c){setTimeout(function(){a.do_remove_new_relationship(b,c)})},a.do_remove_new_field=function(b,c){a.new_models[b].fields.splice(c,1),a.$apply()},a.remove_new_field=function(b,c){setTimeout(function(){a.do_remove_new_field(b,c)})},a.remove_field=function(b,c){var d=function(){a.models[b].fields.splice(c,1),a.$apply()},e=a.models[b].fields[c],f=e.$$hashKey||"remove_field_"+e.name;return a.messageService.simple_confirm("Confirm","Remove the field '"+e.name+"'",d).modal("show").attr("id",f).appendTo("body"),f},a.remove_model=function(b){var c=function(){a.models.splice(b,1),a.$apply()},d=a.models[b],e=d.$$hashKey||"remove_model_"+d.name;return a.messageService.simple_confirm("Confirm","Remove the model '"+d.name+"'",c).modal("show").modal("show").attr("id",e).appendTo("body"),e},a.model_highlight=function(b,c){var d=a.models[b].relationships[c];jQuery(".builder_model_"+d.to_clean()).addClass("builder_model_highlight")},a.model_unhighlight=function(){jQuery(".builder_model").removeClass("builder_model_highlight")},a.new_model_highlight=function(b,c){var d=a.new_models[b].relationships[c];jQuery(".builder_model_"+d.to_clean()).addClass("builder_model_highlight")},a.new_model_unhighlight=function(){jQuery(".builder_model").removeClass("builder_model_highlight")}}]),angular.module("builder.directives",[]).directive("appVersion",["version",function(a){return function(b,c,d){c.text(a)}}]),angular.module("builder.filters",[]).filter("interpolate",["version",function(a){return function(b){return String(b).replace(/\%VERSION\%/gm,a)}}]),angular.module("builder.services",[]).factory("ModelFactory",[ModelServiceFactory]).factory("ModelParser",[ModelParserFactory]).factory("MessageService",[MessageServiceFactory]).factory("FieldFactory",[FieldFactory]).factory("RelationshipFactory",[RelationshipFactory]).factory("RenderFactory",[ModelRenderFactory]).factory("TarballFactory",[TarballFactory]).value("version","0.1");
>>>>>>> WIP: download project
=======
function TarballFactory(){return function(){function a(){var a=this,b=require("tar-js"),c=new b;a.uInt8ToString=function(a){var b,c,d="";for(b=0,c=a.length;c>b;b+=1)d+=String.fromCharCode(a[b]);return d},a.append=function(a,b){c.append(a,b)},a.get_url=function(b){var d=btoa(a.uInt8ToString(c.out));return"data:application/tar;base64,"+d}}return new a}}function ModelRenderFactory(){return function(a){var b=this;b.built_in_models=a,b.spaces=function(a){var b=a||1;return new Array(b+1).join(" ")},b.model_names=function(a,b){var c=b||"";return Object.keys(a).map(function(b){return a[b].name+c})},b.new_lines=function(a){var b=a||1;return new Array(b+1).join("\n")},b.render_all=function(a,c){var d="";return d+=b.render_base_html(a,c),d+=b.render_forms_py(a,c),d+=b.render_urls_py(a,c),d+=b.render_admin_py(a,c),d+=b.render_views_py(a,c),d+=b.render_models_py(a,c),d+=b.render_django_rest_framework_api_py(a,c),d+=b.render_django_rest_framework_serializers_py(a,c),d+=b.render_templates_html(a,c)},b.render_base_html=function(a,b){return"<html><head></head><body>{% block content %}Replace this.{% endblock %}</body>"},b.pre_imported_modules=function(a){return{"django.contrib.auth.models":{as:"auth_models"},"django.db.models":{as:"models"},"django_extensions.db.fields":{as:"extension_fields"}}},b.pre_imported_modules_names=function(a){return Object.keys(b.pre_imported_modules())},b.render_project_manage_py=function(a){var b="# Project: "+a+"\n";return b},b.render_project_settings_py=function(a){var b="# Project: "+a+"\n";return b},b.render_project_wsgi_py=function(a){var b="\n";return b},b.render_project_urls_py=function(a){var b="";return b},b.render_forms_py=function(a,c){var d="from django import forms\n";return d+="from .models import "+b.model_names(c,"").join(", ")+"\n",d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_forms(a,b)}),d},b.render_tests_py=function(a,c){var d="import unittest\nfrom django.core.urlresolvers import reverse\nfrom django.test import Client\n";return d+="from .models import "+b.model_names(c,"").join(", ")+"\n",jQuery.each(b.built_in_models,function(a,c){var e=a.split("."),f=e.pop(),g=e.join(".");d+="from "+g+" import "+f,d+=b.new_lines(1)}),d+=b.new_lines(2),jQuery.each(b.built_in_models,function(a,c){var e="create_"+a.toLowerCase().replace(/\./g,"_"),f=a.split(".").pop(),g="";g+="def "+e+"(**kwargs):\n",g+=b.spaces(4)+"defaults = {}\n",jQuery.each(c.fields,function(a,c){g+=b.spaces(4)+'defaults["'+a+'"] = "'+c["default"]+'"\n'}),g+=b.spaces(4)+"defaults.update(**kwargs)\n",g+=b.spaces(4)+"return "+f+".objects.create(**defaults)\n",g+=b.new_lines(2),d+=g}),jQuery.each(c,function(c,e){d+=e.render_tests_helpers(a,b)}),jQuery.each(c,function(c,e){d+=e.render_tests(a,b)}),d},b.render_urls_py=function(a,c){var d="from django.conf.urls import url, include\n";return d+="from rest_framework import routers"+b.new_lines(1),d+="import api"+b.new_lines(1),d+="import views"+b.new_lines(2),d+="router = routers.DefaultRouter()"+b.new_lines(1),jQuery.each(c,function(a,c){d+="router.register(r'"+c.l_name()+"', api."+c.name+"ViewSet)"+b.new_lines(1)}),d+=b.new_lines(2),d+="urlpatterns = ("+b.new_lines(1),d+=b.spaces(4)+"# urls for Django Rest Framework API"+b.new_lines(1),d+=b.spaces(4)+"url(r'^api/v1/', include(router.urls)),"+b.new_lines(1),d+=")"+b.new_lines(1),d+=b.new_lines(1),jQuery.each(c,function(c,e){d+=e.render_urls(a,b)}),d},b.render_admin_py=function(a,c){var d="from django.contrib import admin\nfrom django import forms\n";return d+="from .models import "+b.model_names(c).join(", "),d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_admin_classes(a,b)}),d},b.render_views_py=function(a,c){var d="from django.views.generic import DetailView, ListView, UpdateView, CreateView\n";return d+="from .models import "+b.model_names(c).join(", "),d+=b.new_lines(1),d+="from .forms import "+b.model_names(c,"Form").join(", "),d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_view_classes(a,b)}),d},b.render_models_py=function(a,c){var d="from django.core.urlresolvers import reverse\n";d+="from django_extensions.db.fields import AutoSlugField\n",d+="from django.db.models import *\n",d+="from django.conf import settings\n",d+="from django.contrib.contenttypes.fields import GenericForeignKey\n",d+="from django.contrib.contenttypes.models import ContentType\n",d+="from django.contrib.auth import get_user_model\n",jQuery.each(b.pre_imported_modules(),function(a,b){var c=a.split("."),e=c.pop();d+="from "+c.join(".")+" import "+e+" as "+b.as+"\n"});var e={};jQuery.each(c,function(a,b){jQuery.each(b.fields,function(a,b){e[b.module()]=b.module()})});var f={};return jQuery.each(c,function(a,b){jQuery.each(b.fields,function(a,b){f[b.type]=b}),jQuery.each(b.relationships,function(a,b){f[b.type]=b})}),jQuery.each(f,function(a,b){}),d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_model_class(a,b)}),d},b.render_templates_html=function(a,b){var c=[];return jQuery.each(b,function(b,d){c.push([d.l_name()+"_form.html",d.render_form_html(a)]),c.push([d.l_name()+"_detail.html",d.render_detail_html(a)]),c.push([d.l_name()+"_list.html",d.render_list_html(a)])}),c},b.render_django_rest_framework_api_py=function(a,c){var d="import models\n";return d+="import serializers\n",d+="from rest_framework import viewsets, permissions\n",d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_model_api(a,b)}),d},b.render_django_rest_framework_serializers_py=function(a,c){var d="import models";return d+=b.new_lines(2),d+="from rest_framework import serializers",d+=b.new_lines(3),jQuery.each(c,function(c,e){d+=e.render_model_serializer(a,b)}),d}}}function MessageServiceFactory(){return function(){var a=this;a.base_modal=function(){var a=jQuery("<div>").addClass("modal fade");a.attr("tabindex","-1"),a.attr("role","dialog"),a.css("display","none");var b=jQuery("<div>").addClass("modal-dialog"),c=jQuery("<div>").addClass("modal-content").appendTo(b),d=jQuery("<h2>").addClass("modal-header-inner");return jQuery("<div>").addClass("modal-header").appendTo(c).append(d),jQuery("<div>").addClass("modal-body").appendTo(c),jQuery("<div>").addClass("modal-footer").appendTo(c),a.append(b),a},a.icon=function(a){return jQuery("<icon>").addClass("fa").addClass(a)},a.simple_error=function(b,c){var d=a.base_modal(),e=a.icon("fa-info").addClass("pull-right");d.find(".modal-header-inner").append(e).append(jQuery("<span>").text(b)),d.find(".modal-body").empty().append(c);var f=jQuery("<button>").addClass("btn btn-default").text("Ok");return d.find(".modal-footer").append(f),f.attr("data-dismiss","modal"),d.modal(),d},a.simple_info=function(b,c){var d=a.base_modal(),e=a.icon("fa-info").addClass("pull-right");d.find(".modal-header-inner").append(e).append(jQuery("<span>").text(b)),d.find(".modal-body").empty().append(c);var f=jQuery("<button>").addClass("btn btn-default").text("Ok");return d.find(".modal-footer").append(f),f.attr("data-dismiss","modal"),d.modal(),d},a.simple_confirm=function(b,c,d){var e=d||jQuery.noop,f=a.base_modal();f.find(".modal-header-inner").html(b),f.find(".modal-body").empty().append(c);var g=jQuery("<button>").addClass("btn btn-primary").text("Ok"),h=jQuery("<button>").addClass("btn btn-default").text("Cancel");return f.find(".modal-footer").append(g).append(h),g.click(function(){e()}),h.attr("data-dismiss","modal"),g.attr("data-dismiss","modal"),f.modal(),f},a.simple_choice=function(b,c,d){var e=a.base_modal();return e.find(".modal-header-inner").html(b),e.find(".modal-body").empty().append(c),jQuery.each(d,function(a,b){var c=jQuery("<button>").addClass("btn btn-primary").text(b.text);e.find(".modal-footer").append(c),c.click(function(){b.callback()}),c.attr("data-dismiss","modal")}),e.modal(),e},a.simple_form=function(b,c,d,e,f){var g=e||jQuery.noop,h=f||!0,i=a.base_modal();i.find(".modal-header-inner").html(b),i.find(".modal-body").empty().append(c).append(d);var j=jQuery("<button>").addClass("btn btn-primary").text("Ok"),k=jQuery("<button>").addClass("btn btn-default").text("Cancel");return i.find(".modal-footer").append(j).append(k),j.click(function(){h||i.modal("hide"),g(d)}),k.attr("data-dismiss","modal"),h||j.attr("data-dismiss","modal"),i.modal(),i},a.simple_form_no_dismiss=function(b,c,d,e){return a.simple_form(b,c,d,e,!0)},a.simple_input=function(b,c,d,e,f){var g=e||jQuery.noop,h=f||!1,i=a.base_modal();i.find(".modal-header-inner").html(b);var j=jQuery("<label>").text(c),k=jQuery("<input>").attr("type","text").attr("name","input").addClass("form-control").attr("value",d),l=jQuery("<span>").text("error message").addClass("help-block hide"),m=jQuery("<div>").addClass("form-group form-group-input has-feedback").append(j).append(k).append(l),n=function(){var a=k.val();!h||""!=a&&void 0!=k?(i.modal("hide"),g(a)):m.addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text("Field Required")},o=jQuery("<form>").append(m).submit(function(a){a.preventDefault(),n()});i.find(".modal-body").empty().append(o);var p=jQuery("<button>").addClass("btn btn-primary").text("Ok"),q=jQuery("<button>").addClass("btn btn-default").text("Cancel");return i.find(".modal-footer").append(p).append(q),p.click(n),q.attr("data-dismiss","modal"),h||p.attr("data-dismiss","modal"),i.modal(),i}}}function RelationshipFactory(){return function(a){function b(a){this.name=a.name,this.type=a.type,this.opts=a.opts,this.to=a.to,this.external_app=a.external_app||!1,this.class_name=function(){return this.type.split(".").reverse()[0]},this.form_update=function(a){this.name=jQuery(a).find("input[name=name]").val(),this.type=jQuery(a).find("select[name=type]").val(),this.opts=jQuery(a).find("input[name=opts]").val(),this.to=jQuery(a).find("input[name=to]").val()},this.to_clean=function(){return this.to.replace(/['"]+/g,"")},this.to_class=function(){return this.to.split(".").reverse().shift()},this.opts_args=function(){return this.opts.split(",").join(", ")},this.to_module=function(){var a=this.to.split(".");return a.slice(0,a.length-1).join(".")},this.module=function(){var a=this.type.split(".");return a.slice(0,a.length-1).join(".")},this.edit_form=function(a){var b=jQuery("<form>"),c=jQuery("<div>").addClass("form-group form-group-name has-feedback").appendTo(b),d=jQuery("<div>").addClass("form-group form-group-type").appendTo(b),e=jQuery("<div>").addClass("form-group form-group-args").appendTo(b),f=jQuery("<div>").addClass("form-group form-group-args").appendTo(b);c.append(jQuery("<label>").text("Name")),c.append(jQuery("<input>").attr("name","name").addClass("form-control").val(this.name)),c.append(jQuery("<span>").text("error message").addClass("help-block hide")),d.append(jQuery("<label>").text("To")),d.append(jQuery("<input>").attr("name","to").attr("placeholder","to").addClass("form-control").val(this.to));var g=jQuery("<select>").attr("name","type").addClass("form-control"),h=this;return jQuery.each(a.relationship_factory.relationship_types(),function(a,b){var c=jQuery("<option>").attr("val",b).text(b);b==h.type&&c.attr("selected","selected"),g.append(c)}),e.append(jQuery("<label>").text("Field Type")),e.append(g),f.append(jQuery("<label>").text("Arguments")),f.append(jQuery("<input>").attr("name","opts").attr("placeholder","options").addClass("form-control").val(this.args)),b}}var c=this;c.relationship_types=function(){return["django.db.models.ForeignKey","django.db.models.OneToOneField","django.db.models.ManyToManyField"]},c.relationship_matches=function(){return c.relationship_types+["ForeignKey","OneToOneField","ManyToManyField","models.ForeignKey","models.OneToOneField","models.ManyToManyField"]},c.relationship_match=function(a){return-1!=c.relationship_matches().indexOf(a)},c.make_relationship=function(a){return new b(a)}}}function FieldFactory(){return function(a){function b(a){this.name=a.name,this.type=a.type,this.opts=a.opts||"",this.class_name=function(){return this.type.split(".").reverse()[0]},this.opts_args=function(){return this.opts.split(",").join(", ")},this.to_clean=function(){return this.to.replace(/['"]+/g,"")},this.module=function(){var a=this.type.split(".");return a.slice(0,a.length-1).join(".")},this.form_update=function(a){this.name=jQuery(a).find("input[name=name]").val(),this.type=jQuery(a).find("select[name=type]").val(),this.opts=jQuery(a).find("input[name=opts]").val()},this.edit_form=function(a){var b=jQuery("<form>"),c=jQuery("<div>").addClass("form-group form-group-name has-feedback").appendTo(b),d=jQuery("<div>").addClass("form-group form-group-type").appendTo(b),e=jQuery("<div>").addClass("form-group form-group-args").appendTo(b);c.append(jQuery("<label>").text("Name")),c.append(jQuery("<input>").attr("name","name").addClass("form-control").val(this.name)),c.append(jQuery("<span>").text("error message").addClass("help-block hide"));var f=jQuery("<select>").attr("name","type").addClass("form-control"),g=this;return jQuery.each(a.field_factory.field_types(),function(a,b){var c=jQuery("<option>").attr("val",b).text(b);b==g.type&&c.attr("selected","selected"),f.append(c)}),d.append(jQuery("<label>").text("Field Type")),d.append(f),e.append(jQuery("<label>").text("Arguments")),e.append(jQuery("<input>").attr("name","opts").attr("placeholder","options").addClass("form-control").val(this.opts)),b}}var c=this;c.fields=function(){return{"django.db.models.TextField":{default_args:"max_length=100"},"django.db.models.CharField":{default_args:"max_length=30"},"django.contrib.contenttypes.fields.GenericForeignKey":{default_args:'"content_type", "object_id"'},"django_extensions.db.fields.AutoSlugField":{},"django.db.models.CommaSeparatedIntegerField":{},"django.db.models.BigAutoField":{},"django.db.models.BigIntegerField":{},"django.db.models.BooleanField":{},"django.db.models.DateField":{},"django.db.models.DateTimeField":{},"django.db.models.DecimalField":{default_args:"max_digits=10, decimal_places=2"},"django.db.models.DurationField":{},"django.db.models.FileField":{default_args:'upload_to="/upload/files/"'},"django.db.models.ImageField":{default_args:'upload_to="/upload/images/"'},"django.db.models.FilePathField":{},"django.db.models.FloatField":{},"django.db.models.IntegerField":{},"django.db.models.PositiveIntegerField":{},"django.db.models.PositiveSmallIntegerField":{},"django.db.models.SlugField":{},"django.db.models.IPAddressField":{},"django.db.models.GenericIPAddressField":{},"django.db.models.NullBooleanField":{},"django.db.models.TimeField":{},"django.db.models.BinaryField":{},"django.db.models.AutoField":{},"django.db.models.SmallIntegerField":{},"django.db.models.URLField":{},"django.db.models.UUIDField":{},"django.db.models.EmailField":{}}},c.default_field_args=function(a){var b=c.fields()[a];return b&&b.default_args?b.default_args:""},c.field_types=function(){return Object.keys(c.fields())},c.make_field=function(a){return new b(a)}}}function ModelServiceFactory(){return function(a,b){function c(a){this.slugify=function(a){return a.toString().replace(/\s+/g,"").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"").replace(/^-+/,"").replace(/-+$/,"")},this.set_name=function(a){this.name=this.slugify(a)},this.set_name(a.name),this.fields=[];a.fields||[];this.fields=(a.fields||[]).map(b.field_factory.make_field),this.relationships=(a.relationships||[]).map(b.relationship_factory.make_relationship),this.relationship_names=function(){var a=this;return Object.keys(a.relationships).map(function(b){return a.relationships[b].name})},this.field_names=function(){var a=this;return Object.keys(a.fields).map(function(b){return a.fields[b].name})},this.l_name=function(){return this.name.toLowerCase()},this.has_relationship=function(a){return-1!=this.relationship_names().indexOf(a)},this.has_field=function(a){return-1!=this.field_names().indexOf(a)},this.name_field=function(){return-1!=this.field_names().indexOf("name")?"name":"id"},this.ordering_field=function(){return-1!=this.field_names().indexOf("created")?"created":"id"},this.identifier=function(){return-1!=this.field_names().indexOf("slug")?"slug":"id"},this.render_forms=function(a,b){var c="";return c+="class "+this.name+"Form(forms.ModelForm):\n",c+=b.spaces(4)+"class Meta:\n",c+=b.spaces(8)+"model = "+this.name+"\n",this.form_fields()&&(c+=b.spaces(8)+"fields = "+this.form_fields()+"\n"),c+=b.new_lines(2)},this.get_initial_data=function(a,b){var c="{";return c+=b.new_lines(1),jQuery.each(this.readable_fields(),function(a,d){c+=b.spaces(12)+'"'+d.name+'": "'+d.name+'",',c+=b.new_lines(1)}),jQuery.each(this.relationships,function(a,d){c+=b.spaces(12)+'"'+d.name+'": create_'+d.to.toLowerCase().replace(/\./g,"_")+"().id,",c+=b.new_lines(1)}),c+=b.spaces(8)+"}"},this.render_tests_helpers=function(a,b){var c="";return c+="def create_"+this.l_name()+"(**kwargs):\n",c+=b.spaces(4)+"defaults = {}\n",jQuery.each(this.readable_fields(),function(a,d){c+=b.spaces(4)+'defaults["'+d.name+'"] = "'+d.name+'"\n'}),c+=b.spaces(4)+"defaults.update(**kwargs)\n",jQuery.each(this.relationships,function(a,d){c+=b.spaces(4)+'if "'+d.name+'" not in defaults:\n';var e="create_"+d.to.toLowerCase().replace(/\./g,"_");b.built_in_models[d.to]&&(e="create_"+d.to.toLowerCase().replace(/\./g,"_")),c+=b.spaces(8)+'defaults["'+d.name+'"] = '+e+"()\n"}),c+=b.spaces(4)+"return "+this.name+".objects.create(**defaults)\n",c+=b.new_lines(2)},this.render_tests=function(a,b){var c="";return c+="class "+this.name+"ViewTest(unittest.TestCase):\n",c+=b.spaces(4)+"'''\n",c+=b.spaces(4)+"Tests for "+this.name+"\n",c+=b.spaces(4)+"'''\n",c+=b.spaces(4)+"def setUp(self):\n",c+=b.spaces(8)+"self.client = Client()\n",c+=b.new_lines(1),c+=b.spaces(4)+"def test_list_"+this.l_name()+"(self):\n",c+=b.spaces(8)+"url = reverse('"+a+"_"+this.l_name()+"_list')\n",c+=b.spaces(8)+"response = self.client.get(url)\n",c+=b.spaces(8)+"self.assertEqual(response.status_code, 200)\n",c+=b.new_lines(1),c+=b.spaces(4)+"def test_create_"+this.l_name()+"(self):\n",c+=b.spaces(8)+"url = reverse('"+a+"_"+this.l_name()+"_create')\n",c+=b.spaces(8)+"data = "+this.get_initial_data(a,b)+"\n",c+=b.spaces(8)+"response = self.client.post(url, data=data)\n",c+=b.spaces(8)+"self.assertEqual(response.status_code, 302)\n",c+=b.new_lines(1),c+=b.spaces(4)+"def test_detail_"+this.l_name()+"(self):\n",c+=b.spaces(8)+this.l_name()+" = create_"+this.l_name()+"()\n",c+=b.spaces(8)+"url = reverse('"+a+"_"+this.l_name()+"_detail', args=["+this.l_name()+"."+this.identifier()+",])\n",c+=b.spaces(8)+"response = self.client.get(url)\n",c+=b.spaces(8)+"self.assertEqual(response.status_code, 200)\n",c+=b.new_lines(1),c+=b.spaces(4)+"def test_update_"+this.l_name()+"(self):\n",c+=b.spaces(8)+this.l_name()+" = create_"+this.l_name()+"()\n",c+=b.spaces(8)+"data = "+this.get_initial_data(a,b)+"\n",c+=b.spaces(8)+"url = reverse('"+a+"_"+this.l_name()+"_update', args=["+this.l_name()+"."+this.identifier()+",])\n",c+=b.spaces(8)+"response = self.client.post(url, data)\n",c+=b.spaces(8)+"self.assertEqual(response.status_code, 302)\n",c+=b.new_lines(2)},this.render_urls=function(a,b){var c="";return c+="urlpatterns += (\n",c+=b.spaces(4)+"# urls for "+this.name+"\n",c+=b.spaces(4)+"url(r'^"+a+"/"+this.l_name()+"/$', views."+this.name+"ListView.as_view(), name='"+a+"_"+this.l_name()+"_list'),\n",c+=b.spaces(4)+"url(r'^"+a+"/"+this.l_name()+"/create/$', views."+this.name+"CreateView.as_view(), name='"+a+"_"+this.l_name()+"_create'),\n",c+=b.spaces(4)+"url(r'^"+a+"/"+this.l_name()+"/detail/(?P<"+this.identifier()+">\\S+)/$', views."+this.name+"DetailView.as_view(), name='"+a+"_"+this.l_name()+"_detail'),\n",c+=b.spaces(4)+"url(r'^"+a+"/"+this.l_name()+"/update/(?P<"+this.identifier()+">\\S+)/$', views."+this.name+"UpdateView.as_view(), name='"+a+"_"+this.l_name()+"_update'),\n",c+=")\n",c+=b.new_lines(1)},this.render_admin_classes=function(a,b){var c="";c+="class "+this.name+"AdminForm(forms.ModelForm):\n",c+=b.new_lines(1),c+=b.spaces(4)+"class Meta:\n",c+=b.spaces(8)+"model = "+this.name+"\n",c+=b.spaces(8)+"fields = '__all__'\n",c+=b.new_lines(2),c+="class "+this.name+"Admin(admin.ModelAdmin):\n",c+=b.spaces(4)+"form = "+this.name+"AdminForm\n";var d=this.admin_fields();return d.length>0?(c+=b.spaces(4)+"list_display = "+this.admin_fields()+"\n",c+=b.spaces(4)+"readonly_fields = "+this.admin_read_only_fields()+"\n"):c+=b.new_lines(1),c+=b.new_lines(1),c+="admin.site.register("+this.name+", "+this.name+"Admin)\n",c+=b.new_lines(2)},this.render_view_classes=function(a,b){var c=b.new_lines(1);return c+="class "+this.name+"ListView(ListView):\n",c+=b.spaces(4)+"model = "+this.name+"\n",c+=b.new_lines(2),c+="class "+this.name+"CreateView(CreateView):\n",c+=b.spaces(4)+"model = "+this.name+"\n",c+=b.spaces(4)+"form_class = "+this.name+"Form\n",c+=b.new_lines(2),c+="class "+this.name+"DetailView(DetailView):\n",c+=b.spaces(4)+"model = "+this.name+"\n",c+=b.new_lines(2),c+="class "+this.name+"UpdateView(UpdateView):\n",c+=b.spaces(4)+"model = "+this.name+"\n",c+=b.spaces(4)+"form_class = "+this.name+"Form",c+=b.new_lines(2)},this.render_model_class_header=function(a,b){var c="class "+this.name+"(models.Model):";return c+b.new_lines(2)},this.render_model_class_fields=function(a,b){var c="";return this.fields.length>0&&(c+=b.spaces(4)+"# Fields",c+=b.new_lines(1)),jQuery.each(this.fields,function(a,d){if(-1==b.pre_imported_modules_names().indexOf(d.module()))c+=b.spaces(4)+d.name+" = "+d.class_name()+"("+d.opts+")";else{var e=b.pre_imported_modules()[d.module()].as;c+=b.spaces(4)+d.name+" = "+e+"."+d.class_name()+"("+d.opts+")"}c+=b.new_lines(1)}),c+=b.new_lines(1)},this.render_model_class_relationships=function(a,c){var d="";return this.relationships.length>0&&(d+=c.spaces(4)+"# Relationship Fields",d+=c.new_lines(1)),jQuery.each(this.relationships,function(e,f){var g="'"+a+"."+f.to_clean()+"'";if(f.external_app&&(g="'"+f.to_clean()+"'"),f.to==b.user_model?g=b.user_model_setting:c.built_in_models[f.to]&&(g=f.to_class()),-1==c.pre_imported_modules_names().indexOf(f.module()))d+=c.spaces(4)+f.name+" = "+f.class_name()+"("+g+", "+f.opts+")";else{var h=c.pre_imported_modules()[f.module()].as;d+=c.spaces(4)+f.name+" = "+h+"."+f.class_name()+"("+g+", "+f.opts+")"}d+=c.new_lines(1)}),d},this.render_model_class=function(a,b){var c=this.render_model_class_header(a,b);return c+=this.render_model_class_fields(a,b),c+=this.render_model_class_relationships(a,b),c+=b.new_lines(1),c+=b.spaces(4)+"class Meta:",c+=b.new_lines(1),c+=b.spaces(8)+"ordering = ('-"+this.ordering_field()+"',)",c+=b.new_lines(2),c+=b.spaces(4)+"def __unicode__(self):",c+=b.new_lines(1),c+=b.spaces(8)+"return u'%s' % self."+this.identifier(),c+=b.new_lines(2),c+=b.spaces(4)+"def get_absolute_url(self):",c+=b.new_lines(1),c+=b.spaces(8)+"return reverse('"+a+"_"+this.l_name()+"_detail', args=(self."+this.identifier()+",))",c+=b.new_lines(1),c+=b.new_lines(2),c+=b.spaces(4)+"def get_update_url(self):",c+=b.new_lines(1),c+=b.spaces(8)+"return reverse('"+a+"_"+this.l_name()+"_update', args=(self."+this.identifier()+",))",c+=b.new_lines(3)},this.render_model_class_fields_only=function(a,b){var c="";return c+=this.render_model_class_header(a,b),c+=this.render_model_class_fields(a,b)},this.render_model_api=function(a,b){var c="class "+this.name+"ViewSet(viewsets.ModelViewSet):"+b.new_lines(1);return c+=b.spaces(4)+'"""ViewSet for the '+this.name+' class"""',c+=b.new_lines(2),c+=b.spaces(4)+"queryset = models."+this.name+".objects.all()"+b.new_lines(1),c+=b.spaces(4)+"serializer_class = serializers."+this.name+"Serializer"+b.new_lines(1),c+=b.spaces(4)+"permission_classes = [permissions.IsAuthenticated]"+b.new_lines(1),c+=b.new_lines(2)},this.render_model_serializer=function(a,b){var c="class "+this.name+"Serializer(serializers.ModelSerializer):";c+=b.new_lines(2),c+=b.spaces(4)+"class Meta:"+b.new_lines(1),c+=b.spaces(8)+"model = models."+this.name+b.new_lines(1),c+=b.spaces(8)+"fields = ("+b.new_lines(1),c+=b.spaces(12)+"'"+this.identifier()+"', "+b.new_lines(1);var d=this;return jQuery.each(this.fields,function(a,e){e.name!=d.identifier()&&(c+=b.spaces(12)+"'"+e.name+"', "+b.new_lines(1))}),c+=b.spaces(8)+")"+b.new_lines(3)},this._template_header=function(){return'{% extends "base.html" %}\n{% load static %}\n'},this._template_links=function(a){var b=a+"_"+this.l_name()+"_list";return'<p><a class="btn btn-default" href="{% url \''+b+"' %}\">"+this.name+" Listing</a></p>\n"},this._wrap_block=function(a,b){return"{% block "+a+" %}\n"+b+"\n{% endblock %}"},this.render_form_html=function(a){var b=this._template_header();b+="{% load crispy_forms_tags %}\n";var c=this._template_links(a)+'<form method="post">\n';return c+="{% csrf_token %}\n{{form|crispy}}\n",c+='<button class="btn btn-primary" type="submit">Submit</button>\n',c+="</form>",b+=this._wrap_block("content",c)},this.render_list_html=function(a){var b=a+"_"+this.l_name()+"_create",c=this._template_header(),d=this._template_links(a)+'<table class="table">\n';return d+="<tr>\n",d+="<td>ID</td><td>Link</td>\n",jQuery.each(this.fields,function(a,b){d+="    <td>"+b.name+"</td>\n"}),d+="</tr>\n",d+="{% for object in object_list %}\n",d+="<tr>\n",d+="    <td>{{object.id}}</td>\n",d+='    <td><a href="{{object.get_absolute_url}}">{{object}}</a></td>\n',jQuery.each(this.fields,function(a,b){d+="    <td>{{ object."+b.name+" }}</td>\n"}),d+="</tr>\n",d+="{% endfor %}\n",d+="</table>",d+='<a class="btn btn-primary" href="{% url \''+b+"' %}\">Create new "+this.name+"</a>",c+=this._wrap_block("content",d)},this.render_detail_html=function(a){var b=this._template_header(),c=this._template_links(a)+'<table class="table">\n';return jQuery.each(this.fields,function(a,b){c+="<tr><td>"+b.name+"</td><td>{{ object."+b.name+" }}</td></tr>\n"}),c+="</table>",c+='\n<a class="btn btn-primary" href="{{object.get_update_url}}">Edit '+this.name+"</a>\n",b+=this._wrap_block("content",c)},this.form_fields=function(){var a=this.readable_fields().map(function(a){return a.name}),b=this.relationships.map(function(a){return a.name}),c=a.concat(b);return c.length?"['"+c.join("', '")+"']":"'__all__'"},this.readable_fields=function(){var a=[];return jQuery.each(this.fields,function(b,c){-1==c.opts.indexOf("readonly")&&-1==c.opts.indexOf("editable")&&-1==c.opts.indexOf("auto_now_add")&&"django.contrib.contenttypes.fields.GenericForeignKey"!=c.type&&"django_extensions.db.fields.AutoSlugField"!=c.type&&a.push(c)}),a},this.admin_fields=function(){return this.field_names().length>0?"['"+this.field_names().join("', '")+"']":""},this.admin_read_only_fields=function(){return this.field_names().length>0?"['"+this.field_names().join("', '")+"']":""}}return new c(a)}}function ModelParserFactory(){return function(a){function b(){this.parse=function(b,c){var d=new FileReader;d.onload=function(b){var e=d.result,f=e.split("\n"),g=[],h=null,i="",j=new RegExp("class ([a-zA-Z_]*)[(]([a-zA-Z._]*)[)][:]$"),k=new RegExp("^([a-zA-Z0-9_]+) = ([a-zA-Z0-9._]+)[(](.*)[)]$");jQuery.each(f,function(b,c){c=c.trim();var d=j.exec(c);d&&d[2].match(/model/i)&&(console.log("Model:",d[1]),h={name:d[1],"class":d[2],fields:[],relationships:[]},g.push(h),i="");var e,f=k.exec(c);f&&(e=f);var l=k.exec(i);if(l&&(e=l),e){if(h&&e[2]&&(e[2].match(/field/i)||a.relationship_factory.relationship_match(e[2]))){var m=a.relationship_factory.relationship_match(e[2]);if(m){var n=e[1],o=e[2],p=e[3].split(","),q=p.shift(),r=p.join(",").trim();console.log("Model:",h.name,"Relationship:",n,o,q,r),h.relationships.push(a.relationship_factory.make_relationship({name:n,type:o,opts:r,to:q}))}else{var s=e[1],t=e[2],u=e[3];console.log("Model:",h.name,"Field:",s,t,u),h.fields.push(a.field_factory.make_field({name:s,type:t,opts:u}))}}i=""}else h&&(i+=c)});var l=[];jQuery.each(g,function(b,c){var d=a.model_factory(c,a);l.push(d)}),c&&c(l)},d.readAsText(b)}}return new b}}ace.define("ace/mode/python",["require","exports","module","ace/lib/oop","ace/mode/text","ace/tokenizer","ace/mode/python_highlight_rules","ace/mode/folding/pythonic","ace/range"],function(a,b,c){var d=a("../lib/oop"),e=a("./text").Mode,f=(a("../tokenizer").Tokenizer,a("./python_highlight_rules").PythonHighlightRules),g=a("./folding/pythonic").FoldMode,h=a("../range").Range,i=function(){this.HighlightRules=f,this.foldingRules=new g("\\:")};d.inherits(i,e),function(){this.lineCommentStart="#",this.getNextLineIndent=function(a,b,c){var d=this.$getIndent(b),e=this.getTokenizer().getLineTokens(b,a),f=e.tokens;if(f.length&&"comment"==f[f.length-1].type)return d;if("start"==a){var g=b.match(/^.*[\{\(\[\:]\s*$/);g&&(d+=c)}return d};var a={pass:1,"return":1,raise:1,"break":1,"continue":1};this.checkOutdent=function(b,c,d){if("\r\n"!==d&&"\r"!==d&&"\n"!==d)return!1;var e=this.getTokenizer().getLineTokens(c.trim(),b).tokens;if(!e)return!1;do var f=e.pop();while(f&&("comment"==f.type||"text"==f.type&&f.value.match(/^\s+$/)));return f?"keyword"==f.type&&a[f.value]:!1},this.autoOutdent=function(a,b,c){c+=1;var d=this.$getIndent(b.getLine(c)),e=b.getTabString();d.slice(-e.length)==e&&b.remove(new h(c,d.length-e.length,c,d.length))},this.$id="ace/mode/python"}.call(i.prototype),b.Mode=i}),ace.define("ace/mode/python_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/text_highlight_rules"],function(a,b,c){var d=a("../lib/oop"),e=a("./text_highlight_rules").TextHighlightRules,f=function(){var a="and|as|assert|break|class|continue|def|del|elif|else|except|exec|finally|for|from|global|if|import|in|is|lambda|not|or|pass|print|raise|return|try|while|with|yield",b="True|False|None|NotImplemented|Ellipsis|__debug__",c="abs|divmod|input|open|staticmethod|all|enumerate|int|ord|str|any|eval|isinstance|pow|sum|basestring|execfile|issubclass|print|super|binfile|iter|property|tuple|bool|filter|len|range|type|bytearray|float|list|raw_input|unichr|callable|format|locals|reduce|unicode|chr|frozenset|long|reload|vars|classmethod|getattr|map|repr|xrange|cmp|globals|max|reversed|zip|compile|hasattr|memoryview|round|__import__|complex|hash|min|set|apply|delattr|help|next|setattr|buffer|dict|hex|object|slice|coerce|dir|id|oct|sorted|intern",d=this.createKeywordMapper({"invalid.deprecated":"debugger","support.function":c,"constant.language":b,keyword:a},"identifier"),e="(?:r|u|ur|R|U|UR|Ur|uR)?",f="(?:(?:[1-9]\\d*)|(?:0))",g="(?:0[oO]?[0-7]+)",h="(?:0[xX][\\dA-Fa-f]+)",i="(?:0[bB][01]+)",j="(?:"+f+"|"+g+"|"+h+"|"+i+")",k="(?:[eE][+-]?\\d+)",l="(?:\\.\\d+)",m="(?:\\d+)",n="(?:(?:"+m+"?"+l+")|(?:"+m+"\\.))",o="(?:(?:"+n+"|"+m+")"+k+")",p="(?:"+o+"|"+n+")",q="\\\\(x[0-9A-Fa-f]{2}|[0-7]{3}|[\\\\abfnrtv'\"]|U[0-9A-Fa-f]{8}|u[0-9A-Fa-f]{4})";this.$rules={start:[{token:"comment",regex:"#.*$"},{token:"string",regex:e+'"{3}',next:"qqstring3"},{token:"string",regex:e+'"(?=.)',next:"qqstring"},{token:"string",regex:e+"'{3}",next:"qstring3"},{token:"string",regex:e+"'(?=.)",next:"qstring"},{token:"constant.numeric",regex:"(?:"+p+"|\\d+)[jJ]\\b"},{token:"constant.numeric",regex:p},{token:"constant.numeric",regex:j+"[lL]\\b"},{token:"constant.numeric",regex:j+"\\b"},{token:d,regex:"[a-zA-Z_$][a-zA-Z0-9_$]*\\b"},{token:"keyword.operator",regex:"\\+|\\-|\\*|\\*\\*|\\/|\\/\\/|%|<<|>>|&|\\||\\^|~|<|>|<=|=>|==|!=|<>|="},{token:"paren.lparen",regex:"[\\[\\(\\{]"},{token:"paren.rparen",regex:"[\\]\\)\\}]"},{token:"text",regex:"\\s+"}],qqstring3:[{token:"constant.language.escape",regex:q},{token:"string",regex:'"{3}',next:"start"},{defaultToken:"string"}],qstring3:[{token:"constant.language.escape",regex:q},{token:"string",regex:"'{3}",next:"start"},{defaultToken:"string"}],qqstring:[{token:"constant.language.escape",regex:q},{token:"string",regex:"\\\\$",next:"qqstring"},{token:"string",regex:'"|$',next:"start"},{defaultToken:"string"}],qstring:[{token:"constant.language.escape",regex:q},{token:"string",regex:"\\\\$",next:"qstring"},{token:"string",regex:"'|$",next:"start"},{defaultToken:"string"}]}};d.inherits(f,e),b.PythonHighlightRules=f}),ace.define("ace/mode/folding/pythonic",["require","exports","module","ace/lib/oop","ace/mode/folding/fold_mode"],function(a,b,c){
var d=a("../../lib/oop"),e=a("./fold_mode").FoldMode,f=b.FoldMode=function(a){this.foldingStartMarker=new RegExp("([\\[{])(?:\\s*)$|("+a+")(?:\\s*)(?:#.*)?$")};d.inherits(f,e),function(){this.getFoldWidgetRange=function(a,b,c){var d=a.getLine(c),e=d.match(this.foldingStartMarker);return e?e[1]?this.openingBracketBlock(a,e[1],c,e.index):e[2]?this.indentationBlock(a,c,e.index+e[2].length):this.indentationBlock(a,c):void 0}}.call(f.prototype)}),ace.define("ace/theme/dawn",["require","exports","module","ace/lib/dom"],function(a,b,c){b.isDark=!1,b.cssClass="ace-dawn",b.cssText=".ace-dawn .ace_gutter {background: #ebebeb;color: #333}.ace-dawn .ace_print-margin {width: 1px;background: #e8e8e8}.ace-dawn {background-color: #F9F9F9;color: #080808}.ace-dawn .ace_cursor {color: #000000}.ace-dawn .ace_marker-layer .ace_selection {background: rgba(39, 95, 255, 0.30)}.ace-dawn.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px #F9F9F9;border-radius: 2px}.ace-dawn .ace_marker-layer .ace_step {background: rgb(255, 255, 0)}.ace-dawn .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgba(75, 75, 126, 0.50)}.ace-dawn .ace_marker-layer .ace_active-line {background: rgba(36, 99, 180, 0.12)}.ace-dawn .ace_gutter-active-line {background-color : #dcdcdc}.ace-dawn .ace_marker-layer .ace_selected-word {border: 1px solid rgba(39, 95, 255, 0.30)}.ace-dawn .ace_invisible {color: rgba(75, 75, 126, 0.50)}.ace-dawn .ace_keyword,.ace-dawn .ace_meta {color: #794938}.ace-dawn .ace_constant,.ace-dawn .ace_constant.ace_character,.ace-dawn .ace_constant.ace_character.ace_escape,.ace-dawn .ace_constant.ace_other {color: #811F24}.ace-dawn .ace_invalid.ace_illegal {text-decoration: underline;font-style: italic;color: #F8F8F8;background-color: #B52A1D}.ace-dawn .ace_invalid.ace_deprecated {text-decoration: underline;font-style: italic;color: #B52A1D}.ace-dawn .ace_support {color: #691C97}.ace-dawn .ace_support.ace_constant {color: #B4371F}.ace-dawn .ace_fold {background-color: #794938;border-color: #080808}.ace-dawn .ace_list,.ace-dawn .ace_markup.ace_list,.ace-dawn .ace_support.ace_function {color: #693A17}.ace-dawn .ace_storage {font-style: italic;color: #A71D5D}.ace-dawn .ace_string {color: #0B6125}.ace-dawn .ace_string.ace_regexp {color: #CF5628}.ace-dawn .ace_comment {font-style: italic;color: #5A525F}.ace-dawn .ace_heading,.ace-dawn .ace_markup.ace_heading {color: #19356D}.ace-dawn .ace_variable {color: #234A97}.ace-dawn .ace_indent-guide {background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAEklEQVQImWNgYGBgYLh/5+x/AAizA4hxNNsZAAAAAElFTkSuQmCC) right repeat-y}";var d=a("../lib/dom");d.importCssString(b.cssText,b.cssClass)});var global=Function("return this;")();!function(a){function b(a){var b=g[a]||window[a];if(!b)throw new Error("Requested module '"+a+"' has not been defined.");return b}function c(a,b){return g[a]=b}function d(a,b){for(var c in b)"noConflict"!=c&&"_VERSION"!=c&&(a[c]=b[c]);return a}function e(a,b,c){return"string"==typeof a||a.nodeName||a.length&&"item"in a||a==window?(c=f._select(a,b),c.selector=a):c=isFinite(a.length)?a:[a],d(c,e)}function f(a,b){return e(a,b)}a.global=a;var g={},h=a.$;a.provide=c,a.require=b,d(f,{_VERSION:"0.3.6",fn:e,ender:function(a,b){d(b?e:f,a)},_select:function(a,b){return(b||document).querySelectorAll(a)}}),d(e,{forEach:function(a,b,c){for(c=0,l=this.length;c<l;++c)c in this&&a.call(b||this[c],this[c],c,this);return this},$:f}),f.noConflict=function(){return a.$=h,this},"undefined"!=typeof module&&module.exports&&(module.exports=f),a.ender=a.$=a.ender||f}(this),function(a){var b={exports:{}};b.exports,require("ender");!function(){"use strict";function a(a){var b,c=new Uint8Array(a);for(b=0;a>b;b+=1)c[b]=0;return c}function c(b,c,d,e){var f=c+d,g=a((parseInt(f/e)+1)*e);return g.set(b),g}function d(a,b,c){return a=a.toString(c||8),"000000000000".substr(a.length+12-b)+a}function e(b,c,d){var e,f;for(c=c||a(b.length),d=d||0,e=0,f=b.length;f>e;e+=1)c[d]=b.charCodeAt(e),d+=1;return c}function f(a){function b(a){return g[a>>18&63]+g[a>>12&63]+g[a>>6&63]+g[63&a]}var c,d,e,f=a.length%3,h="";for(c=0,e=a.length-f;e>c;c+=3)d=(a[c]<<16)+(a[c+1]<<8)+a[c+2],h+=b(d);switch(h.length%4){case 1:h+="=";break;case 2:h+="=="}return h}var g=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"];b.exports.clean=a,b.exports.pad=d,b.exports.extend=c,b.exports.stringToUint8=e,b.exports.uint8ToBase64=f}(),provide("tar-js/utils",b.exports)}(global),function(a){var b={exports:{}};b.exports,require("ender");!function(){"use strict";function a(a,b){var e=d.clean(512),f=0;return c.forEach(function(b){var c,d,g=a[b.field]||"";for(c=0,d=g.length;d>c;c+=1)e[f]=g.charCodeAt(c),f+=1;f+=b.length-c}),"function"==typeof b?b(e,f):e}var c,d=require("tar-js/utils");c=[{field:"fileName",length:100},{field:"fileMode",length:8},{field:"uid",length:8},{field:"gid",length:8},{field:"fileSize",length:12},{field:"mtime",length:12},{field:"checksum",length:8},{field:"type",length:1},{field:"linkName",length:100},{field:"ustar",length:8},{field:"owner",length:32},{field:"group",length:32},{field:"majorNumber",length:8},{field:"minorNumber",length:8},{field:"filenamePrefix",length:155},{field:"padding",length:12}],b.exports.structure=c,b.exports.format=a}(),provide("tar-js/header",b.exports)}(global),function(a){var b={exports:{}};b.exports,require("ender");!function(){"use strict";function a(a){this.written=0,c=(a||20)*f,this.out=e.clean(c)}var c,d=require("tar-js/header"),e=require("tar-js/utils"),f=512;a.prototype.append=function(a,b,g,h){var i,j,k,l,m,n,o;if("string"==typeof b)b=e.stringToUint8(b);else if(b.constructor!==Uint8Array.prototype.constructor)throw"Invalid input type. You gave me: "+b.constructor.toString().match(/function\s*([$A-Za-z_][0-9A-Za-z_]*)\s*\(/)[1];"function"==typeof g&&(h=g,g={}),g=g||{},k=g.mode||4095&parseInt("777",8),l=g.mtime||Math.floor(+new Date/1e3),m=g.uid||0,n=g.gid||0,i={fileName:a,fileMode:e.pad(k,7),uid:e.pad(m,7),gid:e.pad(n,7),fileSize:e.pad(b.length,11),mtime:e.pad(l,11),checksum:"        ",type:"0",ustar:"ustar  ",owner:g.owner||"",group:g.group||""},j=0,Object.keys(i).forEach(function(a){var b,c,d=i[a];for(b=0,c=d.length;c>b;b+=1)j+=d.charCodeAt(b)}),i.checksum=e.pad(j,6)+"\x00 ",o=d.format(i);return this.out.set(o,this.written),this.written+=o.length,this.written+b.length>this.out.length&&(this.out=e.extend(this.out,this.written,b.length,c)),this.out.set(b,this.written),this.written+=b.length+(f-(b.length%f||f)),this.out.length-this.written<2*f&&(this.out=e.extend(this.out,this.written,2*f,c)),"function"==typeof h&&h(this.out),this.out},a.prototype.clear=function(){this.written=0,this.out=e.clean(c)},b.exports=a}(),provide("tar-js",b.exports)}(global),angular.module("ui.ace",[]).constant("uiAceConfig",{}).directive("uiAce",["uiAceConfig",function(a){if(angular.isUndefined(window.ace))throw new Error("ui-ace need ace to work... (o rly?)");var b=function(a,b,c){if(angular.isDefined(c.workerPath)){var d=window.ace.require("ace/config");d.set("workerPath",c.workerPath)}angular.isDefined(c.require)&&c.require.forEach(function(a){window.ace.require(a)}),angular.isDefined(c.showGutter)&&a.renderer.setShowGutter(c.showGutter),angular.isDefined(c.useWrapMode)&&b.setUseWrapMode(c.useWrapMode),angular.isDefined(c.showInvisibles)&&a.renderer.setShowInvisibles(c.showInvisibles),angular.isDefined(c.showIndentGuides)&&a.renderer.setDisplayIndentGuides(c.showIndentGuides),angular.isDefined(c.useSoftTabs)&&b.setUseSoftTabs(c.useSoftTabs),angular.isDefined(c.showPrintMargin)&&a.setShowPrintMargin(c.showPrintMargin),angular.isDefined(c.disableSearch)&&c.disableSearch&&a.commands.addCommands([{name:"unfind",bindKey:{win:"Ctrl-F",mac:"Command-F"},exec:function(){return!1},readOnly:!0}]),angular.isString(c.theme)&&a.setTheme("ace/theme/"+c.theme),angular.isString(c.mode)&&b.setMode("ace/mode/"+c.mode),angular.isDefined(c.firstLineNumber)&&(angular.isNumber(c.firstLineNumber)?b.setOption("firstLineNumber",c.firstLineNumber):angular.isFunction(c.firstLineNumber)&&b.setOption("firstLineNumber",c.firstLineNumber()));var e,f;if(angular.isDefined(c.advanced))for(e in c.advanced)f={name:e,value:c.advanced[e]},a.setOption(f.name,f.value);if(angular.isDefined(c.rendererOptions))for(e in c.rendererOptions)f={name:e,value:c.rendererOptions[e]},a.renderer.setOption(f.name,f.value);angular.forEach(c.callbacks,function(b){angular.isFunction(b)&&b(a)})};return{restrict:"EA",require:"?ngModel",link:function(c,d,e,f){var g,h,i=a.ace||{},j=angular.extend({},i,c.$eval(e.uiAce)),k=window.ace.edit(d[0]),l=k.getSession(),m=function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1);angular.isDefined(a)&&c.$evalAsync(function(){if(!angular.isFunction(a))throw new Error("ui-ace use a function as callback.");a(b)})},n={onChange:function(a){return function(b){var d=l.getValue();!f||d===f.$viewValue||c.$$phase||c.$root.$$phase||c.$evalAsync(function(){f.$setViewValue(d)}),m(a,b,k)}},onBlur:function(a){return function(){m(a,k)}}};e.$observe("readonly",function(a){k.setReadOnly(!!a||""===a)}),f&&(f.$formatters.push(function(a){if(angular.isUndefined(a)||null===a)return"";if(angular.isObject(a)||angular.isArray(a))throw new Error("ui-ace cannot use an object or an array as a model");return a}),f.$render=function(){l.setValue(f.$viewValue)});var o=function(a,d){a!==d&&(j=angular.extend({},i,c.$eval(e.uiAce)),j.callbacks=[j.onLoad],j.onLoad!==i.onLoad&&j.callbacks.unshift(i.onLoad),l.removeListener("change",g),g=n.onChange(j.onChange),l.on("change",g),k.removeListener("blur",h),h=n.onBlur(j.onBlur),k.on("blur",h),b(k,l,j))};c.$watch(e.uiAce,o,!0),o(i),d.on("$destroy",function(){k.session.$stopWorker(),k.destroy()}),c.$watch(function(){return[d[0].offsetWidth,d[0].offsetHeight]},function(){k.resize(),k.renderer.updateFull()},!0)}}}]),!function(a,b){"use strict";var c=b.isDefined,d=b.isUndefined,e=b.isNumber,f=b.isObject,g=b.isArray,h=b.extend,i=b.toJson,j=b.module("LocalStorageModule",[]);j.provider("localStorageService",function(){this.prefix="ls",this.storageType="localStorage",this.cookie={expiry:30,path:"/"},this.notify={setItem:!0,removeItem:!1},this.setPrefix=function(a){return this.prefix=a,this},this.setStorageType=function(a){return this.storageType=a,this},this.setStorageCookie=function(a,b){return this.cookie.expiry=a,this.cookie.path=b,this},this.setStorageCookieDomain=function(a){return this.cookie.domain=a,this},this.setNotify=function(a,b){return this.notify={setItem:a,removeItem:b},this},this.$get=["$rootScope","$window","$document","$parse",function(a,b,j,k){var l,m=this,n=m.prefix,o=m.cookie,p=m.notify,q=m.storageType;j?j[0]&&(j=j[0]):j=document,"."!==n.substr(-1)&&(n=n?n+".":"");var r=function(a){return n+a},s=function(){try{var c=q in b&&null!==b[q],d=r("__"+Math.round(1e7*Math.random()));return c&&(l=b[q],l.setItem(d,""),l.removeItem(d)),c}catch(e){return q="cookie",a.$broadcast("LocalStorageModule.notification.error",e.message),!1}}(),t=function(b,c){if(c=d(c)?null:i(c),!s||"cookie"===m.storageType)return s||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),p.setItem&&a.$broadcast("LocalStorageModule.notification.setitem",{key:b,newvalue:c,storageType:"cookie"}),z(b,c);try{l&&l.setItem(r(b),c),p.setItem&&a.$broadcast("LocalStorageModule.notification.setitem",{key:b,newvalue:c,storageType:m.storageType})}catch(e){return a.$broadcast("LocalStorageModule.notification.error",e.message),z(b,c)}return!0},u=function(b){if(!s||"cookie"===m.storageType)return s||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),A(b);var c=l?l.getItem(r(b)):null;if(!c||"null"===c)return null;try{return JSON.parse(c)}catch(d){return c}},v=function(){var b,c;for(b=0;b<arguments.length;b++)if(c=arguments[b],s&&"cookie"!==m.storageType)try{l.removeItem(r(c)),p.removeItem&&a.$broadcast("LocalStorageModule.notification.removeitem",{key:c,storageType:m.storageType})}catch(d){a.$broadcast("LocalStorageModule.notification.error",d.message),B(c)}else s||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),p.removeItem&&a.$broadcast("LocalStorageModule.notification.removeitem",{key:c,storageType:"cookie"}),B(c)},w=function(){if(!s)return a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),!1;var b=n.length,c=[];for(var d in l)if(d.substr(0,b)===n)try{c.push(d.substr(b))}catch(e){return a.$broadcast("LocalStorageModule.notification.error",e.Description),[]}return c},x=function(b){var c=n?new RegExp("^"+n):new RegExp,d=b?new RegExp(b):new RegExp;if(!s||"cookie"===m.storageType)return s||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),C();var e=n.length;for(var f in l)if(c.test(f)&&d.test(f.substr(e)))try{v(f.substr(e))}catch(g){return a.$broadcast("LocalStorageModule.notification.error",g.message),C()}return!0},y=function(){try{return b.navigator.cookieEnabled||"cookie"in j&&(j.cookie.length>0||(j.cookie="test").indexOf.call(j.cookie,"test")>-1)}catch(c){return a.$broadcast("LocalStorageModule.notification.error",c.message),!1}}(),z=function(b,c,h){if(d(c))return!1;if((g(c)||f(c))&&(c=i(c)),!y)return a.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var k="",l=new Date,m="";if(null===c?(l.setTime(l.getTime()+-864e5),k="; expires="+l.toGMTString(),c=""):e(h)&&0!==h?(l.setTime(l.getTime()+24*h*60*60*1e3),k="; expires="+l.toGMTString()):0!==o.expiry&&(l.setTime(l.getTime()+24*o.expiry*60*60*1e3),k="; expires="+l.toGMTString()),b){var n="; path="+o.path;o.domain&&(m="; domain="+o.domain),j.cookie=r(b)+"="+encodeURIComponent(c)+k+n+m}}catch(p){return a.$broadcast("LocalStorageModule.notification.error",p.message),!1}return!0},A=function(b){if(!y)return a.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var c=j.cookie&&j.cookie.split(";")||[],d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(r(b)+"=")){var f=decodeURIComponent(e.substring(n.length+b.length+1,e.length));try{return JSON.parse(f)}catch(g){return f}}}return null},B=function(a){z(a,null)},C=function(){for(var a=null,b=n.length,c=j.cookie.split(";"),d=0;d<c.length;d++){for(a=c[d];" "===a.charAt(0);)a=a.substring(1,a.length);var e=a.substring(b,a.indexOf("="));B(e)}},D=function(){return q},E=function(a,b,d,e){e=e||b;var g=u(e);return null===g&&c(d)?g=d:f(g)&&f(d)&&(g=h(d,g)),k(b).assign(a,g),a.$watch(b,function(a){t(e,a)},f(a[b]))},F=function(){for(var a=0,c=b[q],d=0;d<c.length;d++)0===c.key(d).indexOf(n)&&a++;return a};return{isSupported:s,getStorageType:D,set:t,add:t,get:u,keys:w,remove:v,clearAll:x,bind:E,deriveKey:r,length:F,cookie:{isSupported:y,set:z,add:z,get:A,remove:B,clearAll:C}}}]})}(window,window.angular),angular.module("builder",["ngRoute","builder.filters","builder.services","builder.directives","builder.controllers","LocalStorageModule","ui.ace","angulartics","angulartics.google.analytics"]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/models",{templateUrl:"partials/models.html",controller:"ModelController"}),a.when("/home",{templateUrl:"partials/home.html",controller:"ModelController"}),a.otherwise({redirectTo:"/home"})}]),angular.module("builder.controllers",["LocalStorageModule"]).controller("ModelController",["$scope","$http","ModelFactory","ModelParser","FieldFactory","RelationshipFactory","localStorageService","MessageService","RenderFactory","TarballFactory",function(a,b,c,d,e,f,g,h,i,j){a.models=[],a.new_models=[],a.user_model="django.contrib.auth.models.User",a.user_model_setting="settings.AUTH_USER_MODEL",a.built_in_models={"django.contrib.auth.models.User":{fields:{username:{"default":"username"},email:{"default":"username@tempurl.com"}}},"django.contrib.auth.models.Group":{fields:{name:{"default":"group"}}},"django.contrib.contenttypes.models.ContentType":{fields:{}}},a.messageService=new h,a.field_factory=new e,a.model_factory=c,a.relationship_factory=new f,a.render_factory=new i(a.built_in_models),a.editors=[],a.models_storage_key="local_models",a._app_name="app_name",a._project_name="project_name",a.create_tar_ball_url=function(b){var c="Built with django_builder\n",d="#";const e=a.project_name(),f=a.app_name();var g=a.render_factory.render_models_py(f,a.models),h=a.render_factory.render_views_py(f,a.models),i=a.render_factory.render_admin_py(f,a.models),k=a.render_factory.render_urls_py(f,a.models),l=a.render_factory.render_tests_py(f,a.models),m=a.render_factory.render_forms_py(f,a.models),n=a.render_factory.render_django_rest_framework_api_py(f,a.models),o=a.render_factory.render_django_rest_framework_serializers_py(f,a.models),p=a.render_factory.render_templates_html(f,a.models),q=new j,r=f;if(b&&(r=e+"/"+f),b){var s=a.render_factory.render_project_settings_py(e),t=a.render_factory.render_project_urls_py(e),u=a.render_factory.render_project_urls_py(e),v=a.render_factory.render_project_wsgi_py(e);q.append(e+"/manage.py",u),q.append(e+"/"+e+"/settings.py",s),q.append(e+"/"+e+"/urls.py",t),q.append(e+"/"+e+"/wsgi.py",v),q.append(e+"/"+e+"/__init__.py",d)}return q.append(r+"/README.txt",c),q.append(r+"/__init__.py",d),q.append(r+"/models.py",g),q.append(r+"/views.py",h),q.append(r+"/admin.py",i),q.append(r+"/urls.py",k),q.append(r+"/tests.py",l),q.append(r+"/forms.py",m),q.append(r+"/api.py",n),q.append(r+"/serializers.py",o),q.append(r+"/templates/base.html",a.render_factory.render_base_html(f,a.models)),jQuery.each(p,function(a,b){q.append(r+"/templates/"+f+"/"+b[0],b[1])}),q.get_url()},a.create_download_modal_app=function(){var b=a.create_tar_ball_url(!1),c=a.app_name()+".tar";return a.create_download_modal(b,c)},a.create_download_modal_project=function(){var b=a.create_tar_ball_url(!0),c=a.project_name()+".tar",d=jQuery("<p>");d.text("The project download includes the following files:");var e=jQuery("<div>").addClass("well well-sm");return e.append(jQuery("<p>").text("manage.py")),e.append(jQuery("<p>").text(a.project_name()+"/settings.py")),e.append(jQuery("<p>").text(a.project_name()+"/urls.py")),e.append(jQuery("<p>").text(a.project_name()+"/wsgi.py")),d.append(jQuery("<br><br>")),d.append(e),a.create_download_modal(b,c,d)},a.create_download_modal=function(b,c,d){var e=jQuery("<a>").attr("href",b).attr("id","django_builder_download_a");e.addClass("btn btn-success btn-lg").css("text-transform","none"),e.text("Click here to download "+c),e.attr("download",c);var f=jQuery("<div>").addClass("text-center").append(e),g=jQuery("<div>");g.append(jQuery("<br>")),g.append("Chrome can block downloads of the generated tarball, if this happens navigate to the "),g.append(jQuery("<strong>").text("Downloads")),g.append(" section of chrome to accept the download"),g.append(jQuery("<br>")),g.append("Window -> Downloads");var h=jQuery("<div>");void 0!=d&&h.append(d),h.append(f),h.append(g);var i="django_builder_download_modal";return a.messageService.simple_info("Download info",h).modal("show").attr("id",i),i},a.render_model_class_fields_only=function(b){return b.render_model_class_fields_only(a._app_name,a.render_factory)},a.upload_input=function(){return jQuery('<input type="file" />')},a.upload_drop_target=function(a){var b=jQuery("<div>").addClass("builder_dnd_target text-center"),c=jQuery("<i>").addClass("fa fa-upload fa-4x builder_dnd_icon");return b.append(jQuery("<div>").text("Drag and Drop files here!")),b.append(c),b},a.upload_form=function(a,b){var c=jQuery("<form>"),d=jQuery("<span>").addClass("btn btn-default btn-file center-block builder_upload_models_py");return d.append("Browse"),d.append(a),c.append(d),c.append(b),c},a.save_new_models=function(b){a.new_models=[],a.models=b,a.saveApp(),a.$apply()},a.merge_models=function(){for(var b=a.models.concat(a.new_models),c=0;c<b.length;++c)for(var d=c+1;d<b.length;++d)b[c].name===b[d].name&&b.splice(d--,1);return a.save_new_models(b)},a.add_unique=function(){jQuery.each(a.new_models,function(b,c){a.existingModel(c.name)||a.models.push(c)}),a.save_new_models(a.models)},a.add_new_models=function(b){a.new_models=b,a.$apply();var c=function(){console.log("Overwriting existing models"),a.merge_models()},d=function(){var b=!1,d=[],e=jQuery("<p>").text("The following models are duplicates:");jQuery.each(a.new_models,function(c,f){a.existingModel(f.name)&&(b=!0,d.push(f),e.append(jQuery("<div>").text(f.name)))});var f=d.length==a.new_models.length;if(b){var g=[{text:"Overwrite existing models",callback:c}];f||g.push({text:"Add unique",callback:a.add_unique}),g.push({text:"Cancel",callback:function(){}});var h="duplicate_models";a.messageService.simple_choice("Add duplicate models?",e,g).modal("show").attr("id",h)}else a.merge_models()},e=jQuery("<div>");jQuery.each(a.new_models,function(b,c){e.append(jQuery("<hr>")),e.append(jQuery("<pre>").html(c.render_model_class_fields_only(a._app_name,a.render_factory)));var d=jQuery('<button class="btn btn-danger pull-right">').text("Remove");e.append(d),e.append(jQuery("<div>").addClass("clearfix"))});var f="add_new_models";return a.messageService.simple_confirm("Add the following models?",jQuery("#builder_new_models"),d).modal("show").find(".modal-dialog").css("width","50%").attr("id",f),f},a.process_models_py=function(b){if(0==b.length)a.messageService.simple_error("Sorry","You didn't seem to choose any files.").modal("show");else if(b.length>1)a.messageService.simple_error("Sorry","Multiple files not yet supported, please choose a single file.").modal("show");else{var c=d(a);c.parse(b[0],function(b){a.add_new_models(b)})}},a.upload_models_py=function(){var b=a.upload_input(),c=a.upload_drop_target(),d=a.upload_form(b,c),e=a.messageService.simple_form("Upload models.py","Choose a models.py file to analyse",d,function(){a.process_models_py(jQuery(b)[0].files),e.modal("hide")}).modal("show");b.change(function(){a.process_models_py(jQuery(b)[0].files),e.modal("hide")}),d.on("drag dragstart dragend dragover dragenter dragleave drop",function(a){a.preventDefault(),a.stopPropagation()}).on("dragover dragenter",function(){c.addClass("is-drag-over")}).on("dragleave dragend drop",function(){c.removeClass("is-drag-over")}).on("drop",function(b){var c=b.originalEvent.dataTransfer.files;e.modal("hide"),a.process_models_py(c)})},jQuery("html body").on("drag dragstart dragend dragover dragenter dragleave drop",function(a){a.preventDefault(),a.stopPropagation()}).on("dragover dragenter",function(){}).on("drop",function(a){}),jQuery("#builder_models_content").on("drag dragstart dragend dragover dragenter dragleave drop",function(a){a.preventDefault(),a.stopPropagation()}).on("dragover dragenter",function(){jQuery(".builder_dnd_target").addClass("is-drag-over")}).on("drop",function(b){jQuery(".builder_dnd_target").removeClass("is-drag-over");var c=b.originalEvent.dataTransfer.files;a.process_models_py(c)}),a.aceLoad=function(b){var c=jQuery(b.container).attr("id");"builder_models"==c?b.setValue(a.render_factory.render_models_py(a.app_name(),a.models)):"builder_views"==c?b.setValue(a.render_factory.render_views_py(a.app_name(),a.models)):"builder_admin"==c?b.setValue(a.render_factory.render_admin_py(a.app_name(),a.models)):"builder_urls"==c?b.setValue(a.render_factory.render_urls_py(a.app_name(),a.models)):"builder_tests"==c?b.setValue(a.render_factory.render_tests_py(a.app_name(),a.models)):"builder_forms"==c?b.setValue(a.render_factory.render_forms_py(a.app_name(),a.models)):"builder_django_rest_framework_api"==c?b.setValue(a.render_factory.render_django_rest_framework_api_py(a.app_name(),a.models)):"builder_django_rest_framework_serializers"==c&&b.setValue(a.render_factory.render_django_rest_framework_serializers_py(a.app_name(),a.models)),b.session.selection.clearSelection()},a.reLoadAce=function(){Object.keys(a.editors).map(function(b){a.aceLoad(a.editors[b])})},a.aceLoaded=function(b){b.setOptions({readOnly:!0,highlightActiveLine:!1,highlightGutterLine:!1,maxLines:1/0}),b.renderer.$cursorLayer.element.style.opacity=0,a.aceLoad(b),a.editors.push(b)},a.$watch("[models,_app_name]",function(){a.reLoadAce(),a.saveApp()},!0),a.aceChanged=function(a){},a.do_set_app_name=function(b){a._app_name=b},a.set_app_name=function(){a.do_set_app_name(jQuery("input#appname").val()),a.reLoadAce()},a.do_set_project_name=function(b){a._project_name=b},a.set_project_name=function(){a.do_set_project_name(jQuery("input#projectname").val()),a.reLoadAce()},a.l_app_name=function(){return a._app_name.toLowerCase()},a.app_name=function(){return a._app_name.replace(new RegExp(" ","g"),"_")},a.project_name=function(){return a._project_name.replace(new RegExp(" ","g"),"_")},a.updateModel=function(b){var c=a.models.indexOf(b);a.models[c]=b,a.$apply()},a.serializeApp=function(){var b={models:a.models,app_config:{app_name:a._app_name}};return JSON.stringify(b)},a.saveApp=function(){g.set(a.models_storage_key,a.serializeApp())},a.doClearModels=function(){g.set(a.models_storage_key,""),a.loadModels(),a.models=[],a.$apply()},a.clearModels=function(){var b=function(){a.doClearModels()},c="clear_all";return a.messageService.simple_confirm("Confirm","Remove all models?",b).modal("show").attr("id",c),c},a.model_count=function(){return a.models.length},a.add_model=function(b){var d={name:b};d.fields=[a.field_factory.make_field({name:"name",type:"django.db.models.CharField",opts:"max_length=255"}),a.field_factory.make_field({name:"slug",type:"django_extensions.db.fields.AutoSlugField",opts:"populate_from='name', blank=True"}),a.field_factory.make_field({name:"created",type:"django.db.models.DateTimeField",opts:"auto_now_add=True, editable=False"}),a.field_factory.make_field({name:"last_updated",type:"django.db.models.DateTimeField",opts:"auto_now=True, editable=False"})];var e=c(d,a);a.models.push(e),a.saveApp(),a.$apply()},a.existingModel=function(b){var c=!1;return jQuery.each(a.models,function(a,d){b==d.name&&(c=!0)}),c},a.addModel=function(){var b=function(b){void 0==b||""===b?a.messageService.simple_info("Model Name Required","Enter a Model name").modal("show"):a.existingModel(b)?a.messageService.simple_error("Error with Model Name","There is already a model with the name "+b).modal("show"):a.add_model(b)},c="add_model";return a.messageService.simple_input("Model Name Required","Enter a Model name","Model1",b,!0).modal("show").attr("id",c),c},a.cleanModel=function(a){delete a.$$hashKey,void 0!=a.fields&&jQuery.each(a.fields,function(a,b){delete b.$$hashKey}),void 0!=a.relationships&&jQuery.each(a.relationships,function(a,b){delete b.$$hashKey})},a.loadModels=function(){var b=g.get(a.models_storage_key)||{models:[],app_config:{app_name:"app_name"}};"string"==typeof b&&(b=JSON.parse(b));var c=b.models||[],d=b.app_config||{app_name:"app_name"};return a._app_name=d.app_name,jQuery.each(c,function(b,c){a.cleanModel(c)}),c},a.loadModel=function(b){var d=c(b,a);a.models.push(d)},a.__init__=function(){jQuery.each(a.loadModels(),function(b,c){a.loadModel(c)})},a.__init__(),a.debug=function(){},a.do_rename_model=function(b,c){var d="rename_model_existing",e=a.models[b];a.existingModel(c)?a.messageService.simple_error("Error with Model Name","There is already a model with the name "+c).modal("show").attr("id",d):(e.set_name(c),a.updateModel(e),a.$apply())},a.rename_model=function(b){var c=a.models[b],d="rename_model",e=function(c){a.do_rename_model(b,c)};return a.messageService.simple_input("Rename model","Enter a new Model name",c.name,e,!0).modal("show").attr("id",d),d},a.add_relationship=function(b){const c=a.models[b],d=function(b){var d=b.find("input[name=name]").val().trim(),e=b.find("select[name=to]").val().trim(),f=!0;if(jQuery.each(a.built_in_models,function(a,b){e==a&&(f=!1)}),jQuery.each(a.models,function(a,b){e==b.name&&(f=!1)}),b.find("div.form-group-name").removeClass("has-error"),b.find("div.form-group-to").removeClass("has-error"),void 0===d||""===d)b.find("div.form-group-name").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text("Field Required");else if(void 0===e||""===e)b.find("div.form-group-to").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text("Field Required");else if(c.has_relationship(d))b.find("div.form-group-name").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text('Field "'+d+'" exists');else{var g=b.find("select[name=type]").val(),h=b.find("input[name=opts]").val(),i=a.relationship_factory.make_relationship({name:d,type:g,opts:h,to:e,external_app:f});c.relationships.push(i),a.updateModel(c),a.$apply(),jQuery(".modal").modal("hide")}},e=jQuery("<form>"),f=jQuery("<div>").addClass("form-group form-group-name has-feedback").appendTo(e),g=jQuery("<div>").addClass("form-group form-group-to").appendTo(e),h=jQuery("<div>").addClass("form-group form-group-type").appendTo(e),i=jQuery("<div>").addClass("form-group form-group-args").appendTo(e);f.append(jQuery("<label>").text("Name")),f.append(jQuery("<input>").attr("name","name").addClass("form-control")),f.append(jQuery("<span>").text("error message").addClass("help-block hide"));const j=jQuery("<select>").attr("name","to").addClass("form-control"),k=jQuery("<optgroup>").attr("label","Django models");jQuery.each(a.built_in_models,function(a,b){k.append(jQuery("<option>").attr("val",a).text(a))}),j.append(k);const l=jQuery("<optgroup>").attr("label","Your App models");jQuery.each(a.models,function(a,b){l.append(jQuery("<option>").attr("val",b.name).text(b.name))}),j.append(l),g.append(jQuery("<label>").text("Relationship to Model")),g.append(j),g.append(jQuery("<p>").addClass("text-primary small clearfix").text("You can add external models (otherapp.models.Model1)").css("margin","4px"));const m=jQuery("<select>").attr("name","type");jQuery.each(a.relationship_factory.relationship_types(),function(a,b){m.append(jQuery("<option>").attr("val",b).text(b))}),h.append(jQuery("<label>").text("Relationship Type")),h.append(m),i.append(jQuery("<label>").text("Arguments")),i.append(jQuery("<input>").attr("name","opts").attr("placeholder","options").addClass("form-control")),j.select2({theme:"bootstrap",allowClear:!0,placeholder:"Select a model.",tags:!0,selectOnClose:!0}),m.select2({theme:"bootstrap"});const n="add_rel_"+c.name+"_"+b;return a.messageService.simple_form_no_dismiss("Add Relationship","",e,d).modal("show").attr("id",n).appendTo("body"),n},a.add_field=function(b){var c=a.models[b],d=function(b){var d=b.find("input[name=name]").val();if(void 0===d||""===d)b.find("div.form-group-name").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text("Field Required");else if(c.has_field(d))b.find("div.form-group-name").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text('Field "'+d+'" exists');else{var e=b.find("select[name=type]").val(),f=b.find("input[name=opts]").val(),g=a.field_factory.make_field({name:d,type:e,opts:f});c.fields.push(g),a.updateModel(c),a.$apply(),jQuery(".modal").modal("hide")}},e=jQuery("<form>"),f=jQuery("<div>").addClass("form-group form-group-name  has-feedback").appendTo(e),g=jQuery("<div>").addClass("form-group form-group-type").appendTo(e),h=jQuery("<div>").addClass("form-group form-group-args").appendTo(e);f.append(jQuery("<label>").text("Name")),f.append(jQuery("<input>").attr("name","name").addClass("form-control")),f.append(jQuery("<span>").text("error message").addClass("help-block hide"));var i=jQuery("<select>").attr("name","type").addClass("form-control");
jQuery.each(a.field_factory.field_types(),function(a,b){i.append(jQuery("<option>").attr("val",b).text(b))});var j=jQuery("<input>").attr("name","opts").attr("placeholder","options").addClass("form-control");g.append(jQuery("<label>").text("Field Type")),g.append(i),h.append(jQuery("<label>").text("Arguments")),h.append(j),i.change(function(){j.val(a.field_factory.default_field_args(i.val()))}),j.val(a.field_factory.default_field_args(i.val()));var k="add_field_"+c.name+"_"+b;return a.messageService.simple_form_no_dismiss("Add Field","",e,d).modal("show").attr("id",k).appendTo("body"),k},a.edit_relationship=function(b,c){var d=a.models[b].relationships[c],e=function(b){d.form_update(b),a.$apply(),jQuery(".modal").modal("hide")},f=d.$$hashKey||"edit_relationship_"+d.name;return a.messageService.simple_form("Edit Relationship '"+d.name+"'","",d.edit_form(a),e).modal("show").attr("id",f).appendTo("body"),f},a.edit_field=function(b,c){var d=a.models[b].fields[c],e=function(b){d.form_update(b),a.$apply(),jQuery(".modal").modal("hide")},f=d.$$hashKey||"edit_field_"+d.name;return a.messageService.simple_form("Edit field '"+d.name+"'","",d.edit_form(a),e).modal("show").attr("id",f).appendTo("body"),f},a.do_remove_new_model=function(b){a.new_models.splice(b,1),a.$apply()},a.remove_new_model=function(b){setTimeout(function(){a.do_remove_new_model(b)})},a.remove_relationship=function(b,c){var d=function(){a.models[b].relationships.splice(c,1),a.$apply()},e=a.models[b].relationships[c],f=e.$$hashKey||"remove_relationship_"+e.name;return a.messageService.simple_confirm("Confirm","Remove the relationship '"+e.name+"'",d).modal("show").attr("id",f).appendTo("body"),f},a.do_remove_new_relationship=function(b,c){a.new_models[b].relationships.splice(c,1)},a.remove_new_relationship=function(b,c){setTimeout(function(){a.do_remove_new_relationship(b,c)})},a.do_remove_new_field=function(b,c){a.new_models[b].fields.splice(c,1),a.$apply()},a.remove_new_field=function(b,c){setTimeout(function(){a.do_remove_new_field(b,c)})},a.remove_field=function(b,c){var d=function(){a.models[b].fields.splice(c,1),a.$apply()},e=a.models[b].fields[c],f=e.$$hashKey||"remove_field_"+e.name;return a.messageService.simple_confirm("Confirm","Remove the field '"+e.name+"'",d).modal("show").attr("id",f).appendTo("body"),f},a.remove_model=function(b){var c=function(){a.models.splice(b,1),a.$apply()},d=a.models[b],e=d.$$hashKey||"remove_model_"+d.name;return a.messageService.simple_confirm("Confirm","Remove the model '"+d.name+"'",c).modal("show").modal("show").attr("id",e).appendTo("body"),e},a.model_highlight=function(b,c){var d=a.models[b].relationships[c];jQuery(".builder_model_"+d.to_clean()).addClass("builder_model_highlight")},a.model_unhighlight=function(){jQuery(".builder_model").removeClass("builder_model_highlight")},a.new_model_highlight=function(b,c){var d=a.new_models[b].relationships[c];jQuery(".builder_model_"+d.to_clean()).addClass("builder_model_highlight")},a.new_model_unhighlight=function(){jQuery(".builder_model").removeClass("builder_model_highlight")}}]),angular.module("builder.directives",[]).directive("appVersion",["version",function(a){return function(b,c,d){c.text(a)}}]),angular.module("builder.filters",[]).filter("interpolate",["version",function(a){return function(b){return String(b).replace(/\%VERSION\%/gm,a)}}]),angular.module("builder.services",[]).factory("ModelFactory",[ModelServiceFactory]).factory("ModelParser",[ModelParserFactory]).factory("MessageService",[MessageServiceFactory]).factory("FieldFactory",[FieldFactory]).factory("RelationshipFactory",[RelationshipFactory]).factory("RenderFactory",[ModelRenderFactory]).factory("TarballFactory",[TarballFactory]).value("version","0.1");
>>>>>>> Adding relationship to external models
=======
function TarballFactory(){return function(){function a(){var a=this,b=require("tar-js"),c=new b;a.uInt8ToString=function(a){var b,c,d="";for(b=0,c=a.length;b<c;b+=1)d+=String.fromCharCode(a[b]);return d},a.append=function(a,b){c.append(a,b)},a.get_url=function(b){var d=btoa(a.uInt8ToString(c.out));return"data:application/tar;base64,"+d}}return new a}}function ModelRenderFactory(){return function(a){var b=this;b.built_in_models=a,b.spaces=function(a){var b=a||1;return new Array(b+1).join(" ")},b.model_names=function(a,b){var c=b||"";return Object.keys(a).map(function(b){return a[b].name+c})},b.new_lines=function(a){var b=a||1;return new Array(b+1).join("\n")},b.render_all=function(a,c){var d="";return d+=b.render_base_html(a,c),d+=b.render_forms_py(a,c),d+=b.render_urls_py(a,c),d+=b.render_admin_py(a,c),d+=b.render_views_py(a,c),d+=b.render_models_py(a,c),d+=b.render_django_rest_framework_api_py(a,c),d+=b.render_django_rest_framework_serializers_py(a,c),d+=b.render_templates_html(a,c)},b.render_base_html=function(a,b){return"<html><head></head><body>{% block content %}Replace this.{% endblock %}</body>"},b.pre_imported_modules=function(a){return{"django.contrib.auth.models":{as:"auth_models"},"django.db.models":{as:"models"},"django_extensions.db.fields":{as:"extension_fields"}}},b.pre_imported_modules_names=function(a){return Object.keys(b.pre_imported_modules())},b.render_project_manage_py=function(a){var b="# Project: "+a+"\n";return b},b.render_project_settings_py=function(a){var b="# Project: "+a+"\n";return b},b.render_project_wsgi_py=function(a){var b="\n";return b},b.render_project_urls_py=function(a){var b="";return b},b.render_forms_py=function(a,c){var d="from django import forms\n";return d+="from .models import "+b.model_names(c,"").join(", ")+"\n",d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_forms(a,b)}),d},b.render_tests_py=function(a,c){var d="import unittest\nfrom django.core.urlresolvers import reverse\nfrom django.test import Client\n";return d+="from .models import "+b.model_names(c,"").join(", ")+"\n",jQuery.each(b.built_in_models,function(a,c){var e=a.split("."),f=e.pop(),g=e.join(".");d+="from "+g+" import "+f,d+=b.new_lines(1)}),d+=b.new_lines(2),jQuery.each(b.built_in_models,function(a,c){var e="create_"+a.toLowerCase().replace(/\./g,"_"),f=a.split(".").pop(),g="";g+="def "+e+"(**kwargs):\n",g+=b.spaces(4)+"defaults = {}\n",jQuery.each(c.fields,function(a,c){g+=b.spaces(4)+'defaults["'+a+'"] = "'+c.default+'"\n'}),g+=b.spaces(4)+"defaults.update(**kwargs)\n",g+=b.spaces(4)+"return "+f+".objects.create(**defaults)\n",g+=b.new_lines(2),d+=g}),jQuery.each(c,function(c,e){d+=e.render_tests_helpers(a,b)}),jQuery.each(c,function(c,e){d+=e.render_tests(a,b)}),d},b.render_urls_py=function(a,c){var d="from django.conf.urls import url, include\n";return d+="from rest_framework import routers"+b.new_lines(1),d+="import api"+b.new_lines(1),d+="import views"+b.new_lines(2),d+="router = routers.DefaultRouter()"+b.new_lines(1),jQuery.each(c,function(a,c){d+="router.register(r'"+c.l_name()+"', api."+c.name+"ViewSet)"+b.new_lines(1)}),d+=b.new_lines(2),d+="urlpatterns = ("+b.new_lines(1),d+=b.spaces(4)+"# urls for Django Rest Framework API"+b.new_lines(1),d+=b.spaces(4)+"url(r'^api/v1/', include(router.urls)),"+b.new_lines(1),d+=")"+b.new_lines(1),d+=b.new_lines(1),jQuery.each(c,function(c,e){d+=e.render_urls(a,b)}),d},b.render_admin_py=function(a,c){var d="from django.contrib import admin\nfrom django import forms\n";return d+="from .models import "+b.model_names(c).join(", "),d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_admin_classes(a,b)}),d},b.render_views_py=function(a,c){var d="from django.views.generic import DetailView, ListView, UpdateView, CreateView\n";return d+="from .models import "+b.model_names(c).join(", "),d+=b.new_lines(1),d+="from .forms import "+b.model_names(c,"Form").join(", "),d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_view_classes(a,b)}),d},b.render_models_py=function(a,c){var d="from django.core.urlresolvers import reverse\n";d+="from django_extensions.db.fields import AutoSlugField\n",d+="from django.db.models import *\n",d+="from django.conf import settings\n",d+="from django.contrib.contenttypes.fields import GenericForeignKey\n",d+="from django.contrib.contenttypes.models import ContentType\n",d+="from django.contrib.auth import get_user_model\n",jQuery.each(b.pre_imported_modules(),function(a,b){var c=a.split("."),e=c.pop();d+="from "+c.join(".")+" import "+e+" as "+b.as+"\n"});var e={};jQuery.each(c,function(a,b){jQuery.each(b.fields,function(a,b){e[b.module()]=b.module()})});var f={};return jQuery.each(c,function(a,b){jQuery.each(b.fields,function(a,b){f[b.type]=b}),jQuery.each(b.relationships,function(a,b){f[b.type]=b})}),jQuery.each(f,function(a,b){}),d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_model_class(a,b)}),d},b.render_templates_html=function(a,b){var c=[];return jQuery.each(b,function(b,d){c.push([d.l_name()+"_form.html",d.render_form_html(a)]),c.push([d.l_name()+"_detail.html",d.render_detail_html(a)]),c.push([d.l_name()+"_list.html",d.render_list_html(a)])}),c},b.render_django_rest_framework_api_py=function(a,c){var d="import models\n";return d+="import serializers\n",d+="from rest_framework import viewsets, permissions\n",d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_model_api(a,b)}),d},b.render_django_rest_framework_serializers_py=function(a,c){var d="import models";return d+=b.new_lines(2),d+="from rest_framework import serializers",d+=b.new_lines(3),jQuery.each(c,function(c,e){d+=e.render_model_serializer(a,b)}),d}}}function MessageServiceFactory(){return function(){var a=this;a.base_modal=function(){var a=jQuery("<div>").addClass("modal fade");a.attr("tabindex","-1"),a.attr("role","dialog"),a.css("display","none");var b=jQuery("<div>").addClass("modal-dialog"),c=jQuery("<div>").addClass("modal-content").appendTo(b),d=jQuery("<h2>").addClass("modal-header-inner");return jQuery("<div>").addClass("modal-header").appendTo(c).append(d),jQuery("<div>").addClass("modal-body").appendTo(c),jQuery("<div>").addClass("modal-footer").appendTo(c),a.append(b),a},a.icon=function(a){return jQuery("<icon>").addClass("fa").addClass(a)},a.simple_error=function(b,c){var d=a.base_modal(),e=a.icon("fa-info").addClass("pull-right");d.find(".modal-header-inner").append(e).append(jQuery("<span>").text(b)),d.find(".modal-body").empty().append(c);var f=jQuery("<button>").addClass("btn btn-default").text("Ok");return d.find(".modal-footer").append(f),f.attr("data-dismiss","modal"),d.modal(),d},a.simple_info=function(b,c){var d=a.base_modal(),e=a.icon("fa-info").addClass("pull-right");d.find(".modal-header-inner").append(e).append(jQuery("<span>").text(b)),d.find(".modal-body").empty().append(c);var f=jQuery("<button>").addClass("btn btn-default").text("Ok");return d.find(".modal-footer").append(f),f.attr("data-dismiss","modal"),d.modal(),d},a.simple_confirm=function(b,c,d){var e=d||jQuery.noop,f=a.base_modal();f.find(".modal-header-inner").html(b),f.find(".modal-body").empty().append(c);var g=jQuery("<button>").addClass("btn btn-primary").text("Ok"),h=jQuery("<button>").addClass("btn btn-default").text("Cancel");return f.find(".modal-footer").append(g).append(h),g.click(function(){e()}),h.attr("data-dismiss","modal"),g.attr("data-dismiss","modal"),f.modal(),f},a.simple_choice=function(b,c,d){var e=a.base_modal();return e.find(".modal-header-inner").html(b),e.find(".modal-body").empty().append(c),jQuery.each(d,function(a,b){var c=jQuery("<button>").addClass("btn btn-primary").text(b.text);e.find(".modal-footer").append(c),c.click(function(){b.callback()}),c.attr("data-dismiss","modal")}),e.modal(),e},a.simple_form=function(b,c,d,e,f){var g=e||jQuery.noop,h=f||!0,i=a.base_modal();i.find(".modal-header-inner").html(b),i.find(".modal-body").empty().append(c).append(d);var j=jQuery("<button>").addClass("btn btn-primary").text("Ok"),k=jQuery("<button>").addClass("btn btn-default").text("Cancel");return i.find(".modal-footer").append(j).append(k),j.click(function(){h||i.modal("hide"),g(d)}),k.attr("data-dismiss","modal"),h||j.attr("data-dismiss","modal"),i.modal(),i},a.simple_form_no_dismiss=function(b,c,d,e){return a.simple_form(b,c,d,e,!0)},a.simple_input=function(b,c,d,e,f){var g=e||jQuery.noop,h=f||!1,i=a.base_modal();i.find(".modal-header-inner").html(b);var j=jQuery("<label>").text(c),k=jQuery("<input>").attr("type","text").attr("name","input").addClass("form-control").attr("value",d),l=jQuery("<span>").text("error message").addClass("help-block hide"),m=jQuery("<div>").addClass("form-group form-group-input has-feedback").append(j).append(k).append(l),n=function(){var a=k.val();!h||""!=a&&void 0!=k?(i.modal("hide"),g(a)):m.addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text("Field Required")},o=jQuery("<form>").append(m).submit(function(a){a.preventDefault(),n()});i.find(".modal-body").empty().append(o);var p=jQuery("<button>").addClass("btn btn-primary").text("Ok"),q=jQuery("<button>").addClass("btn btn-default").text("Cancel");return i.find(".modal-footer").append(p).append(q),p.click(n),q.attr("data-dismiss","modal"),h||p.attr("data-dismiss","modal"),i.modal(),i}}}function RelationshipFactory(){return function(a){function b(a){this.name=a.name,this.type=a.type,this.opts=a.opts,this.to=a.to,this.external_app=a.external_app||!1,this.class_name=function(){return this.type.split(".").reverse()[0]},this.form_update=function(a){this.name=jQuery(a).find("input[name=name]").val(),this.type=jQuery(a).find("select[name=type]").val(),this.opts=jQuery(a).find("input[name=opts]").val(),this.to=jQuery(a).find("input[name=to]").val()},this.to_clean=function(){return this.to.replace(/['"]+/g,"")},this.to_class=function(){return this.to.split(".").reverse().shift()},this.opts_args=function(){return this.opts.split(",").join(", ")},this.to_module=function(){var a=this.to.split(".");return a.slice(0,a.length-1).join(".")},this.module=function(){var a=this.type.split(".");return a.slice(0,a.length-1).join(".")},this.edit_form=function(a){var b=jQuery("<form>"),c=jQuery("<div>").addClass("form-group form-group-name has-feedback").appendTo(b),d=jQuery("<div>").addClass("form-group form-group-type").appendTo(b),e=jQuery("<div>").addClass("form-group form-group-args").appendTo(b),f=jQuery("<div>").addClass("form-group form-group-args").appendTo(b);c.append(jQuery("<label>").text("Name")),c.append(jQuery("<input>").attr("name","name").addClass("form-control").val(this.name)),c.append(jQuery("<span>").text("error message").addClass("help-block hide")),d.append(jQuery("<label>").text("To")),d.append(jQuery("<input>").attr("name","to").attr("placeholder","to").addClass("form-control").val(this.to));var g=jQuery("<select>").attr("name","type").addClass("form-control"),h=this;return jQuery.each(a.relationship_factory.relationship_types(),function(a,b){var c=jQuery("<option>").attr("val",b).text(b);b==h.type&&c.attr("selected","selected"),g.append(c)}),e.append(jQuery("<label>").text("Field Type")),e.append(g),f.append(jQuery("<label>").text("Arguments")),f.append(jQuery("<input>").attr("name","opts").attr("placeholder","options").addClass("form-control").val(this.args)),b}}var c=this;c.relationship_types=function(){return["django.db.models.ForeignKey","django.db.models.OneToOneField","django.db.models.ManyToManyField"]},c.relationship_matches=function(){return c.relationship_types+["ForeignKey","OneToOneField","ManyToManyField","models.ForeignKey","models.OneToOneField","models.ManyToManyField"]},c.relationship_match=function(a){return c.relationship_matches().indexOf(a)!=-1},c.make_relationship=function(a){return new b(a)}}}function FieldFactory(){return function(a){function b(a){this.name=a.name,this.type=a.type,this.opts=a.opts||"",this.class_name=function(){return this.type.split(".").reverse()[0]},this.opts_args=function(){return this.opts.split(",").join(", ")},this.to_clean=function(){return this.to.replace(/['"]+/g,"")},this.module=function(){var a=this.type.split(".");return a.slice(0,a.length-1).join(".")},this.form_update=function(a){this.name=jQuery(a).find("input[name=name]").val(),this.type=jQuery(a).find("select[name=type]").val(),this.opts=jQuery(a).find("input[name=opts]").val()},this.edit_form=function(a){var b=jQuery("<form>"),c=jQuery("<div>").addClass("form-group form-group-name has-feedback").appendTo(b),d=jQuery("<div>").addClass("form-group form-group-type").appendTo(b),e=jQuery("<div>").addClass("form-group form-group-args").appendTo(b);c.append(jQuery("<label>").text("Name")),c.append(jQuery("<input>").attr("name","name").addClass("form-control").val(this.name)),c.append(jQuery("<span>").text("error message").addClass("help-block hide"));var f=jQuery("<select>").attr("name","type").addClass("form-control"),g=this;return jQuery.each(a.field_factory.field_types(),function(a,b){var c=jQuery("<option>").attr("val",b).text(b);b==g.type&&c.attr("selected","selected"),f.append(c)}),d.append(jQuery("<label>").text("Field Type")),d.append(f),e.append(jQuery("<label>").text("Arguments")),e.append(jQuery("<input>").attr("name","opts").attr("placeholder","options").addClass("form-control").val(this.opts)),b}}var c=this;c.fields=function(){return{"django.db.models.TextField":{default_args:"max_length=100"},"django.db.models.CharField":{default_args:"max_length=30"},"django.contrib.contenttypes.fields.GenericForeignKey":{default_args:'"content_type", "object_id"'},"django_extensions.db.fields.AutoSlugField":{},"django.db.models.CommaSeparatedIntegerField":{},"django.db.models.BigAutoField":{},"django.db.models.BigIntegerField":{},"django.db.models.BooleanField":{},"django.db.models.DateField":{},"django.db.models.DateTimeField":{},"django.db.models.DecimalField":{default_args:"max_digits=10, decimal_places=2"},"django.db.models.DurationField":{},"django.db.models.FileField":{default_args:'upload_to="/upload/files/"'},"django.db.models.ImageField":{default_args:'upload_to="/upload/images/"'},"django.db.models.FilePathField":{},"django.db.models.FloatField":{},"django.db.models.IntegerField":{},"django.db.models.PositiveIntegerField":{},"django.db.models.PositiveSmallIntegerField":{},"django.db.models.SlugField":{},"django.db.models.IPAddressField":{},"django.db.models.GenericIPAddressField":{},"django.db.models.NullBooleanField":{},"django.db.models.TimeField":{},"django.db.models.BinaryField":{},"django.db.models.AutoField":{},"django.db.models.SmallIntegerField":{},"django.db.models.URLField":{},"django.db.models.UUIDField":{},"django.db.models.EmailField":{}}},c.default_field_args=function(a){var b=c.fields()[a];return b&&b.default_args?b.default_args:""},c.field_types=function(){return Object.keys(c.fields())},c.make_field=function(a){return new b(a)}}}function ModelServiceFactory(){return function(a,b){function c(a){this.slugify=function(a){return a.toString().replace(/\s+/g,"").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"").replace(/^-+/,"").replace(/-+$/,"")},this.set_name=function(a){this.name=this.slugify(a)},this.set_name(a.name),this.fields=[];a.fields||[];this.fields=(a.fields||[]).map(b.field_factory.make_field),this.relationships=(a.relationships||[]).map(b.relationship_factory.make_relationship),this.relationship_names=function(){var a=this;return Object.keys(a.relationships).map(function(b){return a.relationships[b].name})},this.field_names=function(){var a=this;return Object.keys(a.fields).map(function(b){return a.fields[b].name})},this.l_name=function(){return this.name.toLowerCase()},this.has_relationship=function(a){return this.relationship_names().indexOf(a)!=-1},this.has_field=function(a){return this.field_names().indexOf(a)!=-1},this.name_field=function(){return this.field_names().indexOf("name")!=-1?"name":"id"},this.ordering_field=function(){return this.field_names().indexOf("created")!=-1?"created":"id"},this.identifier=function(){return this.field_names().indexOf("slug")!=-1?"slug":"id"},this.render_forms=function(a,b){var c="";return c+="class "+this.name+"Form(forms.ModelForm):\n",c+=b.spaces(4)+"class Meta:\n",c+=b.spaces(8)+"model = "+this.name+"\n",this.form_fields()&&(c+=b.spaces(8)+"fields = "+this.form_fields()+"\n"),c+=b.new_lines(2)},this.get_initial_data=function(a,b){var c="{";return c+=b.new_lines(1),jQuery.each(this.readable_fields(),function(a,d){c+=b.spaces(12)+'"'+d.name+'": "'+d.name+'",',c+=b.new_lines(1)}),jQuery.each(this.relationships,function(a,d){c+=b.spaces(12)+'"'+d.name+'": create_'+d.to.toLowerCase().replace(/\./g,"_")+"().id,",c+=b.new_lines(1)}),c+=b.spaces(8)+"}"},this.render_tests_helpers=function(a,b){var c="";return c+="def create_"+this.l_name()+"(**kwargs):\n",c+=b.spaces(4)+"defaults = {}\n",jQuery.each(this.readable_fields(),function(a,d){c+=b.spaces(4)+'defaults["'+d.name+'"] = "'+d.name+'"\n'}),c+=b.spaces(4)+"defaults.update(**kwargs)\n",jQuery.each(this.relationships,function(a,d){c+=b.spaces(4)+'if "'+d.name+'" not in defaults:\n';var e="create_"+d.to.toLowerCase().replace(/\./g,"_");b.built_in_models[d.to]&&(e="create_"+d.to.toLowerCase().replace(/\./g,"_")),c+=b.spaces(8)+'defaults["'+d.name+'"] = '+e+"()\n"}),c+=b.spaces(4)+"return "+this.name+".objects.create(**defaults)\n",c+=b.new_lines(2)},this.render_tests=function(a,b){var c="";return c+="class "+this.name+"ViewTest(unittest.TestCase):\n",c+=b.spaces(4)+"'''\n",c+=b.spaces(4)+"Tests for "+this.name+"\n",c+=b.spaces(4)+"'''\n",c+=b.spaces(4)+"def setUp(self):\n",c+=b.spaces(8)+"self.client = Client()\n",c+=b.new_lines(1),c+=b.spaces(4)+"def test_list_"+this.l_name()+"(self):\n",c+=b.spaces(8)+"url = reverse('"+a+"_"+this.l_name()+"_list')\n",c+=b.spaces(8)+"response = self.client.get(url)\n",c+=b.spaces(8)+"self.assertEqual(response.status_code, 200)\n",c+=b.new_lines(1),c+=b.spaces(4)+"def test_create_"+this.l_name()+"(self):\n",c+=b.spaces(8)+"url = reverse('"+a+"_"+this.l_name()+"_create')\n",c+=b.spaces(8)+"data = "+this.get_initial_data(a,b)+"\n",c+=b.spaces(8)+"response = self.client.post(url, data=data)\n",c+=b.spaces(8)+"self.assertEqual(response.status_code, 302)\n",c+=b.new_lines(1),c+=b.spaces(4)+"def test_detail_"+this.l_name()+"(self):\n",c+=b.spaces(8)+this.l_name()+" = create_"+this.l_name()+"()\n",c+=b.spaces(8)+"url = reverse('"+a+"_"+this.l_name()+"_detail', args=["+this.l_name()+"."+this.identifier()+",])\n",c+=b.spaces(8)+"response = self.client.get(url)\n",c+=b.spaces(8)+"self.assertEqual(response.status_code, 200)\n",c+=b.new_lines(1),c+=b.spaces(4)+"def test_update_"+this.l_name()+"(self):\n",c+=b.spaces(8)+this.l_name()+" = create_"+this.l_name()+"()\n",c+=b.spaces(8)+"data = "+this.get_initial_data(a,b)+"\n",c+=b.spaces(8)+"url = reverse('"+a+"_"+this.l_name()+"_update', args=["+this.l_name()+"."+this.identifier()+",])\n",c+=b.spaces(8)+"response = self.client.post(url, data)\n",c+=b.spaces(8)+"self.assertEqual(response.status_code, 302)\n",c+=b.new_lines(2)},this.render_urls=function(a,b){var c="";return c+="urlpatterns += (\n",c+=b.spaces(4)+"# urls for "+this.name+"\n",c+=b.spaces(4)+"url(r'^"+a+"/"+this.l_name()+"/$', views."+this.name+"ListView.as_view(), name='"+a+"_"+this.l_name()+"_list'),\n",c+=b.spaces(4)+"url(r'^"+a+"/"+this.l_name()+"/create/$', views."+this.name+"CreateView.as_view(), name='"+a+"_"+this.l_name()+"_create'),\n",c+=b.spaces(4)+"url(r'^"+a+"/"+this.l_name()+"/detail/(?P<"+this.identifier()+">\\S+)/$', views."+this.name+"DetailView.as_view(), name='"+a+"_"+this.l_name()+"_detail'),\n",c+=b.spaces(4)+"url(r'^"+a+"/"+this.l_name()+"/update/(?P<"+this.identifier()+">\\S+)/$', views."+this.name+"UpdateView.as_view(), name='"+a+"_"+this.l_name()+"_update'),\n",c+=")\n",c+=b.new_lines(1)},this.render_admin_classes=function(a,b){var c="";c+="class "+this.name+"AdminForm(forms.ModelForm):\n",c+=b.new_lines(1),c+=b.spaces(4)+"class Meta:\n",c+=b.spaces(8)+"model = "+this.name+"\n",c+=b.spaces(8)+"fields = '__all__'\n",c+=b.new_lines(2),c+="class "+this.name+"Admin(admin.ModelAdmin):\n",c+=b.spaces(4)+"form = "+this.name+"AdminForm\n";var d=this.admin_fields();return d.length>0?(c+=b.spaces(4)+"list_display = "+this.admin_fields()+"\n",c+=b.spaces(4)+"readonly_fields = "+this.admin_read_only_fields()+"\n"):c+=b.new_lines(1),c+=b.new_lines(1),c+="admin.site.register("+this.name+", "+this.name+"Admin)\n",c+=b.new_lines(2)},this.render_view_classes=function(a,b){var c=b.new_lines(1);return c+="class "+this.name+"ListView(ListView):\n",c+=b.spaces(4)+"model = "+this.name+"\n",c+=b.new_lines(2),c+="class "+this.name+"CreateView(CreateView):\n",c+=b.spaces(4)+"model = "+this.name+"\n",c+=b.spaces(4)+"form_class = "+this.name+"Form\n",c+=b.new_lines(2),c+="class "+this.name+"DetailView(DetailView):\n",c+=b.spaces(4)+"model = "+this.name+"\n",c+=b.new_lines(2),c+="class "+this.name+"UpdateView(UpdateView):\n",c+=b.spaces(4)+"model = "+this.name+"\n",c+=b.spaces(4)+"form_class = "+this.name+"Form",c+=b.new_lines(2)},this.render_model_class_header=function(a,b){var c="class "+this.name+"(models.Model):";return c+b.new_lines(2)},this.render_model_class_fields=function(a,b){var c="";return this.fields.length>0&&(c+=b.spaces(4)+"# Fields",c+=b.new_lines(1)),jQuery.each(this.fields,function(a,d){if(b.pre_imported_modules_names().indexOf(d.module())==-1)c+=b.spaces(4)+d.name+" = "+d.class_name()+"("+d.opts+")";else{var e=b.pre_imported_modules()[d.module()].as;c+=b.spaces(4)+d.name+" = "+e+"."+d.class_name()+"("+d.opts+")"}c+=b.new_lines(1)}),c+=b.new_lines(1)},this.render_model_class_relationships=function(a,c){var d="";return this.relationships.length>0&&(d+=c.spaces(4)+"# Relationship Fields",d+=c.new_lines(1)),jQuery.each(this.relationships,function(e,f){var g="'"+a+"."+f.to_clean()+"'";if(f.external_app&&(g="'"+f.to_clean()+"'"),f.to==b.user_model?g=b.user_model_setting:c.built_in_models[f.to]&&(g=f.to_class()),c.pre_imported_modules_names().indexOf(f.module())==-1)d+=c.spaces(4)+f.name+" = "+f.class_name()+"("+g+", "+f.opts+")";else{var h=c.pre_imported_modules()[f.module()].as;d+=c.spaces(4)+f.name+" = "+h+"."+f.class_name()+"("+g+", "+f.opts+")"}d+=c.new_lines(1)}),d},this.render_model_class=function(a,b){var c=this.render_model_class_header(a,b);return c+=this.render_model_class_fields(a,b),c+=this.render_model_class_relationships(a,b),c+=b.new_lines(1),c+=b.spaces(4)+"class Meta:",c+=b.new_lines(1),c+=b.spaces(8)+"ordering = ('-"+this.ordering_field()+"',)",c+=b.new_lines(2),c+=b.spaces(4)+"def __unicode__(self):",c+=b.new_lines(1),c+=b.spaces(8)+"return u'%s' % self."+this.identifier(),c+=b.new_lines(2),c+=b.spaces(4)+"def get_absolute_url(self):",c+=b.new_lines(1),c+=b.spaces(8)+"return reverse('"+a+"_"+this.l_name()+"_detail', args=(self."+this.identifier()+",))",c+=b.new_lines(1),c+=b.new_lines(2),c+=b.spaces(4)+"def get_update_url(self):",c+=b.new_lines(1),c+=b.spaces(8)+"return reverse('"+a+"_"+this.l_name()+"_update', args=(self."+this.identifier()+",))",c+=b.new_lines(3)},this.render_model_class_fields_only=function(a,b){var c="";return c+=this.render_model_class_header(a,b),c+=this.render_model_class_fields(a,b)},this.render_model_api=function(a,b){var c="class "+this.name+"ViewSet(viewsets.ModelViewSet):"+b.new_lines(1);return c+=b.spaces(4)+'"""ViewSet for the '+this.name+' class"""',c+=b.new_lines(2),c+=b.spaces(4)+"queryset = models."+this.name+".objects.all()"+b.new_lines(1),c+=b.spaces(4)+"serializer_class = serializers."+this.name+"Serializer"+b.new_lines(1),c+=b.spaces(4)+"permission_classes = [permissions.IsAuthenticated]"+b.new_lines(1),c+=b.new_lines(2)},this.render_model_serializer=function(a,b){var c="class "+this.name+"Serializer(serializers.ModelSerializer):";c+=b.new_lines(2),c+=b.spaces(4)+"class Meta:"+b.new_lines(1),c+=b.spaces(8)+"model = models."+this.name+b.new_lines(1),c+=b.spaces(8)+"fields = ("+b.new_lines(1),c+=b.spaces(12)+"'"+this.identifier()+"', "+b.new_lines(1);var d=this;return jQuery.each(this.fields,function(a,e){e.name!=d.identifier()&&(c+=b.spaces(12)+"'"+e.name+"', "+b.new_lines(1))}),c+=b.spaces(8)+")"+b.new_lines(3)},this._template_header=function(){return'{% extends "base.html" %}\n{% load static %}\n'},this._template_links=function(a){var b=a+"_"+this.l_name()+"_list";return'<p><a class="btn btn-default" href="{% url \''+b+"' %}\">"+this.name+" Listing</a></p>\n"},this._wrap_block=function(a,b){return"{% block "+a+" %}\n"+b+"\n{% endblock %}"},this.render_form_html=function(a){var b=this._template_header();b+="{% load crispy_forms_tags %}\n";var c=this._template_links(a)+'<form method="post">\n';return c+="{% csrf_token %}\n{{form|crispy}}\n",c+='<button class="btn btn-primary" type="submit">Submit</button>\n',c+="</form>",b+=this._wrap_block("content",c)},this.render_list_html=function(a){var b=a+"_"+this.l_name()+"_create",c=this._template_header(),d=this._template_links(a)+'<table class="table">\n';return d+="<tr>\n",d+="<td>ID</td><td>Link</td>\n",jQuery.each(this.fields,function(a,b){d+="    <td>"+b.name+"</td>\n"}),d+="</tr>\n",d+="{% for object in object_list %}\n",d+="<tr>\n",d+="    <td>{{object.id}}</td>\n",d+='    <td><a href="{{object.get_absolute_url}}">{{object}}</a></td>\n',jQuery.each(this.fields,function(a,b){d+="    <td>{{ object."+b.name+" }}</td>\n"}),d+="</tr>\n",d+="{% endfor %}\n",d+="</table>",d+='<a class="btn btn-primary" href="{% url \''+b+"' %}\">Create new "+this.name+"</a>",c+=this._wrap_block("content",d)},this.render_detail_html=function(a){var b=this._template_header(),c=this._template_links(a)+'<table class="table">\n';return jQuery.each(this.fields,function(a,b){c+="<tr><td>"+b.name+"</td><td>{{ object."+b.name+" }}</td></tr>\n"}),c+="</table>",c+='\n<a class="btn btn-primary" href="{{object.get_update_url}}">Edit '+this.name+"</a>\n",b+=this._wrap_block("content",c)},this.form_fields=function(){var a=this.readable_fields().map(function(a){return a.name}),b=this.relationships.map(function(a){return a.name}),c=a.concat(b);return c.length?"['"+c.join("', '")+"']":"'__all__'"},this.readable_fields=function(){var a=[];return jQuery.each(this.fields,function(b,c){c.opts.indexOf("readonly")==-1&&c.opts.indexOf("editable")==-1&&c.opts.indexOf("auto_now_add")==-1&&"django.contrib.contenttypes.fields.GenericForeignKey"!=c.type&&"django_extensions.db.fields.AutoSlugField"!=c.type&&a.push(c)}),a},this.admin_fields=function(){return this.field_names().length>0?"['"+this.field_names().join("', '")+"']":""},this.admin_read_only_fields=function(){return this.field_names().length>0?"['"+this.field_names().join("', '")+"']":""}}return new c(a)}}function ModelParserFactory(){return function(a){function b(){this.parse=function(b,c){var d=new FileReader;d.onload=function(b){var e=d.result,f=e.split("\n"),g=[],h=null,i="",j=new RegExp("class ([a-zA-Z_]*)[(]([a-zA-Z._]*)[)][:]$"),k=new RegExp("^([a-zA-Z0-9_]+) = ([a-zA-Z0-9._]+)[(](.*)[)]$");jQuery.each(f,function(b,c){c=c.trim();var d=j.exec(c);d&&d[2].match(/model/i)&&(console.log("Model:",d[1]),h={name:d[1],class:d[2],fields:[],relationships:[]},g.push(h),i="");var e,f=k.exec(c);f&&(e=f);var l=k.exec(i);if(l&&(e=l),e){if(h&&e[2]&&(e[2].match(/field/i)||a.relationship_factory.relationship_match(e[2]))){var m=a.relationship_factory.relationship_match(e[2]);if(m){var n=e[1],o=e[2],p=e[3].split(","),q=p.shift(),r=p.join(",").trim();console.log("Model:",h.name,"Relationship:",n,o,q,r),h.relationships.push(a.relationship_factory.make_relationship({name:n,type:o,opts:r,to:q}))}else{var s=e[1],t=e[2],u=e[3];console.log("Model:",h.name,"Field:",s,t,u),h.fields.push(a.field_factory.make_field({name:s,type:t,opts:u}))}}i=""}else h&&(i+=c)});var l=[];jQuery.each(g,function(b,c){var d=a.model_factory(c,a);l.push(d)}),c&&c(l)},d.readAsText(b)}}return new b}}ace.define("ace/mode/python",["require","exports","module","ace/lib/oop","ace/mode/text","ace/tokenizer","ace/mode/python_highlight_rules","ace/mode/folding/pythonic","ace/range"],function(a,b,c){var d=a("../lib/oop"),e=a("./text").Mode,f=(a("../tokenizer").Tokenizer,a("./python_highlight_rules").PythonHighlightRules),g=a("./folding/pythonic").FoldMode,h=a("../range").Range,i=function(){this.HighlightRules=f,this.foldingRules=new g("\\:")};d.inherits(i,e),function(){this.lineCommentStart="#",this.getNextLineIndent=function(a,b,c){var d=this.$getIndent(b),e=this.getTokenizer().getLineTokens(b,a),f=e.tokens;if(f.length&&"comment"==f[f.length-1].type)return d;if("start"==a){var g=b.match(/^.*[\{\(\[\:]\s*$/);g&&(d+=c)}return d};var a={pass:1,return:1,raise:1,break:1,continue:1};this.checkOutdent=function(b,c,d){if("\r\n"!==d&&"\r"!==d&&"\n"!==d)return!1;var e=this.getTokenizer().getLineTokens(c.trim(),b).tokens;if(!e)return!1;do var f=e.pop();while(f&&("comment"==f.type||"text"==f.type&&f.value.match(/^\s+$/)));return!!f&&("keyword"==f.type&&a[f.value])},this.autoOutdent=function(a,b,c){c+=1;var d=this.$getIndent(b.getLine(c)),e=b.getTabString();d.slice(-e.length)==e&&b.remove(new h(c,d.length-e.length,c,d.length))},this.$id="ace/mode/python"}.call(i.prototype),b.Mode=i}),ace.define("ace/mode/python_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/text_highlight_rules"],function(a,b,c){var d=a("../lib/oop"),e=a("./text_highlight_rules").TextHighlightRules,f=function(){var a="and|as|assert|break|class|continue|def|del|elif|else|except|exec|finally|for|from|global|if|import|in|is|lambda|not|or|pass|print|raise|return|try|while|with|yield",b="True|False|None|NotImplemented|Ellipsis|__debug__",c="abs|divmod|input|open|staticmethod|all|enumerate|int|ord|str|any|eval|isinstance|pow|sum|basestring|execfile|issubclass|print|super|binfile|iter|property|tuple|bool|filter|len|range|type|bytearray|float|list|raw_input|unichr|callable|format|locals|reduce|unicode|chr|frozenset|long|reload|vars|classmethod|getattr|map|repr|xrange|cmp|globals|max|reversed|zip|compile|hasattr|memoryview|round|__import__|complex|hash|min|set|apply|delattr|help|next|setattr|buffer|dict|hex|object|slice|coerce|dir|id|oct|sorted|intern",d=this.createKeywordMapper({"invalid.deprecated":"debugger","support.function":c,"constant.language":b,keyword:a},"identifier"),e="(?:r|u|ur|R|U|UR|Ur|uR)?",f="(?:(?:[1-9]\\d*)|(?:0))",g="(?:0[oO]?[0-7]+)",h="(?:0[xX][\\dA-Fa-f]+)",i="(?:0[bB][01]+)",j="(?:"+f+"|"+g+"|"+h+"|"+i+")",k="(?:[eE][+-]?\\d+)",l="(?:\\.\\d+)",m="(?:\\d+)",n="(?:(?:"+m+"?"+l+")|(?:"+m+"\\.))",o="(?:(?:"+n+"|"+m+")"+k+")",p="(?:"+o+"|"+n+")",q="\\\\(x[0-9A-Fa-f]{2}|[0-7]{3}|[\\\\abfnrtv'\"]|U[0-9A-Fa-f]{8}|u[0-9A-Fa-f]{4})";this.$rules={start:[{token:"comment",regex:"#.*$"},{token:"string",regex:e+'"{3}',next:"qqstring3"},{token:"string",regex:e+'"(?=.)',next:"qqstring"},{token:"string",regex:e+"'{3}",next:"qstring3"},{token:"string",regex:e+"'(?=.)",next:"qstring"},{token:"constant.numeric",regex:"(?:"+p+"|\\d+)[jJ]\\b"},{token:"constant.numeric",regex:p},{token:"constant.numeric",regex:j+"[lL]\\b"},{token:"constant.numeric",regex:j+"\\b"},{token:d,regex:"[a-zA-Z_$][a-zA-Z0-9_$]*\\b"},{token:"keyword.operator",regex:"\\+|\\-|\\*|\\*\\*|\\/|\\/\\/|%|<<|>>|&|\\||\\^|~|<|>|<=|=>|==|!=|<>|="},{token:"paren.lparen",regex:"[\\[\\(\\{]"},{token:"paren.rparen",regex:"[\\]\\)\\}]"},{token:"text",regex:"\\s+"}],qqstring3:[{token:"constant.language.escape",regex:q},{token:"string",regex:'"{3}',next:"start"},{defaultToken:"string"}],qstring3:[{token:"constant.language.escape",regex:q},{token:"string",regex:"'{3}",next:"start"},{defaultToken:"string"}],qqstring:[{token:"constant.language.escape",regex:q},{token:"string",regex:"\\\\$",next:"qqstring"},{token:"string",regex:'"|$',next:"start"},{defaultToken:"string"}],qstring:[{token:"constant.language.escape",regex:q},{token:"string",regex:"\\\\$",next:"qstring"},{token:"string",regex:"'|$",next:"start"},{defaultToken:"string"}]}};d.inherits(f,e),b.PythonHighlightRules=f}),ace.define("ace/mode/folding/pythonic",["require","exports","module","ace/lib/oop","ace/mode/folding/fold_mode"],function(a,b,c){
var d=a("../../lib/oop"),e=a("./fold_mode").FoldMode,f=b.FoldMode=function(a){this.foldingStartMarker=new RegExp("([\\[{])(?:\\s*)$|("+a+")(?:\\s*)(?:#.*)?$")};d.inherits(f,e),function(){this.getFoldWidgetRange=function(a,b,c){var d=a.getLine(c),e=d.match(this.foldingStartMarker);if(e)return e[1]?this.openingBracketBlock(a,e[1],c,e.index):e[2]?this.indentationBlock(a,c,e.index+e[2].length):this.indentationBlock(a,c)}}.call(f.prototype)}),ace.define("ace/theme/dawn",["require","exports","module","ace/lib/dom"],function(a,b,c){b.isDark=!1,b.cssClass="ace-dawn",b.cssText=".ace-dawn .ace_gutter {background: #ebebeb;color: #333}.ace-dawn .ace_print-margin {width: 1px;background: #e8e8e8}.ace-dawn {background-color: #F9F9F9;color: #080808}.ace-dawn .ace_cursor {color: #000000}.ace-dawn .ace_marker-layer .ace_selection {background: rgba(39, 95, 255, 0.30)}.ace-dawn.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px #F9F9F9;border-radius: 2px}.ace-dawn .ace_marker-layer .ace_step {background: rgb(255, 255, 0)}.ace-dawn .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgba(75, 75, 126, 0.50)}.ace-dawn .ace_marker-layer .ace_active-line {background: rgba(36, 99, 180, 0.12)}.ace-dawn .ace_gutter-active-line {background-color : #dcdcdc}.ace-dawn .ace_marker-layer .ace_selected-word {border: 1px solid rgba(39, 95, 255, 0.30)}.ace-dawn .ace_invisible {color: rgba(75, 75, 126, 0.50)}.ace-dawn .ace_keyword,.ace-dawn .ace_meta {color: #794938}.ace-dawn .ace_constant,.ace-dawn .ace_constant.ace_character,.ace-dawn .ace_constant.ace_character.ace_escape,.ace-dawn .ace_constant.ace_other {color: #811F24}.ace-dawn .ace_invalid.ace_illegal {text-decoration: underline;font-style: italic;color: #F8F8F8;background-color: #B52A1D}.ace-dawn .ace_invalid.ace_deprecated {text-decoration: underline;font-style: italic;color: #B52A1D}.ace-dawn .ace_support {color: #691C97}.ace-dawn .ace_support.ace_constant {color: #B4371F}.ace-dawn .ace_fold {background-color: #794938;border-color: #080808}.ace-dawn .ace_list,.ace-dawn .ace_markup.ace_list,.ace-dawn .ace_support.ace_function {color: #693A17}.ace-dawn .ace_storage {font-style: italic;color: #A71D5D}.ace-dawn .ace_string {color: #0B6125}.ace-dawn .ace_string.ace_regexp {color: #CF5628}.ace-dawn .ace_comment {font-style: italic;color: #5A525F}.ace-dawn .ace_heading,.ace-dawn .ace_markup.ace_heading {color: #19356D}.ace-dawn .ace_variable {color: #234A97}.ace-dawn .ace_indent-guide {background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAEklEQVQImWNgYGBgYLh/5+x/AAizA4hxNNsZAAAAAElFTkSuQmCC) right repeat-y}";var d=a("../lib/dom");d.importCssString(b.cssText,b.cssClass)});var global=Function("return this;")();!function(a){function b(a){var b=g[a]||window[a];if(!b)throw new Error("Requested module '"+a+"' has not been defined.");return b}function c(a,b){return g[a]=b}function d(a,b){for(var c in b)"noConflict"!=c&&"_VERSION"!=c&&(a[c]=b[c]);return a}function e(a,b,c){return"string"==typeof a||a.nodeName||a.length&&"item"in a||a==window?(c=f._select(a,b),c.selector=a):c=isFinite(a.length)?a:[a],d(c,e)}function f(a,b){return e(a,b)}a.global=a;var g={},h=a.$;a.provide=c,a.require=b,d(f,{_VERSION:"0.3.6",fn:e,ender:function(a,b){d(b?e:f,a)},_select:function(a,b){return(b||document).querySelectorAll(a)}}),d(e,{forEach:function(a,b,c){for(c=0,l=this.length;c<l;++c)c in this&&a.call(b||this[c],this[c],c,this);return this},$:f}),f.noConflict=function(){return a.$=h,this},"undefined"!=typeof module&&module.exports&&(module.exports=f),a.ender=a.$=a.ender||f}(this),function(a){var b={exports:{}};b.exports,require("ender");!function(){"use strict";function a(a){var b,c=new Uint8Array(a);for(b=0;b<a;b+=1)c[b]=0;return c}function c(b,c,d,e){var f=c+d,g=a((parseInt(f/e)+1)*e);return g.set(b),g}function d(a,b,c){return a=a.toString(c||8),"000000000000".substr(a.length+12-b)+a}function e(b,c,d){var e,f;for(c=c||a(b.length),d=d||0,e=0,f=b.length;e<f;e+=1)c[d]=b.charCodeAt(e),d+=1;return c}function f(a){function b(a){return g[a>>18&63]+g[a>>12&63]+g[a>>6&63]+g[63&a]}var c,d,e,f=a.length%3,h="";for(c=0,e=a.length-f;c<e;c+=3)d=(a[c]<<16)+(a[c+1]<<8)+a[c+2],h+=b(d);switch(h.length%4){case 1:h+="=";break;case 2:h+="=="}return h}var g=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"];b.exports.clean=a,b.exports.pad=d,b.exports.extend=c,b.exports.stringToUint8=e,b.exports.uint8ToBase64=f}(),provide("tar-js/utils",b.exports)}(global),function(a){var b={exports:{}};b.exports,require("ender");!function(){"use strict";function a(a,b){var e=d.clean(512),f=0;return c.forEach(function(b){var c,d,g=a[b.field]||"";for(c=0,d=g.length;c<d;c+=1)e[f]=g.charCodeAt(c),f+=1;f+=b.length-c}),"function"==typeof b?b(e,f):e}var c,d=require("tar-js/utils");c=[{field:"fileName",length:100},{field:"fileMode",length:8},{field:"uid",length:8},{field:"gid",length:8},{field:"fileSize",length:12},{field:"mtime",length:12},{field:"checksum",length:8},{field:"type",length:1},{field:"linkName",length:100},{field:"ustar",length:8},{field:"owner",length:32},{field:"group",length:32},{field:"majorNumber",length:8},{field:"minorNumber",length:8},{field:"filenamePrefix",length:155},{field:"padding",length:12}],b.exports.structure=c,b.exports.format=a}(),provide("tar-js/header",b.exports)}(global),function(a){var b={exports:{}};b.exports,require("ender");!function(){"use strict";function a(a){this.written=0,c=(a||20)*f,this.out=e.clean(c)}var c,d=require("tar-js/header"),e=require("tar-js/utils"),f=512;a.prototype.append=function(a,b,g,h){var i,j,k,l,m,n,o;if("string"==typeof b)b=e.stringToUint8(b);else if(b.constructor!==Uint8Array.prototype.constructor)throw"Invalid input type. You gave me: "+b.constructor.toString().match(/function\s*([$A-Za-z_][0-9A-Za-z_]*)\s*\(/)[1];"function"==typeof g&&(h=g,g={}),g=g||{},k=g.mode||4095&parseInt("777",8),l=g.mtime||Math.floor(+new Date/1e3),m=g.uid||0,n=g.gid||0,i={fileName:a,fileMode:e.pad(k,7),uid:e.pad(m,7),gid:e.pad(n,7),fileSize:e.pad(b.length,11),mtime:e.pad(l,11),checksum:"        ",type:"0",ustar:"ustar  ",owner:g.owner||"",group:g.group||""},j=0,Object.keys(i).forEach(function(a){var b,c,d=i[a];for(b=0,c=d.length;b<c;b+=1)j+=d.charCodeAt(b)}),i.checksum=e.pad(j,6)+"\0 ",o=d.format(i);return this.out.set(o,this.written),this.written+=o.length,this.written+b.length>this.out.length&&(this.out=e.extend(this.out,this.written,b.length,c)),this.out.set(b,this.written),this.written+=b.length+(f-(b.length%f||f)),this.out.length-this.written<2*f&&(this.out=e.extend(this.out,this.written,2*f,c)),"function"==typeof h&&h(this.out),this.out},a.prototype.clear=function(){this.written=0,this.out=e.clean(c)},b.exports=a}(),provide("tar-js",b.exports)}(global),angular.module("ui.ace",[]).constant("uiAceConfig",{}).directive("uiAce",["uiAceConfig",function(a){if(angular.isUndefined(window.ace))throw new Error("ui-ace need ace to work... (o rly?)");var b=function(a,b,c){if(angular.isDefined(c.workerPath)){var d=window.ace.require("ace/config");d.set("workerPath",c.workerPath)}angular.isDefined(c.require)&&c.require.forEach(function(a){window.ace.require(a)}),angular.isDefined(c.showGutter)&&a.renderer.setShowGutter(c.showGutter),angular.isDefined(c.useWrapMode)&&b.setUseWrapMode(c.useWrapMode),angular.isDefined(c.showInvisibles)&&a.renderer.setShowInvisibles(c.showInvisibles),angular.isDefined(c.showIndentGuides)&&a.renderer.setDisplayIndentGuides(c.showIndentGuides),angular.isDefined(c.useSoftTabs)&&b.setUseSoftTabs(c.useSoftTabs),angular.isDefined(c.showPrintMargin)&&a.setShowPrintMargin(c.showPrintMargin),angular.isDefined(c.disableSearch)&&c.disableSearch&&a.commands.addCommands([{name:"unfind",bindKey:{win:"Ctrl-F",mac:"Command-F"},exec:function(){return!1},readOnly:!0}]),angular.isString(c.theme)&&a.setTheme("ace/theme/"+c.theme),angular.isString(c.mode)&&b.setMode("ace/mode/"+c.mode),angular.isDefined(c.firstLineNumber)&&(angular.isNumber(c.firstLineNumber)?b.setOption("firstLineNumber",c.firstLineNumber):angular.isFunction(c.firstLineNumber)&&b.setOption("firstLineNumber",c.firstLineNumber()));var e,f;if(angular.isDefined(c.advanced))for(e in c.advanced)f={name:e,value:c.advanced[e]},a.setOption(f.name,f.value);if(angular.isDefined(c.rendererOptions))for(e in c.rendererOptions)f={name:e,value:c.rendererOptions[e]},a.renderer.setOption(f.name,f.value);angular.forEach(c.callbacks,function(b){angular.isFunction(b)&&b(a)})};return{restrict:"EA",require:"?ngModel",link:function(c,d,e,f){var g,h,i=a.ace||{},j=angular.extend({},i,c.$eval(e.uiAce)),k=window.ace.edit(d[0]),l=k.getSession(),m=function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1);angular.isDefined(a)&&c.$evalAsync(function(){if(!angular.isFunction(a))throw new Error("ui-ace use a function as callback.");a(b)})},n={onChange:function(a){return function(b){var d=l.getValue();!f||d===f.$viewValue||c.$$phase||c.$root.$$phase||c.$evalAsync(function(){f.$setViewValue(d)}),m(a,b,k)}},onBlur:function(a){return function(){m(a,k)}}};e.$observe("readonly",function(a){k.setReadOnly(!!a||""===a)}),f&&(f.$formatters.push(function(a){if(angular.isUndefined(a)||null===a)return"";if(angular.isObject(a)||angular.isArray(a))throw new Error("ui-ace cannot use an object or an array as a model");return a}),f.$render=function(){l.setValue(f.$viewValue)});var o=function(a,d){a!==d&&(j=angular.extend({},i,c.$eval(e.uiAce)),j.callbacks=[j.onLoad],j.onLoad!==i.onLoad&&j.callbacks.unshift(i.onLoad),l.removeListener("change",g),g=n.onChange(j.onChange),l.on("change",g),k.removeListener("blur",h),h=n.onBlur(j.onBlur),k.on("blur",h),b(k,l,j))};c.$watch(e.uiAce,o,!0),o(i),d.on("$destroy",function(){k.session.$stopWorker(),k.destroy()}),c.$watch(function(){return[d[0].offsetWidth,d[0].offsetHeight]},function(){k.resize(),k.renderer.updateFull()},!0)}}}]),!function(a,b){var c=b.isDefined,d=b.isUndefined,e=b.isNumber,f=b.isObject,g=b.isArray,h=b.isString,i=b.extend,j=b.toJson;b.module("LocalStorageModule",[]).provider("localStorageService",function(){this.prefix="ls",this.storageType="localStorage",this.cookie={expiry:30,path:"/",secure:!1},this.defaultToCookie=!0,this.notify={setItem:!0,removeItem:!1},this.setPrefix=function(a){return this.prefix=a,this},this.setStorageType=function(a){return this.storageType=a,this},this.setDefaultToCookie=function(a){return this.defaultToCookie=!!a,this},this.setStorageCookie=function(a,b,c){return this.cookie.expiry=a,this.cookie.path=b,this.cookie.secure=c,this},this.setStorageCookieDomain=function(a){return this.cookie.domain=a,this},this.setNotify=function(a,b){return this.notify={setItem:a,removeItem:b},this},this.$get=["$rootScope","$window","$document","$parse","$timeout",function(a,b,k,l,m){function n(c){if(c||(c=b.event),s.setItem&&h(c.key)&&w(c.key)){var d=v(c.key);m(function(){a.$broadcast("LocalStorageModule.notification.changed",{key:d,newvalue:c.newValue,storageType:p.storageType})})}}var o,p=this,q=p.prefix,r=p.cookie,s=p.notify,t=p.storageType;k?k[0]&&(k=k[0]):k=document,"."!==q.substr(-1)&&(q=q?q+".":"");var u=function(a){return q+a},v=function(a){return a.replace(new RegExp("^"+q,"g"),"")},w=function(a){return 0===a.indexOf(q)},x=function(){try{var c=t in b&&null!==b[t],d=u("__"+Math.round(1e7*Math.random()));return c&&(o=b[t],o.setItem(d,""),o.removeItem(d)),c}catch(b){return p.defaultToCookie&&(t="cookie"),a.$broadcast("LocalStorageModule.notification.error",b.message),!1}},y=x(),z=function(b,c,e){if(K(e),c=d(c)?null:j(c),!y&&p.defaultToCookie||"cookie"===p.storageType)return y||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),s.setItem&&a.$broadcast("LocalStorageModule.notification.setitem",{key:b,newvalue:c,storageType:"cookie"}),F(b,c);try{o&&o.setItem(u(b),c),s.setItem&&a.$broadcast("LocalStorageModule.notification.setitem",{key:b,newvalue:c,storageType:p.storageType})}catch(d){return a.$broadcast("LocalStorageModule.notification.error",d.message),F(b,c)}return!0},A=function(b,c){if(K(c),!y&&p.defaultToCookie||"cookie"===p.storageType)return y||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),G(b);var d=o?o.getItem(u(b)):null;if(!d||"null"===d)return null;try{return JSON.parse(d)}catch(a){return d}},B=function(){var b=0;arguments.length>=1&&("localStorage"===arguments[arguments.length-1]||"sessionStorage"===arguments[arguments.length-1])&&(b=1,K(arguments[arguments.length-1]));var c,d;for(c=0;c<arguments.length-b;c++)if(d=arguments[c],!y&&p.defaultToCookie||"cookie"===p.storageType)y||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),s.removeItem&&a.$broadcast("LocalStorageModule.notification.removeitem",{key:d,storageType:"cookie"}),H(d);else try{o.removeItem(u(d)),s.removeItem&&a.$broadcast("LocalStorageModule.notification.removeitem",{key:d,storageType:p.storageType})}catch(b){a.$broadcast("LocalStorageModule.notification.error",b.message),H(d)}},C=function(b){if(K(b),!y)return a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),[];var c=q.length,d=[];for(var e in o)if(e.substr(0,c)===q)try{d.push(e.substr(c))}catch(b){return a.$broadcast("LocalStorageModule.notification.error",b.Description),[]}return d},D=function(b,c){K(c);var d=q?new RegExp("^"+q):new RegExp,e=b?new RegExp(b):new RegExp;if(!y&&p.defaultToCookie||"cookie"===p.storageType)return y||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),I();if(!y&&!p.defaultToCookie)return!1;var f=q.length;for(var g in o)if(d.test(g)&&e.test(g.substr(f)))try{B(g.substr(f))}catch(b){return a.$broadcast("LocalStorageModule.notification.error",b.message),I()}return!0},E=function(){try{return b.navigator.cookieEnabled||"cookie"in k&&(k.cookie.length>0||(k.cookie="test").indexOf.call(k.cookie,"test")>-1)}catch(b){return a.$broadcast("LocalStorageModule.notification.error",b.message),!1}}(),F=function(b,c,h,i){if(d(c))return!1;if((g(c)||f(c))&&(c=j(c)),!E)return a.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var l="",m=new Date,n="";if(null===c?(m.setTime(m.getTime()+-864e5),l="; expires="+m.toGMTString(),c=""):e(h)&&0!==h?(m.setTime(m.getTime()+24*h*60*60*1e3),l="; expires="+m.toGMTString()):0!==r.expiry&&(m.setTime(m.getTime()+24*r.expiry*60*60*1e3),l="; expires="+m.toGMTString()),b){var o="; path="+r.path;r.domain&&(n="; domain="+r.domain),"boolean"==typeof i?i===!0&&(n+="; secure"):r.secure===!0&&(n+="; secure"),k.cookie=u(b)+"="+encodeURIComponent(c)+l+o+n}}catch(b){return a.$broadcast("LocalStorageModule.notification.error",b.message),!1}return!0},G=function(b){if(!E)return a.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var c=k.cookie&&k.cookie.split(";")||[],d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(u(b)+"=")){var f=decodeURIComponent(e.substring(q.length+b.length+1,e.length));try{return JSON.parse(f)}catch(a){return f}}}return null},H=function(a){F(a,null)},I=function(){for(var a=null,b=q.length,c=k.cookie.split(";"),d=0;d<c.length;d++){for(a=c[d];" "===a.charAt(0);)a=a.substring(1,a.length);var e=a.substring(b,a.indexOf("="));H(e)}},J=function(){return t},K=function(a){return a&&t!==a&&(t=a,y=x()),y},L=function(a,b,d,e,g){e=e||b;var h=A(e,g);return null===h&&c(d)?h=d:f(h)&&f(d)&&(h=i(h,d)),l(b).assign(a,h),a.$watch(b,function(a){z(e,a,g)},f(a[b]))};y&&(b.addEventListener?(b.addEventListener("storage",n,!1),a.$on("$destroy",function(){b.removeEventListener("storage",n)})):b.attachEvent&&(b.attachEvent("onstorage",n),a.$on("$destroy",function(){b.detachEvent("onstorage",n)})));var M=function(a){K(a);for(var c=0,d=b[t],e=0;e<d.length;e++)0===d.key(e).indexOf(q)&&c++;return c};return{isSupported:y,getStorageType:J,setStorageType:K,set:z,add:z,get:A,keys:C,remove:B,clearAll:D,bind:L,deriveKey:u,underiveKey:v,length:M,defaultToCookie:this.defaultToCookie,cookie:{isSupported:E,set:F,add:F,get:G,remove:H,clearAll:I}}}]})}(window,window.angular),angular.module("builder",["ngRoute","builder.filters","builder.services","builder.directives","builder.controllers","LocalStorageModule","ui.ace","angulartics","angulartics.google.analytics"]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/models",{templateUrl:"partials/models.html",controller:"ModelController"}),a.when("/home",{templateUrl:"partials/home.html",controller:"ModelController"}),a.otherwise({redirectTo:"/home"})}]),angular.module("builder.controllers",["LocalStorageModule"]).controller("ModelController",["$scope","$http","ModelFactory","ModelParser","FieldFactory","RelationshipFactory","localStorageService","MessageService","RenderFactory","TarballFactory",function(a,b,c,d,e,f,g,h,i,j){a.models=[],a.new_models=[],a.user_model="django.contrib.auth.models.User",a.user_model_setting="settings.AUTH_USER_MODEL",a.built_in_models={"django.contrib.auth.models.User":{fields:{username:{default:"username"},email:{default:"username@tempurl.com"}}},"django.contrib.auth.models.Group":{fields:{name:{default:"group"}}},"django.contrib.contenttypes.models.ContentType":{fields:{}}},a.messageService=new h,a.field_factory=new e,a.model_factory=c,a.relationship_factory=new f,a.render_factory=new i(a.built_in_models),a.editors=[],a.models_storage_key="local_models",a._app_name="app_name",a._project_name="project_name",a.create_tar_ball_url=function(b){var c="Built with django_builder\n",d="#";const e=a.project_name(),f=a.app_name();var g=a.render_factory.render_models_py(f,a.models),h=a.render_factory.render_views_py(f,a.models),i=a.render_factory.render_admin_py(f,a.models),k=a.render_factory.render_urls_py(f,a.models),l=a.render_factory.render_tests_py(f,a.models),m=a.render_factory.render_forms_py(f,a.models),n=a.render_factory.render_django_rest_framework_api_py(f,a.models),o=a.render_factory.render_django_rest_framework_serializers_py(f,a.models),p=a.render_factory.render_templates_html(f,a.models),q=new j,r=f;if(b&&(r=e+"/"+f),b){var s=a.render_factory.render_project_settings_py(e),t=a.render_factory.render_project_urls_py(e),u=a.render_factory.render_project_urls_py(e),v=a.render_factory.render_project_wsgi_py(e);q.append(e+"/manage.py",u),q.append(e+"/"+e+"/settings.py",s),q.append(e+"/"+e+"/urls.py",t),q.append(e+"/"+e+"/wsgi.py",v),q.append(e+"/"+e+"/__init__.py",d)}return q.append(r+"/README.txt",c),q.append(r+"/__init__.py",d),q.append(r+"/models.py",g),q.append(r+"/views.py",h),q.append(r+"/admin.py",i),q.append(r+"/urls.py",k),q.append(r+"/tests.py",l),q.append(r+"/forms.py",m),q.append(r+"/api.py",n),q.append(r+"/serializers.py",o),q.append(r+"/templates/base.html",a.render_factory.render_base_html(f,a.models)),jQuery.each(p,function(a,b){q.append(r+"/templates/"+f+"/"+b[0],b[1])}),q.get_url()},a.create_download_modal_app=function(){var b=a.create_tar_ball_url(!1),c=a.app_name()+".tar",d="django_builder_download_app_modal";return a.create_download_modal(b,c,d)},a.create_download_modal_project=function(){var b=a.create_tar_ball_url(!0),c=a.project_name()+".tar",d=jQuery("<p>");d.text("The project download includes the following files:");var e=jQuery("<div>").addClass("well well-sm");e.append(jQuery("<p>").text("manage.py")),e.append(jQuery("<p>").text(a.project_name()+"/settings.py")),e.append(jQuery("<p>").text(a.project_name()+"/urls.py")),e.append(jQuery("<p>").text(a.project_name()+"/wsgi.py")),d.append(jQuery("<br><br>")),d.append(e);var f="django_builder_download_project_modal";return a.create_download_modal(b,c,f,d)},a.create_download_modal=function(b,c,d,e){var f=jQuery("<a>").attr("href",b).attr("id","django_builder_download_a");f.addClass("btn btn-success btn-lg").css("text-transform","none"),f.text("Click here to download "+c),f.attr("download",c);var g=jQuery("<div>").addClass("text-center").append(f),h=jQuery("<div>");h.append(jQuery("<br>")),h.append("Chrome can block downloads of the generated tarball, if this happens navigate to the "),h.append(jQuery("<strong>").text("Downloads")),h.append(" section of chrome to accept the download"),h.append(jQuery("<br>")),h.append("Window -> Downloads");var i=jQuery("<div>");return void 0!=e&&i.append(e),i.append(g),i.append(h),a.messageService.simple_info("Download info",i).modal("show").attr("id",d),d},a.render_model_class_fields_only=function(b){return b.render_model_class_fields_only(a._app_name,a.render_factory)},a.upload_input=function(){return jQuery('<input type="file" />')},a.upload_drop_target=function(a){var b=jQuery("<div>").addClass("builder_dnd_target text-center"),c=jQuery("<i>").addClass("fa fa-upload fa-4x builder_dnd_icon");return b.append(jQuery("<div>").text("Drag and Drop files here!")),b.append(c),b},a.upload_form=function(a,b){var c=jQuery("<form>"),d=jQuery("<span>").addClass("btn btn-default btn-file center-block builder_upload_models_py");return d.append("Browse"),d.append(a),c.append(d),c.append(b),c},a.save_new_models=function(b){a.new_models=[],a.models=b,a.saveApp(),a.$apply()},a.merge_models=function(){for(var b=a.models.concat(a.new_models),c=0;c<b.length;++c)for(var d=c+1;d<b.length;++d)b[c].name===b[d].name&&b.splice(d--,1);return a.save_new_models(b)},a.add_unique=function(){jQuery.each(a.new_models,function(b,c){a.existingModel(c.name)||a.models.push(c)}),a.save_new_models(a.models)},a.add_new_models=function(b){a.new_models=b,a.$apply();var c=function(){console.log("Overwriting existing models"),a.merge_models()},d=function(){var b=!1,d=[],e=jQuery("<p>").text("The following models are duplicates:");jQuery.each(a.new_models,function(c,f){a.existingModel(f.name)&&(b=!0,d.push(f),e.append(jQuery("<div>").text(f.name)))});var f=d.length==a.new_models.length;if(b){var g=[{text:"Overwrite existing models",callback:c}];f||g.push({text:"Add unique",callback:a.add_unique}),g.push({text:"Cancel",callback:function(){}});var h="duplicate_models";a.messageService.simple_choice("Add duplicate models?",e,g).modal("show").attr("id",h)}else a.merge_models()},e=jQuery("<div>");jQuery.each(a.new_models,function(b,c){e.append(jQuery("<hr>")),e.append(jQuery("<pre>").html(c.render_model_class_fields_only(a._app_name,a.render_factory)));var d=jQuery('<button class="btn btn-danger pull-right">').text("Remove");e.append(d),e.append(jQuery("<div>").addClass("clearfix"))});var f="add_new_models";return a.messageService.simple_confirm("Add the following models?",jQuery("#builder_new_models"),d).modal("show").find(".modal-dialog").css("width","50%").attr("id",f),f},a.process_models_py=function(b){if(0==b.length)a.messageService.simple_error("Sorry","You didn't seem to choose any files.").modal("show");else if(b.length>1)a.messageService.simple_error("Sorry","Multiple files not yet supported, please choose a single file.").modal("show");else{var c=d(a);c.parse(b[0],function(b){a.add_new_models(b)})}},a.upload_models_py=function(){var b=a.upload_input(),c=a.upload_drop_target(),d=a.upload_form(b,c),e=a.messageService.simple_form("Upload models.py","Choose a models.py file to analyse",d,function(){a.process_models_py(jQuery(b)[0].files),e.modal("hide")}).modal("show");b.change(function(){a.process_models_py(jQuery(b)[0].files),e.modal("hide")}),d.on("drag dragstart dragend dragover dragenter dragleave drop",function(a){a.preventDefault(),a.stopPropagation()}).on("dragover dragenter",function(){c.addClass("is-drag-over")}).on("dragleave dragend drop",function(){c.removeClass("is-drag-over")}).on("drop",function(b){var c=b.originalEvent.dataTransfer.files;e.modal("hide"),a.process_models_py(c)})},jQuery("html body").on("drag dragstart dragend dragover dragenter dragleave drop",function(a){a.preventDefault(),a.stopPropagation()}).on("dragover dragenter",function(){}).on("drop",function(a){}),jQuery("#builder_models_content").on("drag dragstart dragend dragover dragenter dragleave drop",function(a){a.preventDefault(),a.stopPropagation()}).on("dragover dragenter",function(){jQuery(".builder_dnd_target").addClass("is-drag-over")}).on("drop",function(b){jQuery(".builder_dnd_target").removeClass("is-drag-over");var c=b.originalEvent.dataTransfer.files;a.process_models_py(c)}),a.aceLoad=function(b){var c=jQuery(b.container).attr("id");"builder_models"==c?b.setValue(a.render_factory.render_models_py(a.app_name(),a.models)):"builder_views"==c?b.setValue(a.render_factory.render_views_py(a.app_name(),a.models)):"builder_admin"==c?b.setValue(a.render_factory.render_admin_py(a.app_name(),a.models)):"builder_urls"==c?b.setValue(a.render_factory.render_urls_py(a.app_name(),a.models)):"builder_tests"==c?b.setValue(a.render_factory.render_tests_py(a.app_name(),a.models)):"builder_forms"==c?b.setValue(a.render_factory.render_forms_py(a.app_name(),a.models)):"builder_django_rest_framework_api"==c?b.setValue(a.render_factory.render_django_rest_framework_api_py(a.app_name(),a.models)):"builder_django_rest_framework_serializers"==c&&b.setValue(a.render_factory.render_django_rest_framework_serializers_py(a.app_name(),a.models)),b.session.selection.clearSelection()},a.reLoadAce=function(){Object.keys(a.editors).map(function(b){a.aceLoad(a.editors[b])})},a.aceLoaded=function(b){b.setOptions({readOnly:!0,highlightActiveLine:!1,highlightGutterLine:!1,maxLines:1/0}),b.renderer.$cursorLayer.element.style.opacity=0,a.aceLoad(b),a.editors.push(b)},a.$watch("[models,_app_name]",function(){a.reLoadAce(),a.saveApp()},!0),a.aceChanged=function(a){},a.do_set_app_name=function(b){a._app_name=b},a.set_app_name=function(){a.do_set_app_name(jQuery("input#appname").val()),a.reLoadAce()},a.do_set_project_name=function(b){a._project_name=b},a.set_project_name=function(){a.do_set_project_name(jQuery("input#projectname").val()),a.reLoadAce()},a.l_app_name=function(){return a._app_name.toLowerCase()},a.app_name=function(){return a._app_name.replace(new RegExp(" ","g"),"_")},a.project_name=function(){return a._project_name.replace(new RegExp(" ","g"),"_")},a.updateModel=function(b){var c=a.models.indexOf(b);a.models[c]=b,a.$apply()},a.serializeApp=function(){var b={models:a.models,app_config:{app_name:a._app_name}};return JSON.stringify(b)},a.saveApp=function(){g.set(a.models_storage_key,a.serializeApp())},a.doClearModels=function(){g.set(a.models_storage_key,""),a.loadModels(),a.models=[],a.$apply()},a.clearModels=function(){var b=function(){a.doClearModels()},c="clear_all";return a.messageService.simple_confirm("Confirm","Remove all models?",b).modal("show").attr("id",c),c},a.model_count=function(){return a.models.length},a.add_model=function(b){var d={name:b};d.fields=[a.field_factory.make_field({name:"name",type:"django.db.models.CharField",opts:"max_length=255"}),a.field_factory.make_field({name:"slug",type:"django_extensions.db.fields.AutoSlugField",opts:"populate_from='name', blank=True"}),a.field_factory.make_field({name:"created",type:"django.db.models.DateTimeField",opts:"auto_now_add=True, editable=False"}),a.field_factory.make_field({name:"last_updated",type:"django.db.models.DateTimeField",opts:"auto_now=True, editable=False"})];var e=c(d,a);a.models.push(e),a.saveApp(),a.$apply()},a.existingModel=function(b){var c=!1;return jQuery.each(a.models,function(a,d){b==d.name&&(c=!0)}),c},a.addModel=function(){var b=function(b){void 0==b||""===b?a.messageService.simple_info("Model Name Required","Enter a Model name").modal("show"):a.existingModel(b)?a.messageService.simple_error("Error with Model Name","There is already a model with the name "+b).modal("show"):a.add_model(b)},c="add_model";return a.messageService.simple_input("Model Name Required","Enter a Model name","Model1",b,!0).modal("show").attr("id",c),c},a.cleanModel=function(a){delete a.$$hashKey,void 0!=a.fields&&jQuery.each(a.fields,function(a,b){delete b.$$hashKey}),void 0!=a.relationships&&jQuery.each(a.relationships,function(a,b){delete b.$$hashKey})},a.loadModels=function(){var b=g.get(a.models_storage_key)||{models:[],app_config:{app_name:"app_name"}};"string"==typeof b&&(b=JSON.parse(b));var c=b.models||[],d=b.app_config||{app_name:"app_name"};return a._app_name=d.app_name,jQuery.each(c,function(b,c){a.cleanModel(c)}),c},a.loadModel=function(b){var d=c(b,a);a.models.push(d)},a.__init__=function(){jQuery.each(a.loadModels(),function(b,c){a.loadModel(c)})},a.__init__(),a.debug=function(){},a.do_rename_model=function(b,c){var d="rename_model_existing",e=a.models[b];a.existingModel(c)?a.messageService.simple_error("Error with Model Name","There is already a model with the name "+c).modal("show").attr("id",d):(e.set_name(c),a.updateModel(e),a.$apply())},a.rename_model=function(b){var c=a.models[b],d="rename_model",e=function(c){a.do_rename_model(b,c)};return a.messageService.simple_input("Rename model","Enter a new Model name",c.name,e,!0).modal("show").attr("id",d),d},a.add_relationship=function(b){const c=a.models[b],d=function(b){var d=b.find("input[name=name]").val().trim(),e=b.find("select[name=to]").val().trim(),f=!0;if(jQuery.each(a.built_in_models,function(a,b){e==a&&(f=!1)}),jQuery.each(a.models,function(a,b){e==b.name&&(f=!1)}),b.find("div.form-group-name").removeClass("has-error"),b.find("div.form-group-to").removeClass("has-error"),void 0===d||""===d)b.find("div.form-group-name").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text("Field Required");else if(void 0===e||""===e)b.find("div.form-group-to").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text("Field Required");else if(c.has_relationship(d))b.find("div.form-group-name").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text('Field "'+d+'" exists');else{var g=b.find("select[name=type]").val(),h=b.find("input[name=opts]").val(),i=a.relationship_factory.make_relationship({name:d,type:g,opts:h,to:e,external_app:f});c.relationships.push(i),a.updateModel(c),a.$apply(),jQuery(".modal").modal("hide")}},e=jQuery("<form>"),f=jQuery("<div>").addClass("form-group form-group-name has-feedback").appendTo(e),g=jQuery("<div>").addClass("form-group form-group-to").appendTo(e),h=jQuery("<div>").addClass("form-group form-group-type").appendTo(e),i=jQuery("<div>").addClass("form-group form-group-args").appendTo(e);f.append(jQuery("<label>").text("Name")),f.append(jQuery("<input>").attr("name","name").addClass("form-control")),f.append(jQuery("<span>").text("error message").addClass("help-block hide"));const j=jQuery("<select>").attr("name","to").addClass("form-control"),k=jQuery("<optgroup>").attr("label","Django models");jQuery.each(a.built_in_models,function(a,b){k.append(jQuery("<option>").attr("val",a).text(a))}),j.append(k);const l=jQuery("<optgroup>").attr("label","Your App models");jQuery.each(a.models,function(a,b){l.append(jQuery("<option>").attr("val",b.name).text(b.name))}),j.append(l),g.append(jQuery("<label>").text("Relationship to Model")),g.append(j),g.append(jQuery("<p>").addClass("text-primary small clearfix").text("You can add external models (otherapp.models.Model1)").css("margin","4px"));const m=jQuery("<select>").attr("name","type");jQuery.each(a.relationship_factory.relationship_types(),function(a,b){m.append(jQuery("<option>").attr("val",b).text(b))}),h.append(jQuery("<label>").text("Relationship Type")),h.append(m),i.append(jQuery("<label>").text("Arguments")),i.append(jQuery("<input>").attr("name","opts").attr("placeholder","options").addClass("form-control")),j.select2({theme:"bootstrap",allowClear:!0,placeholder:"Select a model.",tags:!0,selectOnClose:!0}),m.select2({theme:"bootstrap"});const n="add_rel_"+c.name+"_"+b;return a.messageService.simple_form_no_dismiss("Add Relationship","",e,d).modal("show").attr("id",n).appendTo("body"),
n},a.add_field=function(b){var c=a.models[b],d=function(b){var d=b.find("input[name=name]").val();if(void 0===d||""===d)b.find("div.form-group-name").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text("Field Required");else if(c.has_field(d))b.find("div.form-group-name").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text('Field "'+d+'" exists');else{var e=b.find("select[name=type]").val(),f=b.find("input[name=opts]").val(),g=a.field_factory.make_field({name:d,type:e,opts:f});c.fields.push(g),a.updateModel(c),a.$apply(),jQuery(".modal").modal("hide")}},e=jQuery("<form>"),f=jQuery("<div>").addClass("form-group form-group-name  has-feedback").appendTo(e),g=jQuery("<div>").addClass("form-group form-group-type").appendTo(e),h=jQuery("<div>").addClass("form-group form-group-args").appendTo(e);f.append(jQuery("<label>").text("Name")),f.append(jQuery("<input>").attr("name","name").addClass("form-control")),f.append(jQuery("<span>").text("error message").addClass("help-block hide"));var i=jQuery("<select>").attr("name","type").addClass("form-control");jQuery.each(a.field_factory.field_types(),function(a,b){i.append(jQuery("<option>").attr("val",b).text(b))});var j=jQuery("<input>").attr("name","opts").attr("placeholder","options").addClass("form-control");g.append(jQuery("<label>").text("Field Type")),g.append(i),h.append(jQuery("<label>").text("Arguments")),h.append(j),i.change(function(){j.val(a.field_factory.default_field_args(i.val()))}),j.val(a.field_factory.default_field_args(i.val()));var k="add_field_"+c.name+"_"+b;return a.messageService.simple_form_no_dismiss("Add Field","",e,d).modal("show").attr("id",k).appendTo("body"),k},a.edit_relationship=function(b,c){var d=a.models[b].relationships[c],e=function(b){d.form_update(b),a.$apply(),jQuery(".modal").modal("hide")},f=d.$$hashKey||"edit_relationship_"+d.name;return a.messageService.simple_form("Edit Relationship '"+d.name+"'","",d.edit_form(a),e).modal("show").attr("id",f).appendTo("body"),f},a.edit_field=function(b,c){var d=a.models[b].fields[c],e=function(b){d.form_update(b),a.$apply(),jQuery(".modal").modal("hide")},f=d.$$hashKey||"edit_field_"+d.name;return a.messageService.simple_form("Edit field '"+d.name+"'","",d.edit_form(a),e).modal("show").attr("id",f).appendTo("body"),f},a.do_remove_new_model=function(b){a.new_models.splice(b,1),a.$apply()},a.remove_new_model=function(b){setTimeout(function(){a.do_remove_new_model(b)})},a.remove_relationship=function(b,c){var d=function(){a.models[b].relationships.splice(c,1),a.$apply()},e=a.models[b].relationships[c],f=e.$$hashKey||"remove_relationship_"+e.name;return a.messageService.simple_confirm("Confirm","Remove the relationship '"+e.name+"'",d).modal("show").attr("id",f).appendTo("body"),f},a.do_remove_new_relationship=function(b,c){a.new_models[b].relationships.splice(c,1)},a.remove_new_relationship=function(b,c){setTimeout(function(){a.do_remove_new_relationship(b,c)})},a.do_remove_new_field=function(b,c){a.new_models[b].fields.splice(c,1),a.$apply()},a.remove_new_field=function(b,c){setTimeout(function(){a.do_remove_new_field(b,c)})},a.remove_field=function(b,c){var d=function(){a.models[b].fields.splice(c,1),a.$apply()},e=a.models[b].fields[c],f=e.$$hashKey||"remove_field_"+e.name;return a.messageService.simple_confirm("Confirm","Remove the field '"+e.name+"'",d).modal("show").attr("id",f).appendTo("body"),f},a.remove_model=function(b){var c=function(){a.models.splice(b,1),a.$apply()},d=a.models[b],e=d.$$hashKey||"remove_model_"+d.name;return a.messageService.simple_confirm("Confirm","Remove the model '"+d.name+"'",c).modal("show").modal("show").attr("id",e).appendTo("body"),e},a.model_highlight=function(b,c){var d=a.models[b].relationships[c];jQuery(".builder_model_"+d.to_clean()).addClass("builder_model_highlight")},a.model_unhighlight=function(){jQuery(".builder_model").removeClass("builder_model_highlight")},a.new_model_highlight=function(b,c){var d=a.new_models[b].relationships[c];jQuery(".builder_model_"+d.to_clean()).addClass("builder_model_highlight")},a.new_model_unhighlight=function(){jQuery(".builder_model").removeClass("builder_model_highlight")}}]),angular.module("builder.directives",[]).directive("appVersion",["version",function(a){return function(b,c,d){c.text(a)}}]),angular.module("builder.filters",[]).filter("interpolate",["version",function(a){return function(b){return String(b).replace(/\%VERSION\%/gm,a)}}]),angular.module("builder.services",[]).factory("ModelFactory",[ModelServiceFactory]).factory("ModelParser",[ModelParserFactory]).factory("MessageService",[MessageServiceFactory]).factory("FieldFactory",[FieldFactory]).factory("RelationshipFactory",[RelationshipFactory]).factory("RenderFactory",[ModelRenderFactory]).factory("TarballFactory",[TarballFactory]).value("version","0.1");
>>>>>>> Update libs and tests
=======
function TarballFactory(){return function(){function a(){var a=this,b=require("tar-js"),c=new b;a.uInt8ToString=function(a){var b,c,d="";for(b=0,c=a.length;b<c;b+=1)d+=String.fromCharCode(a[b]);return d},a.append=function(a,b){c.append(a,b)},a.get_url=function(b){var d=btoa(a.uInt8ToString(c.out));return"data:application/tar;base64,"+d}}return new a}}function ModelRenderFactory(){return function(a){var b=this;b.built_in_models=a,b.spaces=function(a){var b=a||1;return new Array(b+1).join(" ")},b.model_names=function(a,b){var c=b||"";return Object.keys(a).map(function(b){return a[b].name+c})},b.new_lines=function(a){var b=a||1;return new Array(b+1).join("\n")},b.render_all=function(a,c){var d="";return d+=b.render_base_html(a,c),d+=b.render_forms_py(a,c),d+=b.render_urls_py(a,c),d+=b.render_admin_py(a,c),d+=b.render_views_py(a,c),d+=b.render_models_py(a,c),d+=b.render_django_rest_framework_api_py(a,c),d+=b.render_django_rest_framework_serializers_py(a,c),d+=b.render_templates_html(a,c)},b.render_base_html=function(a,b){return"<html><head></head><body>{% block content %}Replace this.{% endblock %}</body>"},b.pre_imported_modules=function(a){return{"django.contrib.auth.models":{as:"auth_models"},"django.db.models":{as:"models"},"django_extensions.db.fields":{as:"extension_fields"}}},b.pre_imported_modules_names=function(a){return Object.keys(b.pre_imported_modules())},b.replace_in_template=function(a,b){return jQuery.each(b,function(b,c){a=a.replace(new RegExp(c[0],"g"),c[1])}),a},b.render_project_manage_py=function(a,c){var d=c.get("manage.py_1.10");return b.replace_in_template(d,[["___PROJECT_NAME___",a]])},b.render_project_requirements=function(){var a="Django==1.10.3\n";return a+="django-crispy-forms==1.6.1\n",a+="django-extensions==1.7.5\n",a+="djangorestframework==3.5.3\n"},b.render_project_settings_py=function(a,c,d){var e=d.get("settings.py_1.10");return console.log("manage_template",e),b.replace_in_template(e,[["___PROJECT_NAME___",a],["___APP_NAME___",c]])},b.render_project_wsgi_py=function(a,c){var d=c.get("wsgi.py_1.10");return b.replace_in_template(d,[["___PROJECT_NAME___",a]])},b.render_project_urls_py=function(a,c){var d=c.get("urls.py_1.10");return b.replace_in_template(d,[["___APP_NAME___",a]])},b.render_forms_py=function(a,c){var d="from django import forms\n";return d+="from .models import "+b.model_names(c,"").join(", ")+"\n",d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_forms(a,b)}),d},b.render_tests_py=function(a,c){var d="import unittest\nfrom django.core.urlresolvers import reverse\nfrom django.test import Client\n";return d+="from .models import "+b.model_names(c,"").join(", ")+"\n",jQuery.each(b.built_in_models,function(a,c){var e=a.split("."),f=e.pop(),g=e.join(".");d+="from "+g+" import "+f,d+=b.new_lines(1)}),d+=b.new_lines(2),jQuery.each(b.built_in_models,function(a,c){var e="create_"+a.toLowerCase().replace(/\./g,"_"),f=a.split(".").pop(),g="";g+="def "+e+"(**kwargs):\n",g+=b.spaces(4)+"defaults = {}\n",jQuery.each(c.fields,function(a,c){g+=b.spaces(4)+'defaults["'+a+'"] = "'+c.default+'"\n'}),g+=b.spaces(4)+"defaults.update(**kwargs)\n",g+=b.spaces(4)+"return "+f+".objects.create(**defaults)\n",g+=b.new_lines(2),d+=g}),jQuery.each(c,function(c,e){d+=e.render_tests_helpers(a,b)}),jQuery.each(c,function(c,e){d+=e.render_tests(a,b)}),d},b.render_urls_py=function(a,c){var d="from django.conf.urls import url, include\n";return d+="from rest_framework import routers"+b.new_lines(1),d+="import api"+b.new_lines(1),d+="import views"+b.new_lines(2),d+="router = routers.DefaultRouter()"+b.new_lines(1),jQuery.each(c,function(a,c){d+="router.register(r'"+c.l_name()+"', api."+c.name+"ViewSet)"+b.new_lines(1)}),d+=b.new_lines(2),d+="urlpatterns = ("+b.new_lines(1),d+=b.spaces(4)+"# urls for Django Rest Framework API"+b.new_lines(1),d+=b.spaces(4)+"url(r'^api/v1/', include(router.urls)),"+b.new_lines(1),d+=")"+b.new_lines(1),d+=b.new_lines(1),jQuery.each(c,function(c,e){d+=e.render_urls(a,b)}),d},b.render_admin_py=function(a,c){var d="from django.contrib import admin\nfrom django import forms\n";return d+="from .models import "+b.model_names(c).join(", "),d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_admin_classes(a,b)}),d},b.render_views_py=function(a,c){var d="from django.views.generic import DetailView, ListView, UpdateView, CreateView\n";return d+="from .models import "+b.model_names(c).join(", "),d+=b.new_lines(1),d+="from .forms import "+b.model_names(c,"Form").join(", "),d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_view_classes(a,b)}),d},b.render_models_py=function(a,c){var d="from django.core.urlresolvers import reverse\n";d+="from django_extensions.db.fields import AutoSlugField\n",d+="from django.db.models import *\n",d+="from django.conf import settings\n",d+="from django.contrib.contenttypes.fields import GenericForeignKey\n",d+="from django.contrib.contenttypes.models import ContentType\n",d+="from django.contrib.auth import get_user_model\n",jQuery.each(b.pre_imported_modules(),function(a,b){var c=a.split("."),e=c.pop();d+="from "+c.join(".")+" import "+e+" as "+b.as+"\n"});var e={};jQuery.each(c,function(a,b){jQuery.each(b.fields,function(a,b){e[b.module()]=b.module()})});var f={};return jQuery.each(c,function(a,b){jQuery.each(b.fields,function(a,b){f[b.type]=b}),jQuery.each(b.relationships,function(a,b){f[b.type]=b})}),jQuery.each(f,function(a,b){}),d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_model_class(a,b)}),d},b.render_templates_html=function(a,b){var c=[];return jQuery.each(b,function(b,d){c.push([d.l_name()+"_form.html",d.render_form_html(a)]),c.push([d.l_name()+"_detail.html",d.render_detail_html(a)]),c.push([d.l_name()+"_list.html",d.render_list_html(a)])}),c},b.render_django_rest_framework_api_py=function(a,c){var d="import models\n";return d+="import serializers\n",d+="from rest_framework import viewsets, permissions\n",d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_model_api(a,b)}),d},b.render_django_rest_framework_serializers_py=function(a,c){var d="import models";return d+=b.new_lines(2),d+="from rest_framework import serializers",d+=b.new_lines(3),jQuery.each(c,function(c,e){d+=e.render_model_serializer(a,b)}),d}}}function MessageServiceFactory(){return function(){var a=this;a.base_modal=function(){var a=jQuery("<div>").addClass("modal fade");a.attr("tabindex","-1"),a.attr("role","dialog"),a.css("display","none");var b=jQuery("<div>").addClass("modal-dialog"),c=jQuery("<div>").addClass("modal-content").appendTo(b),d=jQuery("<h2>").addClass("modal-header-inner");return jQuery("<div>").addClass("modal-header").appendTo(c).append(d),jQuery("<div>").addClass("modal-body").appendTo(c),jQuery("<div>").addClass("modal-footer").appendTo(c),a.append(b),a},a.icon=function(a){return jQuery("<icon>").addClass("fa").addClass(a)},a.simple_error=function(b,c){var d=a.base_modal(),e=a.icon("fa-info").addClass("pull-right");d.find(".modal-header-inner").append(e).append(jQuery("<span>").text(b)),d.find(".modal-body").empty().append(c);var f=jQuery("<button>").addClass("btn btn-default").text("Ok");return d.find(".modal-footer").append(f),f.attr("data-dismiss","modal"),d.modal(),d},a.simple_info=function(b,c){var d=a.base_modal(),e=a.icon("fa-info").addClass("pull-right");d.find(".modal-header-inner").append(e).append(jQuery("<span>").text(b)),d.find(".modal-body").empty().append(c);var f=jQuery("<button>").addClass("btn btn-default").text("Ok");return d.find(".modal-footer").append(f),f.attr("data-dismiss","modal"),d.modal(),d},a.simple_confirm=function(b,c,d){var e=d||jQuery.noop,f=a.base_modal();f.find(".modal-header-inner").html(b),f.find(".modal-body").empty().append(c);var g=jQuery("<button>").addClass("btn btn-primary").text("Ok"),h=jQuery("<button>").addClass("btn btn-default").text("Cancel");return f.find(".modal-footer").append(g).append(h),g.click(function(){e()}),h.attr("data-dismiss","modal"),g.attr("data-dismiss","modal"),f.modal(),f},a.simple_choice=function(b,c,d){var e=a.base_modal();return e.find(".modal-header-inner").html(b),e.find(".modal-body").empty().append(c),jQuery.each(d,function(a,b){var c=jQuery("<button>").addClass("btn btn-primary").text(b.text);e.find(".modal-footer").append(c),c.click(function(){b.callback()}),c.attr("data-dismiss","modal")}),e.modal(),e},a.simple_form=function(b,c,d,e,f){var g=e||jQuery.noop,h=f||!0,i=a.base_modal();i.find(".modal-header-inner").html(b),i.find(".modal-body").empty().append(c).append(d);var j=jQuery("<button>").addClass("btn btn-primary").text("Ok"),k=jQuery("<button>").addClass("btn btn-default").text("Cancel");return i.find(".modal-footer").append(j).append(k),j.click(function(){h||i.modal("hide"),g(d)}),k.attr("data-dismiss","modal"),h||j.attr("data-dismiss","modal"),i.modal(),i},a.simple_form_no_dismiss=function(b,c,d,e){return a.simple_form(b,c,d,e,!0)},a.simple_input=function(b,c,d,e,f){var g=e||jQuery.noop,h=f||!1,i=a.base_modal();i.find(".modal-header-inner").html(b);var j=jQuery("<label>").text(c),k=jQuery("<input>").attr("type","text").attr("name","input").addClass("form-control").attr("value",d),l=jQuery("<span>").text("error message").addClass("help-block hide"),m=jQuery("<div>").addClass("form-group form-group-input has-feedback").append(j).append(k).append(l),n=function(){var a=k.val();!h||""!=a&&void 0!=k?(i.modal("hide"),g(a)):m.addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text("Field Required")},o=jQuery("<form>").append(m).submit(function(a){a.preventDefault(),n()});i.find(".modal-body").empty().append(o);var p=jQuery("<button>").addClass("btn btn-primary").text("Ok"),q=jQuery("<button>").addClass("btn btn-default").text("Cancel");return i.find(".modal-footer").append(p).append(q),p.click(n),q.attr("data-dismiss","modal"),h||p.attr("data-dismiss","modal"),i.modal(),i}}}function RelationshipFactory(){return function(a){function b(a){this.name=a.name,this.type=a.type,this.opts=a.opts,this.to=a.to,this.external_app=a.external_app||!1,this.class_name=function(){return this.type.split(".").reverse()[0]},this.form_update=function(a){this.name=jQuery(a).find("input[name=name]").val(),this.type=jQuery(a).find("select[name=type]").val(),this.opts=jQuery(a).find("input[name=opts]").val(),this.to=jQuery(a).find("input[name=to]").val()},this.to_clean=function(){return this.to.replace(/['"]+/g,"")},this.to_class=function(){return this.to.split(".").reverse().shift()},this.opts_args=function(){return this.opts.split(",").join(", ")},this.to_module=function(){var a=this.to.split(".");return a.slice(0,a.length-1).join(".")},this.module=function(){var a=this.type.split(".");return a.slice(0,a.length-1).join(".")},this.edit_form=function(a){var b=jQuery("<form>"),c=jQuery("<div>").addClass("form-group form-group-name has-feedback").appendTo(b),d=jQuery("<div>").addClass("form-group form-group-type").appendTo(b),e=jQuery("<div>").addClass("form-group form-group-args").appendTo(b),f=jQuery("<div>").addClass("form-group form-group-args").appendTo(b);c.append(jQuery("<label>").text("Name")),c.append(jQuery("<input>").attr("name","name").addClass("form-control").val(this.name)),c.append(jQuery("<span>").text("error message").addClass("help-block hide")),d.append(jQuery("<label>").text("To")),d.append(jQuery("<input>").attr("name","to").attr("placeholder","to").addClass("form-control").val(this.to));var g=jQuery("<select>").attr("name","type").addClass("form-control"),h=this;return jQuery.each(a.relationship_factory.relationship_types(),function(a,b){var c=jQuery("<option>").attr("val",b).text(b);b==h.type&&c.attr("selected","selected"),g.append(c)}),e.append(jQuery("<label>").text("Field Type")),e.append(g),f.append(jQuery("<label>").text("Arguments")),f.append(jQuery("<input>").attr("name","opts").attr("placeholder","options").addClass("form-control").val(this.args)),b}}var c=this;c.relationship_types=function(){return["django.db.models.ForeignKey","django.db.models.OneToOneField","django.db.models.ManyToManyField"]},c.relationship_matches=function(){return c.relationship_types+["ForeignKey","OneToOneField","ManyToManyField","models.ForeignKey","models.OneToOneField","models.ManyToManyField"]},c.relationship_match=function(a){return c.relationship_matches().indexOf(a)!=-1},c.make_relationship=function(a){return new b(a)}}}function FieldFactory(){return function(a){function b(a){this.name=a.name,this.type=a.type,this.opts=a.opts||"",this.class_name=function(){return this.type.split(".").reverse()[0]},this.opts_args=function(){return this.opts.split(",").join(", ")},this.to_clean=function(){return this.to.replace(/['"]+/g,"")},this.module=function(){var a=this.type.split(".");return a.slice(0,a.length-1).join(".")},this.form_update=function(a){this.name=jQuery(a).find("input[name=name]").val(),this.type=jQuery(a).find("select[name=type]").val(),this.opts=jQuery(a).find("input[name=opts]").val()},this.edit_form=function(a){var b=jQuery("<form>"),c=jQuery("<div>").addClass("form-group form-group-name has-feedback").appendTo(b),d=jQuery("<div>").addClass("form-group form-group-type").appendTo(b),e=jQuery("<div>").addClass("form-group form-group-args").appendTo(b);c.append(jQuery("<label>").text("Name")),c.append(jQuery("<input>").attr("name","name").addClass("form-control").val(this.name)),c.append(jQuery("<span>").text("error message").addClass("help-block hide"));var f=jQuery("<select>").attr("name","type").addClass("form-control"),g=this;return jQuery.each(a.field_factory.field_types(),function(a,b){var c=jQuery("<option>").attr("val",b).text(b);b==g.type&&c.attr("selected","selected"),f.append(c)}),d.append(jQuery("<label>").text("Field Type")),d.append(f),e.append(jQuery("<label>").text("Arguments")),e.append(jQuery("<input>").attr("name","opts").attr("placeholder","options").addClass("form-control").val(this.opts)),b}}var c=this;c.fields=function(){return{"django.db.models.TextField":{default_args:"max_length=100"},"django.db.models.CharField":{default_args:"max_length=30"},"django.contrib.contenttypes.fields.GenericForeignKey":{default_args:'"content_type", "object_id"'},"django_extensions.db.fields.AutoSlugField":{},"django.db.models.CommaSeparatedIntegerField":{},"django.db.models.BigAutoField":{},"django.db.models.BigIntegerField":{},"django.db.models.BooleanField":{},"django.db.models.DateField":{},"django.db.models.DateTimeField":{},"django.db.models.DecimalField":{default_args:"max_digits=10, decimal_places=2"},"django.db.models.DurationField":{},"django.db.models.FileField":{default_args:'upload_to="/upload/files/"'},"django.db.models.ImageField":{default_args:'upload_to="/upload/images/"'},"django.db.models.FilePathField":{},"django.db.models.FloatField":{},"django.db.models.IntegerField":{},"django.db.models.PositiveIntegerField":{},"django.db.models.PositiveSmallIntegerField":{},"django.db.models.SlugField":{},"django.db.models.IPAddressField":{},"django.db.models.GenericIPAddressField":{},"django.db.models.NullBooleanField":{},"django.db.models.TimeField":{},"django.db.models.BinaryField":{},"django.db.models.AutoField":{},"django.db.models.SmallIntegerField":{},"django.db.models.URLField":{},"django.db.models.UUIDField":{},"django.db.models.EmailField":{}}},c.default_field_args=function(a){var b=c.fields()[a];return b&&b.default_args?b.default_args:""},c.field_types=function(){return Object.keys(c.fields())},c.make_field=function(a){return new b(a)}}}function ModelServiceFactory(){return function(a,b){function c(a){this.slugify=function(a){return a.toString().replace(/\s+/g,"").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"").replace(/^-+/,"").replace(/-+$/,"")},this.set_name=function(a){this.name=this.slugify(a)},this.set_name(a.name),this.fields=[];a.fields||[];this.fields=(a.fields||[]).map(b.field_factory.make_field),this.relationships=(a.relationships||[]).map(b.relationship_factory.make_relationship),this.relationship_names=function(){var a=this;return Object.keys(a.relationships).map(function(b){return a.relationships[b].name})},this.field_names=function(){var a=this;return Object.keys(a.fields).map(function(b){return a.fields[b].name})},this.l_name=function(){return this.name.toLowerCase()},this.has_relationship=function(a){return this.relationship_names().indexOf(a)!=-1},this.has_field=function(a){return this.field_names().indexOf(a)!=-1},this.name_field=function(){return this.field_names().indexOf("name")!=-1?"name":"id"},this.ordering_field=function(){return this.field_names().indexOf("created")!=-1?"created":"id"},this.identifier=function(){return this.field_names().indexOf("slug")!=-1?"slug":"id"},this.render_forms=function(a,b){var c="";return c+="class "+this.name+"Form(forms.ModelForm):\n",c+=b.spaces(4)+"class Meta:\n",c+=b.spaces(8)+"model = "+this.name+"\n",this.form_fields()&&(c+=b.spaces(8)+"fields = "+this.form_fields()+"\n"),c+=b.new_lines(2)},this.get_initial_data=function(a,b){var c="{";return c+=b.new_lines(1),jQuery.each(this.readable_fields(),function(a,d){c+=b.spaces(12)+'"'+d.name+'": "'+d.name+'",',c+=b.new_lines(1)}),jQuery.each(this.relationships,function(a,d){c+=b.spaces(12)+'"'+d.name+'": create_'+d.to.toLowerCase().replace(/\./g,"_")+"().id,",c+=b.new_lines(1)}),c+=b.spaces(8)+"}"},this.render_tests_helpers=function(a,b){var c="";return c+="def create_"+this.l_name()+"(**kwargs):\n",c+=b.spaces(4)+"defaults = {}\n",jQuery.each(this.readable_fields(),function(a,d){c+=b.spaces(4)+'defaults["'+d.name+'"] = "'+d.name+'"\n'}),c+=b.spaces(4)+"defaults.update(**kwargs)\n",jQuery.each(this.relationships,function(a,d){c+=b.spaces(4)+'if "'+d.name+'" not in defaults:\n';var e="create_"+d.to.toLowerCase().replace(/\./g,"_");b.built_in_models[d.to]&&(e="create_"+d.to.toLowerCase().replace(/\./g,"_")),c+=b.spaces(8)+'defaults["'+d.name+'"] = '+e+"()\n"}),c+=b.spaces(4)+"return "+this.name+".objects.create(**defaults)\n",c+=b.new_lines(2)},this.render_tests=function(a,b){var c="";return c+="class "+this.name+"ViewTest(unittest.TestCase):\n",c+=b.spaces(4)+"'''\n",c+=b.spaces(4)+"Tests for "+this.name+"\n",c+=b.spaces(4)+"'''\n",c+=b.spaces(4)+"def setUp(self):\n",c+=b.spaces(8)+"self.client = Client()\n",c+=b.new_lines(1),c+=b.spaces(4)+"def test_list_"+this.l_name()+"(self):\n",c+=b.spaces(8)+"url = reverse('"+a+"_"+this.l_name()+"_list')\n",c+=b.spaces(8)+"response = self.client.get(url)\n",c+=b.spaces(8)+"self.assertEqual(response.status_code, 200)\n",c+=b.new_lines(1),c+=b.spaces(4)+"def test_create_"+this.l_name()+"(self):\n",c+=b.spaces(8)+"url = reverse('"+a+"_"+this.l_name()+"_create')\n",c+=b.spaces(8)+"data = "+this.get_initial_data(a,b)+"\n",c+=b.spaces(8)+"response = self.client.post(url, data=data)\n",c+=b.spaces(8)+"self.assertEqual(response.status_code, 302)\n",c+=b.new_lines(1),c+=b.spaces(4)+"def test_detail_"+this.l_name()+"(self):\n",c+=b.spaces(8)+this.l_name()+" = create_"+this.l_name()+"()\n",c+=b.spaces(8)+"url = reverse('"+a+"_"+this.l_name()+"_detail', args=["+this.l_name()+"."+this.identifier()+",])\n",c+=b.spaces(8)+"response = self.client.get(url)\n",c+=b.spaces(8)+"self.assertEqual(response.status_code, 200)\n",c+=b.new_lines(1),c+=b.spaces(4)+"def test_update_"+this.l_name()+"(self):\n",c+=b.spaces(8)+this.l_name()+" = create_"+this.l_name()+"()\n",c+=b.spaces(8)+"data = "+this.get_initial_data(a,b)+"\n",c+=b.spaces(8)+"url = reverse('"+a+"_"+this.l_name()+"_update', args=["+this.l_name()+"."+this.identifier()+",])\n",c+=b.spaces(8)+"response = self.client.post(url, data)\n",c+=b.spaces(8)+"self.assertEqual(response.status_code, 302)\n",c+=b.new_lines(2)},this.render_urls=function(a,b){var c="";return c+="urlpatterns += (\n",c+=b.spaces(4)+"# urls for "+this.name+"\n",c+=b.spaces(4)+"url(r'^"+a+"/"+this.l_name()+"/$', views."+this.name+"ListView.as_view(), name='"+a+"_"+this.l_name()+"_list'),\n",c+=b.spaces(4)+"url(r'^"+a+"/"+this.l_name()+"/create/$', views."+this.name+"CreateView.as_view(), name='"+a+"_"+this.l_name()+"_create'),\n",c+=b.spaces(4)+"url(r'^"+a+"/"+this.l_name()+"/detail/(?P<"+this.identifier()+">\\S+)/$', views."+this.name+"DetailView.as_view(), name='"+a+"_"+this.l_name()+"_detail'),\n",c+=b.spaces(4)+"url(r'^"+a+"/"+this.l_name()+"/update/(?P<"+this.identifier()+">\\S+)/$', views."+this.name+"UpdateView.as_view(), name='"+a+"_"+this.l_name()+"_update'),\n",c+=")\n",c+=b.new_lines(1)},this.render_admin_classes=function(a,b){var c="";c+="class "+this.name+"AdminForm(forms.ModelForm):\n",c+=b.new_lines(1),c+=b.spaces(4)+"class Meta:\n",c+=b.spaces(8)+"model = "+this.name+"\n",c+=b.spaces(8)+"fields = '__all__'\n",c+=b.new_lines(2),c+="class "+this.name+"Admin(admin.ModelAdmin):\n",c+=b.spaces(4)+"form = "+this.name+"AdminForm\n";var d=this.admin_fields();return d.length>0?(c+=b.spaces(4)+"list_display = "+this.admin_fields()+"\n",c+=b.spaces(4)+"readonly_fields = "+this.admin_read_only_fields()+"\n"):c+=b.new_lines(1),c+=b.new_lines(1),c+="admin.site.register("+this.name+", "+this.name+"Admin)\n",c+=b.new_lines(2)},this.render_view_classes=function(a,b){var c=b.new_lines(1);return c+="class "+this.name+"ListView(ListView):\n",c+=b.spaces(4)+"model = "+this.name+"\n",c+=b.new_lines(2),c+="class "+this.name+"CreateView(CreateView):\n",c+=b.spaces(4)+"model = "+this.name+"\n",c+=b.spaces(4)+"form_class = "+this.name+"Form\n",c+=b.new_lines(2),c+="class "+this.name+"DetailView(DetailView):\n",c+=b.spaces(4)+"model = "+this.name+"\n",c+=b.new_lines(2),c+="class "+this.name+"UpdateView(UpdateView):\n",c+=b.spaces(4)+"model = "+this.name+"\n",c+=b.spaces(4)+"form_class = "+this.name+"Form",c+=b.new_lines(2)},this.render_model_class_header=function(a,b){var c="class "+this.name+"(models.Model):";return c+b.new_lines(2)},this.render_model_class_fields=function(a,b){var c="";return this.fields.length>0&&(c+=b.spaces(4)+"# Fields",c+=b.new_lines(1)),jQuery.each(this.fields,function(a,d){if(b.pre_imported_modules_names().indexOf(d.module())==-1)c+=b.spaces(4)+d.name+" = "+d.class_name()+"("+d.opts+")";else{var e=b.pre_imported_modules()[d.module()].as;c+=b.spaces(4)+d.name+" = "+e+"."+d.class_name()+"("+d.opts+")"}c+=b.new_lines(1)}),c+=b.new_lines(1)},this.render_model_class_relationships=function(a,c){var d="";return this.relationships.length>0&&(d+=c.spaces(4)+"# Relationship Fields",d+=c.new_lines(1)),jQuery.each(this.relationships,function(e,f){var g="'"+a+"."+f.to_clean()+"'";if(f.external_app&&(g="'"+f.to_clean()+"'"),f.to==b.user_model?g=b.user_model_setting:c.built_in_models[f.to]&&(g=f.to_class()),c.pre_imported_modules_names().indexOf(f.module())==-1)d+=c.spaces(4)+f.name+" = "+f.class_name()+"("+g+", "+f.opts+")";else{var h=c.pre_imported_modules()[f.module()].as;d+=c.spaces(4)+f.name+" = "+h+"."+f.class_name()+"("+g+", "+f.opts+")"}d+=c.new_lines(1)}),d},this.render_model_class=function(a,b){var c=this.render_model_class_header(a,b);return c+=this.render_model_class_fields(a,b),c+=this.render_model_class_relationships(a,b),c+=b.new_lines(1),c+=b.spaces(4)+"class Meta:",c+=b.new_lines(1),c+=b.spaces(8)+"ordering = ('-"+this.ordering_field()+"',)",c+=b.new_lines(2),c+=b.spaces(4)+"def __unicode__(self):",c+=b.new_lines(1),c+=b.spaces(8)+"return u'%s' % self."+this.identifier(),c+=b.new_lines(2),c+=b.spaces(4)+"def get_absolute_url(self):",c+=b.new_lines(1),c+=b.spaces(8)+"return reverse('"+a+"_"+this.l_name()+"_detail', args=(self."+this.identifier()+",))",c+=b.new_lines(1),c+=b.new_lines(2),c+=b.spaces(4)+"def get_update_url(self):",c+=b.new_lines(1),c+=b.spaces(8)+"return reverse('"+a+"_"+this.l_name()+"_update', args=(self."+this.identifier()+",))",c+=b.new_lines(3)},this.render_model_class_fields_only=function(a,b){var c="";return c+=this.render_model_class_header(a,b),c+=this.render_model_class_fields(a,b)},this.render_model_api=function(a,b){var c="class "+this.name+"ViewSet(viewsets.ModelViewSet):"+b.new_lines(1);return c+=b.spaces(4)+'"""ViewSet for the '+this.name+' class"""',c+=b.new_lines(2),c+=b.spaces(4)+"queryset = models."+this.name+".objects.all()"+b.new_lines(1),c+=b.spaces(4)+"serializer_class = serializers."+this.name+"Serializer"+b.new_lines(1),c+=b.spaces(4)+"permission_classes = [permissions.IsAuthenticated]"+b.new_lines(1),c+=b.new_lines(2)},this.render_model_serializer=function(a,b){var c="class "+this.name+"Serializer(serializers.ModelSerializer):";c+=b.new_lines(2),c+=b.spaces(4)+"class Meta:"+b.new_lines(1),c+=b.spaces(8)+"model = models."+this.name+b.new_lines(1),c+=b.spaces(8)+"fields = ("+b.new_lines(1),c+=b.spaces(12)+"'"+this.identifier()+"', "+b.new_lines(1);var d=this;return jQuery.each(this.fields,function(a,e){e.name!=d.identifier()&&(c+=b.spaces(12)+"'"+e.name+"', "+b.new_lines(1))}),c+=b.spaces(8)+")"+b.new_lines(3)},this._template_header=function(){return'{% extends "base.html" %}\n{% load static %}\n'},this._template_links=function(a){var b=a+"_"+this.l_name()+"_list";return'<p><a class="btn btn-default" href="{% url \''+b+"' %}\">"+this.name+" Listing</a></p>\n"},this._wrap_block=function(a,b){return"{% block "+a+" %}\n"+b+"\n{% endblock %}"},this.render_form_html=function(a){var b=this._template_header();b+="{% load crispy_forms_tags %}\n";var c=this._template_links(a)+'<form method="post">\n';return c+="{% csrf_token %}\n{{form|crispy}}\n",c+='<button class="btn btn-primary" type="submit">Submit</button>\n',c+="</form>",b+=this._wrap_block("content",c)},this.render_list_html=function(a){var b=a+"_"+this.l_name()+"_create",c=this._template_header(),d=this._template_links(a)+'<table class="table">\n';return d+="<tr>\n",d+="<td>ID</td><td>Link</td>\n",jQuery.each(this.fields,function(a,b){d+="    <td>"+b.name+"</td>\n"}),d+="</tr>\n",d+="{% for object in object_list %}\n",d+="<tr>\n",d+="    <td>{{object.id}}</td>\n",d+='    <td><a href="{{object.get_absolute_url}}">{{object}}</a></td>\n',jQuery.each(this.fields,function(a,b){d+="    <td>{{ object."+b.name+" }}</td>\n"}),d+="</tr>\n",d+="{% endfor %}\n",d+="</table>",d+='<a class="btn btn-primary" href="{% url \''+b+"' %}\">Create new "+this.name+"</a>",c+=this._wrap_block("content",d)},this.render_detail_html=function(a){var b=this._template_header(),c=this._template_links(a)+'<table class="table">\n';return jQuery.each(this.fields,function(a,b){c+="<tr><td>"+b.name+"</td><td>{{ object."+b.name+" }}</td></tr>\n"}),c+="</table>",c+='\n<a class="btn btn-primary" href="{{object.get_update_url}}">Edit '+this.name+"</a>\n",b+=this._wrap_block("content",c)},this.form_fields=function(){var a=this.readable_fields().map(function(a){return a.name}),b=this.relationships.map(function(a){return a.name}),c=a.concat(b);return c.length?"['"+c.join("', '")+"']":"'__all__'"},this.readable_fields=function(){var a=[];return jQuery.each(this.fields,function(b,c){c.opts.indexOf("readonly")==-1&&c.opts.indexOf("editable")==-1&&c.opts.indexOf("auto_now_add")==-1&&"django.contrib.contenttypes.fields.GenericForeignKey"!=c.type&&"django_extensions.db.fields.AutoSlugField"!=c.type&&a.push(c)}),a},this.admin_fields=function(){return this.field_names().length>0?"['"+this.field_names().join("', '")+"']":""},this.admin_read_only_fields=function(){return this.field_names().length>0?"['"+this.field_names().join("', '")+"']":""}}return new c(a)}}function ModelParserFactory(){return function(a){function b(){this.parse=function(b,c){var d=new FileReader;d.onload=function(b){var e=d.result,f=e.split("\n"),g=[],h=null,i="",j=new RegExp("class ([a-zA-Z_]*)[(]([a-zA-Z._]*)[)][:]$"),k=new RegExp("^([a-zA-Z0-9_]+) = ([a-zA-Z0-9._]+)[(](.*)[)]$");jQuery.each(f,function(b,c){c=c.trim();var d=j.exec(c);d&&d[2].match(/model/i)&&(console.log("Model:",d[1]),h={name:d[1],class:d[2],fields:[],relationships:[]},g.push(h),i="");var e,f=k.exec(c);f&&(e=f);var l=k.exec(i);if(l&&(e=l),e){if(h&&e[2]&&(e[2].match(/field/i)||a.relationship_factory.relationship_match(e[2]))){var m=a.relationship_factory.relationship_match(e[2]);if(m){var n=e[1],o=e[2],p=e[3].split(","),q=p.shift(),r=p.join(",").trim();console.log("Model:",h.name,"Relationship:",n,o,q,r),h.relationships.push(a.relationship_factory.make_relationship({name:n,type:o,opts:r,to:q}))}else{var s=e[1],t=e[2],u=e[3];console.log("Model:",h.name,"Field:",s,t,u),h.fields.push(a.field_factory.make_field({name:s,type:t,opts:u}))}}i=""}else h&&(i+=c)});var l=[];jQuery.each(g,function(b,c){var d=a.model_factory(c,a);l.push(d)}),c&&c(l)},d.readAsText(b)}}return new b}}ace.define("ace/mode/python",["require","exports","module","ace/lib/oop","ace/mode/text","ace/tokenizer","ace/mode/python_highlight_rules","ace/mode/folding/pythonic","ace/range"],function(a,b,c){var d=a("../lib/oop"),e=a("./text").Mode,f=(a("../tokenizer").Tokenizer,a("./python_highlight_rules").PythonHighlightRules),g=a("./folding/pythonic").FoldMode,h=a("../range").Range,i=function(){this.HighlightRules=f,this.foldingRules=new g("\\:")};d.inherits(i,e),function(){this.lineCommentStart="#",this.getNextLineIndent=function(a,b,c){var d=this.$getIndent(b),e=this.getTokenizer().getLineTokens(b,a),f=e.tokens;if(f.length&&"comment"==f[f.length-1].type)return d;if("start"==a){var g=b.match(/^.*[\{\(\[\:]\s*$/);g&&(d+=c)}return d};var a={pass:1,return:1,raise:1,break:1,continue:1};this.checkOutdent=function(b,c,d){if("\r\n"!==d&&"\r"!==d&&"\n"!==d)return!1;var e=this.getTokenizer().getLineTokens(c.trim(),b).tokens;if(!e)return!1;do var f=e.pop();while(f&&("comment"==f.type||"text"==f.type&&f.value.match(/^\s+$/)));return!!f&&("keyword"==f.type&&a[f.value])},this.autoOutdent=function(a,b,c){c+=1;var d=this.$getIndent(b.getLine(c)),e=b.getTabString();d.slice(-e.length)==e&&b.remove(new h(c,d.length-e.length,c,d.length))},this.$id="ace/mode/python"}.call(i.prototype),b.Mode=i}),ace.define("ace/mode/python_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/text_highlight_rules"],function(a,b,c){var d=a("../lib/oop"),e=a("./text_highlight_rules").TextHighlightRules,f=function(){var a="and|as|assert|break|class|continue|def|del|elif|else|except|exec|finally|for|from|global|if|import|in|is|lambda|not|or|pass|print|raise|return|try|while|with|yield",b="True|False|None|NotImplemented|Ellipsis|__debug__",c="abs|divmod|input|open|staticmethod|all|enumerate|int|ord|str|any|eval|isinstance|pow|sum|basestring|execfile|issubclass|print|super|binfile|iter|property|tuple|bool|filter|len|range|type|bytearray|float|list|raw_input|unichr|callable|format|locals|reduce|unicode|chr|frozenset|long|reload|vars|classmethod|getattr|map|repr|xrange|cmp|globals|max|reversed|zip|compile|hasattr|memoryview|round|__import__|complex|hash|min|set|apply|delattr|help|next|setattr|buffer|dict|hex|object|slice|coerce|dir|id|oct|sorted|intern",d=this.createKeywordMapper({"invalid.deprecated":"debugger","support.function":c,"constant.language":b,keyword:a},"identifier"),e="(?:r|u|ur|R|U|UR|Ur|uR)?",f="(?:(?:[1-9]\\d*)|(?:0))",g="(?:0[oO]?[0-7]+)",h="(?:0[xX][\\dA-Fa-f]+)",i="(?:0[bB][01]+)",j="(?:"+f+"|"+g+"|"+h+"|"+i+")",k="(?:[eE][+-]?\\d+)",l="(?:\\.\\d+)",m="(?:\\d+)",n="(?:(?:"+m+"?"+l+")|(?:"+m+"\\.))",o="(?:(?:"+n+"|"+m+")"+k+")",p="(?:"+o+"|"+n+")",q="\\\\(x[0-9A-Fa-f]{2}|[0-7]{3}|[\\\\abfnrtv'\"]|U[0-9A-Fa-f]{8}|u[0-9A-Fa-f]{4})";this.$rules={start:[{token:"comment",regex:"#.*$"},{token:"string",regex:e+'"{3}',next:"qqstring3"},{token:"string",regex:e+'"(?=.)',next:"qqstring"},{token:"string",regex:e+"'{3}",next:"qstring3"},{token:"string",regex:e+"'(?=.)",next:"qstring"},{token:"constant.numeric",regex:"(?:"+p+"|\\d+)[jJ]\\b"},{token:"constant.numeric",regex:p},{token:"constant.numeric",regex:j+"[lL]\\b"},{token:"constant.numeric",regex:j+"\\b"},{token:d,regex:"[a-zA-Z_$][a-zA-Z0-9_$]*\\b"},{token:"keyword.operator",regex:"\\+|\\-|\\*|\\*\\*|\\/|\\/\\/|%|<<|>>|&|\\||\\^|~|<|>|<=|=>|==|!=|<>|="},{token:"paren.lparen",regex:"[\\[\\(\\{]"},{token:"paren.rparen",regex:"[\\]\\)\\}]"},{token:"text",regex:"\\s+"}],qqstring3:[{token:"constant.language.escape",regex:q},{token:"string",regex:'"{3}',next:"start"},{defaultToken:"string"}],qstring3:[{token:"constant.language.escape",
regex:q},{token:"string",regex:"'{3}",next:"start"},{defaultToken:"string"}],qqstring:[{token:"constant.language.escape",regex:q},{token:"string",regex:"\\\\$",next:"qqstring"},{token:"string",regex:'"|$',next:"start"},{defaultToken:"string"}],qstring:[{token:"constant.language.escape",regex:q},{token:"string",regex:"\\\\$",next:"qstring"},{token:"string",regex:"'|$",next:"start"},{defaultToken:"string"}]}};d.inherits(f,e),b.PythonHighlightRules=f}),ace.define("ace/mode/folding/pythonic",["require","exports","module","ace/lib/oop","ace/mode/folding/fold_mode"],function(a,b,c){var d=a("../../lib/oop"),e=a("./fold_mode").FoldMode,f=b.FoldMode=function(a){this.foldingStartMarker=new RegExp("([\\[{])(?:\\s*)$|("+a+")(?:\\s*)(?:#.*)?$")};d.inherits(f,e),function(){this.getFoldWidgetRange=function(a,b,c){var d=a.getLine(c),e=d.match(this.foldingStartMarker);if(e)return e[1]?this.openingBracketBlock(a,e[1],c,e.index):e[2]?this.indentationBlock(a,c,e.index+e[2].length):this.indentationBlock(a,c)}}.call(f.prototype)}),ace.define("ace/theme/dawn",["require","exports","module","ace/lib/dom"],function(a,b,c){b.isDark=!1,b.cssClass="ace-dawn",b.cssText=".ace-dawn .ace_gutter {background: #ebebeb;color: #333}.ace-dawn .ace_print-margin {width: 1px;background: #e8e8e8}.ace-dawn {background-color: #F9F9F9;color: #080808}.ace-dawn .ace_cursor {color: #000000}.ace-dawn .ace_marker-layer .ace_selection {background: rgba(39, 95, 255, 0.30)}.ace-dawn.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px #F9F9F9;border-radius: 2px}.ace-dawn .ace_marker-layer .ace_step {background: rgb(255, 255, 0)}.ace-dawn .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgba(75, 75, 126, 0.50)}.ace-dawn .ace_marker-layer .ace_active-line {background: rgba(36, 99, 180, 0.12)}.ace-dawn .ace_gutter-active-line {background-color : #dcdcdc}.ace-dawn .ace_marker-layer .ace_selected-word {border: 1px solid rgba(39, 95, 255, 0.30)}.ace-dawn .ace_invisible {color: rgba(75, 75, 126, 0.50)}.ace-dawn .ace_keyword,.ace-dawn .ace_meta {color: #794938}.ace-dawn .ace_constant,.ace-dawn .ace_constant.ace_character,.ace-dawn .ace_constant.ace_character.ace_escape,.ace-dawn .ace_constant.ace_other {color: #811F24}.ace-dawn .ace_invalid.ace_illegal {text-decoration: underline;font-style: italic;color: #F8F8F8;background-color: #B52A1D}.ace-dawn .ace_invalid.ace_deprecated {text-decoration: underline;font-style: italic;color: #B52A1D}.ace-dawn .ace_support {color: #691C97}.ace-dawn .ace_support.ace_constant {color: #B4371F}.ace-dawn .ace_fold {background-color: #794938;border-color: #080808}.ace-dawn .ace_list,.ace-dawn .ace_markup.ace_list,.ace-dawn .ace_support.ace_function {color: #693A17}.ace-dawn .ace_storage {font-style: italic;color: #A71D5D}.ace-dawn .ace_string {color: #0B6125}.ace-dawn .ace_string.ace_regexp {color: #CF5628}.ace-dawn .ace_comment {font-style: italic;color: #5A525F}.ace-dawn .ace_heading,.ace-dawn .ace_markup.ace_heading {color: #19356D}.ace-dawn .ace_variable {color: #234A97}.ace-dawn .ace_indent-guide {background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAEklEQVQImWNgYGBgYLh/5+x/AAizA4hxNNsZAAAAAElFTkSuQmCC) right repeat-y}";var d=a("../lib/dom");d.importCssString(b.cssText,b.cssClass)});var global=Function("return this;")();!function(a){function b(a){var b=g[a]||window[a];if(!b)throw new Error("Requested module '"+a+"' has not been defined.");return b}function c(a,b){return g[a]=b}function d(a,b){for(var c in b)"noConflict"!=c&&"_VERSION"!=c&&(a[c]=b[c]);return a}function e(a,b,c){return"string"==typeof a||a.nodeName||a.length&&"item"in a||a==window?(c=f._select(a,b),c.selector=a):c=isFinite(a.length)?a:[a],d(c,e)}function f(a,b){return e(a,b)}a.global=a;var g={},h=a.$;a.provide=c,a.require=b,d(f,{_VERSION:"0.3.6",fn:e,ender:function(a,b){d(b?e:f,a)},_select:function(a,b){return(b||document).querySelectorAll(a)}}),d(e,{forEach:function(a,b,c){for(c=0,l=this.length;c<l;++c)c in this&&a.call(b||this[c],this[c],c,this);return this},$:f}),f.noConflict=function(){return a.$=h,this},"undefined"!=typeof module&&module.exports&&(module.exports=f),a.ender=a.$=a.ender||f}(this),function(a){var b={exports:{}};b.exports,require("ender");!function(){"use strict";function a(a){var b,c=new Uint8Array(a);for(b=0;b<a;b+=1)c[b]=0;return c}function c(b,c,d,e){var f=c+d,g=a((parseInt(f/e)+1)*e);return g.set(b),g}function d(a,b,c){return a=a.toString(c||8),"000000000000".substr(a.length+12-b)+a}function e(b,c,d){var e,f;for(c=c||a(b.length),d=d||0,e=0,f=b.length;e<f;e+=1)c[d]=b.charCodeAt(e),d+=1;return c}function f(a){function b(a){return g[a>>18&63]+g[a>>12&63]+g[a>>6&63]+g[63&a]}var c,d,e,f=a.length%3,h="";for(c=0,e=a.length-f;c<e;c+=3)d=(a[c]<<16)+(a[c+1]<<8)+a[c+2],h+=b(d);switch(h.length%4){case 1:h+="=";break;case 2:h+="=="}return h}var g=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"];b.exports.clean=a,b.exports.pad=d,b.exports.extend=c,b.exports.stringToUint8=e,b.exports.uint8ToBase64=f}(),provide("tar-js/utils",b.exports)}(global),function(a){var b={exports:{}};b.exports,require("ender");!function(){"use strict";function a(a,b){var e=d.clean(512),f=0;return c.forEach(function(b){var c,d,g=a[b.field]||"";for(c=0,d=g.length;c<d;c+=1)e[f]=g.charCodeAt(c),f+=1;f+=b.length-c}),"function"==typeof b?b(e,f):e}var c,d=require("tar-js/utils");c=[{field:"fileName",length:100},{field:"fileMode",length:8},{field:"uid",length:8},{field:"gid",length:8},{field:"fileSize",length:12},{field:"mtime",length:12},{field:"checksum",length:8},{field:"type",length:1},{field:"linkName",length:100},{field:"ustar",length:8},{field:"owner",length:32},{field:"group",length:32},{field:"majorNumber",length:8},{field:"minorNumber",length:8},{field:"filenamePrefix",length:155},{field:"padding",length:12}],b.exports.structure=c,b.exports.format=a}(),provide("tar-js/header",b.exports)}(global),function(a){var b={exports:{}};b.exports,require("ender");!function(){"use strict";function a(a){this.written=0,c=(a||20)*f,this.out=e.clean(c)}var c,d=require("tar-js/header"),e=require("tar-js/utils"),f=512;a.prototype.append=function(a,b,g,h){var i,j,k,l,m,n,o;if("string"==typeof b)b=e.stringToUint8(b);else if(b.constructor!==Uint8Array.prototype.constructor)throw"Invalid input type. You gave me: "+b.constructor.toString().match(/function\s*([$A-Za-z_][0-9A-Za-z_]*)\s*\(/)[1];"function"==typeof g&&(h=g,g={}),g=g||{},k=g.mode||4095&parseInt("777",8),l=g.mtime||Math.floor(+new Date/1e3),m=g.uid||0,n=g.gid||0,i={fileName:a,fileMode:e.pad(k,7),uid:e.pad(m,7),gid:e.pad(n,7),fileSize:e.pad(b.length,11),mtime:e.pad(l,11),checksum:"        ",type:"0",ustar:"ustar  ",owner:g.owner||"",group:g.group||""},j=0,Object.keys(i).forEach(function(a){var b,c,d=i[a];for(b=0,c=d.length;b<c;b+=1)j+=d.charCodeAt(b)}),i.checksum=e.pad(j,6)+"\0 ",o=d.format(i);return this.out.set(o,this.written),this.written+=o.length,this.written+b.length>this.out.length&&(this.out=e.extend(this.out,this.written,b.length,c)),this.out.set(b,this.written),this.written+=b.length+(f-(b.length%f||f)),this.out.length-this.written<2*f&&(this.out=e.extend(this.out,this.written,2*f,c)),"function"==typeof h&&h(this.out),this.out},a.prototype.clear=function(){this.written=0,this.out=e.clean(c)},b.exports=a}(),provide("tar-js",b.exports)}(global),angular.module("ui.ace",[]).constant("uiAceConfig",{}).directive("uiAce",["uiAceConfig",function(a){if(angular.isUndefined(window.ace))throw new Error("ui-ace need ace to work... (o rly?)");var b=function(a,b,c){if(angular.isDefined(c.workerPath)){var d=window.ace.require("ace/config");d.set("workerPath",c.workerPath)}angular.isDefined(c.require)&&c.require.forEach(function(a){window.ace.require(a)}),angular.isDefined(c.showGutter)&&a.renderer.setShowGutter(c.showGutter),angular.isDefined(c.useWrapMode)&&b.setUseWrapMode(c.useWrapMode),angular.isDefined(c.showInvisibles)&&a.renderer.setShowInvisibles(c.showInvisibles),angular.isDefined(c.showIndentGuides)&&a.renderer.setDisplayIndentGuides(c.showIndentGuides),angular.isDefined(c.useSoftTabs)&&b.setUseSoftTabs(c.useSoftTabs),angular.isDefined(c.showPrintMargin)&&a.setShowPrintMargin(c.showPrintMargin),angular.isDefined(c.disableSearch)&&c.disableSearch&&a.commands.addCommands([{name:"unfind",bindKey:{win:"Ctrl-F",mac:"Command-F"},exec:function(){return!1},readOnly:!0}]),angular.isString(c.theme)&&a.setTheme("ace/theme/"+c.theme),angular.isString(c.mode)&&b.setMode("ace/mode/"+c.mode),angular.isDefined(c.firstLineNumber)&&(angular.isNumber(c.firstLineNumber)?b.setOption("firstLineNumber",c.firstLineNumber):angular.isFunction(c.firstLineNumber)&&b.setOption("firstLineNumber",c.firstLineNumber()));var e,f;if(angular.isDefined(c.advanced))for(e in c.advanced)f={name:e,value:c.advanced[e]},a.setOption(f.name,f.value);if(angular.isDefined(c.rendererOptions))for(e in c.rendererOptions)f={name:e,value:c.rendererOptions[e]},a.renderer.setOption(f.name,f.value);angular.forEach(c.callbacks,function(b){angular.isFunction(b)&&b(a)})};return{restrict:"EA",require:"?ngModel",link:function(c,d,e,f){var g,h,i=a.ace||{},j=angular.extend({},i,c.$eval(e.uiAce)),k=window.ace.edit(d[0]),l=k.getSession(),m=function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1);angular.isDefined(a)&&c.$evalAsync(function(){if(!angular.isFunction(a))throw new Error("ui-ace use a function as callback.");a(b)})},n={onChange:function(a){return function(b){var d=l.getValue();!f||d===f.$viewValue||c.$$phase||c.$root.$$phase||c.$evalAsync(function(){f.$setViewValue(d)}),m(a,b,k)}},onBlur:function(a){return function(){m(a,k)}}};e.$observe("readonly",function(a){k.setReadOnly(!!a||""===a)}),f&&(f.$formatters.push(function(a){if(angular.isUndefined(a)||null===a)return"";if(angular.isObject(a)||angular.isArray(a))throw new Error("ui-ace cannot use an object or an array as a model");return a}),f.$render=function(){l.setValue(f.$viewValue)});var o=function(a,d){a!==d&&(j=angular.extend({},i,c.$eval(e.uiAce)),j.callbacks=[j.onLoad],j.onLoad!==i.onLoad&&j.callbacks.unshift(i.onLoad),l.removeListener("change",g),g=n.onChange(j.onChange),l.on("change",g),k.removeListener("blur",h),h=n.onBlur(j.onBlur),k.on("blur",h),b(k,l,j))};c.$watch(e.uiAce,o,!0),o(i),d.on("$destroy",function(){k.session.$stopWorker(),k.destroy()}),c.$watch(function(){return[d[0].offsetWidth,d[0].offsetHeight]},function(){k.resize(),k.renderer.updateFull()},!0)}}}]),!function(a,b){var c=b.isDefined,d=b.isUndefined,e=b.isNumber,f=b.isObject,g=b.isArray,h=b.isString,i=b.extend,j=b.toJson;b.module("LocalStorageModule",[]).provider("localStorageService",function(){this.prefix="ls",this.storageType="localStorage",this.cookie={expiry:30,path:"/",secure:!1},this.defaultToCookie=!0,this.notify={setItem:!0,removeItem:!1},this.setPrefix=function(a){return this.prefix=a,this},this.setStorageType=function(a){return this.storageType=a,this},this.setDefaultToCookie=function(a){return this.defaultToCookie=!!a,this},this.setStorageCookie=function(a,b,c){return this.cookie.expiry=a,this.cookie.path=b,this.cookie.secure=c,this},this.setStorageCookieDomain=function(a){return this.cookie.domain=a,this},this.setNotify=function(a,b){return this.notify={setItem:a,removeItem:b},this},this.$get=["$rootScope","$window","$document","$parse","$timeout",function(a,b,k,l,m){function n(c){if(c||(c=b.event),s.setItem&&h(c.key)&&w(c.key)){var d=v(c.key);m(function(){a.$broadcast("LocalStorageModule.notification.changed",{key:d,newvalue:c.newValue,storageType:p.storageType})})}}var o,p=this,q=p.prefix,r=p.cookie,s=p.notify,t=p.storageType;k?k[0]&&(k=k[0]):k=document,"."!==q.substr(-1)&&(q=q?q+".":"");var u=function(a){return q+a},v=function(a){return a.replace(new RegExp("^"+q,"g"),"")},w=function(a){return 0===a.indexOf(q)},x=function(){try{var c=t in b&&null!==b[t],d=u("__"+Math.round(1e7*Math.random()));return c&&(o=b[t],o.setItem(d,""),o.removeItem(d)),c}catch(b){return p.defaultToCookie&&(t="cookie"),a.$broadcast("LocalStorageModule.notification.error",b.message),!1}},y=x(),z=function(b,c,e){if(K(e),c=d(c)?null:j(c),!y&&p.defaultToCookie||"cookie"===p.storageType)return y||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),s.setItem&&a.$broadcast("LocalStorageModule.notification.setitem",{key:b,newvalue:c,storageType:"cookie"}),F(b,c);try{o&&o.setItem(u(b),c),s.setItem&&a.$broadcast("LocalStorageModule.notification.setitem",{key:b,newvalue:c,storageType:p.storageType})}catch(d){return a.$broadcast("LocalStorageModule.notification.error",d.message),F(b,c)}return!0},A=function(b,c){if(K(c),!y&&p.defaultToCookie||"cookie"===p.storageType)return y||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),G(b);var d=o?o.getItem(u(b)):null;if(!d||"null"===d)return null;try{return JSON.parse(d)}catch(a){return d}},B=function(){var b=0;arguments.length>=1&&("localStorage"===arguments[arguments.length-1]||"sessionStorage"===arguments[arguments.length-1])&&(b=1,K(arguments[arguments.length-1]));var c,d;for(c=0;c<arguments.length-b;c++)if(d=arguments[c],!y&&p.defaultToCookie||"cookie"===p.storageType)y||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),s.removeItem&&a.$broadcast("LocalStorageModule.notification.removeitem",{key:d,storageType:"cookie"}),H(d);else try{o.removeItem(u(d)),s.removeItem&&a.$broadcast("LocalStorageModule.notification.removeitem",{key:d,storageType:p.storageType})}catch(b){a.$broadcast("LocalStorageModule.notification.error",b.message),H(d)}},C=function(b){if(K(b),!y)return a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),[];var c=q.length,d=[];for(var e in o)if(e.substr(0,c)===q)try{d.push(e.substr(c))}catch(b){return a.$broadcast("LocalStorageModule.notification.error",b.Description),[]}return d},D=function(b,c){K(c);var d=q?new RegExp("^"+q):new RegExp,e=b?new RegExp(b):new RegExp;if(!y&&p.defaultToCookie||"cookie"===p.storageType)return y||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),I();if(!y&&!p.defaultToCookie)return!1;var f=q.length;for(var g in o)if(d.test(g)&&e.test(g.substr(f)))try{B(g.substr(f))}catch(b){return a.$broadcast("LocalStorageModule.notification.error",b.message),I()}return!0},E=function(){try{return b.navigator.cookieEnabled||"cookie"in k&&(k.cookie.length>0||(k.cookie="test").indexOf.call(k.cookie,"test")>-1)}catch(b){return a.$broadcast("LocalStorageModule.notification.error",b.message),!1}}(),F=function(b,c,h,i){if(d(c))return!1;if((g(c)||f(c))&&(c=j(c)),!E)return a.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var l="",m=new Date,n="";if(null===c?(m.setTime(m.getTime()+-864e5),l="; expires="+m.toGMTString(),c=""):e(h)&&0!==h?(m.setTime(m.getTime()+24*h*60*60*1e3),l="; expires="+m.toGMTString()):0!==r.expiry&&(m.setTime(m.getTime()+24*r.expiry*60*60*1e3),l="; expires="+m.toGMTString()),b){var o="; path="+r.path;r.domain&&(n="; domain="+r.domain),"boolean"==typeof i?i===!0&&(n+="; secure"):r.secure===!0&&(n+="; secure"),k.cookie=u(b)+"="+encodeURIComponent(c)+l+o+n}}catch(b){return a.$broadcast("LocalStorageModule.notification.error",b.message),!1}return!0},G=function(b){if(!E)return a.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var c=k.cookie&&k.cookie.split(";")||[],d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(u(b)+"=")){var f=decodeURIComponent(e.substring(q.length+b.length+1,e.length));try{return JSON.parse(f)}catch(a){return f}}}return null},H=function(a){F(a,null)},I=function(){for(var a=null,b=q.length,c=k.cookie.split(";"),d=0;d<c.length;d++){for(a=c[d];" "===a.charAt(0);)a=a.substring(1,a.length);var e=a.substring(b,a.indexOf("="));H(e)}},J=function(){return t},K=function(a){return a&&t!==a&&(t=a,y=x()),y},L=function(a,b,d,e,g){e=e||b;var h=A(e,g);return null===h&&c(d)?h=d:f(h)&&f(d)&&(h=i(h,d)),l(b).assign(a,h),a.$watch(b,function(a){z(e,a,g)},f(a[b]))};y&&(b.addEventListener?(b.addEventListener("storage",n,!1),a.$on("$destroy",function(){b.removeEventListener("storage",n)})):b.attachEvent&&(b.attachEvent("onstorage",n),a.$on("$destroy",function(){b.detachEvent("onstorage",n)})));var M=function(a){K(a);for(var c=0,d=b[t],e=0;e<d.length;e++)0===d.key(e).indexOf(q)&&c++;return c};return{isSupported:y,getStorageType:J,setStorageType:K,set:z,add:z,get:A,keys:C,remove:B,clearAll:D,bind:L,deriveKey:u,underiveKey:v,length:M,defaultToCookie:this.defaultToCookie,cookie:{isSupported:E,set:F,add:F,get:G,remove:H,clearAll:I}}}]})}(window,window.angular),angular.module("builder",["ngRoute","builder.filters","builder.services","builder.directives","builder.controllers","LocalStorageModule","ui.ace","angulartics","angulartics.google.analytics"]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/models",{templateUrl:"partials/models.html",controller:"ModelController"}),a.when("/home",{templateUrl:"partials/home.html",controller:"ModelController"}),a.otherwise({redirectTo:"/home"})}]),angular.module("builder.controllers",["LocalStorageModule"]).controller("ModelController",["$scope","$http","ModelFactory","ModelParser","FieldFactory","RelationshipFactory","localStorageService","MessageService","RenderFactory","TarballFactory","$templateCache",function(a,b,c,d,e,f,g,h,i,j,k){a.models=[],a.new_models=[],a.user_model="django.contrib.auth.models.User",a.user_model_setting="settings.AUTH_USER_MODEL",a.built_in_models={"django.contrib.auth.models.User":{fields:{username:{default:"username"},email:{default:"username@tempurl.com"}}},"django.contrib.auth.models.Group":{fields:{name:{default:"group"}}},"django.contrib.contenttypes.models.ContentType":{fields:{}}},a.messageService=new h,a.field_factory=new e,a.model_factory=c,a.template_cache=k,a.relationship_factory=new f,a.render_factory=new i(a.built_in_models),a.editors=[],a.models_storage_key="local_models",a._app_name="app_name",a._project_name="project_name",a.create_tar_ball_url=function(b){var c="Built with django_builder\n",d="#";const e=a.project_name(),f=a.app_name();var g=a.render_factory.render_models_py(f,a.models),h=a.render_factory.render_views_py(f,a.models),i=a.render_factory.render_admin_py(f,a.models),k=a.render_factory.render_urls_py(f,a.models),l=a.render_factory.render_tests_py(f,a.models),m=a.render_factory.render_forms_py(f,a.models),n=a.render_factory.render_django_rest_framework_api_py(f,a.models),o=a.render_factory.render_django_rest_framework_serializers_py(f,a.models),p=a.render_factory.render_templates_html(f,a.models),q=new j,r=f;if(b&&(r=e+"/"+f),b){var s=a.render_factory.render_project_settings_py(e,f,a.template_cache),t=a.render_factory.render_project_requirements(),u=a.render_factory.render_project_urls_py(f,a.template_cache),v=a.render_factory.render_project_manage_py(e,a.template_cache),w=a.render_factory.render_project_wsgi_py(e,a.template_cache);q.append("requirements.txt",t),q.append(e+"/manage.py",v),q.append(e+"/"+e+"/settings.py",s),q.append(e+"/"+e+"/urls.py",u),q.append(e+"/"+e+"/wsgi.py",w),q.append(e+"/"+e+"/__init__.py",d)}return q.append(r+"/README.txt",c),q.append(r+"/__init__.py",d),q.append(r+"/models.py",g),q.append(r+"/views.py",h),q.append(r+"/admin.py",i),q.append(r+"/urls.py",k),q.append(r+"/tests.py",l),q.append(r+"/forms.py",m),q.append(r+"/api.py",n),q.append(r+"/serializers.py",o),q.append(r+"/templates/base.html",a.render_factory.render_base_html(f,a.models)),jQuery.each(p,function(a,b){q.append(r+"/templates/"+f+"/"+b[0],b[1])}),q.get_url()},a.create_download_modal_app=function(){var b=a.create_tar_ball_url(!1),c=a.app_name()+".tar",d="django_builder_download_app_modal";return a.create_download_modal(b,c,d)},a.create_download_modal_project=function(){var b=a.create_tar_ball_url(!0),c=a.project_name()+".tar",d=jQuery("<p>");d.text("The project download includes the following files:");var e=jQuery("<div>").addClass("well well-sm");e.append(jQuery("<p>").text("requirements.txt")),e.append(jQuery("<p>").text("manage.py")),e.append(jQuery("<p>").text(a.project_name()+"/settings.py")),e.append(jQuery("<p>").text(a.project_name()+"/urls.py")),e.append(jQuery("<p>").text(a.project_name()+"/wsgi.py")),d.append(jQuery("<br><br>")),d.append(e);var f="django_builder_download_project_modal";return a.create_download_modal(b,c,f,d)},a.create_download_modal=function(b,c,d,e){var f=jQuery("<a>").attr("href",b).attr("id","django_builder_download_a");f.addClass("btn btn-success btn-lg").css("text-transform","none"),f.text("Click here to download "+c),f.attr("download",c);var g=jQuery("<div>").addClass("text-center").append(f),h=jQuery("<div>");h.append(jQuery("<br>")),h.append("Chrome can block downloads of the generated tarball, if this happens navigate to the "),h.append(jQuery("<strong>").text("Downloads")),h.append(" section of chrome to accept the download"),h.append(jQuery("<br>")),h.append("Window -> Downloads");var i=jQuery("<div>");return void 0!=e&&i.append(e),i.append(g),i.append(h),a.messageService.simple_info("Download info",i).modal("show").attr("id",d),d},a.render_model_class_fields_only=function(b){return b.render_model_class_fields_only(a._app_name,a.render_factory)},a.upload_input=function(){return jQuery('<input type="file" />')},a.upload_drop_target=function(a){var b=jQuery("<div>").addClass("builder_dnd_target text-center"),c=jQuery("<i>").addClass("fa fa-upload fa-4x builder_dnd_icon");return b.append(jQuery("<div>").text("Drag and Drop files here!")),b.append(c),b},a.upload_form=function(a,b){var c=jQuery("<form>"),d=jQuery("<span>").addClass("btn btn-default btn-file center-block builder_upload_models_py");return d.append("Browse"),d.append(a),c.append(d),c.append(b),c},a.save_new_models=function(b){a.new_models=[],a.models=b,a.saveApp(),a.$apply()},a.merge_models=function(){for(var b=a.models.concat(a.new_models),c=0;c<b.length;++c)for(var d=c+1;d<b.length;++d)b[c].name===b[d].name&&b.splice(d--,1);return a.save_new_models(b)},a.add_unique=function(){jQuery.each(a.new_models,function(b,c){a.existingModel(c.name)||a.models.push(c)}),a.save_new_models(a.models)},a.add_new_models=function(b){a.new_models=b,a.$apply();var c=function(){console.log("Overwriting existing models"),a.merge_models()},d=function(){var b=!1,d=[],e=jQuery("<p>").text("The following models are duplicates:");jQuery.each(a.new_models,function(c,f){a.existingModel(f.name)&&(b=!0,d.push(f),e.append(jQuery("<div>").text(f.name)))});var f=d.length==a.new_models.length;if(b){var g=[{text:"Overwrite existing models",callback:c}];f||g.push({text:"Add unique",callback:a.add_unique}),g.push({text:"Cancel",callback:function(){}});var h="duplicate_models";a.messageService.simple_choice("Add duplicate models?",e,g).modal("show").attr("id",h)}else a.merge_models()},e=jQuery("<div>");jQuery.each(a.new_models,function(b,c){e.append(jQuery("<hr>")),e.append(jQuery("<pre>").html(c.render_model_class_fields_only(a._app_name,a.render_factory)));var d=jQuery('<button class="btn btn-danger pull-right">').text("Remove");e.append(d),e.append(jQuery("<div>").addClass("clearfix"))});var f="add_new_models";return a.messageService.simple_confirm("Add the following models?",jQuery("#builder_new_models"),d).modal("show").find(".modal-dialog").css("width","50%").attr("id",f),f},a.process_models_py=function(b){if(0==b.length)a.messageService.simple_error("Sorry","You didn't seem to choose any files.").modal("show");else if(b.length>1)a.messageService.simple_error("Sorry","Multiple files not yet supported, please choose a single file.").modal("show");else{var c=d(a);c.parse(b[0],function(b){a.add_new_models(b)})}},a.upload_models_py=function(){var b=a.upload_input(),c=a.upload_drop_target(),d=a.upload_form(b,c),e=a.messageService.simple_form("Upload models.py","Choose a models.py file to analyse",d,function(){a.process_models_py(jQuery(b)[0].files),e.modal("hide")}).modal("show");b.change(function(){a.process_models_py(jQuery(b)[0].files),e.modal("hide")}),d.on("drag dragstart dragend dragover dragenter dragleave drop",function(a){a.preventDefault(),a.stopPropagation()}).on("dragover dragenter",function(){c.addClass("is-drag-over")}).on("dragleave dragend drop",function(){c.removeClass("is-drag-over")}).on("drop",function(b){var c=b.originalEvent.dataTransfer.files;e.modal("hide"),a.process_models_py(c)})},jQuery("html body").on("drag dragstart dragend dragover dragenter dragleave drop",function(a){a.preventDefault(),a.stopPropagation()}).on("dragover dragenter",function(){}).on("drop",function(a){}),jQuery("#builder_models_content").on("drag dragstart dragend dragover dragenter dragleave drop",function(a){a.preventDefault(),a.stopPropagation()}).on("dragover dragenter",function(){jQuery(".builder_dnd_target").addClass("is-drag-over")}).on("drop",function(b){jQuery(".builder_dnd_target").removeClass("is-drag-over");var c=b.originalEvent.dataTransfer.files;a.process_models_py(c)}),a.aceLoad=function(b){var c=jQuery(b.container).attr("id");"builder_models"==c?b.setValue(a.render_factory.render_models_py(a.app_name(),a.models)):"builder_views"==c?b.setValue(a.render_factory.render_views_py(a.app_name(),a.models)):"builder_admin"==c?b.setValue(a.render_factory.render_admin_py(a.app_name(),a.models)):"builder_urls"==c?b.setValue(a.render_factory.render_urls_py(a.app_name(),a.models)):"builder_tests"==c?b.setValue(a.render_factory.render_tests_py(a.app_name(),a.models)):"builder_forms"==c?b.setValue(a.render_factory.render_forms_py(a.app_name(),a.models)):"builder_django_rest_framework_api"==c?b.setValue(a.render_factory.render_django_rest_framework_api_py(a.app_name(),a.models)):"builder_django_rest_framework_serializers"==c&&b.setValue(a.render_factory.render_django_rest_framework_serializers_py(a.app_name(),a.models)),b.session.selection.clearSelection()},a.reLoadAce=function(){Object.keys(a.editors).map(function(b){a.aceLoad(a.editors[b])})},a.aceLoaded=function(b){b.setOptions({readOnly:!0,highlightActiveLine:!1,highlightGutterLine:!1,maxLines:1/0}),b.renderer.$cursorLayer.element.style.opacity=0,a.aceLoad(b),a.editors.push(b)},a.$watch("[models,_app_name]",function(){a.reLoadAce(),a.saveApp()},!0),a.aceChanged=function(a){},a.do_set_app_name=function(b){a._app_name=b},a.set_app_name=function(){a.do_set_app_name(jQuery("input#appname").val()),a.reLoadAce()},a.do_set_project_name=function(b){a._project_name=b},a.set_project_name=function(){a.do_set_project_name(jQuery("input#projectname").val()),a.reLoadAce()},a.l_app_name=function(){return a._app_name.toLowerCase()},a.app_name=function(){return a._app_name.replace(new RegExp(" ","g"),"_")},a.project_name=function(){return a._project_name.replace(new RegExp(" ","g"),"_")},a.updateModel=function(b){var c=a.models.indexOf(b);a.models[c]=b,a.$apply()},a.serializeApp=function(){var b={models:a.models,app_config:{app_name:a._app_name}};return JSON.stringify(b)},a.saveApp=function(){g.set(a.models_storage_key,a.serializeApp())},a.doClearModels=function(){g.set(a.models_storage_key,""),a.loadModels(),a.models=[],a.$apply()},a.clearModels=function(){var b=function(){a.doClearModels()},c="clear_all";return a.messageService.simple_confirm("Confirm","Remove all models?",b).modal("show").attr("id",c),c},a.model_count=function(){return a.models.length},a.add_model=function(b){var d={name:b};d.fields=[a.field_factory.make_field({name:"name",type:"django.db.models.CharField",opts:"max_length=255"}),a.field_factory.make_field({name:"slug",type:"django_extensions.db.fields.AutoSlugField",opts:"populate_from='name', blank=True"}),a.field_factory.make_field({name:"created",type:"django.db.models.DateTimeField",opts:"auto_now_add=True, editable=False"}),a.field_factory.make_field({name:"last_updated",type:"django.db.models.DateTimeField",opts:"auto_now=True, editable=False"})];var e=c(d,a);a.models.push(e),a.saveApp(),a.$apply()},a.existingModel=function(b){var c=!1;return jQuery.each(a.models,function(a,d){b==d.name&&(c=!0)}),c},a.addModel=function(){var b=function(b){void 0==b||""===b?a.messageService.simple_info("Model Name Required","Enter a Model name").modal("show"):a.existingModel(b)?a.messageService.simple_error("Error with Model Name","There is already a model with the name "+b).modal("show"):a.add_model(b)},c="add_model";return a.messageService.simple_input("Model Name Required","Enter a Model name","Model1",b,!0).modal("show").attr("id",c),c},a.cleanModel=function(a){delete a.$$hashKey,void 0!=a.fields&&jQuery.each(a.fields,function(a,b){delete b.$$hashKey}),void 0!=a.relationships&&jQuery.each(a.relationships,function(a,b){delete b.$$hashKey})},a.loadModels=function(){var b=g.get(a.models_storage_key)||{models:[],app_config:{app_name:"app_name"}};"string"==typeof b&&(b=JSON.parse(b));var c=b.models||[],d=b.app_config||{app_name:"app_name"};return a._app_name=d.app_name,jQuery.each(c,function(b,c){a.cleanModel(c)}),c},a.loadModel=function(b){var d=c(b,a);a.models.push(d)},a.__init__=function(){jQuery.each(a.loadModels(),function(b,c){a.loadModel(c)})},a.__init__(),a.debug=function(){},a.do_rename_model=function(b,c){var d="rename_model_existing",e=a.models[b];a.existingModel(c)?a.messageService.simple_error("Error with Model Name","There is already a model with the name "+c).modal("show").attr("id",d):(e.set_name(c),a.updateModel(e),a.$apply())},a.rename_model=function(b){var c=a.models[b],d="rename_model",e=function(c){a.do_rename_model(b,c)};return a.messageService.simple_input("Rename model","Enter a new Model name",c.name,e,!0).modal("show").attr("id",d),d},a.add_relationship=function(b){const c=a.models[b],d=function(b){var d=b.find("input[name=name]").val().trim(),e=b.find("select[name=to]").val().trim(),f=!0;if(jQuery.each(a.built_in_models,function(a,b){e==a&&(f=!1)}),jQuery.each(a.models,function(a,b){e==b.name&&(f=!1)}),b.find("div.form-group-name").removeClass("has-error"),b.find("div.form-group-to").removeClass("has-error"),void 0===d||""===d)b.find("div.form-group-name").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text("Field Required");else if(void 0===e||""===e)b.find("div.form-group-to").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text("Field Required");else if(c.has_relationship(d))b.find("div.form-group-name").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text('Field "'+d+'" exists');else{var g=b.find("select[name=type]").val(),h=b.find("input[name=opts]").val(),i=a.relationship_factory.make_relationship({name:d,type:g,opts:h,to:e,external_app:f});c.relationships.push(i),a.updateModel(c),a.$apply(),jQuery(".modal").modal("hide")}},e=jQuery("<form>"),f=jQuery("<div>").addClass("form-group form-group-name has-feedback").appendTo(e),g=jQuery("<div>").addClass("form-group form-group-to").appendTo(e),h=jQuery("<div>").addClass("form-group form-group-type").appendTo(e),i=jQuery("<div>").addClass("form-group form-group-args").appendTo(e);f.append(jQuery("<label>").text("Name")),f.append(jQuery("<input>").attr("name","name").addClass("form-control")),f.append(jQuery("<span>").text("error message").addClass("help-block hide"));const j=jQuery("<select>").attr("name","to").addClass("form-control"),k=jQuery("<optgroup>").attr("label","Django models");jQuery.each(a.built_in_models,function(a,b){k.append(jQuery("<option>").attr("val",a).text(a))}),j.append(k);const l=jQuery("<optgroup>").attr("label","Your App models");jQuery.each(a.models,function(a,b){l.append(jQuery("<option>").attr("val",b.name).text(b.name))}),j.append(l),g.append(jQuery("<label>").text("Relationship to Model")),
g.append(j),g.append(jQuery("<p>").addClass("text-primary small clearfix").text("You can add external models (otherapp.models.Model1)").css("margin","4px"));const m=jQuery("<select>").attr("name","type");jQuery.each(a.relationship_factory.relationship_types(),function(a,b){m.append(jQuery("<option>").attr("val",b).text(b))}),h.append(jQuery("<label>").text("Relationship Type")),h.append(m),i.append(jQuery("<label>").text("Arguments")),i.append(jQuery("<input>").attr("name","opts").attr("placeholder","options").addClass("form-control")),j.select2({theme:"bootstrap",allowClear:!0,placeholder:"Select a model.",tags:!0,selectOnClose:!0}),m.select2({theme:"bootstrap"});const n="add_rel_"+c.name+"_"+b;return a.messageService.simple_form_no_dismiss("Add Relationship","",e,d).modal("show").attr("id",n).appendTo("body"),n},a.add_field=function(b){var c=a.models[b],d=function(b){var d=b.find("input[name=name]").val();if(void 0===d||""===d)b.find("div.form-group-name").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text("Field Required");else if(c.has_field(d))b.find("div.form-group-name").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text('Field "'+d+'" exists');else{var e=b.find("select[name=type]").val(),f=b.find("input[name=opts]").val(),g=a.field_factory.make_field({name:d,type:e,opts:f});c.fields.push(g),a.updateModel(c),a.$apply(),jQuery(".modal").modal("hide")}},e=jQuery("<form>"),f=jQuery("<div>").addClass("form-group form-group-name  has-feedback").appendTo(e),g=jQuery("<div>").addClass("form-group form-group-type").appendTo(e),h=jQuery("<div>").addClass("form-group form-group-args").appendTo(e);f.append(jQuery("<label>").text("Name")),f.append(jQuery("<input>").attr("name","name").addClass("form-control")),f.append(jQuery("<span>").text("error message").addClass("help-block hide"));var i=jQuery("<select>").attr("name","type").addClass("form-control");jQuery.each(a.field_factory.field_types(),function(a,b){i.append(jQuery("<option>").attr("val",b).text(b))});var j=jQuery("<input>").attr("name","opts").attr("placeholder","options").addClass("form-control");g.append(jQuery("<label>").text("Field Type")),g.append(i),h.append(jQuery("<label>").text("Arguments")),h.append(j),i.change(function(){j.val(a.field_factory.default_field_args(i.val()))}),j.val(a.field_factory.default_field_args(i.val()));var k="add_field_"+c.name+"_"+b;return a.messageService.simple_form_no_dismiss("Add Field","",e,d).modal("show").attr("id",k).appendTo("body"),k},a.edit_relationship=function(b,c){var d=a.models[b].relationships[c],e=function(b){d.form_update(b),a.$apply(),jQuery(".modal").modal("hide")},f=d.$$hashKey||"edit_relationship_"+d.name;return a.messageService.simple_form("Edit Relationship '"+d.name+"'","",d.edit_form(a),e).modal("show").attr("id",f).appendTo("body"),f},a.edit_field=function(b,c){var d=a.models[b].fields[c],e=function(b){d.form_update(b),a.$apply(),jQuery(".modal").modal("hide")},f=d.$$hashKey||"edit_field_"+d.name;return a.messageService.simple_form("Edit field '"+d.name+"'","",d.edit_form(a),e).modal("show").attr("id",f).appendTo("body"),f},a.do_remove_new_model=function(b){a.new_models.splice(b,1),a.$apply()},a.remove_new_model=function(b){setTimeout(function(){a.do_remove_new_model(b)})},a.remove_relationship=function(b,c){var d=function(){a.models[b].relationships.splice(c,1),a.$apply()},e=a.models[b].relationships[c],f=e.$$hashKey||"remove_relationship_"+e.name;return a.messageService.simple_confirm("Confirm","Remove the relationship '"+e.name+"'",d).modal("show").attr("id",f).appendTo("body"),f},a.do_remove_new_relationship=function(b,c){a.new_models[b].relationships.splice(c,1)},a.remove_new_relationship=function(b,c){setTimeout(function(){a.do_remove_new_relationship(b,c)})},a.do_remove_new_field=function(b,c){a.new_models[b].fields.splice(c,1),a.$apply()},a.remove_new_field=function(b,c){setTimeout(function(){a.do_remove_new_field(b,c)})},a.remove_field=function(b,c){var d=function(){a.models[b].fields.splice(c,1),a.$apply()},e=a.models[b].fields[c],f=e.$$hashKey||"remove_field_"+e.name;return a.messageService.simple_confirm("Confirm","Remove the field '"+e.name+"'",d).modal("show").attr("id",f).appendTo("body"),f},a.remove_model=function(b){var c=function(){a.models.splice(b,1),a.$apply()},d=a.models[b],e=d.$$hashKey||"remove_model_"+d.name;return a.messageService.simple_confirm("Confirm","Remove the model '"+d.name+"'",c).modal("show").modal("show").attr("id",e).appendTo("body"),e},a.model_highlight=function(b,c){var d=a.models[b].relationships[c];jQuery(".builder_model_"+d.to_clean()).addClass("builder_model_highlight")},a.model_unhighlight=function(){jQuery(".builder_model").removeClass("builder_model_highlight")},a.new_model_highlight=function(b,c){var d=a.new_models[b].relationships[c];jQuery(".builder_model_"+d.to_clean()).addClass("builder_model_highlight")},a.new_model_unhighlight=function(){jQuery(".builder_model").removeClass("builder_model_highlight")}}]),angular.module("builder.directives",[]).directive("appVersion",["version",function(a){return function(b,c,d){c.text(a)}}]),angular.module("builder.filters",[]).filter("interpolate",["version",function(a){return function(b){return String(b).replace(/\%VERSION\%/gm,a)}}]),angular.module("builder.services",[]).factory("ModelFactory",[ModelServiceFactory]).factory("ModelParser",[ModelParserFactory]).factory("MessageService",[MessageServiceFactory]).factory("FieldFactory",[FieldFactory]).factory("RelationshipFactory",[RelationshipFactory]).factory("RenderFactory",[ModelRenderFactory]).factory("TarballFactory",[TarballFactory]).value("version","0.1");
>>>>>>> Django 1.10 project
=======
ace.define("ace/mode/python",["require","exports","module","ace/lib/oop","ace/mode/text","ace/tokenizer","ace/mode/python_highlight_rules","ace/mode/folding/pythonic","ace/range"],function(e,t,n){var r=e("../lib/oop"),i=e("./text").Mode,s=e("../tokenizer").Tokenizer,o=e("./python_highlight_rules").PythonHighlightRules,u=e("./folding/pythonic").FoldMode,a=e("../range").Range,f=function(){this.HighlightRules=o,this.foldingRules=new u("\\:")};r.inherits(f,i),function(){this.lineCommentStart="#",this.getNextLineIndent=function(e,t,n){var r=this.$getIndent(t),i=this.getTokenizer().getLineTokens(t,e),s=i.tokens;if(s.length&&s[s.length-1].type=="comment")return r;if(e=="start"){var o=t.match(/^.*[\{\(\[\:]\s*$/);o&&(r+=n)}return r};var e={pass:1,"return":1,raise:1,"break":1,"continue":1};this.checkOutdent=function(t,n,r){if(r!=="\r\n"&&r!=="\r"&&r!=="\n")return!1;var i=this.getTokenizer().getLineTokens(n.trim(),t).tokens;if(!i)return!1;do var s=i.pop();while(s&&(s.type=="comment"||s.type=="text"&&s.value.match(/^\s+$/)));return s?s.type=="keyword"&&e[s.value]:!1},this.autoOutdent=function(e,t,n){n+=1;var r=this.$getIndent(t.getLine(n)),i=t.getTabString();r.slice(-i.length)==i&&t.remove(new a(n,r.length-i.length,n,r.length))},this.$id="ace/mode/python"}.call(f.prototype),t.Mode=f}),ace.define("ace/mode/python_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/text_highlight_rules"],function(e,t,n){var r=e("../lib/oop"),i=e("./text_highlight_rules").TextHighlightRules,s=function(){var e="and|as|assert|break|class|continue|def|del|elif|else|except|exec|finally|for|from|global|if|import|in|is|lambda|not|or|pass|print|raise|return|try|while|with|yield",t="True|False|None|NotImplemented|Ellipsis|__debug__",n="abs|divmod|input|open|staticmethod|all|enumerate|int|ord|str|any|eval|isinstance|pow|sum|basestring|execfile|issubclass|print|super|binfile|iter|property|tuple|bool|filter|len|range|type|bytearray|float|list|raw_input|unichr|callable|format|locals|reduce|unicode|chr|frozenset|long|reload|vars|classmethod|getattr|map|repr|xrange|cmp|globals|max|reversed|zip|compile|hasattr|memoryview|round|__import__|complex|hash|min|set|apply|delattr|help|next|setattr|buffer|dict|hex|object|slice|coerce|dir|id|oct|sorted|intern",r=this.createKeywordMapper({"invalid.deprecated":"debugger","support.function":n,"constant.language":t,keyword:e},"identifier"),i="(?:r|u|ur|R|U|UR|Ur|uR)?",s="(?:(?:[1-9]\\d*)|(?:0))",o="(?:0[oO]?[0-7]+)",u="(?:0[xX][\\dA-Fa-f]+)",a="(?:0[bB][01]+)",f="(?:"+s+"|"+o+"|"+u+"|"+a+")",l="(?:[eE][+-]?\\d+)",c="(?:\\.\\d+)",h="(?:\\d+)",p="(?:(?:"+h+"?"+c+")|(?:"+h+"\\.))",d="(?:(?:"+p+"|"+h+")"+l+")",v="(?:"+d+"|"+p+")",m="\\\\(x[0-9A-Fa-f]{2}|[0-7]{3}|[\\\\abfnrtv'\"]|U[0-9A-Fa-f]{8}|u[0-9A-Fa-f]{4})";this.$rules={start:[{token:"comment",regex:"#.*$"},{token:"string",regex:i+'"{3}',next:"qqstring3"},{token:"string",regex:i+'"(?=.)',next:"qqstring"},{token:"string",regex:i+"'{3}",next:"qstring3"},{token:"string",regex:i+"'(?=.)",next:"qstring"},{token:"constant.numeric",regex:"(?:"+v+"|\\d+)[jJ]\\b"},{token:"constant.numeric",regex:v},{token:"constant.numeric",regex:f+"[lL]\\b"},{token:"constant.numeric",regex:f+"\\b"},{token:r,regex:"[a-zA-Z_$][a-zA-Z0-9_$]*\\b"},{token:"keyword.operator",regex:"\\+|\\-|\\*|\\*\\*|\\/|\\/\\/|%|<<|>>|&|\\||\\^|~|<|>|<=|=>|==|!=|<>|="},{token:"paren.lparen",regex:"[\\[\\(\\{]"},{token:"paren.rparen",regex:"[\\]\\)\\}]"},{token:"text",regex:"\\s+"}],qqstring3:[{token:"constant.language.escape",regex:m},{token:"string",regex:'"{3}',next:"start"},{defaultToken:"string"}],qstring3:[{token:"constant.language.escape",regex:m},{token:"string",regex:"'{3}",next:"start"},{defaultToken:"string"}],qqstring:[{token:"constant.language.escape",regex:m},{token:"string",regex:"\\\\$",next:"qqstring"},{token:"string",regex:'"|$',next:"start"},{defaultToken:"string"}],qstring:[{token:"constant.language.escape",regex:m},{token:"string",regex:"\\\\$",next:"qstring"},{token:"string",regex:"'|$",next:"start"},{defaultToken:"string"}]}};r.inherits(s,i),t.PythonHighlightRules=s}),ace.define("ace/mode/folding/pythonic",["require","exports","module","ace/lib/oop","ace/mode/folding/fold_mode"],function(e,t,n){var r=e("../../lib/oop"),i=e("./fold_mode").FoldMode,s=t.FoldMode=function(e){this.foldingStartMarker=new RegExp("([\\[{])(?:\\s*)$|("+e+")(?:\\s*)(?:#.*)?$")};r.inherits(s,i),function(){this.getFoldWidgetRange=function(e,t,n){var r=e.getLine(n),i=r.match(this.foldingStartMarker);if(i)return i[1]?this.openingBracketBlock(e,i[1],n,i.index):i[2]?this.indentationBlock(e,n,i.index+i[2].length):this.indentationBlock(e,n)}}.call(s.prototype)})
/* ***** BEGIN LICENSE BLOCK *****
 * Distributed under the BSD license:
 *
 * Copyright (c) 2010, Ajax.org B.V.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of Ajax.org B.V. nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * ***** END LICENSE BLOCK ***** */

ace.define('ace/theme/dawn', ['require', 'exports', 'module' , 'ace/lib/dom'], function(require, exports, module) {

exports.isDark = false;
exports.cssClass = "ace-dawn";
exports.cssText = ".ace-dawn .ace_gutter {\
background: #ebebeb;\
color: #333\
}\
.ace-dawn .ace_print-margin {\
width: 1px;\
background: #e8e8e8\
}\
.ace-dawn {\
background-color: #F9F9F9;\
color: #080808\
}\
.ace-dawn .ace_cursor {\
color: #000000\
}\
.ace-dawn .ace_marker-layer .ace_selection {\
background: rgba(39, 95, 255, 0.30)\
}\
.ace-dawn.ace_multiselect .ace_selection.ace_start {\
box-shadow: 0 0 3px 0px #F9F9F9;\
border-radius: 2px\
}\
.ace-dawn .ace_marker-layer .ace_step {\
background: rgb(255, 255, 0)\
}\
.ace-dawn .ace_marker-layer .ace_bracket {\
margin: -1px 0 0 -1px;\
border: 1px solid rgba(75, 75, 126, 0.50)\
}\
.ace-dawn .ace_marker-layer .ace_active-line {\
background: rgba(36, 99, 180, 0.12)\
}\
.ace-dawn .ace_gutter-active-line {\
background-color : #dcdcdc\
}\
.ace-dawn .ace_marker-layer .ace_selected-word {\
border: 1px solid rgba(39, 95, 255, 0.30)\
}\
.ace-dawn .ace_invisible {\
color: rgba(75, 75, 126, 0.50)\
}\
.ace-dawn .ace_keyword,\
.ace-dawn .ace_meta {\
color: #794938\
}\
.ace-dawn .ace_constant,\
.ace-dawn .ace_constant.ace_character,\
.ace-dawn .ace_constant.ace_character.ace_escape,\
.ace-dawn .ace_constant.ace_other {\
color: #811F24\
}\
.ace-dawn .ace_invalid.ace_illegal {\
text-decoration: underline;\
font-style: italic;\
color: #F8F8F8;\
background-color: #B52A1D\
}\
.ace-dawn .ace_invalid.ace_deprecated {\
text-decoration: underline;\
font-style: italic;\
color: #B52A1D\
}\
.ace-dawn .ace_support {\
color: #691C97\
}\
.ace-dawn .ace_support.ace_constant {\
color: #B4371F\
}\
.ace-dawn .ace_fold {\
background-color: #794938;\
border-color: #080808\
}\
.ace-dawn .ace_list,\
.ace-dawn .ace_markup.ace_list,\
.ace-dawn .ace_support.ace_function {\
color: #693A17\
}\
.ace-dawn .ace_storage {\
font-style: italic;\
color: #A71D5D\
}\
.ace-dawn .ace_string {\
color: #0B6125\
}\
.ace-dawn .ace_string.ace_regexp {\
color: #CF5628\
}\
.ace-dawn .ace_comment {\
font-style: italic;\
color: #5A525F\
}\
.ace-dawn .ace_heading,\
.ace-dawn .ace_markup.ace_heading {\
color: #19356D\
}\
.ace-dawn .ace_variable {\
color: #234A97\
}\
.ace-dawn .ace_indent-guide {\
background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAEklEQVQImWNgYGBgYLh/5+x/AAizA4hxNNsZAAAAAElFTkSuQmCC) right repeat-y\
}";

var dom = require("../lib/dom");
dom.importCssString(exports.cssText, exports.cssClass);
});
var global = Function("return this;")();
/*!
  * Ender: open module JavaScript framework (client-lib)
  * copyright Dustin Diaz & Jacob Thornton 2011 (@ded @fat)
  * http://ender.no.de
  * License MIT
  */
!function (context) {

  // a global object for node.js module compatiblity
  // ============================================

  context['global'] = context

  // Implements simple module system
  // losely based on CommonJS Modules spec v1.1.1
  // ============================================

  var modules = {}
    , old = context.$

  function require (identifier) {
    // modules can be required from ender's build system, or found on the window
    var module = modules[identifier] || window[identifier]
    if (!module) throw new Error("Requested module '" + identifier + "' has not been defined.")
    return module
  }

  function provide (name, what) {
    return (modules[name] = what)
  }

  context['provide'] = provide
  context['require'] = require

  function aug(o, o2) {
    for (var k in o2) k != 'noConflict' && k != '_VERSION' && (o[k] = o2[k])
    return o
  }

  function boosh(s, r, els) {
    // string || node || nodelist || window
    if (typeof s == 'string' || s.nodeName || (s.length && 'item' in s) || s == window) {
      els = ender._select(s, r)
      els.selector = s
    } else els = isFinite(s.length) ? s : [s]
    return aug(els, boosh)
  }

  function ender(s, r) {
    return boosh(s, r)
  }

  aug(ender, {
      _VERSION: '0.3.6'
    , fn: boosh // for easy compat to jQuery plugins
    , ender: function (o, chain) {
        aug(chain ? boosh : ender, o)
      }
    , _select: function (s, r) {
        return (r || document).querySelectorAll(s)
      }
  })

  aug(boosh, {
    forEach: function (fn, scope, i) {
      // opt out of native forEach so we can intentionally call our own scope
      // defaulting to the current item and be able to return self
      for (i = 0, l = this.length; i < l; ++i) i in this && fn.call(scope || this[i], this[i], i, this)
      // return self for chaining
      return this
    },
    $: ender // handy reference to self
  })

  ender.noConflict = function () {
    context.$ = old
    return this
  }

  if (typeof module !== 'undefined' && module.exports) module.exports = ender
  // use subscript notation as extern for Closure compilation
  context['ender'] = context['$'] = context['ender'] || ender

}(this);
// pakmanager:tar-js/utils
(function (context) {
  
  var module = { exports: {} }, exports = module.exports
    , $ = require("ender")
    ;
  
  /*
     * tar-js
     * MIT (c) 2011 T. Jameson Little
     */
    
    (function () {
    	"use strict";
    
    	var lookup = [
    			'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H',
    			'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P',
    			'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X',
    			'Y', 'Z', 'a', 'b', 'c', 'd', 'e', 'f',
    			'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n',
    			'o', 'p', 'q', 'r', 's', 't', 'u', 'v',
    			'w', 'x', 'y', 'z', '0', '1', '2', '3',
    			'4', '5', '6', '7', '8', '9', '+', '/'
    		];
    	function clean(length) {
    		var i, buffer = new Uint8Array(length);
    		for (i = 0; i < length; i += 1) {
    			buffer[i] = 0;
    		}
    		return buffer;
    	}
    
    	function extend(orig, length, addLength, multipleOf) {
    		var newSize = length + addLength,
    			buffer = clean((parseInt(newSize / multipleOf) + 1) * multipleOf);
    
    		buffer.set(orig);
    
    		return buffer;
    	}
    
    	function pad(num, bytes, base) {
    		num = num.toString(base || 8);
    		return "000000000000".substr(num.length + 12 - bytes) + num;
    	}	
    	
    	function stringToUint8 (input, out, offset) {
    		var i, length;
    
    		out = out || clean(input.length);
    
    		offset = offset || 0;
    		for (i = 0, length = input.length; i < length; i += 1) {
    			out[offset] = input.charCodeAt(i);
    			offset += 1;
    		}
    
    		return out;
    	}
    
    	function uint8ToBase64(uint8) {
    		var i,
    			extraBytes = uint8.length % 3, // if we have 1 byte left, pad 2 bytes
    			output = "",
    			temp, length;
    
    		function tripletToBase64 (num) {
    			return lookup[num >> 18 & 0x3F] + lookup[num >> 12 & 0x3F] + lookup[num >> 6 & 0x3F] + lookup[num & 0x3F];
    		};
    
    		// go through the array every three bytes, we'll deal with trailing stuff later
    		for (i = 0, length = uint8.length - extraBytes; i < length; i += 3) {
    			temp = (uint8[i] << 16) + (uint8[i + 1] << 8) + (uint8[i + 2]);
    			output += tripletToBase64(temp);
    		}
    
    		// this prevents an ERR_INVALID_URL in Chrome (Firefox okay)
    		switch (output.length % 4) {
    			case 1:
    				output += '=';
    				break;
    			case 2:
    				output += '==';
    				break;
    			default:
    				break;
    		}
    
    		return output;
    	}
    
    	module.exports.clean = clean;
    	module.exports.pad = pad;
    	module.exports.extend = extend;
    	module.exports.stringToUint8 = stringToUint8;
    	module.exports.uint8ToBase64 = uint8ToBase64;
    }());
    
  provide("tar-js/utils", module.exports);
}(global));

// pakmanager:tar-js/header
(function (context) {
  
  var module = { exports: {} }, exports = module.exports
    , $ = require("ender")
    ;
  
  /*
     * tar-js
     * MIT (c) 2011 T. Jameson Little
     */
    
    (function () {
    	"use strict";
    	
    /*
    struct posix_header {             // byte offset
    	char name[100];               //   0
    	char mode[8];                 // 100
    	char uid[8];                  // 108
    	char gid[8];                  // 116
    	char size[12];                // 124
    	char mtime[12];               // 136
    	char chksum[8];               // 148
    	char typeflag;                // 156
    	char linkname[100];           // 157
    	char magic[6];                // 257
    	char version[2];              // 263
    	char uname[32];               // 265
    	char gname[32];               // 297
    	char devmajor[8];             // 329
    	char devminor[8];             // 337
    	char prefix[155];             // 345
                                      // 500
    };
    */
    
    	var utils =  require('tar-js/utils'),
    		headerFormat;
    	
    	headerFormat = [
    		{
    			'field': 'fileName',
    			'length': 100
    		},
    		{
    			'field': 'fileMode',
    			'length': 8
    		},
    		{
    			'field': 'uid',
    			'length': 8
    		},
    		{
    			'field': 'gid',
    			'length': 8
    		},
    		{
    			'field': 'fileSize',
    			'length': 12
    		},
    		{
    			'field': 'mtime',
    			'length': 12
    		},
    		{
    			'field': 'checksum',
    			'length': 8
    		},
    		{
    			'field': 'type',
    			'length': 1
    		},
    		{
    			'field': 'linkName',
    			'length': 100
    		},
    		{
    			'field': 'ustar',
    			'length': 8
    		},
    		{
    			'field': 'owner',
    			'length': 32
    		},
    		{
    			'field': 'group',
    			'length': 32
    		},
    		{
    			'field': 'majorNumber',
    			'length': 8
    		},
    		{
    			'field': 'minorNumber',
    			'length': 8
    		},
    		{
    			'field': 'filenamePrefix',
    			'length': 155
    		},
    		{
    			'field': 'padding',
    			'length': 12
    		}
    	];
    
    	function formatHeader(data, cb) {
    		var buffer = utils.clean(512),
    			offset = 0;
    
    		headerFormat.forEach(function (value) {
    			var str = data[value.field] || "",
    				i, length;
    
    			for (i = 0, length = str.length; i < length; i += 1) {
    				buffer[offset] = str.charCodeAt(i);
    				offset += 1;
    			}
    
    			offset += value.length - i; // space it out with nulls
    		});
    
    		if (typeof cb === 'function') {
    			return cb(buffer, offset);
    		}
    		return buffer;
    	}
    	
    	module.exports.structure = headerFormat;
    	module.exports.format = formatHeader;
    }());
    
  provide("tar-js/header", module.exports);
}(global));

// pakmanager:tar-js
(function (context) {
  
  var module = { exports: {} }, exports = module.exports
    , $ = require("ender")
    ;
  
  /*
     * tar-js
     * MIT (c) 2011 T. Jameson Little
     */
    
    (function () {
    	"use strict";
    
    	var header =  require('tar-js/header'),
    		utils =  require('tar-js/utils'),
    		recordSize = 512,
    		blockSize;
    	
    	function Tar(recordsPerBlock) {
    		this.written = 0;
    		blockSize = (recordsPerBlock || 20) * recordSize;
    		this.out = utils.clean(blockSize);
    	}
    
    	Tar.prototype.append = function (filepath, input, opts, callback) {
    		var data,
    			checksum,
    			mode,
    			mtime,
    			uid,
    			gid,
    			headerArr;
    
    		if (typeof input === 'string') {
    			input = utils.stringToUint8(input);
    		} else if (input.constructor !== Uint8Array.prototype.constructor) {
    			throw 'Invalid input type. You gave me: ' + input.constructor.toString().match(/function\s*([$A-Za-z_][0-9A-Za-z_]*)\s*\(/)[1];
    		}
    
    		if (typeof opts === 'function') {
    			callback = opts;
    			opts = {};
    		}
    
    		opts = opts || {};
    
    		mode = opts.mode || parseInt('777', 8) & 0xfff;
    		mtime = opts.mtime || Math.floor(+new Date() / 1000);
    		uid = opts.uid || 0;
    		gid = opts.gid || 0;
    
    		data = {
    			fileName: filepath,
    			fileMode: utils.pad(mode, 7),
    			uid: utils.pad(uid, 7),
    			gid: utils.pad(gid, 7),
    			fileSize: utils.pad(input.length, 11),
    			mtime: utils.pad(mtime, 11),
    			checksum: '        ',
    			type: '0', // just a file
    			ustar: 'ustar  ',
    			owner: opts.owner || '',
    			group: opts.group || ''
    		};
    
    		// calculate the checksum
    		checksum = 0;
    		Object.keys(data).forEach(function (key) {
    			var i, value = data[key], length;
    
    			for (i = 0, length = value.length; i < length; i += 1) {
    				checksum += value.charCodeAt(i);
    			}
    		});
    
    		data.checksum = utils.pad(checksum, 6) + "\u0000 ";
    
    		headerArr = header.format(data);
    
    		var i, offset, length;
    
    		this.out.set(headerArr, this.written);
    
    		this.written += headerArr.length;
    
    		// If there is not enough space in this.out, we need to expand it to
    		// fit the new input.
    		if (this.written + input.length > this.out.length) {
    			this.out = utils.extend(this.out, this.written, input.length, blockSize);
    		}
    
    		this.out.set(input, this.written);
    
    		// to the nearest multiple of recordSize
    		this.written += input.length + (recordSize - (input.length % recordSize || recordSize));
    
    		// make sure there's at least 2 empty records worth of extra space
    		if (this.out.length - this.written < recordSize * 2) {
    			this.out = utils.extend(this.out, this.written, recordSize * 2, blockSize);
    		}
    
    		if (typeof callback === 'function') {
    			callback(this.out);
    		}
    
    		return this.out;
    	};
    
    	Tar.prototype.clear = function () {
    		this.written = 0;
    		this.out = utils.clean(blockSize);
    	};
    	
    	module.exports = Tar;
    }());
    
  provide("tar-js", module.exports);
}(global));
/**
 * angular-ui-ace - This directive allows you to add ACE editor elements.
 * @version v0.2.3 - 2015-01-29
 * @link http://angular-ui.github.com
 * @license MIT
 */
"use strict";angular.module("ui.ace",[]).constant("uiAceConfig",{}).directive("uiAce",["uiAceConfig",function(a){if(angular.isUndefined(window.ace))throw new Error("ui-ace need ace to work... (o rly?)");var b=function(a,b,c){if(angular.isDefined(c.workerPath)){var d=window.ace.require("ace/config");d.set("workerPath",c.workerPath)}angular.isDefined(c.require)&&c.require.forEach(function(a){window.ace.require(a)}),angular.isDefined(c.showGutter)&&a.renderer.setShowGutter(c.showGutter),angular.isDefined(c.useWrapMode)&&b.setUseWrapMode(c.useWrapMode),angular.isDefined(c.showInvisibles)&&a.renderer.setShowInvisibles(c.showInvisibles),angular.isDefined(c.showIndentGuides)&&a.renderer.setDisplayIndentGuides(c.showIndentGuides),angular.isDefined(c.useSoftTabs)&&b.setUseSoftTabs(c.useSoftTabs),angular.isDefined(c.showPrintMargin)&&a.setShowPrintMargin(c.showPrintMargin),angular.isDefined(c.disableSearch)&&c.disableSearch&&a.commands.addCommands([{name:"unfind",bindKey:{win:"Ctrl-F",mac:"Command-F"},exec:function(){return!1},readOnly:!0}]),angular.isString(c.theme)&&a.setTheme("ace/theme/"+c.theme),angular.isString(c.mode)&&b.setMode("ace/mode/"+c.mode),angular.isDefined(c.firstLineNumber)&&(angular.isNumber(c.firstLineNumber)?b.setOption("firstLineNumber",c.firstLineNumber):angular.isFunction(c.firstLineNumber)&&b.setOption("firstLineNumber",c.firstLineNumber()));var e,f;if(angular.isDefined(c.advanced))for(e in c.advanced)f={name:e,value:c.advanced[e]},a.setOption(f.name,f.value);if(angular.isDefined(c.rendererOptions))for(e in c.rendererOptions)f={name:e,value:c.rendererOptions[e]},a.renderer.setOption(f.name,f.value);angular.forEach(c.callbacks,function(b){angular.isFunction(b)&&b(a)})};return{restrict:"EA",require:"?ngModel",link:function(c,d,e,f){var g,h,i=a.ace||{},j=angular.extend({},i,c.$eval(e.uiAce)),k=window.ace.edit(d[0]),l=k.getSession(),m=function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1);angular.isDefined(a)&&c.$evalAsync(function(){if(!angular.isFunction(a))throw new Error("ui-ace use a function as callback.");a(b)})},n={onChange:function(a){return function(b){var d=l.getValue();!f||d===f.$viewValue||c.$$phase||c.$root.$$phase||c.$evalAsync(function(){f.$setViewValue(d)}),m(a,b,k)}},onBlur:function(a){return function(){m(a,k)}}};e.$observe("readonly",function(a){k.setReadOnly(!!a||""===a)}),f&&(f.$formatters.push(function(a){if(angular.isUndefined(a)||null===a)return"";if(angular.isObject(a)||angular.isArray(a))throw new Error("ui-ace cannot use an object or an array as a model");return a}),f.$render=function(){l.setValue(f.$viewValue)});var o=function(a,d){a!==d&&(j=angular.extend({},i,c.$eval(e.uiAce)),j.callbacks=[j.onLoad],j.onLoad!==i.onLoad&&j.callbacks.unshift(i.onLoad),l.removeListener("change",g),g=n.onChange(j.onChange),l.on("change",g),k.removeListener("blur",h),h=n.onBlur(j.onBlur),k.on("blur",h),b(k,l,j))};c.$watch(e.uiAce,o,!0),o(i),d.on("$destroy",function(){k.session.$stopWorker(),k.destroy()}),c.$watch(function(){return[d[0].offsetWidth,d[0].offsetHeight]},function(){k.resize(),k.renderer.updateFull()},!0)}}}]);
/**
 * An Angular module that gives you access to the browsers local storage
 * @version v0.5.1 - 2016-09-21
 * @link https://github.com/grevory/angular-local-storage
 * @author grevory <greg@gregpike.ca>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(a,b){var c=b.isDefined,d=b.isUndefined,e=b.isNumber,f=b.isObject,g=b.isArray,h=b.isString,i=b.extend,j=b.toJson;b.module("LocalStorageModule",[]).provider("localStorageService",function(){this.prefix="ls",this.storageType="localStorage",this.cookie={expiry:30,path:"/",secure:!1},this.defaultToCookie=!0,this.notify={setItem:!0,removeItem:!1},this.setPrefix=function(a){return this.prefix=a,this},this.setStorageType=function(a){return this.storageType=a,this},this.setDefaultToCookie=function(a){return this.defaultToCookie=!!a,this},this.setStorageCookie=function(a,b,c){return this.cookie.expiry=a,this.cookie.path=b,this.cookie.secure=c,this},this.setStorageCookieDomain=function(a){return this.cookie.domain=a,this},this.setNotify=function(a,b){return this.notify={setItem:a,removeItem:b},this},this.$get=["$rootScope","$window","$document","$parse","$timeout",function(a,b,k,l,m){function n(c){if(c||(c=b.event),s.setItem&&h(c.key)&&w(c.key)){var d=v(c.key);m(function(){a.$broadcast("LocalStorageModule.notification.changed",{key:d,newvalue:c.newValue,storageType:p.storageType})})}}var o,p=this,q=p.prefix,r=p.cookie,s=p.notify,t=p.storageType;k?k[0]&&(k=k[0]):k=document,"."!==q.substr(-1)&&(q=q?q+".":"");var u=function(a){return q+a},v=function(a){return a.replace(new RegExp("^"+q,"g"),"")},w=function(a){return 0===a.indexOf(q)},x=function(){try{var c=t in b&&null!==b[t],d=u("__"+Math.round(1e7*Math.random()));return c&&(o=b[t],o.setItem(d,""),o.removeItem(d)),c}catch(e){return p.defaultToCookie&&(t="cookie"),a.$broadcast("LocalStorageModule.notification.error",e.message),!1}},y=x(),z=function(b,c,e){if(K(e),c=d(c)?null:j(c),!y&&p.defaultToCookie||"cookie"===p.storageType)return y||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),s.setItem&&a.$broadcast("LocalStorageModule.notification.setitem",{key:b,newvalue:c,storageType:"cookie"}),F(b,c);try{o&&o.setItem(u(b),c),s.setItem&&a.$broadcast("LocalStorageModule.notification.setitem",{key:b,newvalue:c,storageType:p.storageType})}catch(f){return a.$broadcast("LocalStorageModule.notification.error",f.message),F(b,c)}return!0},A=function(b,c){if(K(c),!y&&p.defaultToCookie||"cookie"===p.storageType)return y||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),G(b);var d=o?o.getItem(u(b)):null;if(!d||"null"===d)return null;try{return JSON.parse(d)}catch(e){return d}},B=function(){var b=0;arguments.length>=1&&("localStorage"===arguments[arguments.length-1]||"sessionStorage"===arguments[arguments.length-1])&&(b=1,K(arguments[arguments.length-1]));var c,d;for(c=0;c<arguments.length-b;c++)if(d=arguments[c],!y&&p.defaultToCookie||"cookie"===p.storageType)y||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),s.removeItem&&a.$broadcast("LocalStorageModule.notification.removeitem",{key:d,storageType:"cookie"}),H(d);else try{o.removeItem(u(d)),s.removeItem&&a.$broadcast("LocalStorageModule.notification.removeitem",{key:d,storageType:p.storageType})}catch(e){a.$broadcast("LocalStorageModule.notification.error",e.message),H(d)}},C=function(b){if(K(b),!y)return a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),[];var c=q.length,d=[];for(var e in o)if(e.substr(0,c)===q)try{d.push(e.substr(c))}catch(f){return a.$broadcast("LocalStorageModule.notification.error",f.Description),[]}return d},D=function(b,c){K(c);var d=q?new RegExp("^"+q):new RegExp,e=b?new RegExp(b):new RegExp;if(!y&&p.defaultToCookie||"cookie"===p.storageType)return y||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),I();if(!y&&!p.defaultToCookie)return!1;var f=q.length;for(var g in o)if(d.test(g)&&e.test(g.substr(f)))try{B(g.substr(f))}catch(h){return a.$broadcast("LocalStorageModule.notification.error",h.message),I()}return!0},E=function(){try{return b.navigator.cookieEnabled||"cookie"in k&&(k.cookie.length>0||(k.cookie="test").indexOf.call(k.cookie,"test")>-1)}catch(c){return a.$broadcast("LocalStorageModule.notification.error",c.message),!1}}(),F=function(b,c,h,i){if(d(c))return!1;if((g(c)||f(c))&&(c=j(c)),!E)return a.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var l="",m=new Date,n="";if(null===c?(m.setTime(m.getTime()+-864e5),l="; expires="+m.toGMTString(),c=""):e(h)&&0!==h?(m.setTime(m.getTime()+24*h*60*60*1e3),l="; expires="+m.toGMTString()):0!==r.expiry&&(m.setTime(m.getTime()+24*r.expiry*60*60*1e3),l="; expires="+m.toGMTString()),b){var o="; path="+r.path;r.domain&&(n="; domain="+r.domain),"boolean"==typeof i?i===!0&&(n+="; secure"):r.secure===!0&&(n+="; secure"),k.cookie=u(b)+"="+encodeURIComponent(c)+l+o+n}}catch(p){return a.$broadcast("LocalStorageModule.notification.error",p.message),!1}return!0},G=function(b){if(!E)return a.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var c=k.cookie&&k.cookie.split(";")||[],d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(u(b)+"=")){var f=decodeURIComponent(e.substring(q.length+b.length+1,e.length));try{return JSON.parse(f)}catch(g){return f}}}return null},H=function(a){F(a,null)},I=function(){for(var a=null,b=q.length,c=k.cookie.split(";"),d=0;d<c.length;d++){for(a=c[d];" "===a.charAt(0);)a=a.substring(1,a.length);var e=a.substring(b,a.indexOf("="));H(e)}},J=function(){return t},K=function(a){return a&&t!==a&&(t=a,y=x()),y},L=function(a,b,d,e,g){e=e||b;var h=A(e,g);return null===h&&c(d)?h=d:f(h)&&f(d)&&(h=i(h,d)),l(b).assign(a,h),a.$watch(b,function(a){z(e,a,g)},f(a[b]))};y&&(b.addEventListener?(b.addEventListener("storage",n,!1),a.$on("$destroy",function(){b.removeEventListener("storage",n)})):b.attachEvent&&(b.attachEvent("onstorage",n),a.$on("$destroy",function(){b.detachEvent("onstorage",n)})));var M=function(a){K(a);for(var c=0,d=b[t],e=0;e<d.length;e++)0===d.key(e).indexOf(q)&&c++;return c};return{isSupported:y,getStorageType:J,setStorageType:K,set:z,add:z,get:A,keys:C,remove:B,clearAll:D,bind:L,deriveKey:u,underiveKey:v,length:M,defaultToCookie:this.defaultToCookie,cookie:{isSupported:E,set:F,add:F,get:G,remove:H,clearAll:I}}}]})}(window,window.angular);
//# sourceMappingURL=angular-local-storage.min.js.map
'use strict';

// Declare app level module which depends on filters, and services
angular.module('builder', [
    'ngRoute',
    'builder.filters',
    'builder.services',
    'builder.directives',
    'builder.controllers',
    'LocalStorageModule',
    'ui.ace',
    'angulartics',
    'angulartics.google.analytics'
]).config(['$routeProvider', '$locationProvider', function ($routeProvider, $locationProvider) {
    // Angular
    $routeProvider.when('/models', {templateUrl: 'partials/models.html', controller: 'ModelController'});
    $routeProvider.when('/home', {templateUrl: 'partials/home.html', controller: 'ModelController'});
    $routeProvider.otherwise({redirectTo: '/home'});
}]);
/* Controllers */

angular.module('builder.controllers', ['LocalStorageModule'])
    .controller('ModelController', ['$scope', '$http', 'ProjectFactory', 'ModelFactory', 'ModelParser', 'FieldFactory',
        'RelationshipFactory', 'localStorageService', 'MessageService', 'RenderFactory', 'TarballFactory',
        function ($scope, $http, project_factory, model_factory, ModelParser, field_factory,
                  relationship_factory, localStorageService, message_service, renderFactory, tarballFactory) {
            $scope.models = [];
            $scope.new_models = [];
            $scope.user_model = 'django.contrib.auth.models.User';
            $scope.user_model_setting = 'settings.AUTH_USER_MODEL';
            $scope.built_in_models = {
                'django.contrib.auth.models.User': {
                    fields: {
                        'username': {default:'username'},
                        'email': {default:'username@tempurl.com'}
                    }
                },
                'django.contrib.auth.models.Group': {
                    fields: {
                        'name': {default:'group'}
                    }
                },
                'django.contrib.contenttypes.models.ContentType': {
                    fields: {}
                }
            };
            $scope.messageService = new message_service();
            $scope.field_factory = new field_factory();
            $scope.project_factory = new project_factory();
            $scope.model_factory = model_factory;
            $scope.relationship_factory = new relationship_factory();
            $scope.render_factory = new renderFactory($scope.built_in_models);
            $scope.editors = [];
            $scope.models_storage_key = 'local_models';
            $scope._app_name = 'app_name';
            $scope._project_name = 'project_name';

            $scope.create_tar_ball_url = function(include_project){
                var README = 'Built with django_builder\n';
                var __init__ = '#';

                const project_name = $scope.project_name();
                const app_name = $scope.app_name();

                var models = $scope.render_factory.render_models_py(app_name, $scope.models);
                var views = $scope.render_factory.render_views_py(app_name, $scope.models);
                var admin = $scope.render_factory.render_admin_py(app_name, $scope.models);
                var urls = $scope.render_factory.render_urls_py(app_name, $scope.models);
                var tests = $scope.render_factory.render_tests_py(app_name, $scope.models);
                var forms = $scope.render_factory.render_forms_py(app_name, $scope.models);
                var api = $scope.render_factory.render_django_rest_framework_api_py(app_name, $scope.models);
                var serializers = $scope.render_factory.render_django_rest_framework_serializers_py(app_name, $scope.models);

                var templates = $scope.render_factory.render_templates_html(app_name, $scope.models);

                var tarfile = new tarballFactory();
                
                var root_folder = app_name;

                if(include_project){
                    root_folder = project_name+'/'+app_name

                    var project_settings = $scope.project_factory.render_project_settings_py(project_name, app_name);
                    var project_requirements = $scope.project_factory.render_project_requirements();
                    var project_urls = $scope.project_factory.render_project_urls_py(app_name);
                    var project_manage = $scope.project_factory.render_project_manage_py(project_name);
                    var project_wsgi = $scope.project_factory.render_project_wsgi_py(project_name);

                    tarfile.append('requirements.txt', project_requirements);
                    tarfile.append(project_name + '/manage.py', project_manage);
                    tarfile.append(project_name + '/' + project_name + '/settings.py', project_settings);
                    tarfile.append(project_name + '/' + project_name + '/urls.py', project_urls);
                    tarfile.append(project_name + '/' + project_name + '/wsgi.py', project_wsgi);
                    tarfile.append(project_name + '/' + project_name + '/__init__.py', __init__);
                }

                tarfile.append(root_folder+'/README.txt', README);
                tarfile.append(root_folder+'/__init__.py', __init__);
                tarfile.append(root_folder+'/models.py', models);
                tarfile.append(root_folder+'/views.py', views);
                tarfile.append(root_folder+'/admin.py', admin);
                tarfile.append(root_folder+'/urls.py', urls);
                tarfile.append(root_folder+'/tests.py', tests);
                tarfile.append(root_folder+'/forms.py', forms);
                tarfile.append(root_folder+'/api.py', api);
                tarfile.append(root_folder+'/serializers.py', serializers);
                tarfile.append(root_folder+'/templates/base.html', $scope.render_factory.render_base_html(app_name, $scope.models));

                jQuery.each(templates, function(i, template){
                    tarfile.append(root_folder+'/templates/'+app_name+'/'+template[0], template[1]);
                });

                return tarfile.get_url();
            };
            $scope.create_download_modal_app = function(){
                var download_url = $scope.create_tar_ball_url(false);
                var filename = $scope.app_name() + '.tar';
                var identifier = 'django_builder_download_app_modal';
                return $scope.create_download_modal(download_url, filename, identifier);
            };
            $scope.create_download_modal_project = function(){
                var download_url = $scope.create_tar_ball_url(true);
                var filename = $scope.project_name() + '.tar';

                var extra_message = jQuery('<p>');
                extra_message.text('The project download includes the following files:');
                var extra_ul = jQuery('<div>').addClass('well well-sm');
                extra_ul.append(jQuery("<p>").text('requirements.txt'));
                extra_ul.append(jQuery("<p>").text('manage.py'));
                extra_ul.append(jQuery("<p>").text($scope.project_name()+'/settings.py'));
                extra_ul.append(jQuery("<p>").text($scope.project_name()+'/urls.py'));
                extra_ul.append(jQuery("<p>").text($scope.project_name()+'/wsgi.py'));
                extra_message.append(jQuery("<br><br>"));
                extra_message.append(extra_ul);

                var identifier = 'django_builder_download_project_modal';
                return $scope.create_download_modal(download_url, filename, identifier, extra_message)
            };
            $scope.create_download_modal = function(download_url, filename, identifier, extra_message){

                var download_a = jQuery('<a>').attr('href', download_url).attr('id', 'django_builder_download_a');
                download_a.addClass('btn btn-success btn-lg').css('text-transform', 'none');
                download_a.text('Click here to download '+ filename);
                download_a.attr('download', filename);

                var download_button = jQuery('<div>').addClass('text-center').append(download_a);
                var download_message = jQuery('<div>');
                download_message.append(jQuery("<br>"));
                download_message.append("Chrome can block downloads of the generated tarball, if this happens navigate to the ");
                download_message.append(jQuery('<strong>').text('Downloads'));
                download_message.append(" section of chrome to accept the download");
                download_message.append(jQuery("<br>"));
                download_message.append("Window -> Downloads");

                var download_div = jQuery('<div>');
                if(extra_message!=undefined){
                    download_div.append(extra_message)
                }
                download_div.append(download_button);
                download_div.append(download_message);

                $scope.messageService.simple_info('Download info', download_div).modal('show').attr('id', identifier);
                return identifier;
            };
            $scope.render_model_class_fields_only = function (model) {
                return model.render_model_class_fields_only($scope._app_name, $scope.render_factory);
            };
            $scope.upload_input = function(){
                return jQuery('<input type="file" />');
            };
            $scope.upload_drop_target = function(input){
                var dnd = jQuery('<div>').addClass("builder_dnd_target text-center");
                var icon = jQuery('<i>').addClass("fa fa-upload fa-4x builder_dnd_icon");
                dnd.append(jQuery("<div>").text("Drag and Drop files here!"));
                dnd.append(icon)
                return dnd;
            };
            $scope.upload_form = function(input, dnd){
                var form = jQuery('<form>');
                var input_holder = jQuery('<span>').addClass("btn btn-default btn-file center-block builder_upload_models_py");
                input_holder.append("Browse");
                input_holder.append(input);
                form.append(input_holder);
                form.append(dnd);
                return form;
            };
            $scope.save_new_models = function(models){
                $scope.new_models = [];
                $scope.models = models;
                $scope.saveApp();
                $scope.$apply();
            },
            $scope.merge_models = function() {
                var merged_models = $scope.models.concat($scope.new_models);
                for(var i=0; i<merged_models.length; ++i) {
                    for(var j=i+1; j<merged_models.length; ++j) {
                        if(merged_models[i].name === merged_models[j].name) {
                            merged_models.splice(j--, 1);
                        }
                    }
                }
                return $scope.save_new_models(merged_models);
            },
            $scope.add_unique = function(){
                jQuery.each($scope.new_models, function (i, new_model) {
                    if(!$scope.existingModel(new_model.name)) {
                        $scope.models.push(new_model);
                    }
                });
                $scope.save_new_models($scope.models);
            },
            $scope.add_new_models = function(new_models){
                $scope.new_models = new_models;
                $scope.$apply();

                var add = function(){
                    console.log('Adding all models');
                    $scope.merge_models();
                }

                var overwrite_existing = function(){
                    console.log('Overwriting existing models');
                    $scope.merge_models();
                }

                var on_confirm = function () {
                    var are_duplicates = false;
                    var duplicates = [];

                    var duplicate_warning = jQuery('<p>').text('The following models are duplicates:');
                    jQuery.each($scope.new_models, function (i, new_model) {
                        if($scope.existingModel(new_model.name)){
                            are_duplicates = true;
                            duplicates.push(new_model);
                            duplicate_warning.append(jQuery('<div>').text(new_model.name));
                        };
                    });

                    var all_duplicates = duplicates.length == $scope.new_models.length;
                    if(are_duplicates){
                        var choices = [{text: 'Overwrite existing models', callback: overwrite_existing}]
                        if(!all_duplicates){
                            choices.push({text: 'Add unique', callback: $scope.add_unique})
                        }
                        choices.push({text: 'Cancel', callback: function(){}})
                        var duplicate_models_id = 'duplicate_models'
                        $scope.messageService.simple_choice(
                            'Add duplicate models?', duplicate_warning, choices
                        ).modal('show').attr('id', duplicate_models_id);
                    }else{
                        $scope.merge_models();
                    }
                };

                var model_rep = jQuery("<div>");

                jQuery.each($scope.new_models, function (i, new_model) {
                    model_rep.append(jQuery("<hr>"));
                    model_rep.append(jQuery("<pre>").html(new_model.render_model_class_fields_only($scope._app_name, $scope.render_factory)));
                    var remove_button = jQuery('<button class="btn btn-danger pull-right">').text('Remove');
                    model_rep.append(remove_button);
                    model_rep.append(jQuery("<div>").addClass('clearfix'));
                });

                var add_new_models_id = 'add_new_models'
                $scope.messageService.simple_confirm(
                    'Add the following models?', jQuery("#builder_new_models"), on_confirm
                ).modal('show').find('.modal-dialog').css('width', '50%').attr('id', add_new_models_id);
                return add_new_models_id;
            };

            $scope.process_models_py = function(files){
                if(files.length==0) {
                    $scope.messageService.simple_error('Sorry', "You didn't seem to choose any files.").modal('show');
                } else if(files.length>1){
                    $scope.messageService.simple_error('Sorry', "Multiple files not yet supported, please choose a single file.").modal('show');
                }else {
                    var parser = ModelParser($scope);
                    parser.parse(files[0], function(models){
                        $scope.add_new_models(models);
                    });
                }
            };
            $scope.upload_models_py = function(){
                var input =  $scope.upload_input();
                var drop_target = $scope.upload_drop_target();
                var form = $scope.upload_form(input, drop_target);

                var modal = $scope.messageService.simple_form(
                    'Upload models.py', 'Choose a models.py file to analyse',
                    form, function(){
                        $scope.process_models_py(jQuery(input)[0].files);
                        modal.modal('hide');
                    }
                ).modal('show');

                input.change(function(){
                    $scope.process_models_py(jQuery(input)[0].files);
                    modal.modal('hide');
                });

                form.on('drag dragstart dragend dragover dragenter dragleave drop', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                }).on('dragover dragenter', function() {
                    drop_target.addClass('is-drag-over');
                }).on('dragleave dragend drop', function() {
                    drop_target.removeClass('is-drag-over');
                }).on('drop', function(e) {
                    var droppedFiles = e.originalEvent.dataTransfer.files;
                    modal.modal('hide');
                    $scope.process_models_py(droppedFiles);
                });
            };

             jQuery('html body').on('drag dragstart dragend dragover dragenter dragleave drop', function(e) {
                e.preventDefault();
                e.stopPropagation();
                 // pass
            }).on('dragover dragenter', function() {
                // pass
            }).on('drop', function(e) {
                // pass
            });

            jQuery('#builder_models_content').on('drag dragstart dragend dragover dragenter dragleave drop', function(e) {
                e.preventDefault();
                e.stopPropagation();
            }).on('dragover dragenter', function() {
                jQuery(".builder_dnd_target").addClass("is-drag-over")
            }).on('drop', function(e) {
                jQuery(".builder_dnd_target").removeClass("is-drag-over")
                var droppedFiles = e.originalEvent.dataTransfer.files;
                $scope.process_models_py(droppedFiles);
            });

            $scope.aceLoad = function(_editor) {
                var _id = jQuery(_editor.container).attr("id");
                if(_id=="builder_models") {
                    _editor.setValue($scope.render_factory.render_models_py($scope.app_name(), $scope.models));
                }else if(_id=="builder_views"){
                    _editor.setValue($scope.render_factory.render_views_py($scope.app_name(), $scope.models));
                }else if(_id=="builder_admin"){
                    _editor.setValue($scope.render_factory.render_admin_py($scope.app_name(), $scope.models));
                }else if(_id=="builder_urls"){
                    _editor.setValue($scope.render_factory.render_urls_py($scope.app_name(), $scope.models));
                }else if(_id=="builder_tests"){
                    _editor.setValue($scope.render_factory.render_tests_py($scope.app_name(), $scope.models));
                }else if(_id=="builder_forms"){
                    _editor.setValue($scope.render_factory.render_forms_py($scope.app_name(), $scope.models));
                }else if(_id=="builder_django_rest_framework_api"){
                    _editor.setValue($scope.render_factory.render_django_rest_framework_api_py($scope.app_name(), $scope.models));
                }else if(_id=="builder_django_rest_framework_serializers"){
                    _editor.setValue($scope.render_factory.render_django_rest_framework_serializers_py($scope.app_name(), $scope.models));
                }
                _editor.session.selection.clearSelection();
            };

            $scope.reLoadAce = function() {
                Object.keys($scope.editors).map(function (k) {
                    $scope.aceLoad($scope.editors[k]);
                });
            };

            $scope.aceLoaded = function(_editor) {
                // Options
                _editor.setOptions({
                    readOnly: true,
                    highlightActiveLine: false,
                    highlightGutterLine: false,
                    maxLines: Infinity
                });
                _editor.renderer.$cursorLayer.element.style.opacity=0;
                $scope.aceLoad(_editor);
                $scope.editors.push(_editor);
            };

            $scope.$watch("[models,_app_name]", function() {
                $scope.reLoadAce();
                $scope.saveApp();
            }, true);

            $scope.aceChanged = function(e) {
                // console.log('aceChanged');
            };

            $scope.do_set_app_name = function (app_name) {
                $scope._app_name = app_name
            };
            $scope.set_app_name = function () {
                $scope.do_set_app_name(jQuery('input#appname').val());
                $scope.reLoadAce();
            };
            $scope.do_set_project_name = function (project_name) {
                $scope._project_name = project_name
            };
            $scope.set_project_name = function () {
                $scope.do_set_project_name(jQuery('input#projectname').val());
                $scope.reLoadAce();
            };
            $scope.l_app_name = function () {
                return $scope._app_name.toLowerCase();
            };

            $scope.app_name = function () {
                return $scope._app_name.replace(new RegExp(' ', 'g'), '_');
            };

            $scope.project_name = function () {
                return $scope._project_name.replace(new RegExp(' ', 'g'), '_');
            };

            $scope.updateModel = function(model){
                var ind = $scope.models.indexOf(model);
                $scope.models[ind] = model;
                $scope.$apply();
            };

            $scope.serializeApp = function(){
                var config = {
                    'models': $scope.models,
                    'app_config': {
                        'app_name': $scope._app_name
                    }
                };
                return JSON.stringify(config);
            };

            $scope.saveApp = function(){
                localStorageService.set($scope.models_storage_key, $scope.serializeApp());
            };
            $scope.doClearModels = function () {
                localStorageService.set($scope.models_storage_key, '');
                $scope.loadModels();
                $scope.models = [];
                $scope.$apply();
            };

            $scope.clearModels = function () {
                var on_confirm = function () {
                    $scope.doClearModels();
                };
                var identifier = 'clear_all';
                $scope.messageService.simple_confirm('Confirm', "Remove all models?", on_confirm).modal('show').attr('id', identifier);
                return identifier;
            };

            $scope.model_count = function() {
                return $scope.models.length;
            };

            $scope.add_model = function (model_name) {
                var model_opts = {"name": model_name};
                model_opts.fields = [
                    $scope.field_factory.make_field({
                        'name': 'name',
                        'type': 'django.db.models.CharField',
                        'opts': 'max_length=255'
                    }),
                    $scope.field_factory.make_field({
                        'name': 'slug',
                        'type': 'django_extensions.db.fields.AutoSlugField',
                        'opts': 'populate_from=\'name\', blank=True'
                    }),
                    $scope.field_factory.make_field({
                        'name': 'created',
                        'type': 'django.db.models.DateTimeField',
                        'opts': 'auto_now_add=True, editable=False'
                    }),
                    $scope.field_factory.make_field({
                        'name': 'last_updated',
                        'type': 'django.db.models.DateTimeField',
                        'opts': 'auto_now=True, editable=False'
                    })
                ];
                var model = model_factory(model_opts, $scope);
                $scope.models.push(model);
                $scope.saveApp();
                $scope.$apply();
            };
            $scope.existingModel = function (name) {
                var exists = false;
                jQuery.each($scope.models, function (i, model) {
                    if(name==model.name){
                        exists = true;
                    }
                });
                return exists;
            };
            $scope.addModel = function () {
                var add_model_callback = function(model_name){
                    if (model_name == undefined || model_name === '') {
                        $scope.messageService.simple_info('Model Name Required', "Enter a Model name").modal('show');
                    } else {
                        if($scope.existingModel(model_name)) {
                            $scope.messageService.simple_error('Error with Model Name', "There is already a model with the name "+model_name).modal('show');
                        }else{
                            $scope.add_model(model_name);
                        }
                    }
                };
                var identifier = 'add_model';
                $scope.messageService.simple_input(
                    'Model Name Required', "Enter a Model name",
                    "Model1", add_model_callback, true).modal('show').attr('id', identifier);
                return identifier;
            };
            $scope.cleanModel = function(model){
                delete model['$$hashKey'];
                if(model.fields!=undefined) {
                    jQuery.each(model.fields, function (i, field) {
                        delete field['$$hashKey'];
                    });
                }
                if(model.relationships!=undefined) {
                    jQuery.each(model.relationships, function (i, relationship) {
                        delete relationship['$$hashKey'];
                    });
                }
            };

            $scope.loadModels = function(){
                var loaded_app = localStorageService.get($scope.models_storage_key) || {'models': [], 'app_config': {'app_name': 'app_name'}};
                if(typeof loaded_app == "string"){loaded_app = JSON.parse(loaded_app);}
                var loaded_models = loaded_app["models"] || [];
                var loaded_app_config = loaded_app['app_config'] || { 'app_name': 'app_name'};
                $scope._app_name = loaded_app_config['app_name'];
                jQuery.each(loaded_models, function(i, model){
                    $scope.cleanModel(model);
                });
                return loaded_models;
            };

            $scope.loadModel = function(model_opts){
                var model = model_factory(model_opts, $scope);
                $scope.models.push(model);
            };

            $scope.__init__ = function() {
                jQuery.each($scope.loadModels(), function (i, model_opts) {
                    $scope.loadModel(model_opts);
                });
            };

            $scope.__init__();

            $scope.debug = function(){
                //console.log(JSON.stringify($scope.serializeApp()));
            };
            $scope.do_rename_model = function(index, new_model_name) {
                var rename_model_existing_id = 'rename_model_existing';
                var model = $scope.models[index];
                if($scope.existingModel(new_model_name)) {
                    $scope.messageService.simple_error(
                        'Error with Model Name',
                        "There is already a model with the name "+new_model_name
                    ).modal('show').attr('id', rename_model_existing_id);
                }else{
                    model.set_name(new_model_name);
                    $scope.updateModel(model);
                    $scope.$apply();
                }
            }
            $scope.rename_model = function(index){
                var model = $scope.models[index];
                var rename_model_id = 'rename_model';
                var rename_model_callback = function(new_model_name){
                    $scope.do_rename_model(index, new_model_name)
                };
                $scope.messageService.simple_input(
                    'Rename model', "Enter a new Model name", model.name, rename_model_callback, true
                ).modal('show').attr('id', rename_model_id);
                return rename_model_id
            };
            $scope.add_relationship = function (index) {
                const model = $scope.models[index];
                const on_input = function(output_form){
                    var name = output_form.find('input[name=name]').val().trim();
                    var to = output_form.find('select[name=to]').val().trim();
                    var external_app = true;
                    jQuery.each($scope.built_in_models, function(model_name, built_in_model){
                        if(to==model_name){
                            external_app = false;
                        }
                    });
                    jQuery.each($scope.models, function(i, model){
                        if(to==model.name){
                            external_app = false;
                        }
                    });

                    output_form.find('div.form-group-name').removeClass('has-error');
                    output_form.find('div.form-group-to').removeClass('has-error');
                    if(name===undefined||name==='') {
                        output_form.find('div.form-group-name').addClass('has-error')
                            .append(jQuery('<i>').addClass("fa fa-times form-control-feedback"))
                            .find('.help-block').removeClass('hide').text('Field Required');
                    } else if (to===undefined||to==='') {
                        output_form.find('div.form-group-to')
                            .addClass('has-error')
                            .append(jQuery('<i>').addClass("fa fa-times form-control-feedback"))
                            .find('.help-block').removeClass('hide').text('Field Required');
                    } else {
                        if(model.has_relationship(name)){
                            output_form.find('div.form-group-name')
                                .addClass('has-error')
                                .append(jQuery('<i>').addClass("fa fa-times form-control-feedback"))
                                .find('.help-block').removeClass('hide').text('Field \"'+name+'\" exists');
                        }else {
                            var _type = output_form.find('select[name=type]').val();
                            var opts = output_form.find('input[name=opts]').val();
                            var relationship = $scope.relationship_factory.make_relationship({
                                'name': name,
                                'type': _type,
                                'opts': opts,
                                'to': to,
                                'external_app': external_app
                            });
                            model.relationships.push(relationship);
                            $scope.updateModel(model);
                            $scope.$apply();
                            jQuery('.modal').modal('hide');
                        }
                    }
                };
                // TODO make form factory
                const form = jQuery('<form>');
                const form_div1 = jQuery('<div>').addClass('form-group form-group-name has-feedback').appendTo(form);
                const form_div2 = jQuery('<div>').addClass('form-group form-group-to').appendTo(form);
                const form_div3 = jQuery('<div>').addClass('form-group form-group-type').appendTo(form);
                const form_div4 = jQuery('<div>').addClass('form-group form-group-args').appendTo(form);
                form_div1.append(jQuery('<label>').text('Name'));
                form_div1.append(jQuery('<input>').attr('name', 'name').addClass('form-control'));
                form_div1.append(jQuery('<span>').text('error message').addClass('help-block hide'));

                const to_select = jQuery('<select>').attr('name', 'to').addClass('form-control');

                /* include built in models */
                const _opt_builtin = jQuery('<optgroup>').attr('label', 'Django models');
                jQuery.each($scope.built_in_models, function(model_name, built_in_model){
                    _opt_builtin.append(jQuery('<option>').attr('val', model_name).text(model_name));
                });
                to_select.append(_opt_builtin);

                /* include application models */
                const _opt_models = jQuery('<optgroup>').attr('label', 'Your App models');
                jQuery.each($scope.models, function(i, model){
                    _opt_models.append(jQuery('<option>').attr('val', model.name).text(model.name));
                });

                to_select.append(_opt_models);

                form_div2.append(jQuery('<label>').text('Relationship to Model'));
                form_div2.append(to_select);
                form_div2.append(jQuery('<p>').addClass("text-primary small clearfix").text('You can add external models (otherapp.models.Model1)').css('margin', '4px'));

                const type_select = jQuery('<select>').attr('name', 'type');

                jQuery.each($scope.relationship_factory.relationship_types(), function(i, relationship_type){
                    type_select.append(jQuery('<option>').attr('val', relationship_type).text(relationship_type));
                });

                form_div3.append(jQuery('<label>').text('Relationship Type'));
                form_div3.append(type_select);
                form_div4.append(jQuery('<label>').text('Arguments'));
                form_div4.append(jQuery('<input>').attr('name', 'opts').attr('placeholder', 'options').addClass('form-control'));

                // Setup select after adding to form
                to_select.select2({theme: "bootstrap", allowClear: true, placeholder: "Select a model.", tags: true, selectOnClose: true});
                type_select.select2({theme: "bootstrap"});

                const identifier = 'add_rel_'+model['name']+'_'+index;
                $scope.messageService.simple_form_no_dismiss('Add Relationship', '', form, on_input).modal('show')
                    .attr('id', identifier).appendTo('body');
                return identifier;

            };
            $scope.add_field = function (index) {
                var model = $scope.models[index];
                var on_input= function(output_form){
                    var name = output_form.find('input[name=name]').val();
                    if(name===undefined||name==='') {
                        output_form.find('div.form-group-name')
                            .addClass('has-error')
                            .append(jQuery('<i>').addClass("fa fa-times form-control-feedback"))
                            .find('.help-block').removeClass('hide').text('Field Required');
                    }else {
                        if(model.has_field(name)){
                            output_form.find('div.form-group-name')
                                .addClass('has-error')
                                .append(jQuery('<i>').addClass("fa fa-times form-control-feedback"))
                                .find('.help-block').removeClass('hide').text('Field \"'+name+'\" exists');
                        }else {
                            var type = output_form.find('select[name=type]').val();
                            var opts = output_form.find('input[name=opts]').val();
                            var field = $scope.field_factory.make_field({
                                'name': name,
                                'type': type,
                                'opts': opts
                            });
                            model.fields.push(field);
                            $scope.updateModel(model);
                            $scope.$apply();
                            jQuery('.modal').modal('hide');
                        }
                    }
                };
                // TODO make form factory
                var form = jQuery('<form>');
                var form_div1 = jQuery('<div>').addClass('form-group form-group-name  has-feedback').appendTo(form);
                var form_div2 = jQuery('<div>').addClass('form-group form-group-type').appendTo(form);
                var form_div3 = jQuery('<div>').addClass('form-group form-group-args').appendTo(form);
                form_div1.append(jQuery('<label>').text('Name'));
                form_div1.append(jQuery('<input>').attr('name', 'name').addClass('form-control'));
                form_div1.append(jQuery('<span>').text('error message').addClass('help-block hide'));

                var select = jQuery('<select>').attr('name', 'type').addClass('form-control');

                jQuery.each($scope.field_factory.field_types(), function(i, field_type){
                    select.append(jQuery('<option>').attr('val', field_type).text(field_type));
                });

                var options =  jQuery('<input>').attr('name', 'opts').attr('placeholder', 'options').addClass('form-control');

                form_div2.append(jQuery('<label>').text('Field Type'));
                form_div2.append(select);
                form_div3.append(jQuery('<label>').text('Arguments'));
                form_div3.append(options);

                select.change(function(){
                    options.val($scope.field_factory.default_field_args(select.val()));
                });
                options.val($scope.field_factory.default_field_args(select.val()));

                var identifier = 'add_field_'+model['name']+'_'+index;
                $scope.messageService.simple_form_no_dismiss('Add Field', '', form, on_input).modal('show')
                    .attr('id', identifier).appendTo('body');
                return identifier;
            };
            $scope.edit_relationship = function (model_index, relationship_index) {
                var relationship = $scope.models[model_index].relationships[relationship_index];
                var on_confirm = function(form){
                    relationship.form_update(form);
                    $scope.$apply();
                    jQuery('.modal').modal('hide');
                };
                var identifier = relationship['$$hashKey'] || 'edit_relationship_'+relationship.name;
                $scope.messageService.simple_form("Edit Relationship '" + relationship.name+"'",
                    "", relationship.edit_form($scope),
                    on_confirm).modal('show').attr('id', identifier).appendTo('body');
                return identifier;
            };
            $scope.edit_field = function (model_index, field_index) {
                var field = $scope.models[model_index].fields[field_index];
                var on_confirm = function(form){
                    field.form_update(form);
                    $scope.$apply();
                    jQuery('.modal').modal('hide');
                };
                var identifier = field['$$hashKey'] || 'edit_field_'+field.name;
                $scope.messageService.simple_form("Edit field '" + field.name+"'",
                    "", field.edit_form($scope),
                    on_confirm).modal('show').attr('id', identifier).appendTo('body');
                return identifier;
            };
            $scope.do_remove_new_model = function (model_index) {
                $scope.new_models.splice(model_index, 1)
                $scope.$apply();
            };
            $scope.remove_new_model = function (model_index) {
                setTimeout(function(){
                    $scope.do_remove_new_model(model_index);
                })
            };
            $scope.remove_relationship = function (model_index, relationship_index) {
                var on_confirm = function(){
                    $scope.models[model_index].relationships.splice(relationship_index, 1);
                    $scope.$apply();
                };
                var relationship = $scope.models[model_index].relationships[relationship_index];
                var identifier = relationship['$$hashKey'] || 'remove_relationship_'+relationship.name;
                $scope.messageService.simple_confirm('Confirm',
                        "Remove the relationship '" + relationship.name+"'",
                    on_confirm).modal('show').attr('id', identifier).appendTo('body');
                return identifier;
            };
            $scope.do_remove_new_relationship = function (model_index, relationship_index) {
                $scope.new_models[model_index].relationships.splice(relationship_index, 1);
            };
            $scope.remove_new_relationship = function (model_index, relationship_index) {
                setTimeout(function(){
                    $scope.do_remove_new_relationship(model_index, relationship_index);
                })
            };
            $scope.do_remove_new_field = function (model_index, field_index) {
                $scope.new_models[model_index].fields.splice(field_index, 1);
                $scope.$apply();
            };
            $scope.remove_new_field = function (model_index, field_index) {
                setTimeout(function(){
                    $scope.do_remove_new_field(model_index, field_index);
                })
            };
            $scope.remove_field = function (model_index, field_index) {
                var on_confirm = function(){
                    $scope.models[model_index].fields.splice(field_index, 1);
                    $scope.$apply();
                };
                var field = $scope.models[model_index].fields[field_index];
                var identifier = field['$$hashKey'] || 'remove_field_'+field.name;
                $scope.messageService.simple_confirm('Confirm',
                        "Remove the field '" + field.name+"'",
                    on_confirm).modal('show').attr('id', identifier).appendTo('body');
                return identifier;
            };
            $scope.remove_model = function (index) {
                var on_confirm = function(){
                    $scope.models.splice(index, 1);
                    $scope.$apply();
                };
                var model = $scope.models[index];
                var identifier = model['$$hashKey'] || 'remove_model_'+model.name;
                $scope.messageService.simple_confirm('Confirm',
                        "Remove the model '" + model.name +"'",
                    on_confirm).modal('show').modal('show').attr('id', identifier).appendTo('body');
                return identifier;
            };
            $scope.model_highlight = function (model_index, relationship_index) {
                var r = $scope.models[model_index].relationships[relationship_index];
                jQuery('.builder_model_'+ r.to_clean()).addClass('builder_model_highlight');
            };
            $scope.model_unhighlight = function () {
                jQuery('.builder_model').removeClass('builder_model_highlight');
            };
            $scope.new_model_highlight = function (model_index, relationship_index) {
                var r = $scope.new_models[model_index].relationships[relationship_index];
                jQuery('.builder_model_'+ r.to_clean()).addClass('builder_model_highlight');
            };
            $scope.new_model_unhighlight = function () {
                jQuery('.builder_model').removeClass('builder_model_highlight');
            };
        }]
);

'use strict';

/* Directives */


angular.module('builder.directives', []).
  directive('appVersion', ['version', function(version) {
    return function(scope, elm, attrs) {
      elm.text(version);
    };
  }]);

'use strict';

/* Filters */

angular.module('builder.filters', []).
  filter('interpolate', ['version', function(version) {
    return function(text) {
      return String(text).replace(/\%VERSION\%/mg, version);
    };
  }]);

/* Services */
function TarballFactory() {
    return function () {
        function Tarball() {
            var tf = this;
            var Tar = require('tar-js');
            var tarfile = new Tar();
            tf.uInt8ToString = function(buf) {
                var i, length, out = '';
                for (i = 0, length = buf.length; i < length; i += 1) {
                    out += String.fromCharCode(buf[i]);
                }
                return out;
            };
            tf.append = function (file_name, content) {
                tarfile.append(file_name, content)
            };
            tf.get_url = function (n) {
                var base64 = btoa(tf.uInt8ToString(tarfile.out));
                return "data:application/tar;base64," + base64;
            };
        }
        return new Tarball();
    };
}
function ModelRenderFactory() {
    return function (built_in_models) {
        var _this = this;
        _this.built_in_models = built_in_models;
        _this.spaces = function(n){
            var _n = n ||1;
            return new Array(_n+1).join(" ");
        };
        _this.model_names = function(models, suffix){
            var _suffix = suffix || '';
            return Object.keys(models).map(function (k) {
                return models[k].name+_suffix;
            });
        };
        _this.new_lines = function(n){
            var _n = n ||1;
            return new Array(_n+1).join("\n");
        };
        _this.render_all = function(app_name, models){
            // Primary used for testing
            var all_output = '';
            all_output+=_this.render_base_html(app_name, models);
            all_output+=_this.render_forms_py(app_name, models);
            all_output+=_this.render_urls_py(app_name, models);
            all_output+=_this.render_admin_py(app_name, models);
            all_output+=_this.render_views_py(app_name, models);
            all_output+=_this.render_models_py(app_name, models);
            all_output+=_this.render_django_rest_framework_api_py(app_name, models);
            all_output+=_this.render_django_rest_framework_serializers_py(app_name, models);
            all_output+=_this.render_templates_html(app_name, models);
            return all_output;
        };
        _this.render_base_html = function(app_name, models){
            return '<html><head></head><body>{% block content %}Replace this.{% endblock %}</body>';
        };
        _this.pre_imported_modules = function(n){
            return {
                // module, import as
                'django.contrib.auth.models': { as: 'auth_models'},
                'django.db.models': { as: 'models'},
                'django_extensions.db.fields': { as: 'extension_fields'}
            };
        };
        _this.pre_imported_modules_names = function(n){
            return Object.keys(_this.pre_imported_modules());
        };
        _this.render_forms_py = function (app_name, models) {
            var tests_py = 'from django import forms\n';

            tests_py += 'from .models import '+_this.model_names(models, '').join(', ')+'\n';
            tests_py += _this.new_lines(2);

            jQuery.each(models, function(i, model){
                tests_py += model.render_forms(app_name, _this);
            });

            return tests_py;
        };
        _this.render_tests_py = function (app_name, models) {
            var tests_py = 'import unittest\nfrom django.core.urlresolvers import reverse\nfrom django.test import Client\n';

            tests_py += 'from .models import '+_this.model_names(models, '').join(', ')+'\n';
            jQuery.each(_this.built_in_models, function(model, model_details){
                var model_split = model.split('.');
                var model_name = model_split.pop();
                var module_name = model_split.join('.');
                tests_py += 'from '+module_name+' import '+model_name;
                tests_py += _this.new_lines(1);
            });
            tests_py += _this.new_lines(2);

            jQuery.each(_this.built_in_models, function(model, model_details){
                var function_name = 'create_'+model.toLowerCase().replace(/\./g, '_');
                var model_name = model.split('.').pop();

                var test_helpers = '';
                test_helpers += 'def '+function_name+'(**kwargs):\n';
                test_helpers += _this.spaces(4)+'defaults = {}\n';
                jQuery.each(model_details.fields, function(field_name, field_options){
                    test_helpers += _this.spaces(4) + 'defaults[\"' + field_name + '\"] = \"'+field_options['default']+'\"\n';
                });
                test_helpers += _this.spaces(4)+'defaults.update(**kwargs)\n';
                test_helpers += _this.spaces(4)+'return '+model_name+'.objects.create(**defaults)\n';
                test_helpers += _this.new_lines(2);
                tests_py += test_helpers;

            });

            jQuery.each(models, function(i, model){
                tests_py += model.render_tests_helpers(app_name, _this);
            });

            jQuery.each(models, function(i, model){
                tests_py += model.render_tests(app_name, _this);
            });

            return tests_py;
        };
        _this.render_urls_py = function (app_name, models) {
            var urls_py = 'from django.conf.urls import url, include\n';
            urls_py += 'from rest_framework import routers'+_this.new_lines(1);
            urls_py += 'import api'+_this.new_lines(1);
            urls_py += 'import views'+_this.new_lines(2);

            urls_py +='router = routers.DefaultRouter()'+_this.new_lines(1);
            jQuery.each(models, function(i, model){
                urls_py +='router.register(r\''+model.l_name()+'\', api.'+model.name+'ViewSet)'+_this.new_lines(1);
            });
            urls_py += _this.new_lines(2);
            urls_py += 'urlpatterns = ('+_this.new_lines(1);
            urls_py += _this.spaces(4)+'# urls for Django Rest Framework API'+_this.new_lines(1);
            urls_py += _this.spaces(4)+'url(r\'^api/v1/\', include(router.urls)),'+_this.new_lines(1);
            urls_py += ')'+_this.new_lines(1);
            urls_py += _this.new_lines(1);

            jQuery.each(models, function(i, model){
                urls_py += model.render_urls(app_name, _this);
            });

            return urls_py;
        };
        _this.render_admin_py = function (app_name, models) {
            var views_py =  'from django.contrib import admin\nfrom django import forms\n';
            views_py += 'from .models import '+_this.model_names(models).join(', ');
            views_py += _this.new_lines(2);

            jQuery.each(models, function(i, model){
                views_py += model.render_admin_classes(app_name, _this);
            });

            return views_py;
        };
        _this.render_views_py = function (app_name, models) {
            var views_py =  'from django.views.generic import DetailView, ListView, UpdateView, CreateView\n';
            views_py += 'from .models import '+_this.model_names(models).join(', ');
            views_py += _this.new_lines(1);
            views_py += 'from .forms import '+_this.model_names(models, 'Form').join(', ');
            views_py += _this.new_lines(2);

            jQuery.each(models, function(i, model){
                views_py += model.render_view_classes(app_name, _this);
            });

            return views_py;
        };
        _this.render_models_py = function (app_name, models) {
            var models_py =  'from django.core.urlresolvers import reverse\n';
            models_py += 'from django_extensions.db.fields import AutoSlugField\n';
            models_py += 'from django.db.models import *\n';
            models_py += 'from django.conf import settings\n';
            models_py += 'from django.contrib.contenttypes.fields import GenericForeignKey\n';
            models_py += 'from django.contrib.contenttypes.models import ContentType\n';
            models_py += 'from django.contrib.auth import get_user_model\n';

            jQuery.each(_this.pre_imported_modules(), function(_import, import_conf){
                var _import_split = _import.split('.');
                var tail = _import_split.pop();
                models_py += 'from '+_import_split.join('.')+' import '+tail+' as '+import_conf['as']+'\n';
            });

            var all_imports = {};
            jQuery.each(models, function(i, model){
                jQuery.each(model.fields, function(i, field){
                    all_imports[field.module()] = field.module();
                });
            });

            var all_fields = {};
            jQuery.each(models, function(i, model){
                jQuery.each(model.fields, function(i, field){
                    all_fields[field.type] = field;
                });
                jQuery.each(model.relationships, function(i, relationship){
                    all_fields[relationship.type] = relationship;
                });
            });
            jQuery.each(all_fields, function(i, field){
                //if(_this.pre_imported_modules_names().indexOf(field.module()) == -1) {
                //    models_py += 'from ' + field.module() + ' import ' + field.class_name() + '\n';
                //}
            });
            models_py += _this.new_lines(2);

            jQuery.each(models, function(i, model){
                models_py += model.render_model_class(app_name, _this);
            });

            return models_py;
        };
        _this.render_templates_html = function (app_name, models) {
            var templates = [];

            jQuery.each(models, function(i, model){
                templates.push([model.l_name()+'_form.html', model.render_form_html(app_name)]);
                templates.push([model.l_name()+'_detail.html', model.render_detail_html(app_name)]);
                templates.push([model.l_name()+'_list.html', model.render_list_html(app_name)]);
            });

            return templates;
        };
        _this.render_django_rest_framework_api_py = function (app_name, models) {
            var api_py = 'import models\n';
            api_py += 'import serializers\n';
            api_py += 'from rest_framework import viewsets, permissions\n';
            api_py += _this.new_lines(2);

            jQuery.each(models, function(i, model){
                api_py += model.render_model_api(app_name, _this);
            });

            return api_py;
        };
        _this.render_django_rest_framework_serializers_py = function (app_name, models) {
            var serializers_py = 'import models';
            serializers_py += _this.new_lines(2);
            serializers_py += 'from rest_framework import serializers';
            serializers_py += _this.new_lines(3);

            jQuery.each(models, function(i, model){
                serializers_py += model.render_model_serializer(app_name, _this);
            });

            return serializers_py;
        };

    };
}
function MessageServiceFactory() {
    return function () {
        var _this = this;
        _this.base_modal = function () {
            /*
             <div class="modal fade">
             <div class="modal-dialog">
             <div class="modal-content">
             <div class="modal-header">
             <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
             <h4 class="modal-title">Modal title</h4>
             </div>
             <div class="modal-body">
             <p>One fine body&hellip;</p>
             </div>
             <div class="modal-footer">
             <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
             <button type="button" class="btn btn-primary">Save changes</button>
             </div>
             </div><!-- /.modal-content -->
             </div><!-- /.modal-dialog -->
             </div><!-- /.modal -->
             */
            var base = jQuery('<div>').addClass("modal fade");
            base.attr("tabindex", "-1");
            base.attr("role", "dialog");
            base.css("display", "none");

            var modal_dialog = jQuery('<div>').addClass("modal-dialog");
            var modal_content = jQuery('<div>').addClass("modal-content").appendTo(modal_dialog);
            var modal_header_inner = jQuery('<h2>').addClass("modal-header-inner");
            jQuery('<div>').addClass("modal-header").appendTo(modal_content).append(modal_header_inner);
            jQuery('<div>').addClass("modal-body").appendTo(modal_content);
            jQuery('<div>').addClass("modal-footer").appendTo(modal_content);

            base.append(modal_dialog);

            return base;
        };
        _this.icon = function (icon_name) {
            return jQuery('<icon>').addClass('fa').addClass(icon_name);
        };
        _this.simple_error = function (title, message) {
            var simple_info = _this.base_modal();
            var i = _this.icon('fa-info').addClass('pull-right');
            simple_info.find(".modal-header-inner").append(i).append(jQuery('<span>').text(title));
            simple_info.find(".modal-body").empty().append(message);
            var ok_button = jQuery('<button>').addClass('btn btn-default').text('Ok');
            simple_info.find(".modal-footer").append(ok_button);
            ok_button.attr("data-dismiss", "modal");
            simple_info.modal();
            return simple_info;
        };
        _this.simple_info = function (title, message) {
            var simple_info = _this.base_modal();
            var i = _this.icon('fa-info').addClass('pull-right');
            simple_info.find(".modal-header-inner").append(i).append(jQuery('<span>').text(title));
            simple_info.find(".modal-body").empty().append(message);
            var ok_button = jQuery('<button>').addClass('btn btn-default').text('Ok');
            simple_info.find(".modal-footer").append(ok_button);
            ok_button.attr("data-dismiss", "modal");
            simple_info.modal();
            return simple_info;
        };
        _this.simple_confirm = function (title, message, callback) {
            var _callback = callback || jQuery.noop;
            var simple_confirm = _this.base_modal();
            simple_confirm.find(".modal-header-inner").html(title);
            simple_confirm.find(".modal-body").empty().append(message);
            var confirm_button = jQuery('<button>').addClass('btn btn-primary').text('Ok');
            var cancel_button = jQuery('<button>').addClass('btn btn-default').text('Cancel');
            simple_confirm.find(".modal-footer").append(confirm_button).append(cancel_button);
            confirm_button.click(function () {
                _callback();
            });
            cancel_button.attr("data-dismiss", "modal");
            confirm_button.attr("data-dismiss", "modal");
            simple_confirm.modal();
            return simple_confirm;
        };
        _this.simple_choice = function (title, message, choices) {
            var simple_choice = _this.base_modal();
            simple_choice.find(".modal-header-inner").html(title);
            simple_choice.find(".modal-body").empty().append(message);
            jQuery.each(choices, function (i, choice) {
                var choice_button = jQuery('<button>').addClass('btn btn-primary').text(choice['text']);
                simple_choice.find(".modal-footer").append(choice_button);
                choice_button.click(function () {
                    choice['callback']();
                });
                choice_button.attr("data-dismiss", "modal");
            });
            simple_choice.modal();
            return simple_choice;
        };
        _this.simple_form = function (title, message, form, callback, no_dismiss) {
            var _callback = callback || jQuery.noop;
            var _no_dismiss = no_dismiss || true;
            var simple_confirm = _this.base_modal();
            simple_confirm.find(".modal-header-inner").html(title);
            simple_confirm.find(".modal-body").empty().append(message).append(form);
            var confirm_button = jQuery('<button>').addClass('btn btn-primary').text('Ok');
            var cancel_button = jQuery('<button>').addClass('btn btn-default').text('Cancel');
            simple_confirm.find(".modal-footer").append(confirm_button).append(cancel_button);
            confirm_button.click(function () {
                if(!_no_dismiss) {
                    simple_confirm.modal('hide');
                }
                _callback(form);
            });
            cancel_button.attr("data-dismiss", "modal");
            if(!_no_dismiss) {
                confirm_button.attr("data-dismiss", "modal");
            }
            simple_confirm.modal();
            return simple_confirm;
        };
        _this.simple_form_no_dismiss = function (title, message, form, callback) {
            return _this.simple_form(title, message, form, callback, true);
        };
        _this.simple_input = function (title, message, default_value, callback, required) {
            var _callback = callback || jQuery.noop;
            var _required = required || false;
            var simple_input = _this.base_modal();
            simple_input.find(".modal-header-inner").html(title);
            var label = jQuery('<label>').text(message);
            var input = jQuery('<input>').attr('type', 'text').attr('name', 'input').addClass('form-control').attr('value', default_value);
            var input_help = jQuery('<span>').text('error message').addClass('help-block hide');
            var input_group = jQuery('<div>').addClass('form-group form-group-input has-feedback').append(label).append(input).append(input_help);
            var submit_handler = function(){
                var _input = input.val();
                if(_required && (_input=='' || input==undefined)){
                    input_group.addClass('has-error')
                        .append(jQuery('<i>').addClass("fa fa-times form-control-feedback"))
                        .find('.help-block').removeClass('hide').text('Field Required');
                }else{
                    simple_input.modal('hide');
                    _callback(_input);
                }
            };
            var input_form = jQuery('<form>').append(input_group).submit(function( event ) {
                event.preventDefault();
                submit_handler();
            });
            simple_input.find(".modal-body").empty().append(input_form);
            var confirm_button = jQuery('<button>').addClass('btn btn-primary').text('Ok');
            var cancel_button = jQuery('<button>').addClass('btn btn-default').text('Cancel');
            simple_input.find(".modal-footer").append(confirm_button).append(cancel_button);

            confirm_button.click(submit_handler);
            cancel_button.attr("data-dismiss", "modal");
            if(!_required){confirm_button.attr("data-dismiss", "modal");}
            simple_input.modal();
            return simple_input;
        };
    };
}
function RelationshipFactory() {
    return function (options) {
        var _this = this;
        _this.relationship_types = function () {
            return [
                'django.db.models.ForeignKey',
                'django.db.models.OneToOneField',
                'django.db.models.ManyToManyField'
            ];
        };
        _this.relationship_matches = function () {
            return _this.relationship_types + [
                'ForeignKey',
                'OneToOneField',
                'ManyToManyField',
                'models.ForeignKey',
                'models.OneToOneField',
                'models.ManyToManyField'
            ]
        };
        _this.relationship_match = function (rel) {
            return _this.relationship_matches().indexOf(rel) != -1;
        };
        function Relationship(options) {
            this.name = options['name'];
            this.type = options['type'];
            this.opts = options['opts'];
            this.to = options['to'];
            this.external_app = options['external_app'] || false;
            this.class_name = function () {
                return this.type.split('.').reverse()[0]
            };
            this.form_update = function (form) {
                this.name = jQuery(form).find('input[name=name]').val();
                this.type = jQuery(form).find('select[name=type]').val();
                this.opts = jQuery(form).find('input[name=opts]').val();
                this.to = jQuery(form).find('input[name=to]').val();
            };
            this.to_clean = function () {
                return this.to.replace(/['"]+/g, '')
            };
            this.to_class = function () {
                return this.to.split('.').reverse().shift();
            };
            this.opts_args = function () {
                return this.opts.split(',').join(', ');
            };
            this.to_module = function () {
                var split = this.to.split('.');
                return split.slice(0, split.length-1).join('.');
            };
            this.module = function () {
                var split = this.type.split('.');
                return split.slice(0, split.length-1).join('.');
            };
            this.edit_form = function ($scope) {
                var form = jQuery('<form>');
                var form_div1 = jQuery('<div>').addClass('form-group form-group-name has-feedback').appendTo(form);
                var form_div2 = jQuery('<div>').addClass('form-group form-group-type').appendTo(form);
                var form_div3 = jQuery('<div>').addClass('form-group form-group-args').appendTo(form);
                var form_div4 = jQuery('<div>').addClass('form-group form-group-args').appendTo(form);
                form_div1.append(jQuery('<label>').text('Name'));
                form_div1.append(jQuery('<input>').attr('name', 'name').addClass('form-control').val(this.name));
                form_div1.append(jQuery('<span>').text('error message').addClass('help-block hide'));

                form_div2.append(jQuery('<label>').text('To'));
                form_div2.append(jQuery('<input>').attr('name', 'to')
                    .attr('placeholder', 'to').addClass('form-control').val(this.to));

                var select = jQuery('<select>').attr('name', 'type').addClass('form-control');
                var that = this;
                jQuery.each($scope.relationship_factory.relationship_types(), function(i, field_type){
                    var input = jQuery('<option>').attr('val', field_type).text(field_type);
                    if(field_type==that.type){
                        input.attr('selected', 'selected');
                    }
                    select.append(input);
                });
                form_div3.append(jQuery('<label>').text('Field Type'));
                form_div3.append(select);
                form_div4.append(jQuery('<label>').text('Arguments'));
                form_div4.append(jQuery('<input>').attr('name', 'opts')
                    .attr('placeholder', 'options').addClass('form-control').val(this.args));
                return form;
            };
        }
        _this.make_relationship = function (options) {
            return new Relationship(options);
        }
    };
}                
function FieldFactory() {
    return function (options) {
        var _this = this;
        _this.fields = function () {
            return {
                'django.db.models.TextField': {default_args: 'max_length=100'},
                'django.db.models.CharField': {default_args: 'max_length=30'},
                'django.contrib.contenttypes.fields.GenericForeignKey': {default_args: '\"content_type\", \"object_id\"'},
                'django_extensions.db.fields.AutoSlugField': {},
                'django.db.models.CommaSeparatedIntegerField': {},
                'django.db.models.BigAutoField': {},
                'django.db.models.BigIntegerField': {},
                'django.db.models.BooleanField': {},
                'django.db.models.DateField': {},
                'django.db.models.DateTimeField': {},
                'django.db.models.DecimalField': {default_args: 'max_digits=10, decimal_places=2'},
                'django.db.models.DurationField': {},
                'django.db.models.FileField': {default_args: 'upload_to=\"/upload/files/\"'},
                'django.db.models.ImageField': {default_args: 'upload_to=\"/upload/images/\"'},
                'django.db.models.FilePathField': {},
                'django.db.models.FloatField': {},
                'django.db.models.IntegerField': {},
                'django.db.models.PositiveIntegerField': {},
                'django.db.models.PositiveSmallIntegerField': {},
                'django.db.models.SlugField': {},
                'django.db.models.IPAddressField': {},
                'django.db.models.GenericIPAddressField': {},
                'django.db.models.NullBooleanField': {},
                'django.db.models.TimeField': {},
                'django.db.models.BinaryField': {},
                'django.db.models.AutoField': {},
                'django.db.models.SmallIntegerField': {},
                'django.db.models.URLField': {},
                'django.db.models.UUIDField': {},
                'django.db.models.EmailField': {}
            };
        };
        _this.default_field_args = function (field_type) {
            var _field = _this.fields()[field_type];
            if(_field && _field['default_args']){ return _field['default_args']}
            return '';
        };
        _this.field_types = function () {
            return Object.keys(_this.fields());
        };
        function Field(options) {
            this.name = options['name'];
            this.type = options['type'];
            this.opts = options['opts'] || '';
            this.class_name = function () {
                return this.type.split('.').reverse()[0]
            };
            this.opts_args = function () {
                return this.opts.split(',').join(', ');
            };
            this.to_clean = function () {
                return this.to.replace(/['"]+/g, '')
            };
            this.module = function () {
                var split = this.type.split('.');
                return split.slice(0, split.length-1).join('.');
            };
            this.form_update = function (form) {
                this.name = jQuery(form).find('input[name=name]').val();
                this.type = jQuery(form).find('select[name=type]').val();
                this.opts = jQuery(form).find('input[name=opts]').val();
            };
            this.edit_form = function ($scope) {
                var form = jQuery('<form>');
                var form_div1 = jQuery('<div>').addClass('form-group form-group-name has-feedback').appendTo(form);
                var form_div2 = jQuery('<div>').addClass('form-group form-group-type').appendTo(form);
                var form_div3 = jQuery('<div>').addClass('form-group form-group-args').appendTo(form);
                form_div1.append(jQuery('<label>').text('Name'));
                form_div1.append(jQuery('<input>').attr('name', 'name').addClass('form-control').val(this.name));
                form_div1.append(jQuery('<span>').text('error message').addClass('help-block hide'));
                var select = jQuery('<select>').attr('name', 'type').addClass('form-control');
                var that = this;
                jQuery.each($scope.field_factory.field_types(), function(i, field_type){
                    var input = jQuery('<option>').attr('val', field_type).text(field_type);
                    if(field_type==that.type){
                        input.attr('selected', 'selected');
                    }
                    select.append(input);
                });
                form_div2.append(jQuery('<label>').text('Field Type'));
                form_div2.append(select);
                form_div3.append(jQuery('<label>').text('Arguments'));
                form_div3.append(jQuery('<input>').attr('name', 'opts')
                    .attr('placeholder', 'options').addClass('form-control').val(this.opts));
                return form;
            };
        }
        _this.make_field = function (options) {
            return new Field(options);
        }
    };
}
function ModelServiceFactory() {
    return function (options, $scope) {
        function Model(options) {
            this.slugify = function(text) {
                return text.toString()
                    .replace(/\s+/g, '')            // Replace spaces with _
                    .replace(/[^\w\-]+/g, '')       // Remove all non-word chars
                    .replace(/\-\-+/g, '')          // Replace multiple - with single _
                    .replace(/^-+/, '')             // Trim - from start of text
                    .replace(/-+$/, '');            // Trim - from end of text
            };
            this.set_name = function(raw_name){
                this.name = this.slugify(raw_name);
            };
            this.set_name(options['name']);
            this.fields = [];
            var fields = options['fields'] || [];
            this.fields = (options['fields'] || []).map($scope.field_factory.make_field);
            this.relationships = (options['relationships'] || []).map($scope.relationship_factory.make_relationship);
            this.relationship_names = function(){
                var that = this;
                return Object.keys(that.relationships).map(function (k) {
                    return that.relationships[k].name
                });
            };
            this.field_names = function(){
                var that = this;
                return Object.keys(that.fields).map(function (k) {
                    return that.fields[k].name
                });
            };
            this.l_name = function () {
                return this.name.toLowerCase()
            };

            this.has_relationship = function (relationship_name) {
                return this.relationship_names().indexOf(relationship_name) != -1;
            };
            this.has_field = function (field_name) {
                return this.field_names().indexOf(field_name) != -1;
            };
            this.name_field = function () {
                // TODO - find another auto_add_now_field
                if(this.field_names().indexOf('name')!=-1){
                    return 'name';
                }else{
                    return 'id';
                }
            };
            this.ordering_field = function () {
                // TODO - find another auto_add_now_field
                if(this.field_names().indexOf('created')!=-1){
                    return 'created';
                }else{
                    return 'id';
                }
            };
            this.identifier = function () {
                // TODO - find another name AutoSlugField
                if(this.field_names().indexOf('slug')!=-1){
                    return 'slug';
                }else{
                    return 'id';
                }
            };
            this.render_forms = function(app_name, renderer){
                var urls = '';

                urls += 'class '+this.name+'Form(forms.ModelForm):\n';
                urls += renderer.spaces(4)+'class Meta:\n';
                urls += renderer.spaces(8)+'model = '+this.name+'\n';
                if(this.form_fields()) {
                    urls += renderer.spaces(8) + 'fields = ' + this.form_fields() + '\n';
                }
                urls += renderer.new_lines(2);

                return urls;
            };
            this.get_initial_data = function(app_name, renderer){
                var initial = '{';
                initial += renderer.new_lines(1);
                jQuery.each(this.readable_fields(), function(i, field){
                    initial += renderer.spaces(12)+'\"'+field.name+'\": \"'+field.name+'\",';
                    initial += renderer.new_lines(1);
                });
                jQuery.each(this.relationships, function(i, relationship){
                    initial += renderer.spaces(12)+'\"'+relationship.name+'\": create_'+relationship.to.toLowerCase().replace(/\./g, '_')+'().id,';
                    initial += renderer.new_lines(1);
                });
                initial += renderer.spaces(8)+'}';
                return initial;
            };
            this.render_tests_helpers = function(app_name, renderer) {
                var test_helpers = '';
                test_helpers += 'def create_'+this.l_name()+'(**kwargs):\n';
                test_helpers += renderer.spaces(4)+'defaults = {}\n';
                jQuery.each(this.readable_fields(), function(i, field){
                    test_helpers += renderer.spaces(4) + 'defaults[\"' + field.name + '\"] = \"'+field.name+'\"\n';
                });
                test_helpers += renderer.spaces(4)+'defaults.update(**kwargs)\n';
                jQuery.each(this.relationships, function(i, relationship){
                    test_helpers += renderer.spaces(4)+'if \"'+relationship.name+'\" not in defaults:\n';
                    var helper_create = 'create_'+relationship.to.toLowerCase().replace(/\./g, '_');

                    if(renderer.built_in_models[relationship.to]){
                        helper_create = 'create_'+relationship.to.toLowerCase().replace(/\./g, '_');
                    }

                    test_helpers += renderer.spaces(8)+'defaults[\"'+relationship.name+'\"] = '+helper_create+'()\n';
                });
                test_helpers += renderer.spaces(4)+'return '+this.name+'.objects.create(**defaults)\n';
                test_helpers += renderer.new_lines(2);
                return test_helpers;
            };
            this.render_tests = function(app_name, renderer){
                var tests = '';

                tests += 'class '+this.name+'ViewTest(unittest.TestCase):\n';
                tests += renderer.spaces(4)+'\'\'\'\n';
                tests += renderer.spaces(4)+'Tests for '+this.name+'\n';
                tests += renderer.spaces(4)+'\'\'\'\n';
                tests += renderer.spaces(4)+'def setUp(self):\n';

                tests += renderer.spaces(8)+'self.client = Client()\n';
                tests += renderer.new_lines(1);

                tests += renderer.spaces(4)+'def test_list_'+this.l_name()+'(self):\n';
                tests += renderer.spaces(8)+'url = reverse(\''+app_name+'_'+this.l_name()+'_list\')\n';
                tests += renderer.spaces(8)+'response = self.client.get(url)\n';
                tests += renderer.spaces(8)+'self.assertEqual(response.status_code, 200)\n';
                tests += renderer.new_lines(1);

                tests += renderer.spaces(4)+'def test_create_'+this.l_name()+'(self):\n';
                tests += renderer.spaces(8)+'url = reverse(\''+app_name+'_'+this.l_name()+'_create\')\n';
                tests += renderer.spaces(8)+'data = '+this.get_initial_data(app_name, renderer)+'\n';
                tests += renderer.spaces(8)+'response = self.client.post(url, data=data)\n';
                tests += renderer.spaces(8)+'self.assertEqual(response.status_code, 302)\n';
                tests += renderer.new_lines(1);

                tests += renderer.spaces(4)+'def test_detail_'+this.l_name()+'(self):\n';
                tests += renderer.spaces(8)+this.l_name()+' = create_'+this.l_name()+'()\n';
                tests += renderer.spaces(8)+'url = reverse(\''+app_name+'_'+this.l_name()+'_detail\', args=['+this.l_name()+'.'+this.identifier()+',])\n';
                tests += renderer.spaces(8)+'response = self.client.get(url)\n';
                tests += renderer.spaces(8)+'self.assertEqual(response.status_code, 200)\n';
                tests += renderer.new_lines(1);

                tests += renderer.spaces(4)+'def test_update_'+this.l_name()+'(self):\n';
                tests += renderer.spaces(8)+this.l_name()+' = create_'+this.l_name()+'()\n';
                tests += renderer.spaces(8)+'data = '+this.get_initial_data(app_name, renderer)+'\n';
                tests += renderer.spaces(8)+'url = reverse(\''+app_name+'_'+this.l_name()+'_update\', args=['+this.l_name()+'.'+this.identifier()+',])\n';
                tests += renderer.spaces(8)+'response = self.client.post(url, data)\n';
                tests += renderer.spaces(8)+'self.assertEqual(response.status_code, 302)\n';
                tests += renderer.new_lines(2);

                return tests;
            };
            this.render_urls = function(app_name, renderer){
                var urls = '';

                urls += 'urlpatterns += (\n';
                urls += renderer.spaces(4)+'# urls for '+this.name+'\n';

                urls += renderer.spaces(4)+'url(r\'^'+app_name+'/'+this.l_name()+'/$\', views.'+this.name+'ListView.as_view(), name=\''+app_name+'_'+this.l_name()+'_list\'),\n';
                urls += renderer.spaces(4)+'url(r\'^'+app_name+'/'+this.l_name()+'/create/$\', views.'+this.name+'CreateView.as_view(), name=\''+app_name+'_'+this.l_name()+'_create\'),\n';
                urls += renderer.spaces(4)+'url(r\'^'+app_name+'/'+this.l_name()+'/detail/(?P<'+this.identifier()+'>\\S+)/$\', views.'+this.name+'DetailView.as_view(), name=\''+app_name+'_'+this.l_name()+'_detail\'),\n';
                urls += renderer.spaces(4)+'url(r\'^'+app_name+'/'+this.l_name()+'/update/(?P<'+this.identifier()+'>\\S+)/$\', views.'+this.name+'UpdateView.as_view(), name=\''+app_name+'_'+this.l_name()+'_update\'),\n';

                urls += ')\n';
                urls += renderer.new_lines(1);

                return urls;
            };
            this.render_admin_classes = function(app_name, renderer){
                var admin_classes = '';
                admin_classes += 'class '+this.name+'AdminForm(forms.ModelForm):\n';
                admin_classes += renderer.new_lines(1);
                admin_classes += renderer.spaces(4)+'class Meta:\n';
                admin_classes += renderer.spaces(8)+'model = '+this.name+'\n';
                admin_classes += renderer.spaces(8)+'fields = \'__all__\'\n';
                admin_classes += renderer.new_lines(2);

                admin_classes += 'class '+this.name+'Admin(admin.ModelAdmin):\n';
                admin_classes += renderer.spaces(4)+'form = '+this.name+'AdminForm\n';
                var admin_fields = this.admin_fields();
                if(admin_fields.length>0) {
                    admin_classes += renderer.spaces(4) + 'list_display = ' + this.admin_fields() + '\n';
                    admin_classes += renderer.spaces(4) + 'readonly_fields = ' + this.admin_read_only_fields() + '\n';
                }else{
                    admin_classes += renderer.new_lines(1);
                }
                admin_classes += renderer.new_lines(1);
                admin_classes += 'admin.site.register('+this.name+', '+this.name+'Admin)\n';
                admin_classes += renderer.new_lines(2);

                return admin_classes;
            };
            this.render_view_classes = function(app_name, renderer){
                var view_classes = renderer.new_lines(1);
                view_classes += 'class '+this.name+'ListView(ListView):\n';
                view_classes += renderer.spaces(4)+'model = '+this.name+'\n';
                view_classes += renderer.new_lines(2);

                view_classes += 'class '+this.name+'CreateView(CreateView):\n';
                view_classes += renderer.spaces(4)+'model = '+this.name+'\n';
                view_classes += renderer.spaces(4)+'form_class = '+this.name+'Form\n';
                view_classes += renderer.new_lines(2);

                view_classes += 'class '+this.name+'DetailView(DetailView):\n';
                view_classes += renderer.spaces(4)+'model = '+this.name+'\n';
                view_classes += renderer.new_lines(2);

                view_classes += 'class '+this.name+'UpdateView(UpdateView):\n';
                view_classes += renderer.spaces(4)+'model = '+this.name+'\n';
                view_classes += renderer.spaces(4)+'form_class = '+this.name+'Form';
                view_classes += renderer.new_lines(2);

                return view_classes;
            };
            this.render_model_class_header = function(app_name, renderer) {
                var cls = 'class ' + this.name + '(models.Model):';
                return cls + renderer.new_lines(2);
            };
            this.render_model_class_fields = function(app_name, renderer){
                var cls = '';
                if (this.fields.length > 0) {
                    cls += renderer.spaces(4) + "# Fields";
                    cls += renderer.new_lines(1);
                }
                jQuery.each(this.fields, function (i, field) {
                    if (renderer.pre_imported_modules_names().indexOf(field.module()) == -1) {
                        cls += renderer.spaces(4) + field.name + ' = ' + field.class_name() + '(' + field.opts + ')';
                    } else {
                        var _as = renderer.pre_imported_modules()[field.module()]['as'];
                        cls += renderer.spaces(4) + field.name + ' = ' + _as + '.' + field.class_name() + '(' + field.opts + ')';
                    }
                    cls += renderer.new_lines(1);
                });
                cls += renderer.new_lines(1);
                return cls;
            };
            this.render_model_class_relationships = function(app_name, renderer){
                var cls = '';
                if (this.relationships.length > 0) {
                    cls += renderer.spaces(4) + "# Relationship Fields";
                    cls += renderer.new_lines(1);
                }
                jQuery.each(this.relationships, function (i, relationship) {
                    var module = '\''+ app_name + '.' + relationship.to_clean() +'\'';
                    if(relationship.external_app){
                        module = '\'' + relationship.to_clean() +'\'';
                    }

                    // If the to field of the module is a built in class then use that as the relationship
                    if(relationship.to == $scope.user_model){
                        module = $scope.user_model_setting;
                    }
                    else if (renderer.built_in_models[relationship.to]) {
                        module = relationship.to_class();
                    }

                    if (renderer.pre_imported_modules_names().indexOf(relationship.module()) == -1) {
                        cls += renderer.spaces(4) + relationship.name + ' = ' + relationship.class_name() + '(' + module + ', ' + relationship.opts + ')';
                    } else {
                        var _as = renderer.pre_imported_modules()[relationship.module()]['as'];
                        cls += renderer.spaces(4) + relationship.name + ' = ' + _as + '.' + relationship.class_name() + '(' + module + ', ' + relationship.opts + ')';
                    }
                    cls += renderer.new_lines(1);
                });
                return cls;
            };
            this.render_model_class = function(app_name, renderer){
                var cls = this.render_model_class_header(app_name, renderer);
                cls += this.render_model_class_fields(app_name, renderer);
                cls += this.render_model_class_relationships(app_name, renderer);
                cls += renderer.new_lines(1);
                cls += renderer.spaces(4)+'class Meta:';
                cls += renderer.new_lines(1);
                cls += renderer.spaces(8)+'ordering = (\'-'+this.ordering_field()+'\',)';

                cls += renderer.new_lines(2);
                cls += renderer.spaces(4)+'def __unicode__(self):';
                cls += renderer.new_lines(1);
                cls += renderer.spaces(8)+'return u\'%s\' % self.'+this.identifier();

                cls += renderer.new_lines(2);
                cls += renderer.spaces(4)+'def get_absolute_url(self):';
                cls += renderer.new_lines(1);
                cls += renderer.spaces(8)+'return reverse(\''+app_name+'_'+this.l_name()+'_detail\', args=(self.'+this.identifier()+',))';
                cls += renderer.new_lines(1);

                cls += renderer.new_lines(2);
                cls += renderer.spaces(4)+'def get_update_url(self):';
                cls += renderer.new_lines(1);
                cls += renderer.spaces(8)+'return reverse(\''+app_name+'_'+this.l_name()+'_update\', args=(self.'+this.identifier()+',))';
                cls += renderer.new_lines(3);

                return cls;
            };
            this.render_model_class_fields_only = function(app_name, renderer){
                var cls = '';
                cls += this.render_model_class_header(app_name, renderer);
                cls += this.render_model_class_fields(app_name, renderer);
                return cls;
            };
            this.render_model_api = function(app_name, renderer){
                var api =  'class '+this.name+'ViewSet(viewsets.ModelViewSet):'+ renderer.new_lines(1);
                api += renderer.spaces(4)+'"""ViewSet for the '+this.name+' class"""';
                api += renderer.new_lines(2);
                api += renderer.spaces(4)+'queryset = models.'+this.name+'.objects.all()'+renderer.new_lines(1);
                api += renderer.spaces(4)+'serializer_class = serializers.'+this.name+'Serializer'+ renderer.new_lines(1);
                api += renderer.spaces(4)+'permission_classes = [permissions.IsAuthenticated]'+ renderer.new_lines(1);
                api += renderer.new_lines(2);
                return api;
            };
            this.render_model_serializer = function(app_name, renderer){
                var serializer =  'class '+this.name+'Serializer(serializers.ModelSerializer):';
                serializer += renderer.new_lines(2);
                serializer += renderer.spaces(4)+'class Meta:'+renderer.new_lines(1);
                serializer += renderer.spaces(8)+'model = models.'+this.name+renderer.new_lines(1);
                serializer += renderer.spaces(8)+'fields = ('+renderer.new_lines(1);
                serializer += renderer.spaces(12)+'\''+this.identifier()+'\', '+renderer.new_lines(1);
                var model = this;
                jQuery.each(this.fields, function(i, field){
                    if(field.name != model.identifier()) {
                        serializer += renderer.spaces(12) + '\'' + field.name + '\', ' + renderer.new_lines(1);
                    }
                });
                serializer += renderer.spaces(8)+')'+renderer.new_lines(3);
                return serializer;
            };
            this._template_header = function(){
                return '{% extends "base.html" %}\n{% load static %}\n';
            };
            this._template_links = function(app_name){
                var list_url = app_name+'_'+this.l_name()+'_list';
                return '<p><a class="btn btn-default" href="{% url \''+list_url+'\' %}">'+this.name+' Listing<\/a><\/p>\n';
            };
            this._wrap_block = function(block, content){
                return '{% block '+block+' %}\n'+content+'\n{% endblock %}'
            };
            this.render_form_html = function(app_name){
                var form_html = this._template_header();
                form_html += "{% load crispy_forms_tags %}\n";
                var form = this._template_links(app_name) + '<form method="post">\n';
                form += '{% csrf_token %}\n{{form|crispy}}\n';
                form += '<button class="btn btn-primary" type="submit">Submit</button>\n';
                form += '</form>';
                form_html += this._wrap_block('content', form);
                return form_html;
            };
            this.render_list_html = function(app_name){
                var create_url = app_name+'_'+this.l_name()+'_create';
                var list_html = this._template_header();
                var table_html = this._template_links(app_name) +'<table class="table">\n';
                table_html += '<tr>\n';
                table_html += '<td>ID<\/td><td>Link<\/td>\n';
                jQuery.each(this.fields, function(i, field){
                    table_html += '    <td>'+field.name+'<\/td>\n';
                });
                table_html += '<\/tr>\n';
                table_html += '{% for object in object_list %}\n';
                table_html += '<tr>\n';
                table_html += '    <td>{{object.id}}</td>\n';
                table_html += '    <td><a href="{{object.get_absolute_url}}">{{object}}<\/a><\/td>\n';
                jQuery.each(this.fields, function(i, field){
                    table_html += '    <td>{{ object.'+field.name+' }}<\/td>\n';
                });
                table_html += '<\/tr>\n';
                table_html += '{% endfor %}\n';
                table_html += '<\/table>';
                table_html += '<a class="btn btn-primary" href="{% url \''+create_url+'\' %}">Create new '+this.name+'<\/a>';
                list_html += this._wrap_block('content', table_html);
                return list_html;
            };
            this.render_detail_html = function (app_name) {
                var detail_html = this._template_header();
                var table_html = this._template_links(app_name) + '<table class="table">\n';
                jQuery.each(this.fields, function(i, field){
                    table_html += '<tr><td>'+field.name+'<\/td><td>{{ object.'+field.name+' }}<\/td><\/tr>\n';
                });
                table_html += '</table>';
                table_html += '\n<a class="btn btn-primary" href="{{object.get_update_url}}">Edit ' + this.name + '</a>\n';
                detail_html += this._wrap_block('content', table_html);
                return detail_html;
            };
            this.form_fields = function(){
                var readable_field_names = (this.readable_fields()).map(function (field) {
                    return field.name
                });
                var relationships = (this.relationships).map(function (relationship) {
                    return relationship.name;
                });
                var all_fields = readable_field_names.concat(relationships);
                if(all_fields.length) {
                    return '[\'' + all_fields.join('\', \'') + '\']';
                }else{
                    return '\'__all__\'';
                }
            };
            this.readable_fields = function(){
                var readable_fields = [];
                jQuery.each(this.fields, function(i, field){
                    if(field.opts.indexOf('readonly')==-1
                        && field.opts.indexOf('editable')==-1
                        && field.opts.indexOf('auto_now_add')==-1
                        && field.type != 'django.contrib.contenttypes.fields.GenericForeignKey'
                        && field.type != 'django_extensions.db.fields.AutoSlugField') {
                        readable_fields.push(field);
                    }
                });
                return readable_fields;
            };
            this.admin_fields = function(){
                if(this.field_names().length>0) {
                    return '[\'' + this.field_names().join('\', \'') + '\']'
                }else{
                    return '';
                }
            };
            this.admin_read_only_fields = function(){
                if(this.field_names().length>0) {
                    return '[\'' + this.field_names().join('\', \'') + '\']'
                }else{
                    return '';
                }
            };
        }
        return new Model(options);
    };
}
function ModelParserFactory() {
    return function ($scope) {
        function Parser() {
            this.parse = function(file, callback) {
                var reader = new FileReader();

                reader.onload = function (e) {
                    var text = reader.result;
                    var lines = text.split('\n');
                    var model_definitions = [];
                    var current_model = null;
                    var multi_line = '';

                    var model_regex = new RegExp("class\ ([a-zA-Z_]*)[\(]([a-zA-Z._]*)[\)][\:]$");
                    var field_regex = new RegExp("^([a-zA-Z0-9_]+)\ \=\ ([a-zA-Z0-9._]+)[\(](.*)[\)]$");

                    jQuery.each(lines, function (i, line) {
                        line = line.trim();
                        var model_match = model_regex.exec(line);
                        if (model_match && model_match[2].match(/model/i)) {
                            console.log('Model:', model_match[1]);
                            current_model = {
                                'name': model_match[1],
                                'class': model_match[2],
                                'fields': [],
                                'relationships': []
                            };
                            model_definitions.push(current_model);
                            multi_line = '';
                        }
                        var matched_content;
                        var field_match = field_regex.exec(line);
                        if(field_match){
                            matched_content=field_match;
                        }
                        var multi_line_match = field_regex.exec(multi_line);
                        if (multi_line_match) {
                            matched_content=multi_line_match;
                        }
                        if (matched_content) {
                            if (current_model && matched_content[2] && (matched_content[2].match(/field/i) || $scope.relationship_factory.relationship_match(matched_content[2]))){
                                var is_relationship_field = $scope.relationship_factory.relationship_match(matched_content[2]);
                                if(is_relationship_field) {
                                    var rel_name = matched_content[1];
                                    var rel_type = matched_content[2];
                                    var raw_opts = matched_content[3].split(',');
                                    var rel_to = raw_opts.shift();
                                    var rel_opts = raw_opts.join(",").trim();
                                    console.log('Model:', current_model.name, 'Relationship:', rel_name, rel_type, rel_to, rel_opts );
                                    current_model.relationships.push($scope.relationship_factory.make_relationship({
                                        'name': rel_name, 'type': rel_type, 'opts': rel_opts, 'to': rel_to
                                    }));
                                }else{
                                    var f_name = matched_content[1];
                                    var f_type = matched_content[2];
                                    var f_opts = matched_content[3];
                                    console.log('Model:', current_model.name, 'Field:', f_name, f_type, f_opts);
                                    current_model.fields.push($scope.field_factory.make_field({
                                        'name': f_name, 'type': f_type, 'opts': f_opts
                                    }));
                                }
                            }
                            multi_line = '';
                        }else{
                            /*
                            There is no match for this line
                            Append to multi_line to try and match
                            if we are parsing a model
                            */
                            if(current_model) {
                                multi_line = multi_line + line;
                            }
                        }

                    });
                    var new_models = [];
                    jQuery.each(model_definitions, function (i, model_definition) {
                        var model = $scope.model_factory(model_definition, $scope);
                        new_models.push(model);
                    });

                    if(callback){
                        callback(new_models);
                    }

                };
                reader.readAsText(file);
            }
        }
        return new Parser();
    }
}
function ProjectFactory() {
    return function () {

        var _this = this;
        _this.replace_in_template = function(template, replacements){
            jQuery.each(replacements, function(i, repl){
                template = template.replace(new RegExp(repl[0], 'g'), repl[1]);
            });
            return template;
        };
        _this.render_project_requirements = function(){
            var requirements = "Django==1.10.3\n";
            requirements += "django-crispy-forms==1.6.1\n";
            requirements += "django-extensions==1.7.5\n";
            requirements += "djangorestframework==3.5.3\n";
            return requirements;
        };
        _this.render_project_manage_py = function(project_name){
            return _this.replace_in_template(
                this.MANAGE_PY_TEMPLATE,
                [
                    ['___PROJECT_NAME___', project_name]
                ]
            );
        };
        _this.render_project_settings_py = function(project_name, app_name){
            return _this.replace_in_template(
                this.SETTINGS_PY_TEMPLATE,
                [
                    ['___PROJECT_NAME___', project_name],
                    ['___APP_NAME___', app_name]
                ]
            );
        };
        _this.render_project_wsgi_py = function(project_name){
            return _this.replace_in_template(
                this.WSGI_PY_TEMPLATE,
                [
                    ['___PROJECT_NAME___', project_name]
                ]
            );
        };
        _this.render_project_urls_py = function(app_name){
            return _this.replace_in_template(
                this.URLS_PY_TEMPLATE,
                [
                    ['___APP_NAME___', app_name]
                ]
            );
        };
        _this.WSGI_PY_TEMPLATE = `"""
WSGI config for ___PROJECT_NAME___ project.

It exposes the WSGI callable as a module-level variable named 'application'.

For more information on this file, see
https://docs.djangoproject.com/en/1.10/howto/deployment/wsgi/
"""

import os

from django.core.wsgi import get_wsgi_application

os.environ.setdefault("DJANGO_SETTINGS_MODULE", "___PROJECT_NAME___.settings")

application = get_wsgi_application()
`;

        _this.URLS_PY_TEMPLATE = `"""
___PROJECT_NAME___ URL Configuration

The 'urlpatterns' list routes URLs to views. For more information please see:
    https://docs.djangoproject.com/en/1.10/topics/http/urls/
Examples:
Function views
    1. Add an import:  from my_app import views
    2. Add a URL to urlpatterns:  url(r'^$', views.home, name='home')
Class-based views
    1. Add an import:  from other_app.views import Home
    2. Add a URL to urlpatterns:  url(r'^$', Home.as_view(), name='home')
Including another URLconf
    1. Import the include() function: from django.conf.urls import url, include
    2. Add a URL to urlpatterns:  url(r'^blog/', include('blog.urls'))
"""
from django.conf.urls import url, include
from django.contrib import admin

urlpatterns = [
    url(r'^admin/', admin.site.urls),
    url(r'^___APP_NAME___/', include('___APP_NAME___.urls')),
]
`;

        _this.MANAGE_PY_TEMPLATE = `#!/usr/bin/env python
import os
import sys

if __name__ == "__main__":
    os.environ.setdefault("DJANGO_SETTINGS_MODULE", "___PROJECT_NAME___.settings")
    try:
        from django.core.management import execute_from_command_line
    except ImportError:
        # The above import may fail for some other reason. Ensure that the
        # issue is really that Django is missing to avoid masking other
        # exceptions on Python 2.
        try:
            import django
        except ImportError:
            raise ImportError(
                "Couldn't import Django. Are you sure it's installed and "
                "available on your PYTHONPATH environment variable? Did you "
                "forget to activate a virtual environment?"
            )
        raise
    execute_from_command_line(sys.argv)

`;

        _this.SETTINGS_PY_TEMPLATE = `#!/usr/bin/env python
"""
Django settings for ___PROJECT_NAME___ project.

Generated by 'django-admin startproject' using Django 1.10.3.

For more information on this file, see
https://docs.djangoproject.com/en/1.10/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/1.10/ref/settings/
"""

import os

# Build paths inside the project like this: os.path.join(BASE_DIR, ...)
BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))


# Quick-start development settings - unsuitable for production
# See https://docs.djangoproject.com/en/1.10/howto/deployment/checklist/

# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = 'dw*vszsn+q!n&_8t(tjg5$5(s(@i+)2kvfat!q=r+^4-pr&-1k'

# SECURITY WARNING: don't run with debug turned on in production!
DEBUG = True

ALLOWED_HOSTS = []


# Application definition

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'django_extensions',
    'crispy_forms',
    'rest_framework',

    '___APP_NAME___'
]

MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]

ROOT_URLCONF = '___PROJECT_NAME___.urls'

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
        },
    },
]

WSGI_APPLICATION = '___PROJECT_NAME___.wsgi.application'


# Database
# https://docs.djangoproject.com/en/1.10/ref/settings/#databases

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),
    }
}


# Password validation
# https://docs.djangoproject.com/en/1.10/ref/settings/#auth-password-validators

AUTH_PASSWORD_VALIDATORS = [
    {
        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
    },
]


# Internationalization
# https://docs.djangoproject.com/en/1.10/topics/i18n/

LANGUAGE_CODE = 'en-us'

TIME_ZONE = 'UTC'

USE_I18N = True

USE_L10N = True

USE_TZ = True


# Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/1.10/howto/static-files/

STATIC_URL = '/static/'
`;

    }
}
angular.module('builder.services', [])
    .factory('ProjectFactory', [ProjectFactory])
    .factory('ModelFactory', [ModelServiceFactory])
    .factory('ModelParser', [ModelParserFactory])
    .factory('MessageService', [MessageServiceFactory])
    .factory('FieldFactory', [FieldFactory])
    .factory('RelationshipFactory', [RelationshipFactory])
    .factory('RenderFactory', [ModelRenderFactory])
    .factory('TarballFactory', [TarballFactory])
    .value('version', '0.1');
>>>>>>> More project setup
=======
function TarballFactory(){return function(){function a(){var a=this,b=require("tar-js"),c=new b;a.uInt8ToString=function(a){var b,c,d="";for(b=0,c=a.length;b<c;b+=1)d+=String.fromCharCode(a[b]);return d},a.append=function(a,b){c.append(a,b)},a.get_url=function(b){var d=btoa(a.uInt8ToString(c.out));return"data:application/tar;base64,"+d}}return new a}}function ModelRenderFactory(){return function(a){var b=this;b.built_in_models=a,b.spaces=function(a){var b=a||1;return new Array(b+1).join(" ")},b.model_names=function(a,b){var c=b||"";return Object.keys(a).map(function(b){return a[b].name+c})},b.new_lines=function(a){var b=a||1;return new Array(b+1).join("\n")},b.render_all=function(a,c){var d="";return d+=b.render_base_html(a,c),d+=b.render_forms_py(a,c),d+=b.render_urls_py(a,c),d+=b.render_admin_py(a,c),d+=b.render_views_py(a,c),d+=b.render_models_py(a,c),d+=b.render_django_rest_framework_api_py(a,c),d+=b.render_django_rest_framework_serializers_py(a,c),d+=b.render_templates_html(a,c)},b.render_base_html=function(a,b){return"<html><head></head><body>{% block content %}Replace this.{% endblock %}</body>"},b.pre_imported_modules=function(a){return{"django.contrib.auth.models":{as:"auth_models"},"django.db.models":{as:"models"},"django_extensions.db.fields":{as:"extension_fields"}}},b.pre_imported_modules_names=function(a){return Object.keys(b.pre_imported_modules())},b.render_forms_py=function(a,c){var d="from django import forms\n";return d+="from .models import "+b.model_names(c,"").join(", ")+"\n",d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_forms(a,b)}),d},b.render_tests_py=function(a,c){var d="import unittest\nfrom django.core.urlresolvers import reverse\nfrom django.test import Client\n";return d+="from .models import "+b.model_names(c,"").join(", ")+"\n",jQuery.each(b.built_in_models,function(a,c){var e=a.split("."),f=e.pop(),g=e.join(".");d+="from "+g+" import "+f,d+=b.new_lines(1)}),d+=b.new_lines(2),jQuery.each(b.built_in_models,function(a,c){var e="create_"+a.toLowerCase().replace(/\./g,"_"),f=a.split(".").pop(),g="";g+="def "+e+"(**kwargs):\n",g+=b.spaces(4)+"defaults = {}\n",jQuery.each(c.fields,function(a,c){g+=b.spaces(4)+'defaults["'+a+'"] = "'+c.default+'"\n'}),g+=b.spaces(4)+"defaults.update(**kwargs)\n",g+=b.spaces(4)+"return "+f+".objects.create(**defaults)\n",g+=b.new_lines(2),d+=g}),jQuery.each(c,function(c,e){d+=e.render_tests_helpers(a,b)}),jQuery.each(c,function(c,e){d+=e.render_tests(a,b)}),d},b.render_urls_py=function(a,c){var d="from django.conf.urls import url, include\n";return d+="from rest_framework import routers"+b.new_lines(1),d+="import api"+b.new_lines(1),d+="import views"+b.new_lines(2),d+="router = routers.DefaultRouter()"+b.new_lines(1),jQuery.each(c,function(a,c){d+="router.register(r'"+c.l_name()+"', api."+c.name+"ViewSet)"+b.new_lines(1)}),d+=b.new_lines(2),d+="urlpatterns = ("+b.new_lines(1),d+=b.spaces(4)+"# urls for Django Rest Framework API"+b.new_lines(1),d+=b.spaces(4)+"url(r'^api/v1/', include(router.urls)),"+b.new_lines(1),d+=")"+b.new_lines(1),d+=b.new_lines(1),jQuery.each(c,function(c,e){d+=e.render_urls(a,b)}),d},b.render_admin_py=function(a,c){var d="from django.contrib import admin\nfrom django import forms\n";return d+="from .models import "+b.model_names(c).join(", "),d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_admin_classes(a,b)}),d},b.render_views_py=function(a,c){var d="from django.views.generic import DetailView, ListView, UpdateView, CreateView\n";return d+="from .models import "+b.model_names(c).join(", "),d+=b.new_lines(1),d+="from .forms import "+b.model_names(c,"Form").join(", "),d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_view_classes(a,b)}),d},b.render_models_py=function(a,c){var d="from django.core.urlresolvers import reverse\n";d+="from django_extensions.db.fields import AutoSlugField\n",d+="from django.db.models import *\n",d+="from django.conf import settings\n",d+="from django.contrib.contenttypes.fields import GenericForeignKey\n",d+="from django.contrib.contenttypes.models import ContentType\n",d+="from django.contrib.auth import get_user_model\n",jQuery.each(b.pre_imported_modules(),function(a,b){var c=a.split("."),e=c.pop();d+="from "+c.join(".")+" import "+e+" as "+b.as+"\n"});var e={};jQuery.each(c,function(a,b){jQuery.each(b.fields,function(a,b){e[b.module()]=b.module()})});var f={};return jQuery.each(c,function(a,b){jQuery.each(b.fields,function(a,b){f[b.type]=b}),jQuery.each(b.relationships,function(a,b){f[b.type]=b})}),jQuery.each(f,function(a,b){}),d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_model_class(a,b)}),d},b.render_templates_html=function(a,b){var c=[];return jQuery.each(b,function(b,d){c.push([d.l_name()+"_form.html",d.render_form_html(a)]),c.push([d.l_name()+"_detail.html",d.render_detail_html(a)]),c.push([d.l_name()+"_list.html",d.render_list_html(a)])}),c},b.render_django_rest_framework_api_py=function(a,c){var d="import models\n";return d+="import serializers\n",d+="from rest_framework import viewsets, permissions\n",d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_model_api(a,b)}),d},b.render_django_rest_framework_serializers_py=function(a,c){var d="import models";return d+=b.new_lines(2),d+="from rest_framework import serializers",d+=b.new_lines(3),jQuery.each(c,function(c,e){d+=e.render_model_serializer(a,b)}),d}}}function MessageServiceFactory(){return function(){var a=this;a.base_modal=function(){var a=jQuery("<div>").addClass("modal fade");a.attr("tabindex","-1"),a.attr("role","dialog"),a.css("display","none");var b=jQuery("<div>").addClass("modal-dialog"),c=jQuery("<div>").addClass("modal-content").appendTo(b),d=jQuery("<h2>").addClass("modal-header-inner");return jQuery("<div>").addClass("modal-header").appendTo(c).append(d),jQuery("<div>").addClass("modal-body").appendTo(c),jQuery("<div>").addClass("modal-footer").appendTo(c),a.append(b),a},a.icon=function(a){return jQuery("<icon>").addClass("fa").addClass(a)},a.simple_error=function(b,c){var d=a.base_modal(),e=a.icon("fa-info").addClass("pull-right");d.find(".modal-header-inner").append(e).append(jQuery("<span>").text(b)),d.find(".modal-body").empty().append(c);var f=jQuery("<button>").addClass("btn btn-default").text("Ok");return d.find(".modal-footer").append(f),f.attr("data-dismiss","modal"),d.modal(),d},a.simple_info=function(b,c){var d=a.base_modal(),e=a.icon("fa-info").addClass("pull-right");d.find(".modal-header-inner").append(e).append(jQuery("<span>").text(b)),d.find(".modal-body").empty().append(c);var f=jQuery("<button>").addClass("btn btn-default").text("Ok");return d.find(".modal-footer").append(f),f.attr("data-dismiss","modal"),d.modal(),d},a.simple_confirm=function(b,c,d){var e=d||jQuery.noop,f=a.base_modal();f.find(".modal-header-inner").html(b),f.find(".modal-body").empty().append(c);var g=jQuery("<button>").addClass("btn btn-primary").text("Ok"),h=jQuery("<button>").addClass("btn btn-default").text("Cancel");return f.find(".modal-footer").append(g).append(h),g.click(function(){e()}),h.attr("data-dismiss","modal"),g.attr("data-dismiss","modal"),f.modal(),f},a.simple_choice=function(b,c,d){var e=a.base_modal();return e.find(".modal-header-inner").html(b),e.find(".modal-body").empty().append(c),jQuery.each(d,function(a,b){var c=jQuery("<button>").addClass("btn btn-primary").text(b.text);e.find(".modal-footer").append(c),c.click(function(){b.callback()}),c.attr("data-dismiss","modal")}),e.modal(),e},a.simple_form=function(b,c,d,e,f){var g=e||jQuery.noop,h=f||!0,i=a.base_modal();i.find(".modal-header-inner").html(b),i.find(".modal-body").empty().append(c).append(d);var j=jQuery("<button>").addClass("btn btn-primary").text("Ok"),k=jQuery("<button>").addClass("btn btn-default").text("Cancel");return i.find(".modal-footer").append(j).append(k),j.click(function(){h||i.modal("hide"),g(d)}),k.attr("data-dismiss","modal"),h||j.attr("data-dismiss","modal"),i.modal(),i},a.simple_form_no_dismiss=function(b,c,d,e){return a.simple_form(b,c,d,e,!0)},a.simple_input=function(b,c,d,e,f){var g=e||jQuery.noop,h=f||!1,i=a.base_modal();i.find(".modal-header-inner").html(b);var j=jQuery("<label>").text(c),k=jQuery("<input>").attr("type","text").attr("name","input").addClass("form-control").attr("value",d),l=jQuery("<span>").text("error message").addClass("help-block hide"),m=jQuery("<div>").addClass("form-group form-group-input has-feedback").append(j).append(k).append(l),n=function(){var a=k.val();!h||""!=a&&void 0!=k?(i.modal("hide"),g(a)):m.addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text("Field Required")},o=jQuery("<form>").append(m).submit(function(a){a.preventDefault(),n()});i.find(".modal-body").empty().append(o);var p=jQuery("<button>").addClass("btn btn-primary").text("Ok"),q=jQuery("<button>").addClass("btn btn-default").text("Cancel");return i.find(".modal-footer").append(p).append(q),p.click(n),q.attr("data-dismiss","modal"),h||p.attr("data-dismiss","modal"),i.modal(),i}}}function RelationshipFactory(){return function(a){function b(a){this.name=a.name,this.type=a.type,this.opts=a.opts,this.to=a.to,this.external_app=a.external_app||!1,this.class_name=function(){return this.type.split(".").reverse()[0]},this.form_update=function(a){this.name=jQuery(a).find("input[name=name]").val(),this.type=jQuery(a).find("select[name=type]").val(),this.opts=jQuery(a).find("input[name=opts]").val(),this.to=jQuery(a).find("input[name=to]").val()},this.to_clean=function(){return this.to.replace(/['"]+/g,"")},this.to_class=function(){return this.to.split(".").reverse().shift()},this.opts_args=function(){return this.opts.split(",").join(", ")},this.to_module=function(){var a=this.to.split(".");return a.slice(0,a.length-1).join(".")},this.module=function(){var a=this.type.split(".");return a.slice(0,a.length-1).join(".")},this.edit_form=function(a){var b=jQuery("<form>"),c=jQuery("<div>").addClass("form-group form-group-name has-feedback").appendTo(b),d=jQuery("<div>").addClass("form-group form-group-type").appendTo(b),e=jQuery("<div>").addClass("form-group form-group-args").appendTo(b),f=jQuery("<div>").addClass("form-group form-group-args").appendTo(b);c.append(jQuery("<label>").text("Name")),c.append(jQuery("<input>").attr("name","name").addClass("form-control").val(this.name)),c.append(jQuery("<span>").text("error message").addClass("help-block hide")),d.append(jQuery("<label>").text("To")),d.append(jQuery("<input>").attr("name","to").attr("placeholder","to").addClass("form-control").val(this.to));var g=jQuery("<select>").attr("name","type").addClass("form-control"),h=this;return jQuery.each(a.relationship_factory.relationship_types(),function(a,b){var c=jQuery("<option>").attr("val",b).text(b);b==h.type&&c.attr("selected","selected"),g.append(c)}),e.append(jQuery("<label>").text("Field Type")),e.append(g),f.append(jQuery("<label>").text("Arguments")),f.append(jQuery("<input>").attr("name","opts").attr("placeholder","options").addClass("form-control").val(this.args)),b}}var c=this;c.relationship_types=function(){return["django.db.models.ForeignKey","django.db.models.OneToOneField","django.db.models.ManyToManyField"]},c.relationship_matches=function(){return c.relationship_types+["ForeignKey","OneToOneField","ManyToManyField","models.ForeignKey","models.OneToOneField","models.ManyToManyField"]},c.relationship_match=function(a){return c.relationship_matches().indexOf(a)!=-1},c.make_relationship=function(a){return new b(a)}}}function FieldFactory(){return function(a){function b(a){this.name=a.name,this.type=a.type,this.opts=a.opts||"",this.class_name=function(){return this.type.split(".").reverse()[0]},this.opts_args=function(){return this.opts.split(",").join(", ")},this.to_clean=function(){return this.to.replace(/['"]+/g,"")},this.module=function(){var a=this.type.split(".");return a.slice(0,a.length-1).join(".")},this.form_update=function(a){this.name=jQuery(a).find("input[name=name]").val(),this.type=jQuery(a).find("select[name=type]").val(),this.opts=jQuery(a).find("input[name=opts]").val()},this.edit_form=function(a){var b=jQuery("<form>"),c=jQuery("<div>").addClass("form-group form-group-name has-feedback").appendTo(b),d=jQuery("<div>").addClass("form-group form-group-type").appendTo(b),e=jQuery("<div>").addClass("form-group form-group-args").appendTo(b);c.append(jQuery("<label>").text("Name")),c.append(jQuery("<input>").attr("name","name").addClass("form-control").val(this.name)),c.append(jQuery("<span>").text("error message").addClass("help-block hide"));var f=jQuery("<select>").attr("name","type").addClass("form-control"),g=this;return jQuery.each(a.field_factory.field_types(),function(a,b){var c=jQuery("<option>").attr("val",b).text(b);b==g.type&&c.attr("selected","selected"),f.append(c)}),d.append(jQuery("<label>").text("Field Type")),d.append(f),e.append(jQuery("<label>").text("Arguments")),e.append(jQuery("<input>").attr("name","opts").attr("placeholder","options").addClass("form-control").val(this.opts)),b}}var c=this;c.fields=function(){return{"django.db.models.TextField":{default_args:"max_length=100"},"django.db.models.CharField":{default_args:"max_length=30"},"django.contrib.contenttypes.fields.GenericForeignKey":{default_args:'"content_type", "object_id"'},"django_extensions.db.fields.AutoSlugField":{},"django.db.models.CommaSeparatedIntegerField":{},"django.db.models.BigAutoField":{},"django.db.models.BigIntegerField":{},"django.db.models.BooleanField":{},"django.db.models.DateField":{},"django.db.models.DateTimeField":{},"django.db.models.DecimalField":{default_args:"max_digits=10, decimal_places=2"},"django.db.models.DurationField":{},"django.db.models.FileField":{default_args:'upload_to="/upload/files/"'},"django.db.models.ImageField":{default_args:'upload_to="/upload/images/"'},"django.db.models.FilePathField":{},"django.db.models.FloatField":{},"django.db.models.IntegerField":{},"django.db.models.PositiveIntegerField":{},"django.db.models.PositiveSmallIntegerField":{},"django.db.models.SlugField":{},"django.db.models.IPAddressField":{},"django.db.models.GenericIPAddressField":{},"django.db.models.NullBooleanField":{},"django.db.models.TimeField":{},"django.db.models.BinaryField":{},"django.db.models.AutoField":{},"django.db.models.SmallIntegerField":{},"django.db.models.URLField":{},"django.db.models.UUIDField":{},"django.db.models.EmailField":{}}},c.default_field_args=function(a){var b=c.fields()[a];return b&&b.default_args?b.default_args:""},c.field_types=function(){return Object.keys(c.fields())},c.make_field=function(a){return new b(a)}}}function ModelServiceFactory(){return function(a,b){function c(a){this.slugify=function(a){return a.toString().replace(/\s+/g,"").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"").replace(/^-+/,"").replace(/-+$/,"")},this.set_name=function(a){this.name=this.slugify(a)},this.set_name(a.name),this.fields=[];a.fields||[];this.fields=(a.fields||[]).map(b.field_factory.make_field),this.relationships=(a.relationships||[]).map(b.relationship_factory.make_relationship),this.relationship_names=function(){var a=this;return Object.keys(a.relationships).map(function(b){return a.relationships[b].name})},this.field_names=function(){var a=this;return Object.keys(a.fields).map(function(b){return a.fields[b].name})},this.l_name=function(){return this.name.toLowerCase()},this.has_relationship=function(a){return this.relationship_names().indexOf(a)!=-1},this.has_field=function(a){return this.field_names().indexOf(a)!=-1},this.name_field=function(){return this.field_names().indexOf("name")!=-1?"name":"id"},this.ordering_field=function(){return this.field_names().indexOf("created")!=-1?"created":"id"},this.identifier=function(){return this.field_names().indexOf("slug")!=-1?"slug":"id"},this.render_forms=function(a,b){var c="";return c+="class "+this.name+"Form(forms.ModelForm):\n",c+=b.spaces(4)+"class Meta:\n",c+=b.spaces(8)+"model = "+this.name+"\n",this.form_fields()&&(c+=b.spaces(8)+"fields = "+this.form_fields()+"\n"),c+=b.new_lines(2)},this.get_initial_data=function(a,b){var c="{";return c+=b.new_lines(1),jQuery.each(this.readable_fields(),function(a,d){c+=b.spaces(12)+'"'+d.name+'": "'+d.name+'",',c+=b.new_lines(1)}),jQuery.each(this.relationships,function(a,d){c+=b.spaces(12)+'"'+d.name+'": create_'+d.to.toLowerCase().replace(/\./g,"_")+"().id,",c+=b.new_lines(1)}),c+=b.spaces(8)+"}"},this.render_tests_helpers=function(a,b){var c="";return c+="def create_"+this.l_name()+"(**kwargs):\n",c+=b.spaces(4)+"defaults = {}\n",jQuery.each(this.readable_fields(),function(a,d){c+=b.spaces(4)+'defaults["'+d.name+'"] = "'+d.name+'"\n'}),c+=b.spaces(4)+"defaults.update(**kwargs)\n",jQuery.each(this.relationships,function(a,d){c+=b.spaces(4)+'if "'+d.name+'" not in defaults:\n';var e="create_"+d.to.toLowerCase().replace(/\./g,"_");b.built_in_models[d.to]&&(e="create_"+d.to.toLowerCase().replace(/\./g,"_")),c+=b.spaces(8)+'defaults["'+d.name+'"] = '+e+"()\n"}),c+=b.spaces(4)+"return "+this.name+".objects.create(**defaults)\n",c+=b.new_lines(2)},this.render_tests=function(a,b){var c="";return c+="class "+this.name+"ViewTest(unittest.TestCase):\n",c+=b.spaces(4)+"'''\n",c+=b.spaces(4)+"Tests for "+this.name+"\n",c+=b.spaces(4)+"'''\n",c+=b.spaces(4)+"def setUp(self):\n",c+=b.spaces(8)+"self.client = Client()\n",c+=b.new_lines(1),c+=b.spaces(4)+"def test_list_"+this.l_name()+"(self):\n",c+=b.spaces(8)+"url = reverse('"+a+"_"+this.l_name()+"_list')\n",c+=b.spaces(8)+"response = self.client.get(url)\n",c+=b.spaces(8)+"self.assertEqual(response.status_code, 200)\n",c+=b.new_lines(1),c+=b.spaces(4)+"def test_create_"+this.l_name()+"(self):\n",c+=b.spaces(8)+"url = reverse('"+a+"_"+this.l_name()+"_create')\n",c+=b.spaces(8)+"data = "+this.get_initial_data(a,b)+"\n",c+=b.spaces(8)+"response = self.client.post(url, data=data)\n",c+=b.spaces(8)+"self.assertEqual(response.status_code, 302)\n",c+=b.new_lines(1),c+=b.spaces(4)+"def test_detail_"+this.l_name()+"(self):\n",c+=b.spaces(8)+this.l_name()+" = create_"+this.l_name()+"()\n",c+=b.spaces(8)+"url = reverse('"+a+"_"+this.l_name()+"_detail', args=["+this.l_name()+"."+this.identifier()+",])\n",c+=b.spaces(8)+"response = self.client.get(url)\n",c+=b.spaces(8)+"self.assertEqual(response.status_code, 200)\n",c+=b.new_lines(1),c+=b.spaces(4)+"def test_update_"+this.l_name()+"(self):\n",c+=b.spaces(8)+this.l_name()+" = create_"+this.l_name()+"()\n",c+=b.spaces(8)+"data = "+this.get_initial_data(a,b)+"\n",c+=b.spaces(8)+"url = reverse('"+a+"_"+this.l_name()+"_update', args=["+this.l_name()+"."+this.identifier()+",])\n",c+=b.spaces(8)+"response = self.client.post(url, data)\n",c+=b.spaces(8)+"self.assertEqual(response.status_code, 302)\n",c+=b.new_lines(2)},this.render_urls=function(a,b){var c="";return c+="urlpatterns += (\n",c+=b.spaces(4)+"# urls for "+this.name+"\n",c+=b.spaces(4)+"url(r'^"+a+"/"+this.l_name()+"/$', views."+this.name+"ListView.as_view(), name='"+a+"_"+this.l_name()+"_list'),\n",c+=b.spaces(4)+"url(r'^"+a+"/"+this.l_name()+"/create/$', views."+this.name+"CreateView.as_view(), name='"+a+"_"+this.l_name()+"_create'),\n",c+=b.spaces(4)+"url(r'^"+a+"/"+this.l_name()+"/detail/(?P<"+this.identifier()+">\\S+)/$', views."+this.name+"DetailView.as_view(), name='"+a+"_"+this.l_name()+"_detail'),\n",c+=b.spaces(4)+"url(r'^"+a+"/"+this.l_name()+"/update/(?P<"+this.identifier()+">\\S+)/$', views."+this.name+"UpdateView.as_view(), name='"+a+"_"+this.l_name()+"_update'),\n",c+=")\n",c+=b.new_lines(1)},this.render_admin_classes=function(a,b){var c="";c+="class "+this.name+"AdminForm(forms.ModelForm):\n",c+=b.new_lines(1),c+=b.spaces(4)+"class Meta:\n",c+=b.spaces(8)+"model = "+this.name+"\n",c+=b.spaces(8)+"fields = '__all__'\n",c+=b.new_lines(2),c+="class "+this.name+"Admin(admin.ModelAdmin):\n",c+=b.spaces(4)+"form = "+this.name+"AdminForm\n";var d=this.admin_fields();return d.length>0?(c+=b.spaces(4)+"list_display = "+this.admin_fields()+"\n",c+=b.spaces(4)+"readonly_fields = "+this.admin_read_only_fields()+"\n"):c+=b.new_lines(1),c+=b.new_lines(1),c+="admin.site.register("+this.name+", "+this.name+"Admin)\n",c+=b.new_lines(2)},this.render_view_classes=function(a,b){var c=b.new_lines(1);return c+="class "+this.name+"ListView(ListView):\n",c+=b.spaces(4)+"model = "+this.name+"\n",c+=b.new_lines(2),c+="class "+this.name+"CreateView(CreateView):\n",c+=b.spaces(4)+"model = "+this.name+"\n",c+=b.spaces(4)+"form_class = "+this.name+"Form\n",c+=b.new_lines(2),c+="class "+this.name+"DetailView(DetailView):\n",c+=b.spaces(4)+"model = "+this.name+"\n",c+=b.new_lines(2),c+="class "+this.name+"UpdateView(UpdateView):\n",c+=b.spaces(4)+"model = "+this.name+"\n",c+=b.spaces(4)+"form_class = "+this.name+"Form",c+=b.new_lines(2)},this.render_model_class_header=function(a,b){var c="class "+this.name+"(models.Model):";return c+b.new_lines(2)},this.render_model_class_fields=function(a,b){var c="";return this.fields.length>0&&(c+=b.spaces(4)+"# Fields",c+=b.new_lines(1)),jQuery.each(this.fields,function(a,d){if(b.pre_imported_modules_names().indexOf(d.module())==-1)c+=b.spaces(4)+d.name+" = "+d.class_name()+"("+d.opts+")";else{var e=b.pre_imported_modules()[d.module()].as;c+=b.spaces(4)+d.name+" = "+e+"."+d.class_name()+"("+d.opts+")"}c+=b.new_lines(1)}),c+=b.new_lines(1)},this.render_model_class_relationships=function(a,c){var d="";return this.relationships.length>0&&(d+=c.spaces(4)+"# Relationship Fields",d+=c.new_lines(1)),jQuery.each(this.relationships,function(e,f){var g="'"+a+"."+f.to_clean()+"'";if(f.external_app&&(g="'"+f.to_clean()+"'"),f.to==b.user_model?g=b.user_model_setting:c.built_in_models[f.to]&&(g=f.to_class()),c.pre_imported_modules_names().indexOf(f.module())==-1)d+=c.spaces(4)+f.name+" = "+f.class_name()+"("+g+", "+f.opts+")";else{var h=c.pre_imported_modules()[f.module()].as;d+=c.spaces(4)+f.name+" = "+h+"."+f.class_name()+"("+g+", "+f.opts+")"}d+=c.new_lines(1)}),d},this.render_model_class=function(a,b){var c=this.render_model_class_header(a,b);return c+=this.render_model_class_fields(a,b),c+=this.render_model_class_relationships(a,b),c+=b.new_lines(1),c+=b.spaces(4)+"class Meta:",c+=b.new_lines(1),c+=b.spaces(8)+"ordering = ('-"+this.ordering_field()+"',)",c+=b.new_lines(2),c+=b.spaces(4)+"def __unicode__(self):",c+=b.new_lines(1),c+=b.spaces(8)+"return u'%s' % self."+this.identifier(),c+=b.new_lines(2),c+=b.spaces(4)+"def get_absolute_url(self):",c+=b.new_lines(1),c+=b.spaces(8)+"return reverse('"+a+"_"+this.l_name()+"_detail', args=(self."+this.identifier()+",))",c+=b.new_lines(1),c+=b.new_lines(2),c+=b.spaces(4)+"def get_update_url(self):",c+=b.new_lines(1),c+=b.spaces(8)+"return reverse('"+a+"_"+this.l_name()+"_update', args=(self."+this.identifier()+",))",c+=b.new_lines(3)},this.render_model_class_fields_only=function(a,b){var c="";return c+=this.render_model_class_header(a,b),c+=this.render_model_class_fields(a,b)},this.render_model_api=function(a,b){var c="class "+this.name+"ViewSet(viewsets.ModelViewSet):"+b.new_lines(1);return c+=b.spaces(4)+'"""ViewSet for the '+this.name+' class"""',c+=b.new_lines(2),c+=b.spaces(4)+"queryset = models."+this.name+".objects.all()"+b.new_lines(1),c+=b.spaces(4)+"serializer_class = serializers."+this.name+"Serializer"+b.new_lines(1),c+=b.spaces(4)+"permission_classes = [permissions.IsAuthenticated]"+b.new_lines(1),c+=b.new_lines(2)},this.render_model_serializer=function(a,b){var c="class "+this.name+"Serializer(serializers.ModelSerializer):";c+=b.new_lines(2),c+=b.spaces(4)+"class Meta:"+b.new_lines(1),c+=b.spaces(8)+"model = models."+this.name+b.new_lines(1),c+=b.spaces(8)+"fields = ("+b.new_lines(1),c+=b.spaces(12)+"'"+this.identifier()+"', "+b.new_lines(1);var d=this;return jQuery.each(this.fields,function(a,e){e.name!=d.identifier()&&(c+=b.spaces(12)+"'"+e.name+"', "+b.new_lines(1))}),c+=b.spaces(8)+")"+b.new_lines(3)},this._template_header=function(){return'{% extends "base.html" %}\n{% load static %}\n'},this._template_links=function(a){var b=a+"_"+this.l_name()+"_list";return'<p><a class="btn btn-default" href="{% url \''+b+"' %}\">"+this.name+" Listing</a></p>\n"},this._wrap_block=function(a,b){return"{% block "+a+" %}\n"+b+"\n{% endblock %}"},this.render_form_html=function(a){var b=this._template_header();b+="{% load crispy_forms_tags %}\n";var c=this._template_links(a)+'<form method="post">\n';return c+="{% csrf_token %}\n{{form|crispy}}\n",c+='<button class="btn btn-primary" type="submit">Submit</button>\n',c+="</form>",b+=this._wrap_block("content",c)},this.render_list_html=function(a){var b=a+"_"+this.l_name()+"_create",c=this._template_header(),d=this._template_links(a)+'<table class="table">\n';return d+="<tr>\n",d+="<td>ID</td><td>Link</td>\n",jQuery.each(this.fields,function(a,b){d+="    <td>"+b.name+"</td>\n"}),d+="</tr>\n",d+="{% for object in object_list %}\n",d+="<tr>\n",d+="    <td>{{object.id}}</td>\n",d+='    <td><a href="{{object.get_absolute_url}}">{{object}}</a></td>\n',jQuery.each(this.fields,function(a,b){d+="    <td>{{ object."+b.name+" }}</td>\n"}),d+="</tr>\n",d+="{% endfor %}\n",d+="</table>",d+='<a class="btn btn-primary" href="{% url \''+b+"' %}\">Create new "+this.name+"</a>",c+=this._wrap_block("content",d)},this.render_detail_html=function(a){var b=this._template_header(),c=this._template_links(a)+'<table class="table">\n';return jQuery.each(this.fields,function(a,b){c+="<tr><td>"+b.name+"</td><td>{{ object."+b.name+" }}</td></tr>\n"}),c+="</table>",c+='\n<a class="btn btn-primary" href="{{object.get_update_url}}">Edit '+this.name+"</a>\n",b+=this._wrap_block("content",c)},this.form_fields=function(){var a=this.readable_fields().map(function(a){return a.name}),b=this.relationships.map(function(a){return a.name}),c=a.concat(b);return c.length?"['"+c.join("', '")+"']":"'__all__'"},this.readable_fields=function(){var a=[];return jQuery.each(this.fields,function(b,c){c.opts.indexOf("readonly")==-1&&c.opts.indexOf("editable")==-1&&c.opts.indexOf("auto_now_add")==-1&&"django.contrib.contenttypes.fields.GenericForeignKey"!=c.type&&"django_extensions.db.fields.AutoSlugField"!=c.type&&a.push(c)}),a},this.admin_fields=function(){return this.field_names().length>0?"['"+this.field_names().join("', '")+"']":""},this.admin_read_only_fields=function(){return this.field_names().length>0?"['"+this.field_names().join("', '")+"']":""}}return new c(a)}}function ModelParserFactory(){return function(a){function b(){this.parse=function(b,c){var d=new FileReader;d.onload=function(b){var e=d.result,f=e.split("\n"),g=[],h=null,i="",j=new RegExp("class ([a-zA-Z_]*)[(]([a-zA-Z._]*)[)][:]$"),k=new RegExp("^([a-zA-Z0-9_]+) = ([a-zA-Z0-9._]+)[(](.*)[)]$");jQuery.each(f,function(b,c){c=c.trim();var d=j.exec(c);d&&d[2].match(/model/i)&&(console.log("Model:",d[1]),h={name:d[1],class:d[2],fields:[],relationships:[]},g.push(h),i="");var e,f=k.exec(c);f&&(e=f);var l=k.exec(i);if(l&&(e=l),e){if(h&&e[2]&&(e[2].match(/field/i)||a.relationship_factory.relationship_match(e[2]))){var m=a.relationship_factory.relationship_match(e[2]);if(m){var n=e[1],o=e[2],p=e[3].split(","),q=p.shift(),r=p.join(",").trim();console.log("Model:",h.name,"Relationship:",n,o,q,r),h.relationships.push(a.relationship_factory.make_relationship({name:n,type:o,opts:r,to:q}))}else{var s=e[1],t=e[2],u=e[3];console.log("Model:",h.name,"Field:",s,t,u),h.fields.push(a.field_factory.make_field({name:s,type:t,opts:u}))}}i=""}else h&&(i+=c)});var l=[];jQuery.each(g,function(b,c){var d=a.model_factory(c,a);l.push(d)}),c&&c(l)},d.readAsText(b)}}return new b}}function ProjectFactory(){return function(a){var b=this;b.http=a,b.settings_py="",b.urls_py="",b.wsgi_py="",b.manage_py="",b.http.get("partials/py/settings.py").then(function(a){b.settings_py=a.data}),b.http.get("partials/py/manage.py").then(function(a){b.manage_py=a.data}),b.http.get("partials/py/urls.py").then(function(a){b.urls_py=a.data}),b.http.get("partials/py/wsgi.py").then(function(a){b.wsgi_py=a.data}),b.replace_in_template=function(a,b){return jQuery.each(b,function(b,c){a=a.replace(new RegExp(c[0],"g"),c[1])}),a},b.render_project_requirements=function(){var a="Django==1.10.3\n";return a+="django-crispy-forms==1.6.1\n",a+="django-extensions==1.7.5\n",a+="djangorestframework==3.5.3\n"},b.render_project_manage_py=function(a){return b.replace_in_template(b.manage_py,[["___PROJECT_NAME___",a]])},b.render_project_settings_py=function(a,c){return b.replace_in_template(b.settings_py,[["___PROJECT_NAME___",a],["___APP_NAME___",c]])},b.render_project_wsgi_py=function(a){return b.replace_in_template(b.wsgi_py,[["___PROJECT_NAME___",a]])},b.render_project_urls_py=function(a){return b.replace_in_template(b.urls_py,[["___APP_NAME___",a]])}}}ace.define("ace/mode/python",["require","exports","module","ace/lib/oop","ace/mode/text","ace/tokenizer","ace/mode/python_highlight_rules","ace/mode/folding/pythonic","ace/range"],function(a,b,c){var d=a("../lib/oop"),e=a("./text").Mode,f=(a("../tokenizer").Tokenizer,a("./python_highlight_rules").PythonHighlightRules),g=a("./folding/pythonic").FoldMode,h=a("../range").Range,i=function(){this.HighlightRules=f,this.foldingRules=new g("\\:")};d.inherits(i,e),function(){this.lineCommentStart="#",this.getNextLineIndent=function(a,b,c){var d=this.$getIndent(b),e=this.getTokenizer().getLineTokens(b,a),f=e.tokens;if(f.length&&"comment"==f[f.length-1].type)return d;if("start"==a){var g=b.match(/^.*[\{\(\[\:]\s*$/);g&&(d+=c)}return d};var a={pass:1,return:1,raise:1,break:1,continue:1};this.checkOutdent=function(b,c,d){if("\r\n"!==d&&"\r"!==d&&"\n"!==d)return!1;var e=this.getTokenizer().getLineTokens(c.trim(),b).tokens;if(!e)return!1;do var f=e.pop();while(f&&("comment"==f.type||"text"==f.type&&f.value.match(/^\s+$/)));return!!f&&("keyword"==f.type&&a[f.value])},this.autoOutdent=function(a,b,c){c+=1;var d=this.$getIndent(b.getLine(c)),e=b.getTabString();d.slice(-e.length)==e&&b.remove(new h(c,d.length-e.length,c,d.length))},this.$id="ace/mode/python"}.call(i.prototype),b.Mode=i}),ace.define("ace/mode/python_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/text_highlight_rules"],function(a,b,c){var d=a("../lib/oop"),e=a("./text_highlight_rules").TextHighlightRules,f=function(){var a="and|as|assert|break|class|continue|def|del|elif|else|except|exec|finally|for|from|global|if|import|in|is|lambda|not|or|pass|print|raise|return|try|while|with|yield",b="True|False|None|NotImplemented|Ellipsis|__debug__",c="abs|divmod|input|open|staticmethod|all|enumerate|int|ord|str|any|eval|isinstance|pow|sum|basestring|execfile|issubclass|print|super|binfile|iter|property|tuple|bool|filter|len|range|type|bytearray|float|list|raw_input|unichr|callable|format|locals|reduce|unicode|chr|frozenset|long|reload|vars|classmethod|getattr|map|repr|xrange|cmp|globals|max|reversed|zip|compile|hasattr|memoryview|round|__import__|complex|hash|min|set|apply|delattr|help|next|setattr|buffer|dict|hex|object|slice|coerce|dir|id|oct|sorted|intern",d=this.createKeywordMapper({"invalid.deprecated":"debugger","support.function":c,"constant.language":b,keyword:a},"identifier"),e="(?:r|u|ur|R|U|UR|Ur|uR)?",f="(?:(?:[1-9]\\d*)|(?:0))",g="(?:0[oO]?[0-7]+)",h="(?:0[xX][\\dA-Fa-f]+)",i="(?:0[bB][01]+)",j="(?:"+f+"|"+g+"|"+h+"|"+i+")",k="(?:[eE][+-]?\\d+)",l="(?:\\.\\d+)",m="(?:\\d+)",n="(?:(?:"+m+"?"+l+")|(?:"+m+"\\.))",o="(?:(?:"+n+"|"+m+")"+k+")",p="(?:"+o+"|"+n+")",q="\\\\(x[0-9A-Fa-f]{2}|[0-7]{3}|[\\\\abfnrtv'\"]|U[0-9A-Fa-f]{8}|u[0-9A-Fa-f]{4})";this.$rules={start:[{token:"comment",regex:"#.*$"},{token:"string",regex:e+'"{3}',next:"qqstring3"},{token:"string",regex:e+'"(?=.)',next:"qqstring"},{token:"string",regex:e+"'{3}",next:"qstring3"},{token:"string",regex:e+"'(?=.)",next:"qstring"},{token:"constant.numeric",regex:"(?:"+p+"|\\d+)[jJ]\\b"},{token:"constant.numeric",regex:p},{token:"constant.numeric",regex:j+"[lL]\\b"},{token:"constant.numeric",regex:j+"\\b"},{token:d,regex:"[a-zA-Z_$][a-zA-Z0-9_$]*\\b"},{token:"keyword.operator",regex:"\\+|\\-|\\*|\\*\\*|\\/|\\/\\/|%|<<|>>|&|\\||\\^|~|<|>|<=|=>|==|!=|<>|="
},{token:"paren.lparen",regex:"[\\[\\(\\{]"},{token:"paren.rparen",regex:"[\\]\\)\\}]"},{token:"text",regex:"\\s+"}],qqstring3:[{token:"constant.language.escape",regex:q},{token:"string",regex:'"{3}',next:"start"},{defaultToken:"string"}],qstring3:[{token:"constant.language.escape",regex:q},{token:"string",regex:"'{3}",next:"start"},{defaultToken:"string"}],qqstring:[{token:"constant.language.escape",regex:q},{token:"string",regex:"\\\\$",next:"qqstring"},{token:"string",regex:'"|$',next:"start"},{defaultToken:"string"}],qstring:[{token:"constant.language.escape",regex:q},{token:"string",regex:"\\\\$",next:"qstring"},{token:"string",regex:"'|$",next:"start"},{defaultToken:"string"}]}};d.inherits(f,e),b.PythonHighlightRules=f}),ace.define("ace/mode/folding/pythonic",["require","exports","module","ace/lib/oop","ace/mode/folding/fold_mode"],function(a,b,c){var d=a("../../lib/oop"),e=a("./fold_mode").FoldMode,f=b.FoldMode=function(a){this.foldingStartMarker=new RegExp("([\\[{])(?:\\s*)$|("+a+")(?:\\s*)(?:#.*)?$")};d.inherits(f,e),function(){this.getFoldWidgetRange=function(a,b,c){var d=a.getLine(c),e=d.match(this.foldingStartMarker);if(e)return e[1]?this.openingBracketBlock(a,e[1],c,e.index):e[2]?this.indentationBlock(a,c,e.index+e[2].length):this.indentationBlock(a,c)}}.call(f.prototype)}),ace.define("ace/theme/dawn",["require","exports","module","ace/lib/dom"],function(a,b,c){b.isDark=!1,b.cssClass="ace-dawn",b.cssText=".ace-dawn .ace_gutter {background: #ebebeb;color: #333}.ace-dawn .ace_print-margin {width: 1px;background: #e8e8e8}.ace-dawn {background-color: #F9F9F9;color: #080808}.ace-dawn .ace_cursor {color: #000000}.ace-dawn .ace_marker-layer .ace_selection {background: rgba(39, 95, 255, 0.30)}.ace-dawn.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px #F9F9F9;border-radius: 2px}.ace-dawn .ace_marker-layer .ace_step {background: rgb(255, 255, 0)}.ace-dawn .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgba(75, 75, 126, 0.50)}.ace-dawn .ace_marker-layer .ace_active-line {background: rgba(36, 99, 180, 0.12)}.ace-dawn .ace_gutter-active-line {background-color : #dcdcdc}.ace-dawn .ace_marker-layer .ace_selected-word {border: 1px solid rgba(39, 95, 255, 0.30)}.ace-dawn .ace_invisible {color: rgba(75, 75, 126, 0.50)}.ace-dawn .ace_keyword,.ace-dawn .ace_meta {color: #794938}.ace-dawn .ace_constant,.ace-dawn .ace_constant.ace_character,.ace-dawn .ace_constant.ace_character.ace_escape,.ace-dawn .ace_constant.ace_other {color: #811F24}.ace-dawn .ace_invalid.ace_illegal {text-decoration: underline;font-style: italic;color: #F8F8F8;background-color: #B52A1D}.ace-dawn .ace_invalid.ace_deprecated {text-decoration: underline;font-style: italic;color: #B52A1D}.ace-dawn .ace_support {color: #691C97}.ace-dawn .ace_support.ace_constant {color: #B4371F}.ace-dawn .ace_fold {background-color: #794938;border-color: #080808}.ace-dawn .ace_list,.ace-dawn .ace_markup.ace_list,.ace-dawn .ace_support.ace_function {color: #693A17}.ace-dawn .ace_storage {font-style: italic;color: #A71D5D}.ace-dawn .ace_string {color: #0B6125}.ace-dawn .ace_string.ace_regexp {color: #CF5628}.ace-dawn .ace_comment {font-style: italic;color: #5A525F}.ace-dawn .ace_heading,.ace-dawn .ace_markup.ace_heading {color: #19356D}.ace-dawn .ace_variable {color: #234A97}.ace-dawn .ace_indent-guide {background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAEklEQVQImWNgYGBgYLh/5+x/AAizA4hxNNsZAAAAAElFTkSuQmCC) right repeat-y}";var d=a("../lib/dom");d.importCssString(b.cssText,b.cssClass)});var global=Function("return this;")();!function(a){function b(a){var b=g[a]||window[a];if(!b)throw new Error("Requested module '"+a+"' has not been defined.");return b}function c(a,b){return g[a]=b}function d(a,b){for(var c in b)"noConflict"!=c&&"_VERSION"!=c&&(a[c]=b[c]);return a}function e(a,b,c){return"string"==typeof a||a.nodeName||a.length&&"item"in a||a==window?(c=f._select(a,b),c.selector=a):c=isFinite(a.length)?a:[a],d(c,e)}function f(a,b){return e(a,b)}a.global=a;var g={},h=a.$;a.provide=c,a.require=b,d(f,{_VERSION:"0.3.6",fn:e,ender:function(a,b){d(b?e:f,a)},_select:function(a,b){return(b||document).querySelectorAll(a)}}),d(e,{forEach:function(a,b,c){for(c=0,l=this.length;c<l;++c)c in this&&a.call(b||this[c],this[c],c,this);return this},$:f}),f.noConflict=function(){return a.$=h,this},"undefined"!=typeof module&&module.exports&&(module.exports=f),a.ender=a.$=a.ender||f}(this),function(a){var b={exports:{}};b.exports,require("ender");!function(){"use strict";function a(a){var b,c=new Uint8Array(a);for(b=0;b<a;b+=1)c[b]=0;return c}function c(b,c,d,e){var f=c+d,g=a((parseInt(f/e)+1)*e);return g.set(b),g}function d(a,b,c){return a=a.toString(c||8),"000000000000".substr(a.length+12-b)+a}function e(b,c,d){var e,f;for(c=c||a(b.length),d=d||0,e=0,f=b.length;e<f;e+=1)c[d]=b.charCodeAt(e),d+=1;return c}function f(a){function b(a){return g[a>>18&63]+g[a>>12&63]+g[a>>6&63]+g[63&a]}var c,d,e,f=a.length%3,h="";for(c=0,e=a.length-f;c<e;c+=3)d=(a[c]<<16)+(a[c+1]<<8)+a[c+2],h+=b(d);switch(h.length%4){case 1:h+="=";break;case 2:h+="=="}return h}var g=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"];b.exports.clean=a,b.exports.pad=d,b.exports.extend=c,b.exports.stringToUint8=e,b.exports.uint8ToBase64=f}(),provide("tar-js/utils",b.exports)}(global),function(a){var b={exports:{}};b.exports,require("ender");!function(){"use strict";function a(a,b){var e=d.clean(512),f=0;return c.forEach(function(b){var c,d,g=a[b.field]||"";for(c=0,d=g.length;c<d;c+=1)e[f]=g.charCodeAt(c),f+=1;f+=b.length-c}),"function"==typeof b?b(e,f):e}var c,d=require("tar-js/utils");c=[{field:"fileName",length:100},{field:"fileMode",length:8},{field:"uid",length:8},{field:"gid",length:8},{field:"fileSize",length:12},{field:"mtime",length:12},{field:"checksum",length:8},{field:"type",length:1},{field:"linkName",length:100},{field:"ustar",length:8},{field:"owner",length:32},{field:"group",length:32},{field:"majorNumber",length:8},{field:"minorNumber",length:8},{field:"filenamePrefix",length:155},{field:"padding",length:12}],b.exports.structure=c,b.exports.format=a}(),provide("tar-js/header",b.exports)}(global),function(a){var b={exports:{}};b.exports,require("ender");!function(){"use strict";function a(a){this.written=0,c=(a||20)*f,this.out=e.clean(c)}var c,d=require("tar-js/header"),e=require("tar-js/utils"),f=512;a.prototype.append=function(a,b,g,h){var i,j,k,l,m,n,o;if("string"==typeof b)b=e.stringToUint8(b);else if(b.constructor!==Uint8Array.prototype.constructor)throw"Invalid input type. You gave me: "+b.constructor.toString().match(/function\s*([$A-Za-z_][0-9A-Za-z_]*)\s*\(/)[1];"function"==typeof g&&(h=g,g={}),g=g||{},k=g.mode||4095&parseInt("777",8),l=g.mtime||Math.floor(+new Date/1e3),m=g.uid||0,n=g.gid||0,i={fileName:a,fileMode:e.pad(k,7),uid:e.pad(m,7),gid:e.pad(n,7),fileSize:e.pad(b.length,11),mtime:e.pad(l,11),checksum:"        ",type:"0",ustar:"ustar  ",owner:g.owner||"",group:g.group||""},j=0,Object.keys(i).forEach(function(a){var b,c,d=i[a];for(b=0,c=d.length;b<c;b+=1)j+=d.charCodeAt(b)}),i.checksum=e.pad(j,6)+"\0 ",o=d.format(i);return this.out.set(o,this.written),this.written+=o.length,this.written+b.length>this.out.length&&(this.out=e.extend(this.out,this.written,b.length,c)),this.out.set(b,this.written),this.written+=b.length+(f-(b.length%f||f)),this.out.length-this.written<2*f&&(this.out=e.extend(this.out,this.written,2*f,c)),"function"==typeof h&&h(this.out),this.out},a.prototype.clear=function(){this.written=0,this.out=e.clean(c)},b.exports=a}(),provide("tar-js",b.exports)}(global),angular.module("ui.ace",[]).constant("uiAceConfig",{}).directive("uiAce",["uiAceConfig",function(a){if(angular.isUndefined(window.ace))throw new Error("ui-ace need ace to work... (o rly?)");var b=function(a,b,c){if(angular.isDefined(c.workerPath)){var d=window.ace.require("ace/config");d.set("workerPath",c.workerPath)}angular.isDefined(c.require)&&c.require.forEach(function(a){window.ace.require(a)}),angular.isDefined(c.showGutter)&&a.renderer.setShowGutter(c.showGutter),angular.isDefined(c.useWrapMode)&&b.setUseWrapMode(c.useWrapMode),angular.isDefined(c.showInvisibles)&&a.renderer.setShowInvisibles(c.showInvisibles),angular.isDefined(c.showIndentGuides)&&a.renderer.setDisplayIndentGuides(c.showIndentGuides),angular.isDefined(c.useSoftTabs)&&b.setUseSoftTabs(c.useSoftTabs),angular.isDefined(c.showPrintMargin)&&a.setShowPrintMargin(c.showPrintMargin),angular.isDefined(c.disableSearch)&&c.disableSearch&&a.commands.addCommands([{name:"unfind",bindKey:{win:"Ctrl-F",mac:"Command-F"},exec:function(){return!1},readOnly:!0}]),angular.isString(c.theme)&&a.setTheme("ace/theme/"+c.theme),angular.isString(c.mode)&&b.setMode("ace/mode/"+c.mode),angular.isDefined(c.firstLineNumber)&&(angular.isNumber(c.firstLineNumber)?b.setOption("firstLineNumber",c.firstLineNumber):angular.isFunction(c.firstLineNumber)&&b.setOption("firstLineNumber",c.firstLineNumber()));var e,f;if(angular.isDefined(c.advanced))for(e in c.advanced)f={name:e,value:c.advanced[e]},a.setOption(f.name,f.value);if(angular.isDefined(c.rendererOptions))for(e in c.rendererOptions)f={name:e,value:c.rendererOptions[e]},a.renderer.setOption(f.name,f.value);angular.forEach(c.callbacks,function(b){angular.isFunction(b)&&b(a)})};return{restrict:"EA",require:"?ngModel",link:function(c,d,e,f){var g,h,i=a.ace||{},j=angular.extend({},i,c.$eval(e.uiAce)),k=window.ace.edit(d[0]),l=k.getSession(),m=function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1);angular.isDefined(a)&&c.$evalAsync(function(){if(!angular.isFunction(a))throw new Error("ui-ace use a function as callback.");a(b)})},n={onChange:function(a){return function(b){var d=l.getValue();!f||d===f.$viewValue||c.$$phase||c.$root.$$phase||c.$evalAsync(function(){f.$setViewValue(d)}),m(a,b,k)}},onBlur:function(a){return function(){m(a,k)}}};e.$observe("readonly",function(a){k.setReadOnly(!!a||""===a)}),f&&(f.$formatters.push(function(a){if(angular.isUndefined(a)||null===a)return"";if(angular.isObject(a)||angular.isArray(a))throw new Error("ui-ace cannot use an object or an array as a model");return a}),f.$render=function(){l.setValue(f.$viewValue)});var o=function(a,d){a!==d&&(j=angular.extend({},i,c.$eval(e.uiAce)),j.callbacks=[j.onLoad],j.onLoad!==i.onLoad&&j.callbacks.unshift(i.onLoad),l.removeListener("change",g),g=n.onChange(j.onChange),l.on("change",g),k.removeListener("blur",h),h=n.onBlur(j.onBlur),k.on("blur",h),b(k,l,j))};c.$watch(e.uiAce,o,!0),o(i),d.on("$destroy",function(){k.session.$stopWorker(),k.destroy()}),c.$watch(function(){return[d[0].offsetWidth,d[0].offsetHeight]},function(){k.resize(),k.renderer.updateFull()},!0)}}}]),!function(a,b){var c=b.isDefined,d=b.isUndefined,e=b.isNumber,f=b.isObject,g=b.isArray,h=b.isString,i=b.extend,j=b.toJson;b.module("LocalStorageModule",[]).provider("localStorageService",function(){this.prefix="ls",this.storageType="localStorage",this.cookie={expiry:30,path:"/",secure:!1},this.defaultToCookie=!0,this.notify={setItem:!0,removeItem:!1},this.setPrefix=function(a){return this.prefix=a,this},this.setStorageType=function(a){return this.storageType=a,this},this.setDefaultToCookie=function(a){return this.defaultToCookie=!!a,this},this.setStorageCookie=function(a,b,c){return this.cookie.expiry=a,this.cookie.path=b,this.cookie.secure=c,this},this.setStorageCookieDomain=function(a){return this.cookie.domain=a,this},this.setNotify=function(a,b){return this.notify={setItem:a,removeItem:b},this},this.$get=["$rootScope","$window","$document","$parse","$timeout",function(a,b,k,l,m){function n(c){if(c||(c=b.event),s.setItem&&h(c.key)&&w(c.key)){var d=v(c.key);m(function(){a.$broadcast("LocalStorageModule.notification.changed",{key:d,newvalue:c.newValue,storageType:p.storageType})})}}var o,p=this,q=p.prefix,r=p.cookie,s=p.notify,t=p.storageType;k?k[0]&&(k=k[0]):k=document,"."!==q.substr(-1)&&(q=q?q+".":"");var u=function(a){return q+a},v=function(a){return a.replace(new RegExp("^"+q,"g"),"")},w=function(a){return 0===a.indexOf(q)},x=function(){try{var c=t in b&&null!==b[t],d=u("__"+Math.round(1e7*Math.random()));return c&&(o=b[t],o.setItem(d,""),o.removeItem(d)),c}catch(b){return p.defaultToCookie&&(t="cookie"),a.$broadcast("LocalStorageModule.notification.error",b.message),!1}},y=x(),z=function(b,c,e){if(K(e),c=d(c)?null:j(c),!y&&p.defaultToCookie||"cookie"===p.storageType)return y||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),s.setItem&&a.$broadcast("LocalStorageModule.notification.setitem",{key:b,newvalue:c,storageType:"cookie"}),F(b,c);try{o&&o.setItem(u(b),c),s.setItem&&a.$broadcast("LocalStorageModule.notification.setitem",{key:b,newvalue:c,storageType:p.storageType})}catch(d){return a.$broadcast("LocalStorageModule.notification.error",d.message),F(b,c)}return!0},A=function(b,c){if(K(c),!y&&p.defaultToCookie||"cookie"===p.storageType)return y||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),G(b);var d=o?o.getItem(u(b)):null;if(!d||"null"===d)return null;try{return JSON.parse(d)}catch(a){return d}},B=function(){var b=0;arguments.length>=1&&("localStorage"===arguments[arguments.length-1]||"sessionStorage"===arguments[arguments.length-1])&&(b=1,K(arguments[arguments.length-1]));var c,d;for(c=0;c<arguments.length-b;c++)if(d=arguments[c],!y&&p.defaultToCookie||"cookie"===p.storageType)y||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),s.removeItem&&a.$broadcast("LocalStorageModule.notification.removeitem",{key:d,storageType:"cookie"}),H(d);else try{o.removeItem(u(d)),s.removeItem&&a.$broadcast("LocalStorageModule.notification.removeitem",{key:d,storageType:p.storageType})}catch(b){a.$broadcast("LocalStorageModule.notification.error",b.message),H(d)}},C=function(b){if(K(b),!y)return a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),[];var c=q.length,d=[];for(var e in o)if(e.substr(0,c)===q)try{d.push(e.substr(c))}catch(b){return a.$broadcast("LocalStorageModule.notification.error",b.Description),[]}return d},D=function(b,c){K(c);var d=q?new RegExp("^"+q):new RegExp,e=b?new RegExp(b):new RegExp;if(!y&&p.defaultToCookie||"cookie"===p.storageType)return y||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),I();if(!y&&!p.defaultToCookie)return!1;var f=q.length;for(var g in o)if(d.test(g)&&e.test(g.substr(f)))try{B(g.substr(f))}catch(b){return a.$broadcast("LocalStorageModule.notification.error",b.message),I()}return!0},E=function(){try{return b.navigator.cookieEnabled||"cookie"in k&&(k.cookie.length>0||(k.cookie="test").indexOf.call(k.cookie,"test")>-1)}catch(b){return a.$broadcast("LocalStorageModule.notification.error",b.message),!1}}(),F=function(b,c,h,i){if(d(c))return!1;if((g(c)||f(c))&&(c=j(c)),!E)return a.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var l="",m=new Date,n="";if(null===c?(m.setTime(m.getTime()+-864e5),l="; expires="+m.toGMTString(),c=""):e(h)&&0!==h?(m.setTime(m.getTime()+24*h*60*60*1e3),l="; expires="+m.toGMTString()):0!==r.expiry&&(m.setTime(m.getTime()+24*r.expiry*60*60*1e3),l="; expires="+m.toGMTString()),b){var o="; path="+r.path;r.domain&&(n="; domain="+r.domain),"boolean"==typeof i?i===!0&&(n+="; secure"):r.secure===!0&&(n+="; secure"),k.cookie=u(b)+"="+encodeURIComponent(c)+l+o+n}}catch(b){return a.$broadcast("LocalStorageModule.notification.error",b.message),!1}return!0},G=function(b){if(!E)return a.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var c=k.cookie&&k.cookie.split(";")||[],d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(u(b)+"=")){var f=decodeURIComponent(e.substring(q.length+b.length+1,e.length));try{return JSON.parse(f)}catch(a){return f}}}return null},H=function(a){F(a,null)},I=function(){for(var a=null,b=q.length,c=k.cookie.split(";"),d=0;d<c.length;d++){for(a=c[d];" "===a.charAt(0);)a=a.substring(1,a.length);var e=a.substring(b,a.indexOf("="));H(e)}},J=function(){return t},K=function(a){return a&&t!==a&&(t=a,y=x()),y},L=function(a,b,d,e,g){e=e||b;var h=A(e,g);return null===h&&c(d)?h=d:f(h)&&f(d)&&(h=i(h,d)),l(b).assign(a,h),a.$watch(b,function(a){z(e,a,g)},f(a[b]))};y&&(b.addEventListener?(b.addEventListener("storage",n,!1),a.$on("$destroy",function(){b.removeEventListener("storage",n)})):b.attachEvent&&(b.attachEvent("onstorage",n),a.$on("$destroy",function(){b.detachEvent("onstorage",n)})));var M=function(a){K(a);for(var c=0,d=b[t],e=0;e<d.length;e++)0===d.key(e).indexOf(q)&&c++;return c};return{isSupported:y,getStorageType:J,setStorageType:K,set:z,add:z,get:A,keys:C,remove:B,clearAll:D,bind:L,deriveKey:u,underiveKey:v,length:M,defaultToCookie:this.defaultToCookie,cookie:{isSupported:E,set:F,add:F,get:G,remove:H,clearAll:I}}}]})}(window,window.angular),angular.module("builder",["ngRoute","builder.filters","builder.services","builder.directives","builder.controllers","LocalStorageModule","ui.ace","angulartics","angulartics.google.analytics"]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/models",{templateUrl:"partials/models.html",controller:"ModelController"}),a.when("/home",{templateUrl:"partials/home.html",controller:"ModelController"}),a.otherwise({redirectTo:"/home"})}]),angular.module("builder.controllers",["LocalStorageModule"]).controller("ModelController",["$scope","$http","ProjectFactory","ModelFactory","ModelParser","FieldFactory","RelationshipFactory","localStorageService","MessageService","RenderFactory","TarballFactory",function(a,b,c,d,e,f,g,h,i,j,k){a.models=[],a.new_models=[],a.user_model="django.contrib.auth.models.User",a.user_model_setting="settings.AUTH_USER_MODEL",a.built_in_models={"django.contrib.auth.models.User":{fields:{username:{default:"username"},email:{default:"username@tempurl.com"}}},"django.contrib.auth.models.Group":{fields:{name:{default:"group"}}},"django.contrib.contenttypes.models.ContentType":{fields:{}}},a.messageService=new i,a.field_factory=new f,a.project_factory=new c(b),a.model_factory=d,a.relationship_factory=new g,a.render_factory=new j(a.built_in_models),a.editors=[],a.models_storage_key="local_models",a._app_name="app_name",a._project_name="project_name",a.create_tar_ball_url=function(b){var c="Built with django_builder\n",d="#";const e=a.project_name(),f=a.app_name();var g=a.render_factory.render_models_py(f,a.models),h=a.render_factory.render_views_py(f,a.models),i=a.render_factory.render_admin_py(f,a.models),j=a.render_factory.render_urls_py(f,a.models),l=a.render_factory.render_tests_py(f,a.models),m=a.render_factory.render_forms_py(f,a.models),n=a.render_factory.render_django_rest_framework_api_py(f,a.models),o=a.render_factory.render_django_rest_framework_serializers_py(f,a.models),p=a.render_factory.render_templates_html(f,a.models),q=new k,r=f;if(b){r=e+"/"+f;var s=a.project_factory.render_project_requirements(),t=a.project_factory.render_project_settings_py(e,f),u=a.project_factory.render_project_urls_py(f),v=a.project_factory.render_project_manage_py(e),w=a.project_factory.render_project_wsgi_py(e);q.append("requirements.txt",s),q.append(e+"/manage.py",v),q.append(e+"/"+e+"/settings.py",t),q.append(e+"/"+e+"/urls.py",u),q.append(e+"/"+e+"/wsgi.py",w),q.append(e+"/"+e+"/__init__.py",d)}return q.append(r+"/README.txt",c),q.append(r+"/__init__.py",d),q.append(r+"/models.py",g),q.append(r+"/views.py",h),q.append(r+"/admin.py",i),q.append(r+"/urls.py",j),q.append(r+"/tests.py",l),q.append(r+"/forms.py",m),q.append(r+"/api.py",n),q.append(r+"/serializers.py",o),q.append(r+"/templates/base.html",a.render_factory.render_base_html(f,a.models)),jQuery.each(p,function(a,b){q.append(r+"/templates/"+f+"/"+b[0],b[1])}),q.get_url()},a.create_download_modal_app=function(){var b=a.create_tar_ball_url(!1),c=a.app_name()+".tar",d="django_builder_download_app_modal";return a.create_download_modal(b,c,d)},a.create_download_modal_project=function(){var b=a.create_tar_ball_url(!0),c=a.project_name()+".tar",d=jQuery("<p>");d.text("The project download includes the following files:");var e=jQuery("<div>").addClass("well well-sm");e.append(jQuery("<p>").text("requirements.txt")),e.append(jQuery("<p>").text("manage.py")),e.append(jQuery("<p>").text(a.project_name()+"/settings.py")),e.append(jQuery("<p>").text(a.project_name()+"/urls.py")),e.append(jQuery("<p>").text(a.project_name()+"/wsgi.py")),d.append(jQuery("<br><br>")),d.append(e);var f="django_builder_download_project_modal";return a.create_download_modal(b,c,f,d)},a.create_download_modal=function(b,c,d,e){var f=jQuery("<a>").attr("href",b).attr("id","django_builder_download_a");f.addClass("btn btn-success btn-lg").css("text-transform","none"),f.text("Click here to download "+c),f.attr("download",c);var g=jQuery("<div>").addClass("text-center").append(f),h=jQuery("<div>");h.append(jQuery("<br>")),h.append("Chrome can block downloads of the generated tarball, if this happens navigate to the "),h.append(jQuery("<strong>").text("Downloads")),h.append(" section of chrome to accept the download"),h.append(jQuery("<br>")),h.append("Window -> Downloads");var i=jQuery("<div>");return void 0!=e&&i.append(e),i.append(g),i.append(h),a.messageService.simple_info("Download info",i).modal("show").attr("id",d),d},a.render_model_class_fields_only=function(b){return b.render_model_class_fields_only(a._app_name,a.render_factory)},a.upload_input=function(){return jQuery('<input type="file" />')},a.upload_drop_target=function(a){var b=jQuery("<div>").addClass("builder_dnd_target text-center"),c=jQuery("<i>").addClass("fa fa-upload fa-4x builder_dnd_icon");return b.append(jQuery("<div>").text("Drag and Drop files here!")),b.append(c),b},a.upload_form=function(a,b){var c=jQuery("<form>"),d=jQuery("<span>").addClass("btn btn-default btn-file center-block builder_upload_models_py");return d.append("Browse"),d.append(a),c.append(d),c.append(b),c},a.save_new_models=function(b){a.new_models=[],a.models=b,a.saveApp(),a.$apply()},a.merge_models=function(){for(var b=a.models.concat(a.new_models),c=0;c<b.length;++c)for(var d=c+1;d<b.length;++d)b[c].name===b[d].name&&b.splice(d--,1);return a.save_new_models(b)},a.add_unique=function(){jQuery.each(a.new_models,function(b,c){a.existingModel(c.name)||a.models.push(c)}),a.save_new_models(a.models)},a.add_new_models=function(b){a.new_models=b,a.$apply();var c=function(){console.log("Overwriting existing models"),a.merge_models()},d=function(){var b=!1,d=[],e=jQuery("<p>").text("The following models are duplicates:");jQuery.each(a.new_models,function(c,f){a.existingModel(f.name)&&(b=!0,d.push(f),e.append(jQuery("<div>").text(f.name)))});var f=d.length==a.new_models.length;if(b){var g=[{text:"Overwrite existing models",callback:c}];f||g.push({text:"Add unique",callback:a.add_unique}),g.push({text:"Cancel",callback:function(){}});var h="duplicate_models";a.messageService.simple_choice("Add duplicate models?",e,g).modal("show").attr("id",h)}else a.merge_models()},e=jQuery("<div>");jQuery.each(a.new_models,function(b,c){e.append(jQuery("<hr>")),e.append(jQuery("<pre>").html(c.render_model_class_fields_only(a._app_name,a.render_factory)));var d=jQuery('<button class="btn btn-danger pull-right">').text("Remove");e.append(d),e.append(jQuery("<div>").addClass("clearfix"))});var f="add_new_models";return a.messageService.simple_confirm("Add the following models?",jQuery("#builder_new_models"),d).modal("show").find(".modal-dialog").css("width","50%").attr("id",f),f},a.process_models_py=function(b){if(0==b.length)a.messageService.simple_error("Sorry","You didn't seem to choose any files.").modal("show");else if(b.length>1)a.messageService.simple_error("Sorry","Multiple files not yet supported, please choose a single file.").modal("show");else{var c=e(a);c.parse(b[0],function(b){a.add_new_models(b)})}},a.upload_models_py=function(){var b=a.upload_input(),c=a.upload_drop_target(),d=a.upload_form(b,c),e=a.messageService.simple_form("Upload models.py","Choose a models.py file to analyse",d,function(){a.process_models_py(jQuery(b)[0].files),e.modal("hide")}).modal("show");b.change(function(){a.process_models_py(jQuery(b)[0].files),e.modal("hide")}),d.on("drag dragstart dragend dragover dragenter dragleave drop",function(a){a.preventDefault(),a.stopPropagation()}).on("dragover dragenter",function(){c.addClass("is-drag-over")}).on("dragleave dragend drop",function(){c.removeClass("is-drag-over")}).on("drop",function(b){var c=b.originalEvent.dataTransfer.files;e.modal("hide"),a.process_models_py(c)})},jQuery("html body").on("drag dragstart dragend dragover dragenter dragleave drop",function(a){a.preventDefault(),a.stopPropagation()}).on("dragover dragenter",function(){}).on("drop",function(a){}),jQuery("#builder_models_content").on("drag dragstart dragend dragover dragenter dragleave drop",function(a){a.preventDefault(),a.stopPropagation()}).on("dragover dragenter",function(){jQuery(".builder_dnd_target").addClass("is-drag-over")}).on("drop",function(b){jQuery(".builder_dnd_target").removeClass("is-drag-over");var c=b.originalEvent.dataTransfer.files;a.process_models_py(c)}),a.aceLoad=function(b){var c=jQuery(b.container).attr("id");"builder_models"==c?b.setValue(a.render_factory.render_models_py(a.app_name(),a.models)):"builder_views"==c?b.setValue(a.render_factory.render_views_py(a.app_name(),a.models)):"builder_admin"==c?b.setValue(a.render_factory.render_admin_py(a.app_name(),a.models)):"builder_urls"==c?b.setValue(a.render_factory.render_urls_py(a.app_name(),a.models)):"builder_tests"==c?b.setValue(a.render_factory.render_tests_py(a.app_name(),a.models)):"builder_forms"==c?b.setValue(a.render_factory.render_forms_py(a.app_name(),a.models)):"builder_django_rest_framework_api"==c?b.setValue(a.render_factory.render_django_rest_framework_api_py(a.app_name(),a.models)):"builder_django_rest_framework_serializers"==c&&b.setValue(a.render_factory.render_django_rest_framework_serializers_py(a.app_name(),a.models)),b.session.selection.clearSelection()},a.reLoadAce=function(){Object.keys(a.editors).map(function(b){a.aceLoad(a.editors[b])})},a.aceLoaded=function(b){b.setOptions({readOnly:!0,highlightActiveLine:!1,highlightGutterLine:!1,maxLines:1/0}),b.renderer.$cursorLayer.element.style.opacity=0,a.aceLoad(b),a.editors.push(b)},a.$watch("[models,_app_name,_project_name]",function(){a.reLoadAce(),a.saveApp()},!0),a.aceChanged=function(a){},a.do_set_app_name=function(b){a._app_name=b},a.set_app_name=function(){a.do_set_app_name(jQuery("input#appname").val()),a.reLoadAce()},a.do_set_project_name=function(b){a._project_name=b},a.set_project_name=function(){a.do_set_project_name(jQuery("input#projectname").val()),a.reLoadAce()},a.l_app_name=function(){return a._app_name.toLowerCase()},a.app_name=function(){return a._app_name.replace(new RegExp(" ","g"),"_")},a.project_name=function(){return a._project_name.replace(new RegExp(" ","g"),"_")},a.updateModel=function(b){var c=a.models.indexOf(b);a.models[c]=b,a.$apply()},a.serializeApp=function(){var b={models:a.models,app_config:{app_name:a._app_name,project_name:a._project_name}};return JSON.stringify(b)},a.saveApp=function(){h.set(a.models_storage_key,a.serializeApp())},a.doClearModels=function(){h.set(a.models_storage_key,""),a.loadModels(),a.models=[],a.$apply()},a.clearModels=function(){var b=function(){a.doClearModels()},c="clear_all";return a.messageService.simple_confirm("Confirm","Remove all models?",b).modal("show").attr("id",c),c},a.model_count=function(){return a.models.length},a.add_model=function(b){var c={name:b};c.fields=[a.field_factory.make_field({name:"name",type:"django.db.models.CharField",opts:"max_length=255"}),a.field_factory.make_field({name:"slug",type:"django_extensions.db.fields.AutoSlugField",opts:"populate_from='name', blank=True"}),a.field_factory.make_field({name:"created",type:"django.db.models.DateTimeField",opts:"auto_now_add=True, editable=False"}),a.field_factory.make_field({name:"last_updated",type:"django.db.models.DateTimeField",opts:"auto_now=True, editable=False"})];var e=d(c,a);a.models.push(e),a.saveApp(),a.$apply()},a.existingModel=function(b){var c=!1;return jQuery.each(a.models,function(a,d){b==d.name&&(c=!0)}),c},a.addModel=function(){var b=function(b){void 0==b||""===b?a.messageService.simple_info("Model Name Required","Enter a Model name").modal("show"):a.existingModel(b)?a.messageService.simple_error("Error with Model Name","There is already a model with the name "+b).modal("show"):a.add_model(b)},c="add_model";return a.messageService.simple_input("Model Name Required","Enter a Model name","Model1",b,!0).modal("show").attr("id",c),c},a.cleanModel=function(a){delete a.$$hashKey,void 0!=a.fields&&jQuery.each(a.fields,function(a,b){delete b.$$hashKey}),void 0!=a.relationships&&jQuery.each(a.relationships,function(a,b){delete b.$$hashKey})},a.loadModels=function(){const b={app_name:"app_name",project_name:"project_name"};var c=h.get(a.models_storage_key)||{models:[],app_config:b};"string"==typeof c&&(c=JSON.parse(c));var d=c.models||[],e=c.app_config||{app_name:"app_name",project_name:"project_name"};return a._app_name=e.app_name,a._project_name=e.project_name,jQuery.each(d,function(b,c){a.cleanModel(c)}),d},a.loadModel=function(b){var c=d(b,a);a.models.push(c)},a.__init__=function(){jQuery.each(a.loadModels(),function(b,c){a.loadModel(c)})},a.__init__(),a.debug=function(){},a.do_rename_model=function(b,c){var d="rename_model_existing",e=a.models[b];a.existingModel(c)?a.messageService.simple_error("Error with Model Name","There is already a model with the name "+c).modal("show").attr("id",d):(e.set_name(c),a.updateModel(e),a.$apply())},a.rename_model=function(b){var c=a.models[b],d="rename_model",e=function(c){a.do_rename_model(b,c)};return a.messageService.simple_input("Rename model","Enter a new Model name",c.name,e,!0).modal("show").attr("id",d),d},a.add_relationship=function(b){const c=a.models[b],d=function(b){var d=b.find("input[name=name]").val().trim(),e=b.find("select[name=to]").val().trim(),f=!0;if(jQuery.each(a.built_in_models,function(a,b){e==a&&(f=!1)}),jQuery.each(a.models,function(a,b){e==b.name&&(f=!1)}),b.find("div.form-group-name").removeClass("has-error"),b.find("div.form-group-to").removeClass("has-error"),void 0===d||""===d)b.find("div.form-group-name").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text("Field Required");else if(void 0===e||""===e)b.find("div.form-group-to").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text("Field Required");else if(c.has_relationship(d))b.find("div.form-group-name").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text('Field "'+d+'" exists');else{var g=b.find("select[name=type]").val(),h=b.find("input[name=opts]").val(),i=a.relationship_factory.make_relationship({name:d,type:g,opts:h,to:e,external_app:f});c.relationships.push(i),a.updateModel(c),a.$apply(),jQuery(".modal").modal("hide")}},e=jQuery("<form>"),f=jQuery("<div>").addClass("form-group form-group-name has-feedback").appendTo(e),g=jQuery("<div>").addClass("form-group form-group-to").appendTo(e),h=jQuery("<div>").addClass("form-group form-group-type").appendTo(e),i=jQuery("<div>").addClass("form-group form-group-args").appendTo(e);f.append(jQuery("<label>").text("Name")),f.append(jQuery("<input>").attr("name","name").addClass("form-control")),f.append(jQuery("<span>").text("error message").addClass("help-block hide"));const j=jQuery("<select>").attr("name","to").addClass("form-control"),k=jQuery("<optgroup>").attr("label","Django models");
jQuery.each(a.built_in_models,function(a,b){k.append(jQuery("<option>").attr("val",a).text(a))}),j.append(k);const l=jQuery("<optgroup>").attr("label","Your App models");jQuery.each(a.models,function(a,b){l.append(jQuery("<option>").attr("val",b.name).text(b.name))}),j.append(l),g.append(jQuery("<label>").text("Relationship to Model")),g.append(j),g.append(jQuery("<p>").addClass("text-primary small clearfix").text("You can add external models (otherapp.models.Model1)").css("margin","4px"));const m=jQuery("<select>").attr("name","type");jQuery.each(a.relationship_factory.relationship_types(),function(a,b){m.append(jQuery("<option>").attr("val",b).text(b))}),h.append(jQuery("<label>").text("Relationship Type")),h.append(m),i.append(jQuery("<label>").text("Arguments")),i.append(jQuery("<input>").attr("name","opts").attr("placeholder","options").addClass("form-control")),j.select2({theme:"bootstrap",allowClear:!0,placeholder:"Select a model.",tags:!0,selectOnClose:!0}),m.select2({theme:"bootstrap"});const n="add_rel_"+c.name+"_"+b;return a.messageService.simple_form_no_dismiss("Add Relationship","",e,d).modal("show").attr("id",n).appendTo("body"),n},a.add_field=function(b){var c=a.models[b],d=function(b){var d=b.find("input[name=name]").val();if(void 0===d||""===d)b.find("div.form-group-name").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text("Field Required");else if(c.has_field(d))b.find("div.form-group-name").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text('Field "'+d+'" exists');else{var e=b.find("select[name=type]").val(),f=b.find("input[name=opts]").val(),g=a.field_factory.make_field({name:d,type:e,opts:f});c.fields.push(g),a.updateModel(c),a.$apply(),jQuery(".modal").modal("hide")}},e=jQuery("<form>"),f=jQuery("<div>").addClass("form-group form-group-name  has-feedback").appendTo(e),g=jQuery("<div>").addClass("form-group form-group-type").appendTo(e),h=jQuery("<div>").addClass("form-group form-group-args").appendTo(e);f.append(jQuery("<label>").text("Name")),f.append(jQuery("<input>").attr("name","name").addClass("form-control")),f.append(jQuery("<span>").text("error message").addClass("help-block hide"));var i=jQuery("<select>").attr("name","type").addClass("form-control");jQuery.each(a.field_factory.field_types(),function(a,b){i.append(jQuery("<option>").attr("val",b).text(b))});var j=jQuery("<input>").attr("name","opts").attr("placeholder","options").addClass("form-control");g.append(jQuery("<label>").text("Field Type")),g.append(i),h.append(jQuery("<label>").text("Arguments")),h.append(j),i.change(function(){j.val(a.field_factory.default_field_args(i.val()))}),j.val(a.field_factory.default_field_args(i.val()));var k="add_field_"+c.name+"_"+b;return a.messageService.simple_form_no_dismiss("Add Field","",e,d).modal("show").attr("id",k).appendTo("body"),k},a.edit_relationship=function(b,c){var d=a.models[b].relationships[c],e=function(b){d.form_update(b),a.$apply(),jQuery(".modal").modal("hide")},f=d.$$hashKey||"edit_relationship_"+d.name;return a.messageService.simple_form("Edit Relationship '"+d.name+"'","",d.edit_form(a),e).modal("show").attr("id",f).appendTo("body"),f},a.edit_field=function(b,c){var d=a.models[b].fields[c],e=function(b){d.form_update(b),a.$apply(),jQuery(".modal").modal("hide")},f=d.$$hashKey||"edit_field_"+d.name;return a.messageService.simple_form("Edit field '"+d.name+"'","",d.edit_form(a),e).modal("show").attr("id",f).appendTo("body"),f},a.do_remove_new_model=function(b){a.new_models.splice(b,1),a.$apply()},a.remove_new_model=function(b){setTimeout(function(){a.do_remove_new_model(b)})},a.remove_relationship=function(b,c){var d=function(){a.models[b].relationships.splice(c,1),a.$apply()},e=a.models[b].relationships[c],f=e.$$hashKey||"remove_relationship_"+e.name;return a.messageService.simple_confirm("Confirm","Remove the relationship '"+e.name+"'",d).modal("show").attr("id",f).appendTo("body"),f},a.do_remove_new_relationship=function(b,c){a.new_models[b].relationships.splice(c,1)},a.remove_new_relationship=function(b,c){setTimeout(function(){a.do_remove_new_relationship(b,c)})},a.do_remove_new_field=function(b,c){a.new_models[b].fields.splice(c,1),a.$apply()},a.remove_new_field=function(b,c){setTimeout(function(){a.do_remove_new_field(b,c)})},a.remove_field=function(b,c){var d=function(){a.models[b].fields.splice(c,1),a.$apply()},e=a.models[b].fields[c],f=e.$$hashKey||"remove_field_"+e.name;return a.messageService.simple_confirm("Confirm","Remove the field '"+e.name+"'",d).modal("show").attr("id",f).appendTo("body"),f},a.remove_model=function(b){var c=function(){a.models.splice(b,1),a.$apply()},d=a.models[b],e=d.$$hashKey||"remove_model_"+d.name;return a.messageService.simple_confirm("Confirm","Remove the model '"+d.name+"'",c).modal("show").modal("show").attr("id",e).appendTo("body"),e},a.model_highlight=function(b,c){var d=a.models[b].relationships[c];jQuery(".builder_model_"+d.to_clean()).addClass("builder_model_highlight")},a.model_unhighlight=function(){jQuery(".builder_model").removeClass("builder_model_highlight")},a.new_model_highlight=function(b,c){var d=a.new_models[b].relationships[c];jQuery(".builder_model_"+d.to_clean()).addClass("builder_model_highlight")},a.new_model_unhighlight=function(){jQuery(".builder_model").removeClass("builder_model_highlight")}}]),angular.module("builder.directives",[]).directive("appVersion",["version",function(a){return function(b,c,d){c.text(a)}}]),angular.module("builder.filters",[]).filter("interpolate",["version",function(a){return function(b){return String(b).replace(/\%VERSION\%/gm,a)}}]),angular.module("builder.services",[]).factory("ProjectFactory",[ProjectFactory]).factory("ModelFactory",[ModelServiceFactory]).factory("ModelParser",[ModelParserFactory]).factory("MessageService",[MessageServiceFactory]).factory("FieldFactory",[FieldFactory]).factory("RelationshipFactory",[RelationshipFactory]).factory("RenderFactory",[ModelRenderFactory]).factory("TarballFactory",[TarballFactory]).value("version","0.1");
>>>>>>> Load project templates from http resource
=======
function TarballFactory(){return function(){function a(){var a=this,b=require("tar-js"),c=new b;a.uInt8ToString=function(a){var b,c,d="";for(b=0,c=a.length;b<c;b+=1)d+=String.fromCharCode(a[b]);return d},a.append=function(a,b){c.append(a,b)},a.get_url=function(b){var d=btoa(a.uInt8ToString(c.out));return"data:application/tar;base64,"+d}}return new a}}function ModelRenderFactory(){return function(a){var b=this;b.built_in_models=a,b.spaces=function(a){var b=a||1;return new Array(b+1).join(" ")},b.model_names=function(a,b){var c=b||"";return Object.keys(a).map(function(b){return a[b].name+c})},b.new_lines=function(a){var b=a||1;return new Array(b+1).join("\n")},b.render_all=function(a,c){var d="";return d+=b.render_base_html(a,c),d+=b.render_forms_py(a,c),d+=b.render_urls_py(a,c),d+=b.render_admin_py(a,c),d+=b.render_views_py(a,c),d+=b.render_models_py(a,c),d+=b.render_django_rest_framework_api_py(a,c),d+=b.render_django_rest_framework_serializers_py(a,c),d+=b.render_templates_html(a,c)},b.render_base_html=function(a,b){return"<html><head></head><body>{% block content %}Replace this.{% endblock %}</body>"},b.pre_imported_modules=function(a){return{"django.contrib.auth.models":{as:"auth_models"},"django.db.models":{as:"models"},"django_extensions.db.fields":{as:"extension_fields"}}},b.pre_imported_modules_names=function(a){return Object.keys(b.pre_imported_modules())},b.render_forms_py=function(a,c){var d="from django import forms\n";return d+="from .models import "+b.model_names(c,"").join(", ")+"\n",d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_forms(a,b)}),d},b.render_tests_py=function(a,c){var d="import unittest\nfrom django.core.urlresolvers import reverse\nfrom django.test import Client\n";return d+="from .models import "+b.model_names(c,"").join(", ")+"\n",jQuery.each(b.built_in_models,function(a,c){var e=a.split("."),f=e.pop(),g=e.join(".");d+="from "+g+" import "+f,d+=b.new_lines(1)}),d+=b.new_lines(2),jQuery.each(b.built_in_models,function(a,c){var e="create_"+a.toLowerCase().replace(/\./g,"_"),f=a.split(".").pop(),g="";g+="def "+e+"(**kwargs):\n",g+=b.spaces(4)+"defaults = {}\n",jQuery.each(c.fields,function(a,c){g+=b.spaces(4)+'defaults["'+a+'"] = "'+c.default+'"\n'}),g+=b.spaces(4)+"defaults.update(**kwargs)\n",g+=b.spaces(4)+"return "+f+".objects.create(**defaults)\n",g+=b.new_lines(2),d+=g}),jQuery.each(c,function(c,e){d+=e.render_tests_helpers(a,b)}),jQuery.each(c,function(c,e){d+=e.render_tests(a,b)}),d},b.render_urls_py=function(a,c){var d="from django.conf.urls import url, include\n";return d+="from rest_framework import routers"+b.new_lines(1),d+="import api"+b.new_lines(1),d+="import views"+b.new_lines(2),d+="router = routers.DefaultRouter()"+b.new_lines(1),jQuery.each(c,function(a,c){d+="router.register(r'"+c.l_name()+"', api."+c.name+"ViewSet)"+b.new_lines(1)}),d+=b.new_lines(2),d+="urlpatterns = ("+b.new_lines(1),d+=b.spaces(4)+"# urls for Django Rest Framework API"+b.new_lines(1),d+=b.spaces(4)+"url(r'^api/v1/', include(router.urls)),"+b.new_lines(1),d+=")"+b.new_lines(1),d+=b.new_lines(1),jQuery.each(c,function(c,e){d+=e.render_urls(a,b)}),d},b.render_admin_py=function(a,c){var d="from django.contrib import admin\nfrom django import forms\n";return d+="from .models import "+b.model_names(c).join(", "),d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_admin_classes(a,b)}),d},b.render_views_py=function(a,c){var d="from django.views.generic import DetailView, ListView, UpdateView, CreateView\n";return d+="from .models import "+b.model_names(c).join(", "),d+=b.new_lines(1),d+="from .forms import "+b.model_names(c,"Form").join(", "),d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_view_classes(a,b)}),d},b.render_models_py=function(a,c){var d="from django.core.urlresolvers import reverse\n";d+="from django_extensions.db.fields import AutoSlugField\n",d+="from django.db.models import *\n",d+="from django.conf import settings\n",d+="from django.contrib.contenttypes.fields import GenericForeignKey\n",d+="from django.contrib.contenttypes.models import ContentType\n",d+="from django.contrib.auth import get_user_model\n",jQuery.each(b.pre_imported_modules(),function(a,b){var c=a.split("."),e=c.pop();d+="from "+c.join(".")+" import "+e+" as "+b.as+"\n"});var e={};jQuery.each(c,function(a,b){jQuery.each(b.fields,function(a,b){e[b.module()]=b.module()})});var f={};return jQuery.each(c,function(a,b){jQuery.each(b.fields,function(a,b){f[b.type]=b}),jQuery.each(b.relationships,function(a,b){f[b.type]=b})}),jQuery.each(f,function(a,b){}),d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_model_class(a,b)}),d},b.render_templates_html=function(a,b){var c=[];return jQuery.each(b,function(b,d){c.push([d.l_name()+"_form.html",d.render_form_html(a)]),c.push([d.l_name()+"_detail.html",d.render_detail_html(a)]),c.push([d.l_name()+"_list.html",d.render_list_html(a)])}),c},b.render_django_rest_framework_api_py=function(a,c){var d="import models\n";return d+="import serializers\n",d+="from rest_framework import viewsets, permissions\n",d+=b.new_lines(2),jQuery.each(c,function(c,e){d+=e.render_model_api(a,b)}),d},b.render_django_rest_framework_serializers_py=function(a,c){var d="import models";return d+=b.new_lines(2),d+="from rest_framework import serializers",d+=b.new_lines(3),jQuery.each(c,function(c,e){d+=e.render_model_serializer(a,b)}),d}}}function MessageServiceFactory(){return function(){var a=this;a.base_modal=function(){var a=jQuery("<div>").addClass("modal fade");a.attr("tabindex","-1"),a.attr("role","dialog"),a.css("display","none");var b=jQuery("<div>").addClass("modal-dialog"),c=jQuery("<div>").addClass("modal-content").appendTo(b),d=jQuery("<h2>").addClass("modal-header-inner");return jQuery("<div>").addClass("modal-header").appendTo(c).append(d),jQuery("<div>").addClass("modal-body").appendTo(c),jQuery("<div>").addClass("modal-footer").appendTo(c),a.append(b),a},a.icon=function(a){return jQuery("<icon>").addClass("fa").addClass(a)},a.simple_error=function(b,c){var d=a.base_modal().addClass("django_builder_simple_error"),e=a.icon("fa-info").addClass("pull-right");d.find(".modal-header-inner").append(e).append(jQuery("<span>").text(b)),d.find(".modal-body").empty().append(c);var f=jQuery("<button>").addClass("btn btn-default").text("Ok");return d.find(".modal-footer").append(f),f.attr("data-dismiss","modal"),d.modal(),d},a.simple_info=function(b,c){var d=a.base_modal(),e=a.icon("fa-info").addClass("pull-right");d.find(".modal-header-inner").append(e).append(jQuery("<span>").text(b)),d.find(".modal-body").empty().append(c);var f=jQuery("<button>").addClass("btn btn-default").text("Ok");return d.find(".modal-footer").append(f),f.attr("data-dismiss","modal"),d.modal(),d},a.simple_confirm=function(b,c,d){var e=d||jQuery.noop,f=a.base_modal();f.find(".modal-header-inner").html(b),f.find(".modal-body").empty().append(c);var g=jQuery("<button>").addClass("btn btn-primary").text("Ok"),h=jQuery("<button>").addClass("btn btn-default").text("Cancel");return f.find(".modal-footer").append(g).append(h),g.click(function(){e()}),h.attr("data-dismiss","modal"),g.attr("data-dismiss","modal"),f.modal(),f},a.simple_choice=function(b,c,d){var e=a.base_modal();return e.find(".modal-header-inner").html(b),e.find(".modal-body").empty().append(c),jQuery.each(d,function(a,b){var c=jQuery("<button>").addClass("btn btn-primary").text(b.text);e.find(".modal-footer").append(c),c.click(function(){b.callback()}),c.attr("data-dismiss","modal")}),e.modal(),e},a.simple_form=function(b,c,d,e,f){var g=e||jQuery.noop,h=f||!0,i=a.base_modal();i.find(".modal-header-inner").html(b),i.find(".modal-body").empty().append(c).append(d);var j=jQuery("<button>").addClass("btn btn-primary").text("Ok"),k=jQuery("<button>").addClass("btn btn-default").text("Cancel");return i.find(".modal-footer").append(j).append(k),j.click(function(){h||i.modal("hide"),g(d)}),k.attr("data-dismiss","modal"),h||j.attr("data-dismiss","modal"),i.modal(),i},a.simple_form_no_dismiss=function(b,c,d,e){return a.simple_form(b,c,d,e,!0)},a.simple_input=function(b,c,d,e,f){var g=e||jQuery.noop,h=f||!1,i=a.base_modal();i.find(".modal-header-inner").html(b);var j=jQuery("<label>").text(c),k=jQuery("<input>").attr("type","text").attr("name","input").addClass("form-control").attr("value",d),l=jQuery("<span>").text("error message").addClass("help-block hide"),m=jQuery("<div>").addClass("form-group form-group-input has-feedback").append(j).append(k).append(l),n=function(){var a=k.val();!h||""!=a&&void 0!=k?(i.modal("hide"),g(a)):m.addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text("Field Required")},o=jQuery("<form>").append(m).submit(function(a){a.preventDefault(),n()});i.find(".modal-body").empty().append(o);var p=jQuery("<button>").addClass("btn btn-primary").text("Ok"),q=jQuery("<button>").addClass("btn btn-default").text("Cancel");return i.find(".modal-footer").append(p).append(q),p.click(n),q.attr("data-dismiss","modal"),h||p.attr("data-dismiss","modal"),i.modal(),i}}}function RelationshipFactory(){return function(a){function b(a){this.name=a.name,this.type=a.type,this.opts=a.opts,this.to=a.to,this.external_app=a.external_app||!1,this.class_name=function(){return this.type.split(".").reverse()[0]},this.form_update=function(a){this.name=jQuery(a).find("input[name=name]").val(),this.type=jQuery(a).find("select[name=type]").val(),this.opts=jQuery(a).find("input[name=opts]").val(),this.to=jQuery(a).find("input[name=to]").val()},this.to_clean=function(){return this.to.replace(/['"]+/g,"")},this.to_class=function(){return this.to.split(".").reverse().shift()},this.opts_args=function(){return this.opts.split(",").join(", ")},this.to_module=function(){var a=this.to.split(".");return a.slice(0,a.length-1).join(".")},this.module=function(){var a=this.type.split(".");return a.slice(0,a.length-1).join(".")},this.edit_form=function(a){var b=jQuery("<form>"),c=jQuery("<div>").addClass("form-group form-group-name has-feedback").appendTo(b),d=jQuery("<div>").addClass("form-group form-group-type").appendTo(b),e=jQuery("<div>").addClass("form-group form-group-args").appendTo(b),f=jQuery("<div>").addClass("form-group form-group-args").appendTo(b);c.append(jQuery("<label>").text("Name")),c.append(jQuery("<input>").attr("name","name").addClass("form-control").val(this.name)),c.append(jQuery("<span>").text("error message").addClass("help-block hide")),d.append(jQuery("<label>").text("To")),d.append(jQuery("<input>").attr("name","to").attr("placeholder","to").addClass("form-control").val(this.to));var g=jQuery("<select>").attr("name","type").addClass("form-control"),h=this;return jQuery.each(a.relationship_factory.relationship_types(),function(a,b){var c=jQuery("<option>").attr("val",b).text(b);b==h.type&&c.attr("selected","selected"),g.append(c)}),e.append(jQuery("<label>").text("Field Type")),e.append(g),f.append(jQuery("<label>").text("Arguments")),f.append(jQuery("<input>").attr("name","opts").attr("placeholder","options").addClass("form-control").val(this.args)),b}}var c=this;c.relationship_types=function(){return["django.db.models.ForeignKey","django.db.models.OneToOneField","django.db.models.ManyToManyField"]},c.relationship_matches=function(){return c.relationship_types+["ForeignKey","OneToOneField","ManyToManyField","models.ForeignKey","models.OneToOneField","models.ManyToManyField"]},c.relationship_match=function(a){return c.relationship_matches().indexOf(a)!=-1},c.make_relationship=function(a){return new b(a)}}}function FieldFactory(){return function(a){function b(a){this.name=a.name,this.type=a.type,this.opts=a.opts||"",this.class_name=function(){return this.type.split(".").reverse()[0]},this.opts_args=function(){return this.opts.split(",").join(", ")},this.to_clean=function(){return this.to.replace(/['"]+/g,"")},this.module=function(){var a=this.type.split(".");return a.slice(0,a.length-1).join(".")},this.form_update=function(a){this.name=jQuery(a).find("input[name=name]").val(),this.type=jQuery(a).find("select[name=type]").val(),this.opts=jQuery(a).find("input[name=opts]").val()},this.edit_form=function(a){var b=jQuery("<form>"),c=jQuery("<div>").addClass("form-group form-group-name has-feedback").appendTo(b),d=jQuery("<div>").addClass("form-group form-group-type").appendTo(b),e=jQuery("<div>").addClass("form-group form-group-args").appendTo(b);c.append(jQuery("<label>").text("Name")),c.append(jQuery("<input>").attr("name","name").addClass("form-control").val(this.name)),c.append(jQuery("<span>").text("error message").addClass("help-block hide"));var f=jQuery("<select>").attr("name","type").addClass("form-control"),g=this;return jQuery.each(a.field_factory.field_types(),function(a,b){var c=jQuery("<option>").attr("val",b).text(b);b==g.type&&c.attr("selected","selected"),f.append(c)}),d.append(jQuery("<label>").text("Field Type")),d.append(f),e.append(jQuery("<label>").text("Arguments")),e.append(jQuery("<input>").attr("name","opts").attr("placeholder","options").addClass("form-control").val(this.opts)),b}}var c=this;c.fields=function(){return{"django.db.models.TextField":{default_args:"max_length=100"},"django.db.models.CharField":{default_args:"max_length=30"},"django.contrib.contenttypes.fields.GenericForeignKey":{default_args:'"content_type", "object_id"'},"django_extensions.db.fields.AutoSlugField":{},"django.db.models.CommaSeparatedIntegerField":{},"django.db.models.BigAutoField":{},"django.db.models.BigIntegerField":{},"django.db.models.BooleanField":{},"django.db.models.DateField":{},"django.db.models.DateTimeField":{},"django.db.models.DecimalField":{default_args:"max_digits=10, decimal_places=2"},"django.db.models.DurationField":{},"django.db.models.FileField":{default_args:'upload_to="/upload/files/"'},"django.db.models.ImageField":{default_args:'upload_to="/upload/images/"'},"django.db.models.FilePathField":{},"django.db.models.FloatField":{},"django.db.models.IntegerField":{},"django.db.models.PositiveIntegerField":{},"django.db.models.PositiveSmallIntegerField":{},"django.db.models.SlugField":{},"django.db.models.IPAddressField":{},"django.db.models.GenericIPAddressField":{},"django.db.models.NullBooleanField":{},"django.db.models.TimeField":{},"django.db.models.BinaryField":{},"django.db.models.AutoField":{},"django.db.models.SmallIntegerField":{},"django.db.models.URLField":{},"django.db.models.UUIDField":{},"django.db.models.EmailField":{}}},c.default_field_args=function(a){var b=c.fields()[a];return b&&b.default_args?b.default_args:""},c.field_types=function(){return Object.keys(c.fields())},c.make_field=function(a){return new b(a)}}}function ModelServiceFactory(){return function(a,b){function c(a){this.slugify=function(a){return a.toString().replace(/\s+/g,"").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"").replace(/^-+/,"").replace(/-+$/,"")},this.set_name=function(a){this.name=this.slugify(a)},this.set_name(a.name),this.fields=[];a.fields||[];this.fields=(a.fields||[]).map(b.field_factory.make_field),this.relationships=(a.relationships||[]).map(b.relationship_factory.make_relationship),this.relationship_names=function(){var a=this;return Object.keys(a.relationships).map(function(b){return a.relationships[b].name})},this.field_names=function(){var a=this;return Object.keys(a.fields).map(function(b){return a.fields[b].name})},this.l_name=function(){return this.name.toLowerCase()},this.has_relationship=function(a){return this.relationship_names().indexOf(a)!=-1},this.has_field=function(a){return this.field_names().indexOf(a)!=-1},this.name_field=function(){return this.field_names().indexOf("name")!=-1?"name":"id"},this.ordering_field=function(){return this.field_names().indexOf("created")!=-1?"created":"id"},this.identifier=function(){return this.field_names().indexOf("slug")!=-1?"slug":"id"},this.render_forms=function(a,b){var c="";return c+="class "+this.name+"Form(forms.ModelForm):\n",c+=b.spaces(4)+"class Meta:\n",c+=b.spaces(8)+"model = "+this.name+"\n",this.form_fields()&&(c+=b.spaces(8)+"fields = "+this.form_fields()+"\n"),c+=b.new_lines(2)},this.get_initial_data=function(a,b){var c="{";return c+=b.new_lines(1),jQuery.each(this.readable_fields(),function(a,d){c+=b.spaces(12)+'"'+d.name+'": "'+d.name+'",',c+=b.new_lines(1)}),jQuery.each(this.relationships,function(a,d){c+=b.spaces(12)+'"'+d.name+'": create_'+d.to.toLowerCase().replace(/\./g,"_")+"().id,",c+=b.new_lines(1)}),c+=b.spaces(8)+"}"},this.render_tests_helpers=function(a,b){var c="";return c+="def create_"+this.l_name()+"(**kwargs):\n",c+=b.spaces(4)+"defaults = {}\n",jQuery.each(this.readable_fields(),function(a,d){c+=b.spaces(4)+'defaults["'+d.name+'"] = "'+d.name+'"\n'}),c+=b.spaces(4)+"defaults.update(**kwargs)\n",jQuery.each(this.relationships,function(a,d){c+=b.spaces(4)+'if "'+d.name+'" not in defaults:\n';var e="create_"+d.to.toLowerCase().replace(/\./g,"_");b.built_in_models[d.to]&&(e="create_"+d.to.toLowerCase().replace(/\./g,"_")),c+=b.spaces(8)+'defaults["'+d.name+'"] = '+e+"()\n"}),c+=b.spaces(4)+"return "+this.name+".objects.create(**defaults)\n",c+=b.new_lines(2)},this.render_tests=function(a,b){var c="";return c+="class "+this.name+"ViewTest(unittest.TestCase):\n",c+=b.spaces(4)+"'''\n",c+=b.spaces(4)+"Tests for "+this.name+"\n",c+=b.spaces(4)+"'''\n",c+=b.spaces(4)+"def setUp(self):\n",c+=b.spaces(8)+"self.client = Client()\n",c+=b.new_lines(1),c+=b.spaces(4)+"def test_list_"+this.l_name()+"(self):\n",c+=b.spaces(8)+"url = reverse('"+a+"_"+this.l_name()+"_list')\n",c+=b.spaces(8)+"response = self.client.get(url)\n",c+=b.spaces(8)+"self.assertEqual(response.status_code, 200)\n",c+=b.new_lines(1),c+=b.spaces(4)+"def test_create_"+this.l_name()+"(self):\n",c+=b.spaces(8)+"url = reverse('"+a+"_"+this.l_name()+"_create')\n",c+=b.spaces(8)+"data = "+this.get_initial_data(a,b)+"\n",c+=b.spaces(8)+"response = self.client.post(url, data=data)\n",c+=b.spaces(8)+"self.assertEqual(response.status_code, 302)\n",c+=b.new_lines(1),c+=b.spaces(4)+"def test_detail_"+this.l_name()+"(self):\n",c+=b.spaces(8)+this.l_name()+" = create_"+this.l_name()+"()\n",c+=b.spaces(8)+"url = reverse('"+a+"_"+this.l_name()+"_detail', args=["+this.l_name()+"."+this.identifier()+",])\n",c+=b.spaces(8)+"response = self.client.get(url)\n",c+=b.spaces(8)+"self.assertEqual(response.status_code, 200)\n",c+=b.new_lines(1),c+=b.spaces(4)+"def test_update_"+this.l_name()+"(self):\n",c+=b.spaces(8)+this.l_name()+" = create_"+this.l_name()+"()\n",c+=b.spaces(8)+"data = "+this.get_initial_data(a,b)+"\n",c+=b.spaces(8)+"url = reverse('"+a+"_"+this.l_name()+"_update', args=["+this.l_name()+"."+this.identifier()+",])\n",c+=b.spaces(8)+"response = self.client.post(url, data)\n",c+=b.spaces(8)+"self.assertEqual(response.status_code, 302)\n",c+=b.new_lines(2)},this.render_urls=function(a,b){var c="";return c+="urlpatterns += (\n",c+=b.spaces(4)+"# urls for "+this.name+"\n",c+=b.spaces(4)+"url(r'^"+a+"/"+this.l_name()+"/$', views."+this.name+"ListView.as_view(), name='"+a+"_"+this.l_name()+"_list'),\n",c+=b.spaces(4)+"url(r'^"+a+"/"+this.l_name()+"/create/$', views."+this.name+"CreateView.as_view(), name='"+a+"_"+this.l_name()+"_create'),\n",c+=b.spaces(4)+"url(r'^"+a+"/"+this.l_name()+"/detail/(?P<"+this.identifier()+">\\S+)/$', views."+this.name+"DetailView.as_view(), name='"+a+"_"+this.l_name()+"_detail'),\n",c+=b.spaces(4)+"url(r'^"+a+"/"+this.l_name()+"/update/(?P<"+this.identifier()+">\\S+)/$', views."+this.name+"UpdateView.as_view(), name='"+a+"_"+this.l_name()+"_update'),\n",c+=")\n",c+=b.new_lines(1)},this.render_admin_classes=function(a,b){var c="";c+="class "+this.name+"AdminForm(forms.ModelForm):\n",c+=b.new_lines(1),c+=b.spaces(4)+"class Meta:\n",c+=b.spaces(8)+"model = "+this.name+"\n",c+=b.spaces(8)+"fields = '__all__'\n",c+=b.new_lines(2),c+="class "+this.name+"Admin(admin.ModelAdmin):\n",c+=b.spaces(4)+"form = "+this.name+"AdminForm\n";var d=this.admin_fields();return d.length>0?(c+=b.spaces(4)+"list_display = "+this.admin_fields()+"\n",c+=b.spaces(4)+"readonly_fields = "+this.admin_read_only_fields()+"\n"):c+=b.new_lines(1),c+=b.new_lines(1),c+="admin.site.register("+this.name+", "+this.name+"Admin)\n",c+=b.new_lines(2)},this.render_view_classes=function(a,b){var c=b.new_lines(1);return c+="class "+this.name+"ListView(ListView):\n",c+=b.spaces(4)+"model = "+this.name+"\n",c+=b.new_lines(2),c+="class "+this.name+"CreateView(CreateView):\n",c+=b.spaces(4)+"model = "+this.name+"\n",c+=b.spaces(4)+"form_class = "+this.name+"Form\n",c+=b.new_lines(2),c+="class "+this.name+"DetailView(DetailView):\n",c+=b.spaces(4)+"model = "+this.name+"\n",c+=b.new_lines(2),c+="class "+this.name+"UpdateView(UpdateView):\n",c+=b.spaces(4)+"model = "+this.name+"\n",c+=b.spaces(4)+"form_class = "+this.name+"Form",c+=b.new_lines(2)},this.render_model_class_header=function(a,b){var c="class "+this.name+"(models.Model):";return c+b.new_lines(2)},this.render_model_class_fields=function(a,b){var c="";return this.fields.length>0&&(c+=b.spaces(4)+"# Fields",c+=b.new_lines(1)),jQuery.each(this.fields,function(a,d){if(b.pre_imported_modules_names().indexOf(d.module())==-1)c+=b.spaces(4)+d.name+" = "+d.class_name()+"("+d.opts+")";else{var e=b.pre_imported_modules()[d.module()].as;c+=b.spaces(4)+d.name+" = "+e+"."+d.class_name()+"("+d.opts+")"}c+=b.new_lines(1)}),c+=b.new_lines(1)},this.render_model_class_relationships=function(a,c){var d="";return this.relationships.length>0&&(d+=c.spaces(4)+"# Relationship Fields",d+=c.new_lines(1)),jQuery.each(this.relationships,function(e,f){var g="'"+a+"."+f.to_clean()+"'";if(f.external_app&&(g="'"+f.to_clean()+"'"),f.to==b.user_model?g=b.user_model_setting:c.built_in_models[f.to]&&(g=f.to_class()),c.pre_imported_modules_names().indexOf(f.module())==-1)d+=c.spaces(4)+f.name+" = "+f.class_name()+"("+g+", "+f.opts+")";else{var h=c.pre_imported_modules()[f.module()].as;d+=c.spaces(4)+f.name+" = "+h+"."+f.class_name()+"("+g+", "+f.opts+")"}d+=c.new_lines(1)}),d},this.render_model_class=function(a,b){var c=this.render_model_class_header(a,b);return c+=this.render_model_class_fields(a,b),c+=this.render_model_class_relationships(a,b),c+=b.new_lines(1),c+=b.spaces(4)+"class Meta:",c+=b.new_lines(1),c+=b.spaces(8)+"ordering = ('-"+this.ordering_field()+"',)",c+=b.new_lines(2),c+=b.spaces(4)+"def __unicode__(self):",c+=b.new_lines(1),c+=b.spaces(8)+"return u'%s' % self."+this.identifier(),c+=b.new_lines(2),c+=b.spaces(4)+"def get_absolute_url(self):",c+=b.new_lines(1),c+=b.spaces(8)+"return reverse('"+a+"_"+this.l_name()+"_detail', args=(self."+this.identifier()+",))",c+=b.new_lines(1),c+=b.new_lines(2),c+=b.spaces(4)+"def get_update_url(self):",c+=b.new_lines(1),c+=b.spaces(8)+"return reverse('"+a+"_"+this.l_name()+"_update', args=(self."+this.identifier()+",))",c+=b.new_lines(3)},this.render_model_class_fields_only=function(a,b){var c="";return c+=this.render_model_class_header(a,b),c+=this.render_model_class_fields(a,b)},this.render_model_api=function(a,b){var c="class "+this.name+"ViewSet(viewsets.ModelViewSet):"+b.new_lines(1);return c+=b.spaces(4)+'"""ViewSet for the '+this.name+' class"""',c+=b.new_lines(2),c+=b.spaces(4)+"queryset = models."+this.name+".objects.all()"+b.new_lines(1),c+=b.spaces(4)+"serializer_class = serializers."+this.name+"Serializer"+b.new_lines(1),c+=b.spaces(4)+"permission_classes = [permissions.IsAuthenticated]"+b.new_lines(1),c+=b.new_lines(2)},this.render_model_serializer=function(a,b){var c="class "+this.name+"Serializer(serializers.ModelSerializer):";c+=b.new_lines(2),c+=b.spaces(4)+"class Meta:"+b.new_lines(1),c+=b.spaces(8)+"model = models."+this.name+b.new_lines(1),c+=b.spaces(8)+"fields = ("+b.new_lines(1),c+=b.spaces(12)+"'"+this.identifier()+"', "+b.new_lines(1);var d=this;return jQuery.each(this.fields,function(a,e){e.name!=d.identifier()&&(c+=b.spaces(12)+"'"+e.name+"', "+b.new_lines(1))}),c+=b.spaces(8)+")"+b.new_lines(3)},this._template_header=function(){return'{% extends "base.html" %}\n{% load static %}\n'},this._template_links=function(a){var b=a+"_"+this.l_name()+"_list";return'<p><a class="btn btn-default" href="{% url \''+b+"' %}\">"+this.name+" Listing</a></p>\n"},this._wrap_block=function(a,b){return"{% block "+a+" %}\n"+b+"\n{% endblock %}"},this.render_form_html=function(a){var b=this._template_header();b+="{% load crispy_forms_tags %}\n";var c=this._template_links(a)+'<form method="post">\n';return c+="{% csrf_token %}\n{{form|crispy}}\n",c+='<button class="btn btn-primary" type="submit">Submit</button>\n',c+="</form>",b+=this._wrap_block("content",c)},this.render_list_html=function(a){var b=a+"_"+this.l_name()+"_create",c=this._template_header(),d=this._template_links(a)+'<table class="table">\n';return d+="<tr>\n",d+="<td>ID</td><td>Link</td>\n",jQuery.each(this.fields,function(a,b){d+="    <td>"+b.name+"</td>\n"}),d+="</tr>\n",d+="{% for object in object_list %}\n",d+="<tr>\n",d+="    <td>{{object.id}}</td>\n",d+='    <td><a href="{{object.get_absolute_url}}">{{object}}</a></td>\n',jQuery.each(this.fields,function(a,b){d+="    <td>{{ object."+b.name+" }}</td>\n"}),d+="</tr>\n",d+="{% endfor %}\n",d+="</table>",d+='<a class="btn btn-primary" href="{% url \''+b+"' %}\">Create new "+this.name+"</a>",c+=this._wrap_block("content",d)},this.render_detail_html=function(a){var b=this._template_header(),c=this._template_links(a)+'<table class="table">\n';return jQuery.each(this.fields,function(a,b){c+="<tr><td>"+b.name+"</td><td>{{ object."+b.name+" }}</td></tr>\n"}),c+="</table>",c+='\n<a class="btn btn-primary" href="{{object.get_update_url}}">Edit '+this.name+"</a>\n",b+=this._wrap_block("content",c)},this.form_fields=function(){var a=this.readable_fields().map(function(a){return a.name}),b=this.relationships.map(function(a){return a.name}),c=a.concat(b);return c.length?"['"+c.join("', '")+"']":"'__all__'"},this.readable_fields=function(){var a=[];return jQuery.each(this.fields,function(b,c){c.opts.indexOf("readonly")==-1&&c.opts.indexOf("editable")==-1&&c.opts.indexOf("auto_now_add")==-1&&"django.contrib.contenttypes.fields.GenericForeignKey"!=c.type&&"django_extensions.db.fields.AutoSlugField"!=c.type&&a.push(c)}),a},this.admin_fields=function(){return this.field_names().length>0?"['"+this.field_names().join("', '")+"']":""},this.admin_read_only_fields=function(){return this.field_names().length>0?"['"+this.field_names().join("', '")+"']":""}}return new c(a)}}function ModelParserFactory(){return function(a){function b(){this.parse=function(b,c){var d=new FileReader;d.onload=function(b){var e=d.result,f=e.split("\n"),g=[],h=null,i="",j=new RegExp("class ([a-zA-Z_]*)[(]([a-zA-Z._]*)[)][:]$"),k=new RegExp("^([a-zA-Z0-9_]+) = ([a-zA-Z0-9._]+)[(](.*)[)]$");jQuery.each(f,function(b,c){c=c.trim();var d=j.exec(c);d&&d[2].match(/model/i)&&(h={name:d[1],class:d[2],fields:[],relationships:[]},g.push(h),i="");var e,f=k.exec(c);f&&(e=f);var l=k.exec(i);if(l&&(e=l),e){if(h&&e[2]&&(e[2].match(/field/i)||a.relationship_factory.relationship_match(e[2]))){var m=a.relationship_factory.relationship_match(e[2]);if(m){var n=e[1],o=e[2],p=e[3].split(","),q=p.shift(),r=p.join(",").trim();console.log("Model:",h.name,"Relationship:",n,o,q,r),h.relationships.push(a.relationship_factory.make_relationship({name:n,type:o,opts:r,to:q}))}else{var s=e[1],t=e[2],u=e[3];console.log("Model:",h.name,"Field:",s,t,u),h.fields.push(a.field_factory.make_field({name:s,type:t,opts:u}))}}i=""}else h&&(i+=c)});var l=[];jQuery.each(g,function(b,c){var d=a.model_factory(c,a);l.push(d)}),c&&c(l)},d.readAsText(b)}}return new b}}function ProjectFactory(){return function(a){var b=this;b.http=a,b.settings_py="",b.urls_py="",b.wsgi_py="",b.manage_py="",b.http.get("partials/py/settings.py").then(function(a){b.settings_py=a.data}),b.http.get("partials/py/manage.py").then(function(a){b.manage_py=a.data}),b.http.get("partials/py/urls.py").then(function(a){b.urls_py=a.data}),b.http.get("partials/py/wsgi.py").then(function(a){b.wsgi_py=a.data}),b.replace_in_template=function(a,b){return jQuery.each(b,function(b,c){a=a.replace(new RegExp(c[0],"g"),c[1])}),a},b.render_project_requirements=function(){var a="Django==1.10.3\n";return a+="django-crispy-forms==1.6.1\n",a+="django-extensions==1.7.5\n",a+="djangorestframework==3.5.3\n"},b.render_project_manage_py=function(a){return b.replace_in_template(b.manage_py,[["___PROJECT_NAME___",a]])},b.render_project_settings_py=function(a,c){return b.replace_in_template(b.settings_py,[["___PROJECT_NAME___",a],["___APP_NAME___",c]])},b.render_project_wsgi_py=function(a){return b.replace_in_template(b.wsgi_py,[["___PROJECT_NAME___",a]])},b.render_project_urls_py=function(a){return b.replace_in_template(b.urls_py,[["___APP_NAME___",a]])}}}ace.define("ace/mode/python",["require","exports","module","ace/lib/oop","ace/mode/text","ace/tokenizer","ace/mode/python_highlight_rules","ace/mode/folding/pythonic","ace/range"],function(a,b,c){var d=a("../lib/oop"),e=a("./text").Mode,f=(a("../tokenizer").Tokenizer,a("./python_highlight_rules").PythonHighlightRules),g=a("./folding/pythonic").FoldMode,h=a("../range").Range,i=function(){this.HighlightRules=f,this.foldingRules=new g("\\:")};d.inherits(i,e),function(){this.lineCommentStart="#",this.getNextLineIndent=function(a,b,c){var d=this.$getIndent(b),e=this.getTokenizer().getLineTokens(b,a),f=e.tokens;if(f.length&&"comment"==f[f.length-1].type)return d;if("start"==a){var g=b.match(/^.*[\{\(\[\:]\s*$/);g&&(d+=c)}return d};var a={pass:1,return:1,raise:1,break:1,continue:1};this.checkOutdent=function(b,c,d){if("\r\n"!==d&&"\r"!==d&&"\n"!==d)return!1;var e=this.getTokenizer().getLineTokens(c.trim(),b).tokens;if(!e)return!1;do var f=e.pop();while(f&&("comment"==f.type||"text"==f.type&&f.value.match(/^\s+$/)));return!!f&&("keyword"==f.type&&a[f.value])},this.autoOutdent=function(a,b,c){c+=1;var d=this.$getIndent(b.getLine(c)),e=b.getTabString();d.slice(-e.length)==e&&b.remove(new h(c,d.length-e.length,c,d.length))},this.$id="ace/mode/python"}.call(i.prototype),b.Mode=i}),ace.define("ace/mode/python_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/text_highlight_rules"],function(a,b,c){var d=a("../lib/oop"),e=a("./text_highlight_rules").TextHighlightRules,f=function(){var a="and|as|assert|break|class|continue|def|del|elif|else|except|exec|finally|for|from|global|if|import|in|is|lambda|not|or|pass|print|raise|return|try|while|with|yield",b="True|False|None|NotImplemented|Ellipsis|__debug__",c="abs|divmod|input|open|staticmethod|all|enumerate|int|ord|str|any|eval|isinstance|pow|sum|basestring|execfile|issubclass|print|super|binfile|iter|property|tuple|bool|filter|len|range|type|bytearray|float|list|raw_input|unichr|callable|format|locals|reduce|unicode|chr|frozenset|long|reload|vars|classmethod|getattr|map|repr|xrange|cmp|globals|max|reversed|zip|compile|hasattr|memoryview|round|__import__|complex|hash|min|set|apply|delattr|help|next|setattr|buffer|dict|hex|object|slice|coerce|dir|id|oct|sorted|intern",d=this.createKeywordMapper({"invalid.deprecated":"debugger","support.function":c,"constant.language":b,keyword:a},"identifier"),e="(?:r|u|ur|R|U|UR|Ur|uR)?",f="(?:(?:[1-9]\\d*)|(?:0))",g="(?:0[oO]?[0-7]+)",h="(?:0[xX][\\dA-Fa-f]+)",i="(?:0[bB][01]+)",j="(?:"+f+"|"+g+"|"+h+"|"+i+")",k="(?:[eE][+-]?\\d+)",l="(?:\\.\\d+)",m="(?:\\d+)",n="(?:(?:"+m+"?"+l+")|(?:"+m+"\\.))",o="(?:(?:"+n+"|"+m+")"+k+")",p="(?:"+o+"|"+n+")",q="\\\\(x[0-9A-Fa-f]{2}|[0-7]{3}|[\\\\abfnrtv'\"]|U[0-9A-Fa-f]{8}|u[0-9A-Fa-f]{4})";this.$rules={start:[{token:"comment",regex:"#.*$"},{token:"string",regex:e+'"{3}',next:"qqstring3"},{token:"string",regex:e+'"(?=.)',next:"qqstring"},{token:"string",regex:e+"'{3}",next:"qstring3"},{token:"string",regex:e+"'(?=.)",next:"qstring"},{token:"constant.numeric",regex:"(?:"+p+"|\\d+)[jJ]\\b"},{token:"constant.numeric",regex:p},{token:"constant.numeric",regex:j+"[lL]\\b"},{token:"constant.numeric",regex:j+"\\b"},{token:d,regex:"[a-zA-Z_$][a-zA-Z0-9_$]*\\b"},{token:"keyword.operator",regex:"\\+|\\-|\\*|\\*\\*|\\/|\\/\\/|%|<<|>>|&|\\||\\^|~|<|>|<=|=>|==|!=|<>|="
},{token:"paren.lparen",regex:"[\\[\\(\\{]"},{token:"paren.rparen",regex:"[\\]\\)\\}]"},{token:"text",regex:"\\s+"}],qqstring3:[{token:"constant.language.escape",regex:q},{token:"string",regex:'"{3}',next:"start"},{defaultToken:"string"}],qstring3:[{token:"constant.language.escape",regex:q},{token:"string",regex:"'{3}",next:"start"},{defaultToken:"string"}],qqstring:[{token:"constant.language.escape",regex:q},{token:"string",regex:"\\\\$",next:"qqstring"},{token:"string",regex:'"|$',next:"start"},{defaultToken:"string"}],qstring:[{token:"constant.language.escape",regex:q},{token:"string",regex:"\\\\$",next:"qstring"},{token:"string",regex:"'|$",next:"start"},{defaultToken:"string"}]}};d.inherits(f,e),b.PythonHighlightRules=f}),ace.define("ace/mode/folding/pythonic",["require","exports","module","ace/lib/oop","ace/mode/folding/fold_mode"],function(a,b,c){var d=a("../../lib/oop"),e=a("./fold_mode").FoldMode,f=b.FoldMode=function(a){this.foldingStartMarker=new RegExp("([\\[{])(?:\\s*)$|("+a+")(?:\\s*)(?:#.*)?$")};d.inherits(f,e),function(){this.getFoldWidgetRange=function(a,b,c){var d=a.getLine(c),e=d.match(this.foldingStartMarker);if(e)return e[1]?this.openingBracketBlock(a,e[1],c,e.index):e[2]?this.indentationBlock(a,c,e.index+e[2].length):this.indentationBlock(a,c)}}.call(f.prototype)}),ace.define("ace/theme/dawn",["require","exports","module","ace/lib/dom"],function(a,b,c){b.isDark=!1,b.cssClass="ace-dawn",b.cssText=".ace-dawn .ace_gutter {background: #ebebeb;color: #333}.ace-dawn .ace_print-margin {width: 1px;background: #e8e8e8}.ace-dawn {background-color: #F9F9F9;color: #080808}.ace-dawn .ace_cursor {color: #000000}.ace-dawn .ace_marker-layer .ace_selection {background: rgba(39, 95, 255, 0.30)}.ace-dawn.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px #F9F9F9;border-radius: 2px}.ace-dawn .ace_marker-layer .ace_step {background: rgb(255, 255, 0)}.ace-dawn .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgba(75, 75, 126, 0.50)}.ace-dawn .ace_marker-layer .ace_active-line {background: rgba(36, 99, 180, 0.12)}.ace-dawn .ace_gutter-active-line {background-color : #dcdcdc}.ace-dawn .ace_marker-layer .ace_selected-word {border: 1px solid rgba(39, 95, 255, 0.30)}.ace-dawn .ace_invisible {color: rgba(75, 75, 126, 0.50)}.ace-dawn .ace_keyword,.ace-dawn .ace_meta {color: #794938}.ace-dawn .ace_constant,.ace-dawn .ace_constant.ace_character,.ace-dawn .ace_constant.ace_character.ace_escape,.ace-dawn .ace_constant.ace_other {color: #811F24}.ace-dawn .ace_invalid.ace_illegal {text-decoration: underline;font-style: italic;color: #F8F8F8;background-color: #B52A1D}.ace-dawn .ace_invalid.ace_deprecated {text-decoration: underline;font-style: italic;color: #B52A1D}.ace-dawn .ace_support {color: #691C97}.ace-dawn .ace_support.ace_constant {color: #B4371F}.ace-dawn .ace_fold {background-color: #794938;border-color: #080808}.ace-dawn .ace_list,.ace-dawn .ace_markup.ace_list,.ace-dawn .ace_support.ace_function {color: #693A17}.ace-dawn .ace_storage {font-style: italic;color: #A71D5D}.ace-dawn .ace_string {color: #0B6125}.ace-dawn .ace_string.ace_regexp {color: #CF5628}.ace-dawn .ace_comment {font-style: italic;color: #5A525F}.ace-dawn .ace_heading,.ace-dawn .ace_markup.ace_heading {color: #19356D}.ace-dawn .ace_variable {color: #234A97}.ace-dawn .ace_indent-guide {background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAEklEQVQImWNgYGBgYLh/5+x/AAizA4hxNNsZAAAAAElFTkSuQmCC) right repeat-y}";var d=a("../lib/dom");d.importCssString(b.cssText,b.cssClass)});var global=Function("return this;")();!function(a){function b(a){var b=g[a]||window[a];if(!b)throw new Error("Requested module '"+a+"' has not been defined.");return b}function c(a,b){return g[a]=b}function d(a,b){for(var c in b)"noConflict"!=c&&"_VERSION"!=c&&(a[c]=b[c]);return a}function e(a,b,c){return"string"==typeof a||a.nodeName||a.length&&"item"in a||a==window?(c=f._select(a,b),c.selector=a):c=isFinite(a.length)?a:[a],d(c,e)}function f(a,b){return e(a,b)}a.global=a;var g={},h=a.$;a.provide=c,a.require=b,d(f,{_VERSION:"0.3.6",fn:e,ender:function(a,b){d(b?e:f,a)},_select:function(a,b){return(b||document).querySelectorAll(a)}}),d(e,{forEach:function(a,b,c){for(c=0,l=this.length;c<l;++c)c in this&&a.call(b||this[c],this[c],c,this);return this},$:f}),f.noConflict=function(){return a.$=h,this},"undefined"!=typeof module&&module.exports&&(module.exports=f),a.ender=a.$=a.ender||f}(this),function(a){var b={exports:{}};b.exports,require("ender");!function(){"use strict";function a(a){var b,c=new Uint8Array(a);for(b=0;b<a;b+=1)c[b]=0;return c}function c(b,c,d,e){var f=c+d,g=a((parseInt(f/e)+1)*e);return g.set(b),g}function d(a,b,c){return a=a.toString(c||8),"000000000000".substr(a.length+12-b)+a}function e(b,c,d){var e,f;for(c=c||a(b.length),d=d||0,e=0,f=b.length;e<f;e+=1)c[d]=b.charCodeAt(e),d+=1;return c}function f(a){function b(a){return g[a>>18&63]+g[a>>12&63]+g[a>>6&63]+g[63&a]}var c,d,e,f=a.length%3,h="";for(c=0,e=a.length-f;c<e;c+=3)d=(a[c]<<16)+(a[c+1]<<8)+a[c+2],h+=b(d);switch(h.length%4){case 1:h+="=";break;case 2:h+="=="}return h}var g=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"];b.exports.clean=a,b.exports.pad=d,b.exports.extend=c,b.exports.stringToUint8=e,b.exports.uint8ToBase64=f}(),provide("tar-js/utils",b.exports)}(global),function(a){var b={exports:{}};b.exports,require("ender");!function(){"use strict";function a(a,b){var e=d.clean(512),f=0;return c.forEach(function(b){var c,d,g=a[b.field]||"";for(c=0,d=g.length;c<d;c+=1)e[f]=g.charCodeAt(c),f+=1;f+=b.length-c}),"function"==typeof b?b(e,f):e}var c,d=require("tar-js/utils");c=[{field:"fileName",length:100},{field:"fileMode",length:8},{field:"uid",length:8},{field:"gid",length:8},{field:"fileSize",length:12},{field:"mtime",length:12},{field:"checksum",length:8},{field:"type",length:1},{field:"linkName",length:100},{field:"ustar",length:8},{field:"owner",length:32},{field:"group",length:32},{field:"majorNumber",length:8},{field:"minorNumber",length:8},{field:"filenamePrefix",length:155},{field:"padding",length:12}],b.exports.structure=c,b.exports.format=a}(),provide("tar-js/header",b.exports)}(global),function(a){var b={exports:{}};b.exports,require("ender");!function(){"use strict";function a(a){this.written=0,c=(a||20)*f,this.out=e.clean(c)}var c,d=require("tar-js/header"),e=require("tar-js/utils"),f=512;a.prototype.append=function(a,b,g,h){var i,j,k,l,m,n,o;if("string"==typeof b)b=e.stringToUint8(b);else if(b.constructor!==Uint8Array.prototype.constructor)throw"Invalid input type. You gave me: "+b.constructor.toString().match(/function\s*([$A-Za-z_][0-9A-Za-z_]*)\s*\(/)[1];"function"==typeof g&&(h=g,g={}),g=g||{},k=g.mode||4095&parseInt("777",8),l=g.mtime||Math.floor(+new Date/1e3),m=g.uid||0,n=g.gid||0,i={fileName:a,fileMode:e.pad(k,7),uid:e.pad(m,7),gid:e.pad(n,7),fileSize:e.pad(b.length,11),mtime:e.pad(l,11),checksum:"        ",type:"0",ustar:"ustar  ",owner:g.owner||"",group:g.group||""},j=0,Object.keys(i).forEach(function(a){var b,c,d=i[a];for(b=0,c=d.length;b<c;b+=1)j+=d.charCodeAt(b)}),i.checksum=e.pad(j,6)+"\0 ",o=d.format(i);return this.out.set(o,this.written),this.written+=o.length,this.written+b.length>this.out.length&&(this.out=e.extend(this.out,this.written,b.length,c)),this.out.set(b,this.written),this.written+=b.length+(f-(b.length%f||f)),this.out.length-this.written<2*f&&(this.out=e.extend(this.out,this.written,2*f,c)),"function"==typeof h&&h(this.out),this.out},a.prototype.clear=function(){this.written=0,this.out=e.clean(c)},b.exports=a}(),provide("tar-js",b.exports)}(global),angular.module("ui.ace",[]).constant("uiAceConfig",{}).directive("uiAce",["uiAceConfig",function(a){if(angular.isUndefined(window.ace))throw new Error("ui-ace need ace to work... (o rly?)");var b=function(a,b,c){if(angular.isDefined(c.workerPath)){var d=window.ace.require("ace/config");d.set("workerPath",c.workerPath)}angular.isDefined(c.require)&&c.require.forEach(function(a){window.ace.require(a)}),angular.isDefined(c.showGutter)&&a.renderer.setShowGutter(c.showGutter),angular.isDefined(c.useWrapMode)&&b.setUseWrapMode(c.useWrapMode),angular.isDefined(c.showInvisibles)&&a.renderer.setShowInvisibles(c.showInvisibles),angular.isDefined(c.showIndentGuides)&&a.renderer.setDisplayIndentGuides(c.showIndentGuides),angular.isDefined(c.useSoftTabs)&&b.setUseSoftTabs(c.useSoftTabs),angular.isDefined(c.showPrintMargin)&&a.setShowPrintMargin(c.showPrintMargin),angular.isDefined(c.disableSearch)&&c.disableSearch&&a.commands.addCommands([{name:"unfind",bindKey:{win:"Ctrl-F",mac:"Command-F"},exec:function(){return!1},readOnly:!0}]),angular.isString(c.theme)&&a.setTheme("ace/theme/"+c.theme),angular.isString(c.mode)&&b.setMode("ace/mode/"+c.mode),angular.isDefined(c.firstLineNumber)&&(angular.isNumber(c.firstLineNumber)?b.setOption("firstLineNumber",c.firstLineNumber):angular.isFunction(c.firstLineNumber)&&b.setOption("firstLineNumber",c.firstLineNumber()));var e,f;if(angular.isDefined(c.advanced))for(e in c.advanced)f={name:e,value:c.advanced[e]},a.setOption(f.name,f.value);if(angular.isDefined(c.rendererOptions))for(e in c.rendererOptions)f={name:e,value:c.rendererOptions[e]},a.renderer.setOption(f.name,f.value);angular.forEach(c.callbacks,function(b){angular.isFunction(b)&&b(a)})};return{restrict:"EA",require:"?ngModel",link:function(c,d,e,f){var g,h,i=a.ace||{},j=angular.extend({},i,c.$eval(e.uiAce)),k=window.ace.edit(d[0]),l=k.getSession(),m=function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1);angular.isDefined(a)&&c.$evalAsync(function(){if(!angular.isFunction(a))throw new Error("ui-ace use a function as callback.");a(b)})},n={onChange:function(a){return function(b){var d=l.getValue();!f||d===f.$viewValue||c.$$phase||c.$root.$$phase||c.$evalAsync(function(){f.$setViewValue(d)}),m(a,b,k)}},onBlur:function(a){return function(){m(a,k)}}};e.$observe("readonly",function(a){k.setReadOnly(!!a||""===a)}),f&&(f.$formatters.push(function(a){if(angular.isUndefined(a)||null===a)return"";if(angular.isObject(a)||angular.isArray(a))throw new Error("ui-ace cannot use an object or an array as a model");return a}),f.$render=function(){l.setValue(f.$viewValue)});var o=function(a,d){a!==d&&(j=angular.extend({},i,c.$eval(e.uiAce)),j.callbacks=[j.onLoad],j.onLoad!==i.onLoad&&j.callbacks.unshift(i.onLoad),l.removeListener("change",g),g=n.onChange(j.onChange),l.on("change",g),k.removeListener("blur",h),h=n.onBlur(j.onBlur),k.on("blur",h),b(k,l,j))};c.$watch(e.uiAce,o,!0),o(i),d.on("$destroy",function(){k.session.$stopWorker(),k.destroy()}),c.$watch(function(){return[d[0].offsetWidth,d[0].offsetHeight]},function(){k.resize(),k.renderer.updateFull()},!0)}}}]),!function(a,b){var c=b.isDefined,d=b.isUndefined,e=b.isNumber,f=b.isObject,g=b.isArray,h=b.isString,i=b.extend,j=b.toJson;b.module("LocalStorageModule",[]).provider("localStorageService",function(){this.prefix="ls",this.storageType="localStorage",this.cookie={expiry:30,path:"/",secure:!1},this.defaultToCookie=!0,this.notify={setItem:!0,removeItem:!1},this.setPrefix=function(a){return this.prefix=a,this},this.setStorageType=function(a){return this.storageType=a,this},this.setDefaultToCookie=function(a){return this.defaultToCookie=!!a,this},this.setStorageCookie=function(a,b,c){return this.cookie.expiry=a,this.cookie.path=b,this.cookie.secure=c,this},this.setStorageCookieDomain=function(a){return this.cookie.domain=a,this},this.setNotify=function(a,b){return this.notify={setItem:a,removeItem:b},this},this.$get=["$rootScope","$window","$document","$parse","$timeout",function(a,b,k,l,m){function n(c){if(c||(c=b.event),s.setItem&&h(c.key)&&w(c.key)){var d=v(c.key);m(function(){a.$broadcast("LocalStorageModule.notification.changed",{key:d,newvalue:c.newValue,storageType:p.storageType})})}}var o,p=this,q=p.prefix,r=p.cookie,s=p.notify,t=p.storageType;k?k[0]&&(k=k[0]):k=document,"."!==q.substr(-1)&&(q=q?q+".":"");var u=function(a){return q+a},v=function(a){return a.replace(new RegExp("^"+q,"g"),"")},w=function(a){return 0===a.indexOf(q)},x=function(){try{var c=t in b&&null!==b[t],d=u("__"+Math.round(1e7*Math.random()));return c&&(o=b[t],o.setItem(d,""),o.removeItem(d)),c}catch(b){return p.defaultToCookie&&(t="cookie"),a.$broadcast("LocalStorageModule.notification.error",b.message),!1}},y=x(),z=function(b,c,e){if(K(e),c=d(c)?null:j(c),!y&&p.defaultToCookie||"cookie"===p.storageType)return y||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),s.setItem&&a.$broadcast("LocalStorageModule.notification.setitem",{key:b,newvalue:c,storageType:"cookie"}),F(b,c);try{o&&o.setItem(u(b),c),s.setItem&&a.$broadcast("LocalStorageModule.notification.setitem",{key:b,newvalue:c,storageType:p.storageType})}catch(d){return a.$broadcast("LocalStorageModule.notification.error",d.message),F(b,c)}return!0},A=function(b,c){if(K(c),!y&&p.defaultToCookie||"cookie"===p.storageType)return y||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),G(b);var d=o?o.getItem(u(b)):null;if(!d||"null"===d)return null;try{return JSON.parse(d)}catch(a){return d}},B=function(){var b=0;arguments.length>=1&&("localStorage"===arguments[arguments.length-1]||"sessionStorage"===arguments[arguments.length-1])&&(b=1,K(arguments[arguments.length-1]));var c,d;for(c=0;c<arguments.length-b;c++)if(d=arguments[c],!y&&p.defaultToCookie||"cookie"===p.storageType)y||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),s.removeItem&&a.$broadcast("LocalStorageModule.notification.removeitem",{key:d,storageType:"cookie"}),H(d);else try{o.removeItem(u(d)),s.removeItem&&a.$broadcast("LocalStorageModule.notification.removeitem",{key:d,storageType:p.storageType})}catch(b){a.$broadcast("LocalStorageModule.notification.error",b.message),H(d)}},C=function(b){if(K(b),!y)return a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),[];var c=q.length,d=[];for(var e in o)if(e.substr(0,c)===q)try{d.push(e.substr(c))}catch(b){return a.$broadcast("LocalStorageModule.notification.error",b.Description),[]}return d},D=function(b,c){K(c);var d=q?new RegExp("^"+q):new RegExp,e=b?new RegExp(b):new RegExp;if(!y&&p.defaultToCookie||"cookie"===p.storageType)return y||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),I();if(!y&&!p.defaultToCookie)return!1;var f=q.length;for(var g in o)if(d.test(g)&&e.test(g.substr(f)))try{B(g.substr(f))}catch(b){return a.$broadcast("LocalStorageModule.notification.error",b.message),I()}return!0},E=function(){try{return b.navigator.cookieEnabled||"cookie"in k&&(k.cookie.length>0||(k.cookie="test").indexOf.call(k.cookie,"test")>-1)}catch(b){return a.$broadcast("LocalStorageModule.notification.error",b.message),!1}}(),F=function(b,c,h,i){if(d(c))return!1;if((g(c)||f(c))&&(c=j(c)),!E)return a.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var l="",m=new Date,n="";if(null===c?(m.setTime(m.getTime()+-864e5),l="; expires="+m.toGMTString(),c=""):e(h)&&0!==h?(m.setTime(m.getTime()+24*h*60*60*1e3),l="; expires="+m.toGMTString()):0!==r.expiry&&(m.setTime(m.getTime()+24*r.expiry*60*60*1e3),l="; expires="+m.toGMTString()),b){var o="; path="+r.path;r.domain&&(n="; domain="+r.domain),"boolean"==typeof i?i===!0&&(n+="; secure"):r.secure===!0&&(n+="; secure"),k.cookie=u(b)+"="+encodeURIComponent(c)+l+o+n}}catch(b){return a.$broadcast("LocalStorageModule.notification.error",b.message),!1}return!0},G=function(b){if(!E)return a.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var c=k.cookie&&k.cookie.split(";")||[],d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(u(b)+"=")){var f=decodeURIComponent(e.substring(q.length+b.length+1,e.length));try{return JSON.parse(f)}catch(a){return f}}}return null},H=function(a){F(a,null)},I=function(){for(var a=null,b=q.length,c=k.cookie.split(";"),d=0;d<c.length;d++){for(a=c[d];" "===a.charAt(0);)a=a.substring(1,a.length);var e=a.substring(b,a.indexOf("="));H(e)}},J=function(){return t},K=function(a){return a&&t!==a&&(t=a,y=x()),y},L=function(a,b,d,e,g){e=e||b;var h=A(e,g);return null===h&&c(d)?h=d:f(h)&&f(d)&&(h=i(h,d)),l(b).assign(a,h),a.$watch(b,function(a){z(e,a,g)},f(a[b]))};y&&(b.addEventListener?(b.addEventListener("storage",n,!1),a.$on("$destroy",function(){b.removeEventListener("storage",n)})):b.attachEvent&&(b.attachEvent("onstorage",n),a.$on("$destroy",function(){b.detachEvent("onstorage",n)})));var M=function(a){K(a);for(var c=0,d=b[t],e=0;e<d.length;e++)0===d.key(e).indexOf(q)&&c++;return c};return{isSupported:y,getStorageType:J,setStorageType:K,set:z,add:z,get:A,keys:C,remove:B,clearAll:D,bind:L,deriveKey:u,underiveKey:v,length:M,defaultToCookie:this.defaultToCookie,cookie:{isSupported:E,set:F,add:F,get:G,remove:H,clearAll:I}}}]})}(window,window.angular),angular.module("builder",["ngRoute","builder.filters","builder.services","builder.directives","builder.controllers","LocalStorageModule","ui.ace","angulartics","angulartics.google.analytics"]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/models",{templateUrl:"partials/models.html",controller:"ModelController"}),a.when("/home",{templateUrl:"partials/home.html",controller:"ModelController"}),a.otherwise({redirectTo:"/home"})}]),angular.module("builder.controllers",["LocalStorageModule"]).controller("ModelController",["$scope","$http","ProjectFactory","ModelFactory","ModelParser","FieldFactory","RelationshipFactory","localStorageService","MessageService","RenderFactory","TarballFactory",function(a,b,c,d,e,f,g,h,i,j,k){a.models=[],a.new_models=[],a.user_model="django.contrib.auth.models.User",a.user_model_setting="settings.AUTH_USER_MODEL",a.built_in_models={"django.contrib.auth.models.User":{fields:{username:{default:"username"},email:{default:"username@tempurl.com"}}},"django.contrib.auth.models.Group":{fields:{name:{default:"group"}}},"django.contrib.contenttypes.models.ContentType":{fields:{}}},a.messageService=new i,a.localStorageService=h,a.field_factory=new f,a.project_factory=new c(b),a.model_factory=d,a.relationship_factory=new g,a.render_factory=new j(a.built_in_models),a.editors=[],a.models_storage_key="local_models",a._app_name="app_name",a._project_name="project_name",a.create_tar_ball_url=function(b){var c="Built with django_builder\n",d="#";const e=a.project_name(),f=a.app_name();var g=a.render_factory.render_models_py(f,a.models),h=a.render_factory.render_views_py(f,a.models),i=a.render_factory.render_admin_py(f,a.models),j=a.render_factory.render_urls_py(f,a.models),l=a.render_factory.render_tests_py(f,a.models),m=a.render_factory.render_forms_py(f,a.models),n=a.render_factory.render_django_rest_framework_api_py(f,a.models),o=a.render_factory.render_django_rest_framework_serializers_py(f,a.models),p=a.render_factory.render_templates_html(f,a.models),q=new k,r=f;if(b){r=e+"/"+f;var s=a.project_factory.render_project_requirements(),t=a.project_factory.render_project_settings_py(e,f),u=a.project_factory.render_project_urls_py(f),v=a.project_factory.render_project_manage_py(e),w=a.project_factory.render_project_wsgi_py(e);q.append("requirements.txt",s),q.append(e+"/manage.py",v),q.append(e+"/"+e+"/settings.py",t),q.append(e+"/"+e+"/urls.py",u),q.append(e+"/"+e+"/wsgi.py",w),q.append(e+"/"+e+"/__init__.py",d)}return q.append(r+"/README.txt",c),q.append(r+"/__init__.py",d),q.append(r+"/models.py",g),q.append(r+"/views.py",h),q.append(r+"/admin.py",i),q.append(r+"/urls.py",j),q.append(r+"/tests.py",l),q.append(r+"/forms.py",m),q.append(r+"/api.py",n),q.append(r+"/serializers.py",o),q.append(r+"/templates/base.html",a.render_factory.render_base_html(f,a.models)),jQuery.each(p,function(a,b){q.append(r+"/templates/"+f+"/"+b[0],b[1])}),q.get_url()},a.create_download_modal_app=function(){var b=a.create_tar_ball_url(!1),c=a.app_name()+".tar",d="django_builder_download_app_modal";return a.create_download_modal(b,c,d)},a.create_download_modal_project=function(){var b=a.create_tar_ball_url(!0),c=a.project_name()+".tar",d=jQuery("<p>");d.text("The project download includes the following files:");var e=jQuery("<div>").addClass("well well-sm");e.append(jQuery("<p>").text("requirements.txt")),e.append(jQuery("<p>").text("manage.py")),e.append(jQuery("<p>").text(a.project_name()+"/settings.py")),e.append(jQuery("<p>").text(a.project_name()+"/urls.py")),e.append(jQuery("<p>").text(a.project_name()+"/wsgi.py")),d.append(jQuery("<br><br>")),d.append(e);var f="django_builder_download_project_modal";return a.create_download_modal(b,c,f,d)},a.create_download_modal=function(b,c,d,e){var f=jQuery("<a>").attr("href",b).attr("id","django_builder_download_a");f.addClass("btn btn-success btn-lg").css("text-transform","none"),f.text("Click here to download "+c),f.attr("download",c);var g=jQuery("<div>").addClass("text-center").append(f),h=jQuery("<div>");h.append(jQuery("<br>")),h.append("Chrome can block downloads of the generated tarball, if this happens navigate to the "),h.append(jQuery("<strong>").text("Downloads")),h.append(" section of chrome to accept the download"),h.append(jQuery("<br>")),h.append("Window -> Downloads");var i=jQuery("<div>");return void 0!=e&&i.append(e),i.append(g),i.append(h),a.messageService.simple_info("Download info",i).modal("show").attr("id",d),d},a.render_model_class_fields_only=function(b){return b.render_model_class_fields_only(a._app_name,a.render_factory)},a.upload_input=function(){return jQuery('<input type="file" />')},a.upload_drop_target=function(a){var b=jQuery("<div>").addClass("builder_dnd_target text-center"),c=jQuery("<i>").addClass("fa fa-upload fa-4x builder_dnd_icon");return b.append(jQuery("<div>").text("Drag and Drop files here!")),b.append(c),b},a.upload_form=function(a,b){var c=jQuery("<form>"),d=jQuery("<span>").addClass("btn btn-default btn-file center-block builder_upload_models_py");return d.append("Browse"),d.append(a),c.append(d),c.append(b),c},a.save_new_models=function(b){a.new_models=[],a.models=b,a.saveApp(),a.$apply()},a.merge_models=function(){for(var b=a.models.concat(a.new_models),c=0;c<b.length;++c)for(var d=c+1;d<b.length;++d)b[c].name===b[d].name&&b.splice(d--,1);return a.save_new_models(b)},a.add_unique=function(){jQuery.each(a.new_models,function(b,c){a.existingModel(c.name)||a.models.push(c)}),a.save_new_models(a.models)},a.add_new_models=function(b){a.new_models=b,a.$apply();var c=function(){console.log("Overwriting existing models"),a.merge_models()},d=function(){var b=!1,d=[],e=jQuery("<p>").text("The following models are duplicates:");jQuery.each(a.new_models,function(c,f){a.existingModel(f.name)&&(b=!0,d.push(f),e.append(jQuery("<div>").text(f.name)))});var f=d.length==a.new_models.length;if(b){var g=[{text:"Overwrite existing models",callback:c}];f||g.push({text:"Add unique",callback:a.add_unique}),g.push({text:"Cancel",callback:function(){}});var h="duplicate_models";a.messageService.simple_choice("Add duplicate models?",e,g).modal("show").attr("id",h)}else a.merge_models()},e=jQuery("<div>");jQuery.each(a.new_models,function(b,c){e.append(jQuery("<hr>")),e.append(jQuery("<pre>").html(c.render_model_class_fields_only(a._app_name,a.render_factory)));var d=jQuery('<button class="btn btn-danger pull-right">').text("Remove");e.append(d),e.append(jQuery("<div>").addClass("clearfix"))});var f="add_new_models";return a.messageService.simple_confirm("Add the following models?",jQuery("#builder_new_models"),d).modal("show").find(".modal-dialog").css("width","50%").attr("id",f),f},a.ERR_PROCESS_MODELS_PY_NO_FILE="You didn't seem to choose any files.",a.ERR_PROCESS_MODELS_PY_MULTIPLE_FILES="Multiple files not yet supported, please choose a single file.",a.process_models_py=function(b){if(0==b.length)return a.messageService.simple_error("Sorry",a.ERR_PROCESS_MODELS_PY_NO_FILE).modal("show"),!1;if(b.length>1)return a.messageService.simple_error("Sorry",a.ERR_PROCESS_MODELS_PY_MULTIPLE_FILES).modal("show"),!1;var c=e(a);return c.parse(b[0],function(b){a.add_new_models(b)}),!0},a.upload_models_py=function(){var b=a.upload_input(),c=a.upload_drop_target(),d=a.upload_form(b,c),e=a.messageService.simple_form("Upload models.py","Choose a models.py file to analyse",d,function(){a.process_models_py(jQuery(b)[0].files),e.modal("hide")}).modal("show");b.change(function(){a.process_models_py(jQuery(b)[0].files),e.modal("hide")}),d.on("drag dragstart dragend dragover dragenter dragleave drop",function(a){a.preventDefault(),a.stopPropagation()}).on("dragover dragenter",function(){c.addClass("is-drag-over")}).on("dragleave dragend drop",function(){c.removeClass("is-drag-over")}).on("drop",function(b){var c=b.originalEvent.dataTransfer.files;e.modal("hide"),a.process_models_py(c)})},jQuery("html body").on("drag dragstart dragend dragover dragenter dragleave drop",function(a){a.preventDefault(),a.stopPropagation()}).on("dragover dragenter",function(){}).on("drop",function(a){}),jQuery("#builder_models_content").on("drag dragstart dragend dragover dragenter dragleave drop",function(a){a.preventDefault(),a.stopPropagation()}).on("dragover dragenter",function(){jQuery(".builder_dnd_target").addClass("is-drag-over")}).on("drop",function(b){jQuery(".builder_dnd_target").removeClass("is-drag-over");var c=b.originalEvent.dataTransfer.files;a.process_models_py(c)}),a.aceLoad=function(b){var c=jQuery(b.container).attr("id");"builder_models"==c?b.setValue(a.render_factory.render_models_py(a.app_name(),a.models)):"builder_views"==c?b.setValue(a.render_factory.render_views_py(a.app_name(),a.models)):"builder_admin"==c?b.setValue(a.render_factory.render_admin_py(a.app_name(),a.models)):"builder_urls"==c?b.setValue(a.render_factory.render_urls_py(a.app_name(),a.models)):"builder_tests"==c?b.setValue(a.render_factory.render_tests_py(a.app_name(),a.models)):"builder_forms"==c?b.setValue(a.render_factory.render_forms_py(a.app_name(),a.models)):"builder_django_rest_framework_api"==c?b.setValue(a.render_factory.render_django_rest_framework_api_py(a.app_name(),a.models)):"builder_django_rest_framework_serializers"==c&&b.setValue(a.render_factory.render_django_rest_framework_serializers_py(a.app_name(),a.models)),b.session.selection.clearSelection()},a.reLoadAce=function(){Object.keys(a.editors).map(function(b){a.aceLoad(a.editors[b])})},a.aceLoaded=function(b){b.setOptions({readOnly:!0,highlightActiveLine:!1,highlightGutterLine:!1,maxLines:1/0}),b.renderer.$cursorLayer.element.style.opacity=0,a.aceLoad(b),a.editors.push(b)},a.$watch("[models,_app_name,_project_name]",function(){a.reLoadAce(),a.saveApp()},!0),a.aceChanged=function(a){},a.do_set_app_name=function(b){a._app_name=b},a.set_app_name=function(){a.do_set_app_name(jQuery("input#appname").val()),a.reLoadAce()},a.do_set_project_name=function(b){a._project_name=b},a.set_project_name=function(){a.do_set_project_name(jQuery("input#projectname").val()),a.reLoadAce()},a.l_app_name=function(){return a._app_name.toLowerCase()},a.app_name=function(){return a._app_name.replace(new RegExp(" ","g"),"_")},a.l_project_name=function(){return a._project_name.toLowerCase()},a.project_name=function(){return a._project_name.replace(new RegExp(" ","g"),"_")},a.updateModel=function(b){var c=a.models.indexOf(b);a.models[c]=b,a.$apply()},a.serializeApp=function(){var b={models:a.models,app_config:{app_name:a._app_name,project_name:a._project_name}};return JSON.stringify(b)},a.saveApp=function(){h.set(a.models_storage_key,a.serializeApp())},a.doClearModels=function(){h.set(a.models_storage_key,""),a.loadModels(),a.models=[],a.$apply()},a.clearModels=function(){var b=function(){a.doClearModels()},c="clear_all";return a.messageService.simple_confirm("Confirm","Remove all models?",b).modal("show").attr("id",c),c},a.model_count=function(){return a.models.length},a.add_model=function(b){var c={name:b};c.fields=[a.field_factory.make_field({name:"name",type:"django.db.models.CharField",opts:"max_length=255"}),a.field_factory.make_field({name:"slug",type:"django_extensions.db.fields.AutoSlugField",opts:"populate_from='name', blank=True"}),a.field_factory.make_field({name:"created",type:"django.db.models.DateTimeField",opts:"auto_now_add=True, editable=False"}),a.field_factory.make_field({name:"last_updated",type:"django.db.models.DateTimeField",opts:"auto_now=True, editable=False"})];var e=d(c,a);a.models.push(e),a.saveApp(),a.$apply()},a.existingModel=function(b){var c=!1;return jQuery.each(a.models,function(a,d){b==d.name&&(c=!0)}),c},a.addModel=function(){var b=function(b){void 0==b||""===b?a.messageService.simple_info("Model Name Required","Enter a Model name").modal("show"):a.existingModel(b)?a.messageService.simple_error("Error with Model Name","There is already a model with the name "+b).modal("show"):a.add_model(b)},c="add_model";return a.messageService.simple_input("Model Name Required","Enter a Model name","Model1",b,!0).modal("show").attr("id",c),c},a.cleanModel=function(a){delete a.$$hashKey,void 0!=a.fields&&jQuery.each(a.fields,function(a,b){delete b.$$hashKey}),void 0!=a.relationships&&jQuery.each(a.relationships,function(a,b){delete b.$$hashKey})},a.loadModels=function(){const b={app_name:"app_name",project_name:"project_name"};var c=h.get(a.models_storage_key)||{models:[],app_config:b};"string"==typeof c&&(c=JSON.parse(c));var d=c.models||[],e=c.app_config||{app_name:"app_name",project_name:"project_name"};return a._app_name=e.app_name,a._project_name=e.project_name,jQuery.each(d,function(b,c){a.cleanModel(c)}),d},a.loadModel=function(b){var c=d(b,a);a.models.push(c)},a.__init__=function(){jQuery.each(a.loadModels(),function(b,c){a.loadModel(c)})},a.__init__(),a.debug=function(){},a.do_rename_model=function(b,c){var d="rename_model_existing",e=a.models[b];if(a.existingModel(c)){a.messageService.simple_error("Error with Model Name","There is already a model with the name "+c).modal("show").attr("id",d);return!1}return e.set_name(c),a.updateModel(e),a.$apply(),!0},a.rename_model=function(b,c){var d=a.models[b],e="rename_model",f=function(c){a.do_rename_model(b,c)};return a.messageService.simple_input("Rename model","Enter a new Model name",d.name,f,!0).modal("show").attr("id",e),e},a.add_relationship=function(b){const c=a.models[b],d=function(b){var d=b.find("input[name=name]").val().trim(),e=b.find("select[name=to]").val().trim(),f=!0;if(jQuery.each(a.built_in_models,function(a,b){e==a&&(f=!1)}),jQuery.each(a.models,function(a,b){e==b.name&&(f=!1)}),b.find("div.form-group-name").removeClass("has-error"),b.find("div.form-group-to").removeClass("has-error"),void 0===d||""===d)b.find("div.form-group-name").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text("Field Required");else if(void 0===e||""===e)b.find("div.form-group-to").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text("Field Required");else if(c.has_relationship(d))b.find("div.form-group-name").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text('Field "'+d+'" exists');else{var g=b.find("select[name=type]").val(),h=b.find("input[name=opts]").val(),i=a.relationship_factory.make_relationship({name:d,type:g,opts:h,to:e,external_app:f});c.relationships.push(i),a.updateModel(c),a.$apply(),jQuery(".modal").modal("hide")}},e=jQuery("<form>"),f=jQuery("<div>").addClass("form-group form-group-name has-feedback").appendTo(e),g=jQuery("<div>").addClass("form-group form-group-to").appendTo(e),h=jQuery("<div>").addClass("form-group form-group-type").appendTo(e),i=jQuery("<div>").addClass("form-group form-group-args").appendTo(e);
f.append(jQuery("<label>").text("Name")),f.append(jQuery("<input>").attr("name","name").addClass("form-control")),f.append(jQuery("<span>").text("error message").addClass("help-block hide"));const j=jQuery("<select>").attr("name","to").addClass("form-control"),k=jQuery("<optgroup>").attr("label","Django models");jQuery.each(a.built_in_models,function(a,b){k.append(jQuery("<option>").attr("val",a).text(a))}),j.append(k);const l=jQuery("<optgroup>").attr("label","Your App models");jQuery.each(a.models,function(a,b){l.append(jQuery("<option>").attr("val",b.name).text(b.name))}),j.append(l),g.append(jQuery("<label>").text("Relationship to Model")),g.append(j),g.append(jQuery("<p>").addClass("text-primary small clearfix").text("You can add external models (otherapp.models.Model1)").css("margin","4px"));const m=jQuery("<select>").attr("name","type");jQuery.each(a.relationship_factory.relationship_types(),function(a,b){m.append(jQuery("<option>").attr("val",b).text(b))}),h.append(jQuery("<label>").text("Relationship Type")),h.append(m),i.append(jQuery("<label>").text("Arguments")),i.append(jQuery("<input>").attr("name","opts").attr("placeholder","options").addClass("form-control")),j.select2({theme:"bootstrap",allowClear:!0,placeholder:"Select a model.",tags:!0,selectOnClose:!0}),m.select2({theme:"bootstrap"});const n="add_rel_"+c.name+"_"+b;return a.messageService.simple_form_no_dismiss("Add Relationship","",e,d).modal("show").attr("id",n).appendTo("body"),n},a.add_field=function(b){var c=a.models[b],d=function(b){var d=b.find("input[name=name]").val();if(void 0===d||""===d)b.find("div.form-group-name").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text("Field Required");else if(c.has_field(d))b.find("div.form-group-name").addClass("has-error").append(jQuery("<i>").addClass("fa fa-times form-control-feedback")).find(".help-block").removeClass("hide").text('Field "'+d+'" exists');else{var e=b.find("select[name=type]").val(),f=b.find("input[name=opts]").val(),g=a.field_factory.make_field({name:d,type:e,opts:f});c.fields.push(g),a.updateModel(c),a.$apply(),jQuery(".modal").modal("hide")}},e=jQuery("<form>"),f=jQuery("<div>").addClass("form-group form-group-name  has-feedback").appendTo(e),g=jQuery("<div>").addClass("form-group form-group-type").appendTo(e),h=jQuery("<div>").addClass("form-group form-group-args").appendTo(e);f.append(jQuery("<label>").text("Name")),f.append(jQuery("<input>").attr("name","name").addClass("form-control")),f.append(jQuery("<span>").text("error message").addClass("help-block hide"));var i=jQuery("<select>").attr("name","type").addClass("form-control");jQuery.each(a.field_factory.field_types(),function(a,b){i.append(jQuery("<option>").attr("val",b).text(b))});var j=jQuery("<input>").attr("name","opts").attr("placeholder","options").addClass("form-control");g.append(jQuery("<label>").text("Field Type")),g.append(i),h.append(jQuery("<label>").text("Arguments")),h.append(j),i.change(function(){j.val(a.field_factory.default_field_args(i.val()))}),j.val(a.field_factory.default_field_args(i.val()));var k="add_field_"+c.name+"_"+b;return a.messageService.simple_form_no_dismiss("Add Field","",e,d).modal("show").attr("id",k).appendTo("body"),k},a.edit_relationship=function(b,c){var d=a.models[b].relationships[c],e=function(b){d.form_update(b),a.$apply(),jQuery(".modal").modal("hide")},f=d.$$hashKey||"edit_relationship_"+d.name;return a.messageService.simple_form("Edit Relationship '"+d.name+"'","",d.edit_form(a),e).modal("show").attr("id",f).appendTo("body"),f},a.edit_field=function(b,c){var d=a.models[b].fields[c],e=function(b){d.form_update(b),a.$apply(),jQuery(".modal").modal("hide")},f=d.$$hashKey||"edit_field_"+d.name;return a.messageService.simple_form("Edit field '"+d.name+"'","",d.edit_form(a),e).modal("show").attr("id",f).appendTo("body"),f},a.do_remove_new_model=function(b){a.new_models.splice(b,1),a.$apply()},a.remove_new_model=function(b){setTimeout(function(){a.do_remove_new_model(b)})},a.remove_relationship=function(b,c){var d=function(){a.models[b].relationships.splice(c,1),a.$apply()},e=a.models[b].relationships[c],f=e.$$hashKey||"remove_relationship_"+e.name;return a.messageService.simple_confirm("Confirm","Remove the relationship '"+e.name+"'",d).modal("show").attr("id",f).appendTo("body"),f},a.do_remove_new_relationship=function(b,c){a.new_models[b].relationships.splice(c,1)},a.remove_new_relationship=function(b,c){setTimeout(function(){a.do_remove_new_relationship(b,c)})},a.do_remove_new_field=function(b,c){a.new_models[b].fields.splice(c,1),a.$apply()},a.remove_new_field=function(b,c){setTimeout(function(){a.do_remove_new_field(b,c)})},a.remove_field=function(b,c){var d=function(){a.models[b].fields.splice(c,1),a.$apply()},e=a.models[b].fields[c],f=e.$$hashKey||"remove_field_"+e.name;return a.messageService.simple_confirm("Confirm","Remove the field '"+e.name+"'",d).modal("show").attr("id",f).appendTo("body"),f},a.remove_model=function(b){var c=function(){a.models.splice(b,1),a.$apply()},d=a.models[b],e=d.$$hashKey||"remove_model_"+d.name;return a.messageService.simple_confirm("Confirm","Remove the model '"+d.name+"'",c).modal("show").modal("show").attr("id",e).appendTo("body"),e},a.model_highlight=function(b,c){var d=a.models[b].relationships[c];jQuery(".builder_model_"+d.to_clean()).addClass("builder_model_highlight")},a.model_unhighlight=function(){jQuery(".builder_model").removeClass("builder_model_highlight")},a.new_model_highlight=function(b,c){var d=a.new_models[b].relationships[c];jQuery(".builder_model_"+d.to_clean()).addClass("builder_model_highlight")},a.new_model_unhighlight=function(){jQuery(".builder_model").removeClass("builder_model_highlight")}}]),angular.module("builder.directives",[]).directive("appVersion",["version",function(a){return function(b,c,d){c.text(a)}}]),angular.module("builder.filters",[]).filter("interpolate",["version",function(a){return function(b){return String(b).replace(/\%VERSION\%/gm,a)}}]),angular.module("builder.services",[]).factory("ProjectFactory",[ProjectFactory]).factory("ModelFactory",[ModelServiceFactory]).factory("ModelParser",[ModelParserFactory]).factory("MessageService",[MessageServiceFactory]).factory("FieldFactory",[FieldFactory]).factory("RelationshipFactory",[RelationshipFactory]).factory("RenderFactory",[ModelRenderFactory]).factory("TarballFactory",[TarballFactory]).value("version","0.1");
>>>>>>> Adding Download Project text
